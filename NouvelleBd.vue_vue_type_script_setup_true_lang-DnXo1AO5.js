import{d as me,p as fe,ம as be,e0 as pe,u as Ce,n as ge,r,q as f,s as L,v as E,c as h,a as O,x as xe,w as s,b as t,V as _e,h as i,i as Be,e as Ve,z as W,t as j,at as Ne,f as z,m as we,T as he,W as d,X as Oe,M as A,bG as F,am as $,e1 as H,e2 as De,F as J,ac as ke,ax as X,ef as K,ad as ye,j as Se,R as Te,ao as Le,bs as je,y as Ae,bt as $e,H as Ge,I as Ie,J as Pe}from"./index-BRylzrLF.js";import{_ as Re}from"./ChoisirStatut.vue_vue_type_script_setup_true_lang-WEtC4pXJ.js";import{c as Ue}from"./SélecteurNuée.vue_vue_type_script_setup_true_lang-DM3ruw2h.js";const qe={class:"text-center"},Fe=me({__name:"NouvelleBd",emits:["nouvelle"],setup(Me,{emit:Q}){const Y=Q,c=fe(),{$மொ:u}=be(),Z=pe(),{isRtl:D}=Ce(),{mdAndUp:ee}=ge(),k=r(!1),o=r(0),l=["cheminement","gabaritBd","gabaritNuée","noms","descriptions","motsClefs","licence","licenceContenu","statut","confirmation"],te=f(()=>{switch(l[o.value]){case"cheminement":return"bds.nouvelle.titreCheminement";case"gabaritBd":return"bds.nouvelle.titreGabaritBd";case"gabaritNuée":return"bds.nouvelle.titreGabaritNuée";case"noms":return"bds.nouvelle.titreNoms";case"descriptions":return"bds.nouvelle.titreDescriptions";case"motsClefs":return"bds.nouvelle.titreMotsClefs";case"licence":return"bds.nouvelle.titreLicence";case"licenceContenu":return"bds.nouvelle.titreLicenceContenu";case"statut":return"bds.nouvelle.titreStatut";case"confirmation":return"bds.nouvelle.titreConfirmation";default:return""}}),ne=f(()=>{switch(l[o.value]){case"cheminement":return"bds.nouvelle.sousTitreCheminement";case"gabaritBd":return"bds.nouvelle.sousTitreGabaritBd";case"gabaritNuée":return"bds.nouvelle.sousTitreGabaritNuée";case"noms":return"bds.nouvelle.sousTitreNoms";case"descriptions":return"bds.nouvelle.sousTitreDescriptions";case"motsClefs":return"bds.nouvelle.sousTitreMotsClefs";case"licence":return"bds.nouvelle.sousTitreLicence";case"licenceContenu":return"bds.nouvelle.sousTitreLicenceContenu";case"statut":return"bds.nouvelle.sousTitreStatut";case"confirmation":return"bds.nouvelle.sousTitreConfirmation";default:return""}}),b=r(),G=n=>{b.value=n,o.value=l.indexOf(n==="bd"?"gabaritBd":"gabaritNuée")},ae=()=>{b.value="nouvelle",o.value=l.indexOf("noms")},ie=()=>{switch(l[o.value]){case"gabaritBd":case"gabaritNuée":o.value=l.indexOf("licence");break;case"licence":o.value=l.indexOf(N.value?"statut":"licenceContenu");break;default:o.value++;break}},le=()=>{switch(l[o.value]){case"gabaritBd":case"gabaritNuée":case"noms":o.value=l.indexOf("cheminement");break;case"licence":o.value=l.indexOf(b.value==="bd"?"gabaritBd":b.value==="nuée"?"gabaritNuée":"motsClefs");break;case"statut":o.value=l.indexOf(N.value?"licence":"licenceContenu");break;default:o.value--;break}},I=f(()=>{switch(l[o.value]){case"cheminement":return{actif:!1,visible:!1};case"gabaritBd":return{actif:!!p.value,visible:!0};case"gabaritNuée":return{actif:!!x.value,visible:!0};case"noms":return{actif:Object.keys(C.value).length>0,visible:!0};case"licence":return{actif:!!v.value,visible:!0};case"licenceContenu":return{actif:!!m.value,visible:!0};case"confirmation":return{actif:!1,visible:!1};default:return{actif:!0,visible:!0}}}),P=f(()=>{switch(l[o.value]){case"cheminement":return{actif:!1,visible:!1};case"confirmation":return{actif:!w.value,visible:!0};default:return{actif:!0,visible:!0}}}),x=r(),p=r(),se=async n=>{p.value=n},ue=async n=>{const e=await c.nuées.générerSchémaBdNuée({idNuée:n,licence:"ODbl-1_0"});e&&(x.value=e,v.value=e.licence,m.value=e.licenceContenu)},_=r(!0),C=r({}),oe=n=>{C.value=n},B=r({}),re=n=>{B.value=n},V=r([]),R=L(c.licences.suivreLicences),v=r(),N=r(!0),m=r(),y=L(c.bds.suivreLicenceBd,{idBd:p}),g=f(()=>y.value&&R.value?.[y.value]?.conditions.includes("partageÉgal"));E(()=>{g.value&&(v.value=y.value)});const S=L(c.bds.suivreLicenceContenuBd,{idBd:p}),U=f(()=>S.value&&R.value?.[S.value]?.conditions.includes("partageÉgal"));E(()=>{U.value&&(m.value=S.value)});const q=r({statut:"active"}),M=f(()=>{if(v.value)return{licenceChoisie:v.value}}),T=r(!0),w=r(!1),ce=async()=>{w.value=!0;let n;if(b.value==="nouvelle"){if(!M.value)return;const{licenceChoisie:e}=M.value;if(n=await c.bds.créerBd({licence:e,licenceContenu:m.value}),!n)throw new Error("Bd non créée.");await c.bds.sauvegarderNomsBd({idBd:n,noms:Object.fromEntries(Object.entries(C.value))}),await c.bds.sauvegarderDescriptionsBd({idBd:n,descriptions:Object.fromEntries(Object.entries(B.value))}),await c.bds.ajouterMotsClefsBd({idBd:n,idsMotsClefs:V.value})}else if(b.value==="nuée"){if(!x.value)return;n=await c.bds.créerBdDeSchéma({schéma:x.value})}else{if(!p.value)return;n=await c.bds.copierBd({idBd:p.value,copierDonnées:_.value})}await c.bds.changerStatutBd({idBd:n,statut:q.value}),Y("nouvelle",n),de(),T.value&&Z.push(encodeURI(`/données/bd/${encodeURIComponent(n)}`))},de=()=>{C.value={},B.value={},v.value=void 0,m.value=void 0,V.value=[],o.value=0,w.value=!1,k.value=!1};return(n,e)=>(O(),h(xe,{modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=a=>k.value=a)},{activator:s(({props:a})=>[Ge(n.$slots,"activator",Ie(Pe({props:a})))]),default:s(()=>[t(_e,{class:"mx-auto","min-width":i(ee)?750:300},{default:s(()=>[t(Be,null,{default:s(()=>[t(Ve,{class:"text-h5 justify-space-between"},{default:s(()=>[W("span",null,j(i(u)(te.value)),1)]),_:1}),t(Ne,null,{default:s(()=>[z(j(i(u)(ne.value)),1)]),_:1})]),_:1}),t(we,null,{default:s(()=>[t(he,{modelValue:o.value,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value=a),style:{"overflow-y":"scroll"}},{default:s(()=>[(O(),h(d,{key:l.indexOf("cheminement")},{default:s(()=>[t(Oe,null,{default:s(()=>[t(A,{"prepend-icon":"mdi-creation-outline","append-icon":i(D)?"mdi-chevron-left":"mdi-chevron-right",title:i(u)("bds.nouvelle.créerNouvelle"),onClick:e[0]||(e[0]=()=>ae())},null,8,["append-icon","title"]),t(A,{"prepend-icon":"mdi-table","append-icon":i(D)?"mdi-chevron-left":"mdi-chevron-right",title:i(u)("bds.nouvelle.copierDeBd"),onClick:e[1]||(e[1]=()=>G("bd"))},null,8,["append-icon","title"]),t(A,{"prepend-icon":"mdi-table-multiple","append-icon":i(D)?"mdi-chevron-left":"mdi-chevron-right",title:i(u)("bds.nouvelle.copierDeNuée"),onClick:e[2]||(e[2]=()=>G("nuée"))},null,8,["append-icon","title"])]),_:1})]),_:1})),t(d,{value:l.indexOf("gabaritBd")},{default:s(()=>[t(F,{multiples:!1,onSelectionnee:e[3]||(e[3]=a=>a[0]&&se(a[0]))}),t($,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),label:i(u)("bds.copier.copierDonnées"),color:"primary"},null,8,["modelValue","label"])]),_:1},8,["value"]),t(d,{value:l.indexOf("gabaritNuée")},{default:s(()=>[t(Ue,{multiples:!1,onSelectionnee:e[5]||(e[5]=a=>a.length&&ue(a[0]))})]),_:1},8,["value"]),t(d,{value:l.indexOf("noms")},{default:s(()=>[t(H,{"texte-aucun-nom":i(u)("communs.texteAucunNom"),"indice-langue":i(u)("communs.indiceLangue"),"etiquette-nom":i(u)("communs.étiquetteNom"),"indice-nom":i(u)("bds.nouvelle.texteIndiceNom"),"noms-initiaux":C.value,"autorisation-modification":!0,onAjusterNoms:oe},null,8,["texte-aucun-nom","indice-langue","etiquette-nom","indice-nom","noms-initiaux"])]),_:1},8,["value"]),t(d,{value:l.indexOf("descriptions")},{default:s(()=>[t(H,{"texte-aucun-nom":i(u)("bds.nouvelle.texteAucuneDescription"),"indice-langue":i(u)("communs.indiceLangue"),"etiquette-nom":i(u)("bds.nouvelle.texteÉtiquetteDescription"),"indice-nom":i(u)("bds.nouvelle.texteIndiceDescription"),"noms-initiaux":B.value,"autorisation-modification":!0,longue:"",onAjusterNoms:re},null,8,["texte-aucun-nom","indice-langue","etiquette-nom","indice-nom","noms-initiaux"])]),_:1},8,["value"]),t(d,{value:5},{default:s(()=>[t(De,{multiples:"",originaux:V.value,onSelectionnee:e[6]||(e[6]=a=>V.value=a)},null,8,["originaux"])]),_:1}),t(d,{value:l.indexOf("licence")},{default:s(()=>[g.value?(O(),h(X,{key:0,class:"mb-4",variant:"outlined",type:"info",density:"compact",title:i(u)("licences.titrePartageÉgale"),text:i(u)("licences.infoPartageÉgale")},null,8,["title","text"])):J("",!0),t(K,{licence:v.value,"permission-modifier":!g.value,onChangerLicence:e[7]||(e[7]=a=>v.value=a)},null,8,["licence","permission-modifier"]),ke(t($,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=a=>N.value=a),label:i(u)("licences.pareilPourContenu"),disabled:!!g.value,color:"primary"},null,8,["modelValue","label","disabled"]),[[ye,v.value]])]),_:1},8,["value"]),t(d,{value:l.indexOf("licenceContenu")},{default:s(()=>[U.value&&_.value?(O(),h(X,{key:0,class:"mb-4",variant:"outlined",type:"info",density:"compact",title:i(u)("licences.titrePartageÉgale"),text:i(u)("licences.infoPartageÉgale")},null,8,["title","text"])):J("",!0),t(K,{licence:m.value,"permission-modifier":!g.value,onChangerLicence:e[9]||(e[9]=a=>m.value=a)},null,8,["licence","permission-modifier"])]),_:1},8,["value"]),t(d,{value:l.indexOf("statut")},{default:s(()=>[t(Re,{onChoisir:e[10]||(e[10]=a=>q.value=a)},{sélecteur:s(({choisirNouvelle:a})=>[t(F,{multiples:!1,onSelectionnee:ve=>a(ve[0])},null,8,["onSelectionnee"])]),_:1})]),_:1},8,["value"]),t(d,{value:l.indexOf("confirmation")},{default:s(()=>[W("div",qe,[t(Se,{class:"mt-3",variant:"outlined",loading:w.value,onClick:e[11]||(e[11]=()=>ce())},{default:s(()=>[z(j(i(u)("bds.nouvelle.texteBtnCréation")),1)]),_:1},8,["loading"]),t($,{modelValue:T.value,"onUpdate:modelValue":e[12]||(e[12]=a=>T.value=a),label:i(u)("bds.nouvelle.ouvrirAprèsCréation")},null,8,["modelValue","label"])])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),t(Te),t(Le,null,{default:s(()=>[t(je,{visible:P.value.visible,actif:P.value.actif,onRetour:le},null,8,["visible","actif"]),t(Ae),t($e,{visible:I.value.visible,actif:I.value.actif,onSuivant:ie},null,8,["visible","actif"])]),_:1})]),_:1},8,["min-width"])]),_:3},8,["modelValue"]))}});export{Fe as _};
//# sourceMappingURL=NouvelleBd.vue_vue_type_script_setup_true_lang-DnXo1AO5.js.map
