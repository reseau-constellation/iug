{"version":3,"file":"NouvelleVariable.vue_vue_type_script_setup_true_lang-DQX23eyL.js","sources":["../../src/components/variables/NouvelleVariable.vue"],"sourcesContent":["<template>\n  <v-dialog v-model=\"dialogue\">\n    <template #activator=\"{props}\">\n      <slot\n        name=\"activateur\"\n        v-bind=\"{props}\"\n      ></slot>\n    </template>\n\n    <v-card\n      class=\"mx-auto\"\n      :min-width=\"mdAndUp ? 500 : 300\"\n    >\n      <v-card-item>\n        <v-card-title class=\"text-h5 justify-space-between\">\n          <span>{{ t(titreCarte) }}</span>\n        </v-card-title>\n        <v-card-subtitle> {{ t(sousTitreCarte) }} </v-card-subtitle>\n      </v-card-item>\n      <v-card-text>\n        <v-window\n          v-model=\"étape\"\n          style=\"overflow-y: scroll\"\n        >\n          <v-window-item :value=\"0\">\n            <v-select\n              v-model=\"catégorieBase\"\n              class=\"mt-2\"\n              :items=\"catégoriesBase\"\n              :label=\"t('variables.nouvelle.catégorie')\"\n              variant=\"outlined\"\n            >\n              <template #item=\"{item, props: propsItem}\">\n                <v-list-item\n                  v-bind=\"propsItem\"\n                  :title=\"t(`variables.catégories.${item.raw}`)\"\n                  :subtitle=\"t(`variables.indicesCatégories.${item.raw}`)\"\n                  :prepend-icon=\"\n                    icôneCatégorieVariable({type: 'simple', catégorie: item.raw}) || 'mdi-variable'\n                  \"\n                />\n              </template>\n              <template #selection=\"{item}\">\n                {{ t(`variables.catégories.${item.raw}`) }}\n              </template>\n            </v-select>\n            <v-checkbox\n              v-show=\"false\"\n              v-model=\"catégorieListe\"\n              :label=\"t('variables.nouvelle.typeListe')\"\n              color=\"primary\"\n              append-icon=\"mdi-format-list-bulleted\"\n            />\n          </v-window-item>\n          <v-window-item :value=\"1\">\n            <liste-noms\n              :texte-aucun-nom=\"t('communs.texteAucunNom')\"\n              :indice-langue=\"t('communs.indiceLangue')\"\n              :etiquette-nom=\"t('communs.étiquetteNom')\"\n              :indice-nom=\"t('variables.nouvelle.texteIndiceNom')\"\n              :noms-initiaux=\"noms\"\n              :autorisation-modification=\"true\"\n              @ajuster-noms=\"ajusterNoms\"\n            />\n          </v-window-item>\n          <v-window-item :value=\"listeÉtapes.indexOf('descriptions')\">\n            <liste-noms\n              :texte-aucun-nom=\"t('variables.nouvelle.texteAucuneDescription')\"\n              :indice-langue=\"t('communs.indiceLangue')\"\n              :etiquette-nom=\"t('variables.nouvelle.texteÉtiquetteDescription')\"\n              :indice-nom=\"t('variables.nouvelle.texteIndiceDescription')\"\n              :noms-initiaux=\"descriptions\"\n              :autorisation-modification=\"true\"\n              longue\n              @ajuster-noms=\"ajusterDescriptions\"\n            />\n          </v-window-item>\n          <v-window-item :value=\"listeÉtapes.indexOf('unités')\">\n            <v-text-field\n              v-model=\"unités\"\n              variant=\"outlined\"\n            />\n          </v-window-item>\n          <v-window-item :value=\"listeÉtapes.indexOf('règles')\">\n            <NouvelleRegle\n              :source=\"{\n                type: 'variable',\n              }\"\n              :categorie-variable=\"catégorieBase\"\n              @sauvegarder=\"r => ajouterRègle(r)\"\n            >\n              <template #activateur=\"{props: propsActivateurNouvelleRègle}\">\n                <v-list-item\n                  v-bind=\"propsActivateurNouvelleRègle\"\n                  prepend-icon=\"mdi-plus\"\n                >\n                  <v-list-item-title>\n                    {{ t('variables.règles.nouvelle') }}\n                  </v-list-item-title>\n                </v-list-item>\n              </template>\n            </NouvelleRegle>\n            <item-regle\n              v-for=\"r in règles\"\n              :key=\"r.id\"\n              :regle=\"r\"\n              effacable\n              autorisation-modifier\n              @effacer=\"() => effacerRègle(r.id)\"\n            ></item-regle>\n            <p\n              v-if=\"!règles.length\"\n              class=\"my-2 text-center text-disabled\"\n            >\n              {{ t('variables.règles.aucune') }}\n            </p>\n          </v-window-item>\n          <v-window-item :key=\"listeÉtapes.indexOf('confirmation')\">\n            <div class=\"text-center\">\n              <v-btn\n                class=\"mt-3\"\n                variant=\"outlined\"\n                :loading=\"enCréation\"\n                @click=\"() => créerVariable()\"\n              >\n                {{ t('variables.nouvelle.texteBtnCréation') }}\n              </v-btn>\n            </div>\n          </v-window-item>\n        </v-window>\n      </v-card-text>\n      <v-card-actions>\n        <btn-retour\n          :visible=\"retourActif.visible\"\n          :actif=\"retourActif.actif\"\n          @retour=\"retour\"\n        />\n        <v-spacer></v-spacer>\n        <btn-suivant\n          :visible=\"suivantActif.visible\"\n          :actif=\"suivantActif.actif\"\n          @suivant=\"suivant\"\n        />\n      </v-card-actions>\n    </v-card>\n  </v-dialog>\n</template>\n<script setup lang=\"ts\">\nimport type {valid, variables} from '@constl/ipa';\n\nimport {மொழியாக்கத்தைப்_பயன்படுத்து} from '@lassi-js/kilimukku-vue';\nimport {computed, ref} from 'vue';\nimport {useDisplay} from 'vuetify';\n\nimport BtnRetour from '/@/components/communs/BtnRetour.vue';\nimport BtnSuivant from '/@/components/communs/BtnSuivant.vue';\nimport ListeNoms from '/@/components/communs/listeNoms/ListeNoms.vue';\nimport ItemRegle from '/@/components/règles/ItemRègle.vue';\nimport NouvelleRegle from '/@/components/règles/NouvelleRègle.vue';\n\nimport {v4 as uuidv4} from 'uuid';\nimport {icôneCatégorieVariable} from '/@/components/variables/utils';\n\nimport {utiliserConstellation} from '../utils';\nimport {catégoriesBase} from './utils';\n\nconst émettre = defineEmits<{(é: 'nouvelle', id: string): void}>();\n\nconst constl = utiliserConstellation();\n\nconst {$மொ: t} = மொழியாக்கத்தைப்_பயன்படுத்து();\n\nconst {mdAndUp} = useDisplay();\n\n// Navigation\nconst dialogue = ref(false);\n\nconst étape = ref(0);\nconst listeÉtapes = [\n  'catégorie',\n  'noms',\n  'descriptions',\n  'unités',\n  'règles',\n  'confirmation',\n] as const;\n\nconst titreCarte = computed(() => {\n  const é = listeÉtapes[étape.value];\n  switch (é) {\n    case 'catégorie':\n      return 'variables.nouvelle.titreCatégorie';\n    case 'noms':\n      return 'variables.nouvelle.titreNoms';\n    case 'descriptions':\n      return 'variables.nouvelle.titreDescriptions';\n    case 'unités':\n      return 'variables.nouvelle.titreUnités';\n    case 'règles':\n      return 'variables.nouvelle.titreRègles';\n    case 'confirmation':\n      return 'variables.nouvelle.titreConfirmation';\n    default:\n      return '';\n  }\n});\n\nconst sousTitreCarte = computed(() => {\n  const é = listeÉtapes[étape.value];\n  switch (é) {\n    case 'catégorie':\n      return 'variables.nouvelle.sousTitreCatégorie';\n    case 'noms':\n      return 'variables.nouvelle.sousTitreNoms';\n    case 'descriptions':\n      return 'variables.nouvelle.sousTitreDescriptions';\n    case 'unités':\n      return 'variables.nouvelle.sousTitreUnités';\n    case 'règles':\n      return 'variables.nouvelle.sousTitreRègles';\n    case 'confirmation':\n      return 'variables.nouvelle.sousTitreConfirmation';\n    default:\n      return '';\n  }\n});\n\nconst retour = () => {\n  const é = listeÉtapes[étape.value];\n  switch (é) {\n    case 'règles':\n      étape.value = listeÉtapes.indexOf(unitésPossible.value ? 'unités' : 'descriptions');\n      break;\n    default:\n      étape.value--;\n      break;\n  }\n};\n\nconst suivant = () => {\n  const é = listeÉtapes[étape.value];\n  switch (é) {\n    case 'descriptions':\n      étape.value = listeÉtapes.indexOf(unitésPossible.value ? 'unités' : 'règles');\n      break;\n    default:\n      étape.value++;\n      break;\n  }\n};\n\nconst suivantActif = computed<{actif: boolean; visible: boolean}>(() => {\n  const é = listeÉtapes[étape.value];\n  switch (é) {\n    case 'catégorie':\n      return {actif: !!catégorieBase.value, visible: true};\n    case 'noms':\n      return {actif: !!Object.keys(noms.value).length, visible: true};\n    case 'confirmation':\n      return {actif: false, visible: false};\n    default:\n      return {actif: true, visible: true};\n  }\n});\n\nconst retourActif = computed<{actif: boolean; visible: boolean}>(() => {\n  const é = listeÉtapes[étape.value];\n  switch (é) {\n    case 'catégorie':\n      return {actif: false, visible: false};\n    case 'confirmation':\n      return {actif: !enCréation.value, visible: true};\n    default:\n      return {actif: true, visible: true};\n  }\n});\n\n// Catégorie\nconst catégorieListe = ref(false);\nconst catégorieBase = ref<variables.catégorieBaseVariables>();\nconst catégorie = computed<variables.catégorieVariables | undefined>(() => {\n  if (!catégorieBase.value) return;\n  return {type: catégorieListe.value ? 'liste' : 'simple', catégorie: catégorieBase.value};\n});\n\n// Noms\nconst noms = ref<{[lng: string]: string}>({});\nconst ajusterNoms = (nms: {[lng: string]: string}) => {\n  noms.value = nms;\n};\n\n// Descriptions\nconst descriptions = ref<{[lng: string]: string}>({});\nconst ajusterDescriptions = (desrc: {[lng: string]: string}) => {\n  descriptions.value = desrc;\n};\n\n// Unités\nconst unités = ref<string>();\nconst unitésPossible = computed(() => {\n  return catégorieBase.value === 'numérique';\n});\n\n// Règles\nconst règles = ref<valid.règleVariableAvecId[]>([]);\nconst ajouterRègle = (règle: valid.règleVariable) => {\n  règles.value = [\n    ...règles.value,\n    {\n      règle,\n      id: uuidv4(),\n    },\n  ];\n};\nconst effacerRègle = (id: string) => {\n  règles.value = règles.value.filter(r => r.id !== id);\n};\n\n// Création\nconst enCréation = ref(false);\nconst créerVariable = async () => {\n  enCréation.value = true;\n\n  if (!catégorie.value) return;\n\n  const idVariable = await constl.variables.créerVariable({catégorie: catégorie.value});\n\n  const promesses: Promise<unknown>[] = [\n    constl.variables.sauvegarderNomsVariable({\n      idVariable,\n      noms: Object.fromEntries(Object.entries(noms.value)),\n    }),\n    constl.variables.sauvegarderDescriptionsVariable({\n      idVariable,\n      descriptions: Object.fromEntries(Object.entries(descriptions.value)),\n    }),\n    ...règles.value.map(r =>\n      constl.variables.ajouterRègleVariable({\n        idVariable,\n        règle: r.règle,\n      }),\n    ),\n  ];\n\n  if (unités.value) {\n    promesses.push(constl.variables.sauvegarderUnitésVariable({idVariable, idUnité: unités.value}));\n  }\n\n  émettre('nouvelle', idVariable);\n\n  fermer();\n};\n\n// Fermer\nconst fermer = () => {\n  catégorieBase.value = undefined;\n  catégorieListe.value = false;\n  noms.value = {};\n  descriptions.value = {};\n  étape.value = 0;\n  enCréation.value = false;\n  dialogue.value = false;\n};\n</script>\n"],"names":["émettre","__emit","constl","utiliserConstellation","t","மொழியாக்கத்தைப்_பயன்படுத்து","mdAndUp","useDisplay","dialogue","ref","étape","listeÉtapes","titreCarte","computed","sousTitreCarte","retour","unitésPossible","suivant","suivantActif","catégorieBase","noms","retourActif","enCréation","catégorieListe","catégorie","ajusterNoms","nms","descriptions","ajusterDescriptions","desrc","unités","règles","ajouterRègle","règle","uuidv4","effacerRègle","id","r","créerVariable","idVariable","promesses","fermer"],"mappings":"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"}