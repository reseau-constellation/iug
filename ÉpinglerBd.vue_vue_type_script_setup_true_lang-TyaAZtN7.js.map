{"version":3,"file":"ÉpinglerBd.vue_vue_type_script_setup_true_lang-TyaAZtN7.js","sources":["../../src/components/épingles/utils.ts","../../src/components/épingles/SélectionDispositifs.vue","../../src/components/épingles/ÉpinglerBd.vue"],"sourcesContent":["import {adresseOrbiteValide} from '@constl/utils-ipa';\nimport {கிளிமூக்கை_பயன்படுத்து} from '@lassi-js/kilimukku-vue';\nimport {isEqual} from 'lodash-es';\nimport {computed, ref, watchEffect, type Ref} from 'vue';\n\nexport const utiliserOptionsÉpingles = (): {\n  titre: string;\n  sousTitre: string;\n  icône: string;\n  valeur: 'AUCUN' | 'TOUS' | 'INSTALLÉ' | 'SPÉCIFIQUES';\n}[] => {\n  const {மொழியாக்கம்_பயன்படுத்து} = கிளிமூக்கை_பயன்படுத்து();\n  const {$மொ: t} = மொழியாக்கம்_பயன்படுத்து();\n\n  return [\n    {\n      titre: t('épingler.aucun'),\n      sousTitre: t('épingler.indiceAucun'),\n      icône: 'mdi-cancel',\n      valeur: 'AUCUN',\n    },\n    {\n      titre: t('épingler.tous'),\n      sousTitre: t('épingler.indiceTous'),\n      icône: 'mdi-devices',\n      valeur: 'TOUS',\n    },\n    {\n      titre: t('épingler.installé'),\n      sousTitre: t('épingler.indiceInstallé'),\n      icône: 'mdi-monitor',\n      valeur: 'INSTALLÉ',\n    },\n    {\n      titre: t('épingler.dispositifsSpécifiques'),\n      sousTitre: t('épingler.indiceDispositifsSpécifiques'),\n      icône: 'mdi-monitor-cellphone-star',\n      valeur: 'SPÉCIFIQUES',\n    },\n  ];\n};\n\nexport const optionsDispositifs = (\n  valeur: Ref<'AUCUN' | 'TOUS' | 'INSTALLÉ' | string | string[] | undefined>,\n  défaut: 'AUCUN' | 'TOUS' | 'INSTALLÉ' = 'AUCUN',\n) => {\n  const sélection = ref<'AUCUN' | 'TOUS' | 'INSTALLÉ' | 'SPÉCIFIQUES'>(défaut);\n  const spécifiques = ref<string[]>([]);\n  const dispositifs = computed(() => {\n    if (sélection.value === 'SPÉCIFIQUES') return spécifiques.value;\n    else return sélection.value;\n  });\n  const valide = computed(() => {\n    return sélection.value === 'SPÉCIFIQUES' ? spécifiques.value?.length : true;\n  });\n  const modifié = computed(() => {\n    if (valeur.value === 'AUCUN' || valeur.value === undefined) {\n      return sélection.value !== 'AUCUN';\n    } else if (Array.isArray(valeur.value)) {\n      return !isEqual(new Set(valeur.value), new Set(sélection.value));\n    } else {\n      return valeur.value !== sélection.value;\n    }\n  });\n\n  watchEffect(() => {\n    if (sélection.value !== 'SPÉCIFIQUES') spécifiques.value = [];\n  });\n\n  watchEffect(() => {\n    if (valeur.value === undefined) {\n      sélection.value = 'AUCUN';\n    } else if (Array.isArray(valeur.value) || adresseOrbiteValide(valeur.value)) {\n      sélection.value = 'SPÉCIFIQUES';\n      spécifiques.value = Array.isArray(valeur.value) ? valeur.value : [valeur.value];\n    } else if (valeur.value === 'INSTALLÉ' || valeur.value === 'TOUS') {\n      sélection.value = valeur.value;\n    }\n  });\n\n  return {\n    sélection,\n    spécifiques,\n    dispositifs,\n    valide,\n    modifié,\n  };\n};\n","<template>\n  <v-select\n    v-model=\"sélection\"\n    :items=\"optionsÉpingles\"\n    :prepend-inner-icon=\"optionsÉpingles.find(o => o.valeur === sélection)?.icône\"\n    item-value=\"valeur\"\n    variant=\"plain\"\n  >\n    <template #selection=\"{item}\">\n      {{ item.raw.titre }}\n    </template>\n    <template #item=\"{item, props: propsItem}\">\n      <v-list-item\n        v-bind=\"propsItem\"\n        :title=\"item.raw.titre\"\n        :subtitle=\"item.raw.sousTitre\"\n        :prepend-icon=\"item.raw.icône\"\n      />\n    </template>\n  </v-select>\n  <v-expand-transition>\n    <v-autocomplete\n      v-show=\"sélection === 'SPÉCIFIQUES'\"\n      v-model=\"spécifiques\"\n      :items=\"dispositifs\"\n      :label=\"t('épingler.indiceSélectionnerDispositif')\"\n      chips\n      closable-chips\n      density=\"compact\"\n      variant=\"outlined\"\n      multiple\n    >\n      <template #chip=\"{props: propsActivateur, item}\">\n        <jeton-dispositif\n          v-bind=\"propsActivateur\"\n          :id-dispositif=\"item.title\"\n        />\n      </template>\n\n      <template #item=\"{props: propsActivateur, item}\">\n        <item-dispositif\n          v-bind=\"propsActivateur\"\n          :id-dispositif=\"item.title\"\n        />\n      </template>\n    </v-autocomplete>\n  </v-expand-transition>\n</template>\n<script setup lang=\"ts\">\nimport {suivre} from '@constl/vue';\nimport {கிளிமூக்கை_பயன்படுத்து} from '@lassi-js/kilimukku-vue';\nimport {utiliserConstellation} from '../utils';\nimport {utiliserOptionsÉpingles} from './utils';\nimport ItemDispositif from '/@/components/membres/ItemDispositif.vue';\nimport JetonDispositif from '/@/components/membres/JetonDispositif.vue';\n\nconst sélection = defineModel<'AUCUN' | 'TOUS' | 'INSTALLÉ' | 'SPÉCIFIQUES' | undefined>(\n  'selection',\n);\nconst spécifiques = defineModel<string[]>('specifiques');\n\nconst constl = utiliserConstellation();\nconst {மொழியாக்கம்_பயன்படுத்து} = கிளிமூக்கை_பயன்படுத்து();\nconst {$மொ: t} = மொழியாக்கம்_பயன்படுத்து();\nconst optionsÉpingles = utiliserOptionsÉpingles();\n\n// Dispositifs\nconst dispositifs = suivre(constl.suivreDispositifs);\n</script>\n","<template>\n  <v-dialog\n    v-model=\"dialogue\"\n    :max-width=\"mdAndUp ? 500 : 300\"\n  >\n    <template #activator=\"{props: propsActivateur}\">\n      <slot\n        name=\"activator\"\n        v-bind=\"{props: propsActivateur}\"\n      ></slot>\n    </template>\n    <v-card>\n      <v-card-item>\n        <v-card-title class=\"d-flex\">\n          {{ t('épingler.titre') }}\n          <v-spacer />\n          <v-btn\n            icon=\"mdi-close\"\n            size=\"small\"\n            variant=\"flat\"\n            @click=\"fermer\"\n          >\n          </v-btn>\n        </v-card-title>\n      </v-card-item>\n      <v-divider />\n      <v-card-text style=\"overflow-y: scroll\">\n        <v-icon start>mdi-pin-outline</v-icon>\n        <span class=\"font-weight-bold\">ஒட்டுக்கொள்ளும் சாதனங்கள்</span>\n        <selection-dispositifs\n          v-model:selection=\"sélectionBase\"\n          v-model:specifiques=\"spécifiquesBase\"\n        />\n\n        <v-expand-transition>\n          <div v-show=\"sélectionBase !== 'AUCUN'\">\n            <p class=\"mb-2\">\n              <span>{{ t('épingler.optionsAvancées') }}</span>\n              <v-btn\n                :icon=\"optionsAvancées ? 'mdi-chevron-up' : 'mdi-chevron-down'\"\n                size=\"xsmall\"\n                variant=\"flat\"\n                @click=\"() => (optionsAvancées = !optionsAvancées)\"\n              ></v-btn>\n            </p>\n\n            <v-expand-transition>\n              <div v-show=\"optionsAvancées\">\n                <v-divider class=\"mb-2\" />\n                <p>\n                  <v-icon start>mdi-table-multiple</v-icon><span class=\"font-weight-bold\">தரவுகளை ஒட்டுக்கொள்ளும் சாதனங்கள்</span>\n                </p>\n                <selection-dispositifs\n                  v-model:selection=\"sélectionTableaux\"\n                  v-model:specifiques=\"spécifiquesTableaux\"\n                />\n                <p>\n                  <v-icon start>mdi-image-multiple-outline</v-icon><span class=\"font-weight-bold\">கோப்புரைகளை ஒட்டுக்கொள்ளும் சாதனங்கள்</span>\n                </p>\n                <selection-dispositifs\n                  v-model:selection=\"sélectionFichiersTableaux\"\n                  v-model:specifiques=\"spécifiquesFichiersTableaux\"\n                />\n              </div>\n            </v-expand-transition>\n          </div>\n        </v-expand-transition>\n      </v-card-text>\n      <v-divider />\n      <v-card-actions>\n        <v-spacer></v-spacer>\n        <v-btn\n          variant=\"outlined\"\n          @click=\"fermer\"\n        >\n          {{ t('communs.fermer') }}\n          <v-icon\n            icon=\"mdi-close\"\n            end\n          />\n        </v-btn>\n        <v-btn\n          color=\"primary\"\n          variant=\"outlined\"\n          :loading=\"enProgrès\"\n          :disabled=\"!prêtÀÉpingler || !valeursChangées\"\n          @click=\"() => épingler()\"\n        >\n          {{ t('communs.sauvegarder') }}\n          <v-icon\n            icon=\"mdi-check\"\n            end\n          />\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-dialog>\n</template>\n<script setup lang=\"ts\">\nimport {type favoris} from '@constl/ipa';\n\nimport {suivre} from '@constl/vue';\nimport {computed, ref} from 'vue';\nimport {useDisplay} from 'vuetify';\n\nimport {கிளிமூக்கை_பயன்படுத்து} from '@lassi-js/kilimukku-vue';\nimport SelectionDispositifs from './SélectionDispositifs.vue';\nimport {optionsDispositifs} from './utils';\nimport {utiliserConstellation} from '/@/components/utils';\n\nconst props = defineProps<{idBd: string}>();\n\nconst constl = utiliserConstellation();\n\nconst {mdAndUp} = useDisplay();\nconst {மொழியாக்கம்_பயன்படுத்து} = கிளிமூக்கை_பயன்படுத்து();\nconst {$மொ: t} = மொழியாக்கம்_பயன்படுத்து();\n\n// Navigation\nconst dialogue = ref(false);\nconst optionsAvancées = ref(false);\n\n// Épingle actuelle\nconst épingle = suivre(constl.bds.suivreÉpingleBd, {idBd: props.idBd});\n\n// Options\nconst {\n  sélection: sélectionBase,\n  dispositifs: dispositifsBase,\n  spécifiques: spécifiquesBase,\n  valide: baseValide,\n  modifié: baseModifié,\n} = optionsDispositifs(\n  computed(() => épingle.value?.base),\n  'TOUS',\n);\nconst {\n  sélection: sélectionTableaux,\n  dispositifs: dispositifsTableaux,\n  spécifiques: spécifiquesTableaux,\n  valide: tableauxValide,\n  modifié: tableauxModifié,\n} = optionsDispositifs(\n  computed(() => épingle.value?.données.tableaux),\n  'TOUS',\n);\nconst {\n  sélection: sélectionFichiersTableaux,\n  dispositifs: dispositifsFichiersTableaux,\n  spécifiques: spécifiquesFichiersTableaux,\n  valide: fichiersTableauxValide,\n  modifié: fichiersTableauxModifié,\n} = optionsDispositifs(\n  computed(() => épingle.value?.données.fichiers),\n  'INSTALLÉ',\n);\n\n// Sauvegarder\nconst prêtÀÉpingler = computed(() => {\n  return baseValide && tableauxValide && fichiersTableauxValide;\n});\n\nconst valeursChangées = computed(() => {\n  return baseModifié.value || tableauxModifié.value || fichiersTableauxModifié.value;\n});\n\nconst enProgrès = ref(false);\nconst épingler = async () => {\n  enProgrès.value = true;\n\n  if (dispositifsBase.value !== 'AUCUN') {\n    const épingle: favoris.ÉpingleBd = {\n      type: 'bd',\n      base: dispositifsBase.value,\n      données: {\n        tableaux: dispositifsTableaux.value,\n        fichiers: dispositifsFichiersTableaux.value,\n      },\n    };\n    await constl.bds.épinglerBd({\n      idBd: props.idBd,\n      options: épingle,\n    });\n  } else {\n    await désépingler();\n  }\n  fermer();\n};\nconst désépingler = async () => {\n  await constl.favoris.désépinglerFavori({idObjet: props.idBd});\n};\n\n// Fermer\nconst fermer = () => {\n  dialogue.value = false;\n  enProgrès.value = false;\n};\n</script>\n"],"names":["utiliserOptionsÉpingles","மொழியாக்கம்_பயன்படுத்து","கிளிமூக்கை_பயன்படுத்து","t","optionsDispositifs","valeur","défaut","sélection","ref","spécifiques","dispositifs","computed","valide","modifié","isEqual","watchEffect","adresseOrbiteValide","_useModel","__props","constl","utiliserConstellation","optionsÉpingles","suivre","props","mdAndUp","useDisplay","dialogue","optionsAvancées","épingle","sélectionBase","dispositifsBase","spécifiquesBase","baseValide","baseModifié","sélectionTableaux","dispositifsTableaux","spécifiquesTableaux","tableauxValide","tableauxModifié","sélectionFichiersTableaux","dispositifsFichiersTableaux","spécifiquesFichiersTableaux","fichiersTableauxValide","fichiersTableauxModifié","prêtÀÉpingler","valeursChangées","enProgrès","épingler","désépingler","fermer"],"mappings":"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"}