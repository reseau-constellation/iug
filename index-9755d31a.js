var pq=Object.defineProperty;var yq=(r,e,t)=>e in r?pq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var N=(r,e,t)=>(yq(r,typeof e!="symbol"?e+"":e,t),t),sS=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var ve=(r,e,t)=>(sS(r,e,"read from private field"),t?t.call(r):e.get(r)),ar=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Dt=(r,e,t,n)=>(sS(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var R3=(r,e,t,n)=>({set _(s){Dt(r,e,s,t)},get _(){return ve(r,e,n)}});import{d as _e,r as D7,b as Zi,a as gq,c as $o,e as wq,f as z,g as xa,h as Ie,p as pt,i as Et,j as $r,k as M,l as $O,t as R,m as Is,n as P7,o as bq,q as TO,w as mq,s as Eq,u as vq,v as _q,x as Xt,y as IO,T as Sq,z as Aq,A as Pm,B as zr,C as Fr,D as Vr,E as At,F as RO,R as Mw,G as CO,W as Uw,H as xO,I as Bw,J as iS,K as Om,L as $q,M as Tq,N as Iq,O as Rq,P as Cq,Q as xq,S as Dq,U as Pq,V as Oq,X as kq,Y as Rt,Z as oS,_ as Hh,$ as b1,a0 as DO,a1 as PO,a2 as O7,a3 as OO,a4 as Nq,a5 as Lq,a6 as _d}from"./index-9d686756.js";function Mq(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in r)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(r,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var _c;let aS=(_c=class extends Error{constructor(t="The operation was aborted"){super(t);N(this,"code");N(this,"type");this.code=_c.code,this.type=_c.type}},N(_c,"code","ABORT_ERR"),N(_c,"type","aborted"),_c);class L extends Error{constructor(t,n,s){super(t);N(this,"code");N(this,"props");this.code=n,this.name=s?.name??"CodeError",this.props=s??{}}}function Uq(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var Bq=Uq,zq=Bq;const Fq=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};let Vq=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},jq=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return kO(this,e)}},Kq=class{constructor(e){this.decoders=e}or(e){return kO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const kO=(r,e)=>new Kq({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let qq=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Vq(e,t,n),this.decoder=new jq(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const NO=({name:r,prefix:e,encode:t,decode:n})=>new qq(r,e,t,n),LO=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=zq(t,e);return NO({prefix:r,name:e,encode:n,decode:i=>Fq(s(i))})},Hq=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Gq=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ds=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>NO({prefix:e,name:r,encode(s){return Gq(s,n,t)},decode(s){return Hq(s,n,t,r)}}),Wq=LO({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});LO({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Qq=Ds({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ds({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ds({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ds({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ds({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ds({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ds({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ds({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ds({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Yq=Ds({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Ds({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Ds({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Ds({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});_e.formatters.b=r=>r==null?"undefined":Wq.baseEncode(r);_e.formatters.t=r=>r==null?"undefined":Qq.baseEncode(r);_e.formatters.m=r=>r==null?"undefined":Yq.baseEncode(r);_e.formatters.p=r=>r==null?"undefined":r.toString();_e.formatters.c=r=>r==null?"undefined":r.toString();_e.formatters.k=r=>r==null?"undefined":r.toString();_e.formatters.a=r=>r==null?"undefined":r.toString();function Xq(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function U(r){let e=Xq(`${r}:trace`);return _e.enabled(`${r}:trace`)&&_e.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=_e(`${r}:trace`)),Object.assign(_e(r),{error:_e(`${r}:error`),trace:e})}let cS=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Vc(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function m1(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new cS(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new cS(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}function MO(r){const e=new globalThis.AbortController;function t(){e.abort();for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(const i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=n,s}var zw=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=typeof e>"u"?1:e}get msDuration(){return this.duration*1e3}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=typeof e>"u"?0:e}get msBlockDuration(){return this.blockDuration*1e3}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=typeof e>"u"?!1:!!e}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=typeof e>"u"?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(typeof e>"u"&&(e="rlflx"),typeof e!="string")throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}},Jq=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach(t=>{this._keys[t]<=e&&delete this._keys[t]}),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,t*1e3)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();const n=Date.now();return t>=n?t-n:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach(t=>{delete this._keys[t]})}};const Zq=Jq;var eH=Zq,gi=class{constructor(e,t,n,s){this.remainingPoints=typeof e>"u"?0:e,this.msBeforeNext=typeof t>"u"?0:t,this.consumedPoints=typeof n>"u"?0:n,this.isFirstInDuration=typeof s>"u"?!1:s}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=!!e}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}};const C3=zw,tH=eH,lS=gi;var hp=class extends C3{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new tH}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,n,s,i,o={}){const a=this._getRateLimiterRes(n,s,i);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&a.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,a.msBeforeNext),a.consumedPoints>this.points?t(a):e(a);if(a.consumedPoints>this.points){let c=Promise.resolve();this.blockDuration>0&&a.consumedPoints<=this.points+s&&(a.msBeforeNext=this.msBlockDuration,c=this._block(n,a.consumedPoints,this.msBlockDuration,o)),this.inMemoryBlockOnConsumed>0&&a.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),a.msBeforeNext=this.msInMemoryBlockDuration),c.then(()=>{t(a)}).catch(u=>{t(u)})}else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,c,a)}else e(a)}_handleError(e,t,n,s,i,o=!1,a={}){this.insuranceLimiter instanceof C3?this.insuranceLimiter[t](i,o,a).then(c=>{n(c)}).catch(c=>{s(c)}):s(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return this.inMemoryBlockDuration*1e3}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&this.inMemoryBlockOnConsumed===0)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return this._inMemoryBlockDuration*1e3}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(typeof e<"u"&&!(e instanceof C3))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,n={}){const s=t*1e3;return this._block(this.getKey(e),this.points+1,s,n)}set(e,t,n,s={}){const i=(n>=0?n:this.duration)*1e3;return this._block(this.getKey(e),t,i,s)}consume(e,t=1,n={}){return new Promise((s,i)=>{const o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return i(new lS(0,a));this._upsert(o,t,this._getKeySecDuration(n)*1e3,!1,n).then(c=>{this._afterConsume(s,i,o,t,c)}).catch(c=>{this._handleError(c,"consume",s,i,e,t,n)})})}penalty(e,t=1,n={}){const s=this.getKey(e);return new Promise((i,o)=>{this._upsert(s,t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{i(this._getRateLimiterRes(s,t,a))}).catch(a=>{this._handleError(a,"penalty",i,o,e,t,n)})})}reward(e,t=1,n={}){const s=this.getKey(e);return new Promise((i,o)=>{this._upsert(s,-t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{i(this._getRateLimiterRes(s,-t,a))}).catch(a=>{this._handleError(a,"reward",i,o,e,t,n)})})}get(e,t={}){const n=this.getKey(e);return new Promise((s,i)=>{this._get(n,t).then(o=>{s(o===null||typeof o>"u"?null:this._getRateLimiterRes(n,0,o))}).catch(o=>{this._handleError(o,"get",s,i,e,t)})})}delete(e,t={}){const n=this.getKey(e);return new Promise((s,i)=>{this._delete(n,t).then(o=>{this._inMemoryBlockedKeys.delete(n),s(o)}).catch(o=>{this._handleError(o,"delete",s,i,e,t)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,n,s={}){return new Promise((i,o)=>{this._upsert(e,t,n,!0,s).then(()=>{i(new lS(0,n>0?n:-1,t))}).catch(a=>{this._handleError(a,"block",i,o,this.parseKey(e),n/1e3,s)})})}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,n,s=!1,i={}){throw new Error("You have to implement the method '_upsert'!")}};const rH=hp,nH=gi,uS="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";let sH=class extends rH{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,typeof this.client.defineCommand=="function"&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:uS})}_isRedisReady(){return this._rejectIfRedisNotReady?!(this.client.status&&this.client.status!=="ready"||typeof this.client.isReady=="function"&&!this.client.isReady()):!0}_getRateLimiterRes(e,t,n){let[s,i]=n;Array.isArray(s)&&([,s]=s,[,i]=i);const o=new nH;return o.consumedPoints=parseInt(s),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=i,o}_upsert(e,t,n,s=!1){return new Promise((i,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));const a=Math.floor(n/1e3),c=this.client.multi();if(s)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec((u,l)=>u?o(u):i(l));else if(a>0){const u=function(l,h){return l?o(l):i(h)};typeof this.client.rlflxIncr=="function"?this.client.rlflxIncr(e,t,a,u):this.client.eval(uS,1,e,t,a,u)}else c.incrby(e,t).pttl(e).exec((u,l)=>u?o(u):i(l))})}_get(e){return new Promise((t,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec((s,i)=>{if(s)n(s);else{const[o]=i;if(o===null)return t(null);t(i)}})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(s,i)=>{s?n(s):t(i>0)})})}};var iH=sH;const oH=hp,aH=gi;function hS(r){try{const e=r.client?r.client:r,{version:t}=e.topology.s.options.metadata.driver,n=t.split(".").map(s=>parseInt(s));return{major:n[0],feature:n[1],patch:n[2]}}catch{return{major:0,feature:0,patch:0}}}let cH=class UO extends oH{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,typeof this.client.then=="function"?this.client.then(t=>{this.client=t,this._initCollection(),this._driverVersion=hS(this.client)}):(this._initCollection(),this._driverVersion=hS(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?UO.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const t=(typeof this.client.db=="function"?this.client.db(this.dbName):this.client).collection(this.tableName);t.createIndex({expire:-1},{expireAfterSeconds:0}),t.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=t}_getRateLimiterRes(e,t,n){const s=new aH;let i;return typeof n.value>"u"?i=n:i=n.value,s.isFirstInDuration=i.points===t,s.consumedPoints=i.points,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=i.expire!==null?Math.max(new Date(i.expire).getTime()-Date.now(),0):-1,s}_upsert(e,t,n,s=!1,i={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const o=i.attrs||{};let a,c;s?(a={key:e},a=Object.assign(a,o),c={$set:{key:e,points:t,expire:n>0?new Date(Date.now()+n):null}},c.$set=Object.assign(c.$set,o)):(a={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},a=Object.assign(a,o),c={$setOnInsert:{key:e,expire:n>0?new Date(Date.now()+n):null},$inc:{points:t}},c.$setOnInsert=Object.assign(c.$setOnInsert,o));const u={upsert:!0};return this._driverVersion.major>=4||this._driverVersion.major===3&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?u.returnDocument="after":u.returnOriginal=!1,new Promise((l,h)=>{this._collection.findOneAndUpdate(a,c,u).then(f=>{l(f)}).catch(f=>{if(f&&f.code===11e3){const y=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},o),d={$set:Object.assign({key:e,points:t,expire:n>0?new Date(Date.now()+n):null},o)};this._collection.findOneAndUpdate(y,d,u).then(p=>{l(p)}).catch(p=>{p&&p.code===11e3?this._upsert(e,t,n,s).then(b=>l(b)).catch(b=>h(b)):h(p)})}else h(f)})})}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const n=t.attrs||{},s=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(s)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const n=t.attrs||{},s=Object.assign({key:e},n);return this._collection.deleteOne(s).then(i=>i.deletedCount>0)}};var lH=cH;const uH=hp,hH=gi;let dH=class extends uH{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{this._getConnection().then(n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],()=>{this._releaseConnection(n),t()})}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((e,t)=>{this.client.getConnection((n,s)=>{if(n)return t(n);e(s)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise((e,t)=>{this._getConnection().then(n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,s=>{if(s)return this._releaseConnection(n),t(s);n.query(this._getCreateTableStmt(),i=>{if(i)return this._releaseConnection(n),t(i);this._releaseConnection(n),e()})})}).catch(n=>{t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(typeof e>"u")if(this.client.constructor.name==="Connection")e="connection";else if(this.client.constructor.name==="Pool")e="pool";else if(this.client.constructor.name==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){const s=new hH,[i]=n;return s.isFirstInDuration=t===i.points,s.consumedPoints=s.isFirstInDuration?t:i.points,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,s}_upsertTransaction(e,t,n,s,i){return new Promise((o,a)=>{e.query("BEGIN",c=>{if(c)return e.rollback(),a(c);const u=Date.now(),l=s>0?u+s:null;let h,f;i?(h=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,f=[this.dbName,this.tableName,t,n,l,n,l]):(h=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,f=[this.dbName,this.tableName,t,n,l,u,n,n,u,l]),e.query(h,f,y=>{if(y)return e.rollback(),a(y);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],(d,p)=>{if(d)return e.rollback(),a(d);e.query("COMMIT",b=>{if(b)return e.rollback(),a(b);o(p)})})})})})}_upsert(e,t,n,s=!1){return this.tableCreated?new Promise((i,o)=>{this._getConnection().then(a=>{this._upsertTransaction(a,e,t,n,s).then(c=>{i(c),this._releaseConnection(a)}).catch(c=>{o(c),this._releaseConnection(a)})}).catch(a=>{o(a)})}):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(s=>{s.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],(i,o)=>{i?n(i):o.length===0?t(null):t(o),this._releaseConnection(s)})}).catch(s=>{n(s)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(s=>{s.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],(i,o)=>{i?n(i):t(o.affectedRows>0),this._releaseConnection(s)})}).catch(s=>{n(s)})}):Promise.reject(Error("Table is not created yet"))}};var fH=dH;const pH=hp,yH=gi;let gH=class extends pH{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?typeof t=="function"&&t():this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{const n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(n).then(()=>{t()}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise((e,t)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{e()}).catch(n=>{n.code==="23505"?e():t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( 
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(e){const t=this.client.constructor.name;if(typeof e>"u")if(t==="Client")e="client";else if(t==="Pool"||t==="BoundPool")e="pool";else if(t==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){const s=new yH,i=n.rows[0];return s.isFirstInDuration=t===i.points,s.consumedPoints=s.isFirstInDuration?t:i.points,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,s}_query(e){const n={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise((s,i)=>{this._getConnection().then(o=>{o.query(n).then(a=>{s(a),this._releaseConnection(o)}).catch(a=>{i(a),this._releaseConnection(o)})}).catch(o=>{i(o)})})}_upsert(e,t,n,s=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const i=n>0?Date.now()+n:null,o=s?" $3 ":` CASE
             WHEN ${this.tableName}.expire <= $4 THEN $3
             ELSE ${this.tableName}.expire
            END `;return this._query({name:s?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this.tableName}.expire <= $4 OR 1=${s?1:0}) THEN $2
                          ELSE ${this.tableName}.points + ($2)
                         END,
                expire = ${o}
            RETURNING points, expire;`,values:[e,t,i,Date.now()]})}_get(e){return this.tableCreated?new Promise((t,n)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then(s=>{s.rowCount===0&&(s=null),t(s)}).catch(s=>{n(s)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then(t=>t.rowCount>0):Promise.reject(Error("Table is not created yet"))}};var wH=gH,bH=class{constructor(e,t,n=null){this.value=e,this.expiresAt=t,this.timeoutId=n}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){!(e instanceof Date)&&Number.isInteger(e)&&(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}};const mH=bH,x3=gi;var EH=class{constructor(){this._storage={}}incrby(e,t,n){if(this._storage[e]){const s=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return s!==0?(this._storage[e].value=this._storage[e].value+t,new x3(0,s,this._storage[e].value,!1)):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const s=n*1e3;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new mH(t,s>0?new Date(Date.now()+s):null),s>0&&(this._storage[e].timeoutId=setTimeout(()=>{delete this._storage[e]},s),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new x3(0,s===0?-1:s,this._storage[e].value,!0)}get(e){if(this._storage[e]){const t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return new x3(0,t,this._storage[e].value,!1)}return null}delete(e){return this._storage[e]?(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0):!1}};const vH=zw,_H=EH,dS=gi;let SH=class extends vH{constructor(e={}){super(e),this._memoryStorage=new _H}consume(e,t=1,n={}){return new Promise((s,i)=>{const o=this.getKey(e),a=this._getKeySecDuration(n);let c=this._memoryStorage.incrby(o,t,a);if(c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c.consumedPoints>this.points)this.blockDuration>0&&c.consumedPoints<=this.points+t&&(c=this._memoryStorage.set(o,c.consumedPoints,this.blockDuration)),i(c);else if(this.execEvenly&&c.msBeforeNext>0&&!c.isFirstInDuration){let u=Math.ceil(c.msBeforeNext/(c.remainingPoints+2));u<this.execEvenlyMinDelayMs&&(u=c.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(s,u,c)}else s(c)})}penalty(e,t=1,n={}){const s=this.getKey(e);return new Promise(i=>{const o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(s,t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),i(a)})}reward(e,t=1,n={}){const s=this.getKey(e);return new Promise(i=>{const o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(s,-t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),i(a)})}block(e,t){const n=t*1e3,s=this.points+1;return this._memoryStorage.set(this.getKey(e),s,t),Promise.resolve(new dS(0,n===0?-1:n,s))}set(e,t,n){const s=(n>=0?n:this.duration)*1e3;return this._memoryStorage.set(this.getKey(e),t,n),Promise.resolve(new dS(0,s===0?-1:s,t))}get(e){const t=this._memoryStorage.get(this.getKey(e));return t!==null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}};var BO=SH;const fS=gq,AH=D7(),$H=zw,zO=BO,TH=gi,ui="rate_limiter_flexible";let nh=null;const pS=function(r,e,t,n){let s;n===null||n===!0||n===!1?s=n:s={remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},r.send({channel:ui,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:t,data:s})},FO=function(r){setTimeout(()=>{this._initiated?Zi.send(r):typeof this._promises[r.promiseId]<"u"&&FO.call(this,r)},30)},_u=function(r,e,t,n,s){const i={channel:ui,keyPrefix:this.keyPrefix,func:r,promiseId:e,data:{key:t,arg:n,opts:s}};this._initiated?Zi.send(i):FO.call(this,i)},VO=function(r,e){if(!e||e.channel!==ui||typeof this._rateLimiters[e.keyPrefix]>"u")return!1;let t;switch(e.func){case"consume":t=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":t=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":t=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":t=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":t=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":t=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}t&&t.then(n=>{pS(r,e,"resolve",n)}).catch(n=>{pS(r,e,"reject",n)})},IH=function(r){if(!r||r.channel!==ui||r.keyPrefix!==this.keyPrefix)return!1;if(this._promises[r.promiseId]){clearTimeout(this._promises[r.promiseId].timeoutId);let e;switch(r.data===null||r.data===!0||r.data===!1?e=r.data:e=new TH(r.data.remainingPoints,r.data.msBeforeNext,r.data.consumedPoints,r.data.isFirstInDuration),r.type){case"resolve":this._promises[r.promiseId].resolve(e);break;case"reject":this._promises[r.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${r.type}'`)}delete this._promises[r.promiseId]}},RH=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},Su=function(r,e){const t=Zi.hrtime();let n=t[0].toString()+t[1].toString();return typeof this._promises[n]<"u"&&(n+=AH.randomBytes(12).toString("base64")),this._promises[n]={resolve:r,reject:e,timeoutId:setTimeout(()=>{delete this._promises[n],e(new Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},n};let CH=class{constructor(){if(nh)return nh;this._rateLimiters={},fS.setMaxListeners(0),fS.on("message",(e,t)=>{t&&t.channel===ui&&t.type==="init"?(typeof this._rateLimiters[t.opts.keyPrefix]>"u"&&(this._rateLimiters[t.opts.keyPrefix]=new zO(t.opts)),e.send({channel:ui,type:"init",keyPrefix:t.opts.keyPrefix})):VO.call(this,e,t)}),nh=this}},xH=class{constructor(e){if(nh)return nh;this._rateLimiters={},e.launchBus((t,n)=>{n.on("process:msg",s=>{const i=s.raw;if(i&&i.channel===ui&&i.type==="init")typeof this._rateLimiters[i.opts.keyPrefix]>"u"&&(this._rateLimiters[i.opts.keyPrefix]=new zO(i.opts)),e.sendDataToProcessId(s.process.pm_id,{data:{},topic:ui,channel:ui,type:"init",keyPrefix:i.opts.keyPrefix},(o,a)=>{o&&console.log(o,a)});else{const o={send:a=>{const c=a;c.topic=ui,typeof c.data>"u"&&(c.data={}),e.sendDataToProcessId(s.process.pm_id,c,(u,l)=>{u&&console.log(u,l)})}};VO.call(this,o,i)}})}),nh=this}};class DH extends $H{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=typeof e>"u"?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),Zi.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,Zi.on("message",t=>{t&&t.channel===ui&&t.type==="init"&&t.keyPrefix===this.keyPrefix?this._initiated=!0:IH.call(this,t)}),Zi.send({channel:ui,type:"init",opts:RH.call(this)}),this._promises={}}consume(e,t=1,n={}){return new Promise((s,i)=>{const o=Su.call(this,s,i);_u.call(this,"consume",o,e,t,n)})}penalty(e,t=1,n={}){return new Promise((s,i)=>{const o=Su.call(this,s,i);_u.call(this,"penalty",o,e,t,n)})}reward(e,t=1,n={}){return new Promise((s,i)=>{const o=Su.call(this,s,i);_u.call(this,"reward",o,e,t,n)})}block(e,t,n={}){return new Promise((s,i)=>{const o=Su.call(this,s,i);_u.call(this,"block",o,e,t,n)})}get(e,t={}){return new Promise((n,s)=>{const i=Su.call(this,n,s);_u.call(this,"get",i,e,t)})}delete(e,t={}){return new Promise((n,s)=>{const i=Su.call(this,n,s);_u.call(this,"delete",i,e,t)})}}var PH={RateLimiterClusterMaster:CH,RateLimiterClusterMasterPM2:xH,RateLimiterCluster:DH};const OH=hp,kH=gi;let NH=class extends OH{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,n){const s=new kH;return s.consumedPoints=parseInt(n.consumedPoints),s.isFirstInDuration=n.consumedPoints===t,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=n.msBeforeNext,s}_upsert(e,t,n,s=!1,i={}){return new Promise((o,a)=>{const c=Date.now(),u=Math.floor(n/1e3);s?this.client.set(e,t,u,l=>{l?a(l):this.client.set(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{const h={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};o(h)})}):this.client.incr(e,t,(l,h)=>{l||h===!1?this.client.add(e,t,u,(f,y)=>{if(f||!y)if(typeof i.attemptNumber>"u"||i.attemptNumber<3){const d=Object.assign({},i);d.attemptNumber=d.attemptNumber?d.attemptNumber+1:1,this._upsert(e,t,n,s,d).then(p=>o(p)).catch(p=>a(p))}else a(new Error("Can not add key"));else this.client.add(`${e}_expire`,u>0?c+u*1e3:-1,u,()=>{const d={consumedPoints:t,msBeforeNext:u>0?u*1e3:-1};o(d)})}):this.client.get(`${e}_expire`,(f,y)=>{if(f)a(f);else{const d=y===!1?0:y,p={consumedPoints:h,msBeforeNext:d>=0?Math.max(d-c,0):-1};o(p)}})})})}_get(e){return new Promise((t,n)=>{const s=Date.now();this.client.get(e,(i,o)=>{o?this.client.get(`${e}_expire`,(a,c)=>{if(a)n(a);else{const u=c===!1?0:c,l={consumedPoints:o,msBeforeNext:u>=0?Math.max(u-s,0):-1};t(l)}}):t(null)})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(s,i)=>{s?n(s):i===!1?t(i):this.client.del(`${e}_expire`,o=>{o?n(o):t(i)})})})}};var LH=NH;const yS=gi;var MH=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(typeof e>"u")throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=typeof e>"u"?!1:e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new yS(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new yS(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.rejectBlack()),typeof n>"u"?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch(()=>{}),n)}block(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch(()=>{}),n)}penalty(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch(()=>{}),n)}reward(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch(()=>{}),n)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),typeof t>"u"||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}};const UH=zw;var BH=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach(t=>{if(!(t instanceof UH))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=e}consume(e,t=1){return new Promise((n,s)=>{const i=[];this._limiters.forEach(o=>{i.push(o.consume(e,t).catch(a=>({rejected:!0,rej:a})))}),Promise.all(i).then(o=>{const a={};let c=!1;o.forEach(u=>{u.rejected===!0&&(c=!0)});for(let u=0;u<o.length;u++)c&&o[u].rejected===!0?a[this._limiters[u].keyPrefix]=o[u].rej:c||(a[this._limiters[u].keyPrefix]=o[u]);c?s(a):n(a)})})}},zH=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}};const gS=zH,jO=4294967295,km="limiter";var FH=class{constructor(e,t={maxQueueSize:jO}){this._queueLimiters={KEY_DEFAULT:new wS(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=km){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=km){return this._queueLimiters[t]||(this._queueLimiters[t]=new wS(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};class wS{constructor(e,t={maxQueueSize:jO,key:km}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(e=>e!==null?e.remainingPoints:this._limiterFlexible.points)}removeTokens(e){const t=this;return new Promise((n,s)=>{if(e>t._limiterFlexible.points){s(new gS(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`));return}t._queue.length>0?t._queueRequest.call(t,n,s,e):t._limiterFlexible.consume(t._key,e).then(i=>{n(i.remainingPoints)}).catch(i=>{i instanceof Error?s(i):(t._queueRequest.call(t,n,s,e),t._waitTimeout===null&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),i.msBeforeNext)))})})}_queueRequest(e,t,n){const s=this;s._queue.length<s._maxQueueSize?s._queue.push({resolve:e,reject:t,tokens:n}):t(new gS(`Number of requests reached it's maximum ${s._maxQueueSize}`))}_processFIFO(){const e=this;if(e._waitTimeout!==null&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),e._queue.length===0)return;const t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then(n=>{t.resolve(n.remainingPoints),e._processFIFO.call(e)}).catch(n=>{n instanceof Error?(t.reject(n),e._processFIFO.call(e)):(e._queue.unshift(t),e._waitTimeout===null&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),n.msBeforeNext)))})}}const D3=gi;var VH=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return e?new D3(e.remainingPoints,Math.min(e.msBeforeNext,t?t.msBeforeNext:0),e.consumedPoints,e.isFirstInDuration):null}consume(e,t=1,n={}){return this._rateLimiter.consume(e,t,n).catch(s=>s instanceof D3?this._burstLimiter.consume(e,t,n).then(i=>Promise.resolve(this._combineRes(s,i))).catch(i=>i instanceof D3?Promise.reject(this._combineRes(s,i)):Promise.reject(i)):Promise.reject(s))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then(([t,n])=>this._combineRes(t,n))}get points(){return this._rateLimiter.points}};const jH=iH,KH=lH,qH=fH,HH=wH,{RateLimiterClusterMaster:GH,RateLimiterClusterMasterPM2:WH,RateLimiterCluster:QH}=PH,YH=BO,XH=LH,JH=MH,ZH=BH,eG=FH,tG=VH,rG=gi;var k7={RateLimiterRedis:jH,RateLimiterMongo:KH,RateLimiterMySQL:qH,RateLimiterPostgres:HH,RateLimiterMemory:YH,RateLimiterMemcache:XH,RateLimiterClusterMaster:GH,RateLimiterClusterMasterPM2:WH,RateLimiterCluster:QH,RLWrapperBlackAndWhite:JH,RateLimiterUnion:ZH,RateLimiterQueue:eG,BurstyRateLimiter:tG,RateLimiterRes:rG};function E1(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=$o(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return wq(t)}const KO=Symbol.for("@achingbrain/uint8arraylist");function bS(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const s=t+n.byteLength;if(e<s)return{buf:n,index:e-t};t=s}throw new RangeError("index is out of bounds")}function gl(r){return!!r?.[KO]}class Se{constructor(...e){Object.defineProperty(this,KO,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(gl(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(gl(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=bS(this.bufs,e);return t.buf[t.index]}set(e,t){const n=bS(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(gl(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:s}=this._subList(e,t);return z(n,s)}subarray(e,t){const{bufs:n,length:s}=this._subList(e,t);return n.length===1?n[0]:z(n,s)}sublist(e,t){const{bufs:n,length:s}=this._subList(e,t),i=new Se;return i.length=s,i.bufs=n,i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:[...this.bufs],length:this.length};const n=[];let s=0;for(let i=0;i<this.bufs.length;i++){const o=this.bufs[i],a=s,c=a+o.byteLength;if(s=c,e>=c)continue;const u=e>=a&&e<c,l=t>a&&t<=c;if(u&&l){if(e===a&&t===c){n.push(o);break}const h=e-a;n.push(o.subarray(h,h+(t-e)));break}if(u){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(l){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!gl(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const s=n.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");const i=256,o=new Int32Array(i);for(let h=0;h<i;h++)o[h]=-1;for(let h=0;h<s;h++)o[n[h]]=h;const a=o,c=this.byteLength-n.byteLength,u=n.byteLength-1;let l;for(let h=t;h<=c;h+=l){l=0;for(let f=u;f>=0;f--){const y=this.get(h+f);if(n[f]!==y){l=Math.max(1,f-a[y]);break}}if(l===0)return h}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=$o(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const s=xa(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,t,n),this.write(s,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const s=xa(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,t,n),this.write(s,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const s=xa(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,t,n),this.write(s,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=$o(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const s=xa(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,t,n),this.write(s,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const s=xa(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,t,n),this.write(s,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const s=xa(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,t,n),this.write(s,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const s=xa(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,t,n),this.write(s,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const s=xa(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,t,n),this.write(s,e)}equals(e){if(e==null||!(e instanceof Se)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Ie(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Se;return n.bufs=e,t==null&&(t=e.reduce((s,i)=>s+i.byteLength,0)),n.length=t,n}}var Qe;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(Qe||(Qe={}));const N7=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),mS=Object.freeze({NEW_STREAM:Qe.NEW_STREAM,MESSAGE:Qe.MESSAGE_INITIATOR,CLOSE:Qe.CLOSE_INITIATOR,RESET:Qe.RESET_INITIATOR}),nG=Object.freeze({MESSAGE:Qe.MESSAGE_RECEIVER,CLOSE:Qe.CLOSE_RECEIVER,RESET:Qe.RESET_RECEIVER}),qO=1<<20,sG=4<<20;let iG=class{constructor(e=qO,t=sG){N(this,"_buffer");N(this,"_headerInfo");N(this,"_maxMessageSize");N(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Se,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(u){if(u.code==="ERR_MSG_TOO_BIG")throw u;break}const{id:n,type:s,length:i,offset:o}=this._headerInfo;if(this._buffer.length-o<i)break;const c={id:n,type:s};(s===Qe.NEW_STREAM||s===Qe.MESSAGE_INITIATOR||s===Qe.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+i)),t.push(c),this._buffer.consume(o+i),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=vS(e),{value:s,offset:i}=vS(e,n),o=t&7;if(N7[o]==null)throw new Error(`Invalid type received: ${o}`);if(s>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:o,offset:n+i,length:s}}};const oG=128,ES=127;function vS(r,e=0){let t=0,n=0,s=e,i;const o=r.length;do{if(s>=o||n>49)throw e=0,new RangeError("Could not decode varint");i=r.get(s++),t+=n<28?(i&ES)<<n:(i&ES)*Math.pow(2,n),n+=7}while(i>=oG);return e=s-e,{value:t,offset:e}}function aG(r){return r[Symbol.asyncIterator]!=null}const f0=1024*1024,_S=(r,e)=>{e.append(r)};function cG(r,e){return aG(r)?async function*(){let t=new Se,n=!1,s=pt(),i=Number(e?.size??f0);if((isNaN(i)||i===0||i<0)&&(i=f0),i!==Math.round(i))throw new Error("Batch size must be an integer");const o=e?.yieldAfter??0,a=e?.serialize??_S;for(Promise.resolve().then(async()=>{try{let c;for await(const u of r){if(a(u,t),t.byteLength>=i){clearTimeout(c),s.resolve();continue}c=setTimeout(()=>{s.resolve()},o)}clearTimeout(c),s.resolve()}catch(c){s.reject(c)}finally{n=!0}});!n;)if(await s.promise,s=pt(),t.byteLength>0){const c=t;t=new Se,yield c.subarray()}}():function*(){const t=new Se;let n=Number(e?.size??f0);if((isNaN(n)||n===0||n<0)&&(n=f0),n!==Math.round(n))throw new Error("Batch size must be an integer");const s=e?.serialize??_S;for(const i of r)s(i,t),t.byteLength>=n&&(yield t.subarray(0,n),t.consume(n));t.byteLength>0&&(yield t.subarray())}()}var lG=Nm,SS=128,uG=127,hG=~uG,dG=Math.pow(2,31);function Nm(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw Nm.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=dG;)e[t++]=r&255|SS,r/=128;for(;r&hG;)e[t++]=r&255|SS,r>>>=7;return e[t]=r|0,Nm.bytes=t-n+1,e}var fG=Lm,pG=128,AS=127;function Lm(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a||s>49)throw Lm.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&AS)<<s:(o&AS)*Math.pow(2,s),s+=7}while(o>=pG);return Lm.bytes=i-n,t}var yG=Math.pow(2,7),gG=Math.pow(2,14),wG=Math.pow(2,21),bG=Math.pow(2,28),mG=Math.pow(2,35),EG=Math.pow(2,42),vG=Math.pow(2,49),_G=Math.pow(2,56),SG=Math.pow(2,63),AG=function(r){return r<yG?1:r<gG?2:r<wG?3:r<bG?4:r<mG?5:r<EG?6:r<vG?7:r<_G?8:r<SG?9:10},HO={encode:lG,decode:fG,encodingLength:AG};const P=Et(HO);function $S(r){return new Uint8Array(r)}const P3=10*1024;let $G=class{constructor(){N(this,"_pool");N(this,"_poolOffset");this._pool=$S(P3),this._poolOffset=0}write(e,t){const n=this._pool;let s=this._poolOffset;P.encode(e.id<<3|e.type,n,s),s+=P.encode.bytes??0,(e.type===Qe.NEW_STREAM||e.type===Qe.MESSAGE_INITIATOR||e.type===Qe.MESSAGE_RECEIVER)&&e.data!=null?P.encode(e.data.length,n,s):P.encode(0,n,s),s+=P.encode.bytes??0;const i=n.subarray(this._poolOffset,s);P3-s<100?(this._pool=$S(P3),this._poolOffset=0):this._poolOffset=s,t.append(i),(e.type===Qe.NEW_STREAM||e.type===Qe.MESSAGE_INITIATOR||e.type===Qe.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const TS=new $G;async function*TG(r,e=0){if(e==null||e===0){for await(const t of r){const n=new Se;for(const s of t)TS.write(s,n);yield n.subarray()}return}yield*cG(r,{size:e,serialize:(t,n)=>{for(const s of t)TS.write(s,n)}})}const Es=U("libp2p:stream"),O3="ERR_STREAM_RESET",IG="ERR_STREAM_ABORT",RG="ERR_SINK_ENDED",CG="ERR_DOUBLE_SINK";function Jc(r){return r!=null&&typeof r.then=="function"}class xG{constructor(e){N(this,"id");N(this,"stat");N(this,"metadata");N(this,"source");N(this,"abortController");N(this,"resetController");N(this,"closeController");N(this,"sourceEnded");N(this,"sinkEnded");N(this,"sinkSunk");N(this,"endErr");N(this,"streamSource");N(this,"onEnd");N(this,"maxDataSize");this.abortController=new AbortController,this.resetController=new AbortController,this.closeController=new AbortController,this.sourceEnded=!1,this.sinkEnded=!1,this.sinkSunk=!1,this.id=e.id,this.metadata=e.metadata??{},this.stat={direction:e.direction,timeline:{open:Date.now()}},this.maxDataSize=e.maxDataSize,this.onEnd=e.onEnd,this.source=this.streamSource=$r({onEnd:()=>{if(this.stat.timeline.reset!==null){const t=this.sendCloseRead();Jc(t)&&t.catch(n=>{Es.error("error while sending close read",n)})}this.onSourceEnd()}}),this.sink=this.sink.bind(this)}onSourceEnd(e){this.sourceEnded||(this.stat.timeline.closeRead=Date.now(),this.sourceEnded=!0,Es.trace("%s stream %s source end - err: %o",this.stat.direction,this.id,e),e!=null&&this.endErr==null&&(this.endErr=e),this.sinkEnded&&(this.stat.timeline.close=Date.now(),this.onEnd!=null&&this.onEnd(this.endErr)))}onSinkEnd(e){this.sinkEnded||(this.stat.timeline.closeWrite=Date.now(),this.sinkEnded=!0,Es.trace("%s stream %s sink end - err: %o",this.stat.direction,this.id,e),e!=null&&this.endErr==null&&(this.endErr=e),this.sourceEnded&&(this.stat.timeline.close=Date.now(),this.onEnd!=null&&this.onEnd(this.endErr)))}close(){Es.trace("%s stream %s close",this.stat.direction,this.id),this.closeRead(),this.closeWrite()}closeRead(){Es.trace("%s stream %s closeRead",this.stat.direction,this.id),!this.sourceEnded&&this.streamSource.end()}closeWrite(){if(Es.trace("%s stream %s closeWrite",this.stat.direction,this.id),!this.sinkEnded){this.closeController.abort();try{const e=this.sendCloseWrite();Jc(e)&&e.catch(t=>{Es.error("error while sending close write",t)})}catch(e){Es.trace("%s stream %s error sending close",this.stat.direction,this.id,e)}this.onSinkEnd()}}abort(e){Es.trace("%s stream %s abort",this.stat.direction,this.id,e),this.streamSource.end(e),this.abortController.abort(),this.onSinkEnd(e)}reset(){const e=new L("stream reset",O3);this.resetController.abort(),this.streamSource.end(e),this.onSinkEnd(e)}async sink(e){if(this.sinkSunk)throw new L("sink already called on stream",CG);if(this.sinkSunk=!0,this.sinkEnded)throw new L("stream closed for writing",RG);const t=MO([this.abortController.signal,this.resetController.signal,this.closeController.signal]);try{if(e=m1(e,t),this.stat.direction==="outbound"){const n=this.sendNewStream();Jc(n)&&await n}for await(let n of e)for(;n.length>0;){if(n.length<=this.maxDataSize){const i=this.sendData(n instanceof Uint8Array?new Se(n):n);Jc(i)&&await i;break}n=n instanceof Uint8Array?new Se(n):n;const s=this.sendData(n.sublist(0,this.maxDataSize));Jc(s)&&await s,n.consume(this.maxDataSize)}}catch(n){if(n.type==="aborted"&&n.message==="The operation was aborted"){if(this.closeController.signal.aborted)return;this.resetController.signal.aborted&&(n.message="stream reset",n.code=O3),this.abortController.signal.aborted&&(n.message="stream aborted",n.code=IG)}if(n.code===O3)Es.trace("%s stream %s reset",this.stat.direction,this.id);else{Es.trace("%s stream %s error",this.stat.direction,this.id,n);try{const s=this.sendReset();Jc(s)&&await s,this.stat.timeline.reset=Date.now()}catch(s){Es.trace("%s stream %s error sending reset",this.stat.direction,this.id,s)}}throw this.streamSource.end(n),this.onSinkEnd(n),n}finally{t.clear()}try{const n=this.sendCloseWrite();Jc(n)&&await n}catch(n){Es.trace("%s stream %s error sending close",this.stat.direction,this.id,n)}this.onSinkEnd()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}class DG extends xG{constructor(t){super(t);N(this,"name");N(this,"streamId");N(this,"send");N(this,"types");this.types=t.direction==="outbound"?mS:nG,this.send=t.send,this.name=t.name,this.streamId=t.streamId}sendNewStream(){this.send({id:this.streamId,type:mS.NEW_STREAM,data:new Se(M(this.name))})}sendData(t){this.send({id:this.streamId,type:this.types.MESSAGE,data:t})}sendReset(){this.send({id:this.streamId,type:this.types.RESET})}sendCloseWrite(){this.send({id:this.streamId,type:this.types.CLOSE})}sendCloseRead(){}}function PG(r){const{id:e,name:t,send:n,onEnd:s,type:i="initiator",maxMsgSize:o=qO}=r;return new DG({id:i==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:i==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:s,send:n})}const Si=U("libp2p:mplex"),OG=1024,kG=1024,NG=1024*1024*4,LG=5;function IS(r){const e={...r,type:`${N7[r.type]} (${r.type})`};return r.type===Qe.NEW_STREAM&&(e.data=R(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===Qe.MESSAGE_INITIATOR||r.type===Qe.MESSAGE_RECEIVER)&&(e.data=R(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}let MG=class{constructor(e){N(this,"protocol","/mplex/6.7.0");N(this,"sink");N(this,"source");N(this,"_streamId");N(this,"_streams");N(this,"_init");N(this,"_source");N(this,"closeController");N(this,"rateLimiter");e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();const t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new k7.RateLimiterMemory({points:e.disconnectThreshold??LG,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){this.closeController.signal.aborted||(e!=null?this.streams.forEach(t=>{t.abort(e)}):this.streams.forEach(t=>{t.close()}),this.closeController.abort())}_newReceiverStream(e){const{id:t,name:n}=e,s=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:s})}_newStream(e){const{id:t,name:n,type:s,registry:i}=e;if(Si("new %s stream %s",s,t),s==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??kG))throw new L("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(i.has(t))throw new Error(`${s} stream ${t} already exists!`);const c=PG({id:t,name:n,send:u=>{Si.enabled&&Si.trace("%s stream %s send",s,t,IS(u)),this._source.push(u)},type:s,onEnd:()=>{Si("%s stream with id %s and protocol %s ended",s,t,c.stat.protocol),i.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize});return i.set(t,c),c}_createSink(){return async t=>{const n=MO([this.closeController.signal,this._init.signal]);try{t=m1(t,n);const s=new iG(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const i of t)for(const o of s.write(i))await this._handleIncoming(o);this._source.end()}catch(s){Si("error in sink",s),this._source.end(s)}finally{n.clear()}}}_createSource(){const t=$O({objectMode:!0,onEnd:n=>{this.close(n)}});return Object.assign(TG(t,this._init.minSendBytes),{push:t.push,end:t.end,return:t.return})}async _handleIncoming(e){const{id:t,type:n}=e;if(Si.enabled&&Si.trace("incoming message",IS(e)),e.type===Qe.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??OG)){Si("too many inbound streams open"),this._source.push({id:t,type:Qe.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{Si("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this._source.end(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:R(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const i=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(i==null){Si("missing stream %s for message type %s",t,N7[n]);return}const o=this._init.maxStreamBufferSize??NG;switch(n){case Qe.MESSAGE_INITIATOR:case Qe.MESSAGE_RECEIVER:if(i.sourceReadableLength()>o){this._source.push({id:e.id,type:n===Qe.MESSAGE_INITIATOR?Qe.RESET_RECEIVER:Qe.RESET_INITIATOR});const a=new L("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");i.abort(a);return}i.sourcePush(e.data);break;case Qe.CLOSE_INITIATOR:case Qe.CLOSE_RECEIVER:i.closeRead();break;case Qe.RESET_INITIATOR:case Qe.RESET_RECEIVER:i.reset();break;default:Si("unknown message type %s",n)}}},UG=class{constructor(e={}){N(this,"protocol","/mplex/6.7.0");N(this,"_init");this._init=e}createStreamMuxer(e={}){return new MG({...e,...this._init})}};function BG(r={}){return()=>new UG(r)}var zG=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype};const K2=zG,{hasOwnProperty:GO}=Object.prototype,{propertyIsEnumerable:FG}=Object,bh=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),VG=Is,RS={concatArrays:!1,ignoreUndefined:!1},Fw=r=>{const e=[];for(const t in r)GO.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)FG.call(r,n)&&e.push(n)}return e};function Gh(r){return Array.isArray(r)?jG(r):K2(r)?KG(r):r}function jG(r){const e=r.slice(0,0);return Fw(r).forEach(t=>{bh(e,t,Gh(r[t]))}),e}function KG(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return Fw(r).forEach(t=>{bh(e,t,Gh(r[t]))}),e}const WO=(r,e,t,n)=>(t.forEach(s=>{typeof e[s]>"u"&&n.ignoreUndefined||(s in r&&r[s]!==Object.getPrototypeOf(r)?bh(r,s,Mm(r[s],e[s],n)):bh(r,s,Gh(e[s])))}),r),qG=(r,e,t)=>{let n=r.slice(0,0),s=0;return[r,e].forEach(i=>{const o=[];for(let a=0;a<i.length;a++)GO.call(i,a)&&(o.push(String(a)),i===r?bh(n,s++,i[a]):bh(n,s++,Gh(i[a])));n=WO(n,i,Fw(i).filter(a=>!o.includes(a)),t)}),n};function Mm(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?qG(r,e,t):!K2(e)||!K2(r)?Gh(e):WO(r,e,Fw(e),t)}var HG=function(...r){const e=Mm(Gh(RS),this!==VG&&this||{},RS);let t={_:{}};for(const n of r)if(n!==void 0){if(!K2(n))throw new TypeError("`"+n+"` is not an Option Object");t=Mm(t,{_:n},e)}return t._};const kt=Et(HG),GG=Object.freeze(Object.defineProperty({__proto__:null,default:kt},Symbol.toStringTag,{value:"Module"})),WG=bq,Vw=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,dp=WG(),QG=Vw&&!dp,YG=dp&&!Vw,XG=dp&&Vw,JG=typeof P7=="function"&&typeof Zi<"u"&&typeof Zi.release<"u"&&Zi.release.name==="node"&&!dp,ZG=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,eW=typeof Zi<"u"&&typeof Zi.env<"u"&&!1,tW=typeof navigator<"u"&&navigator.product==="ReactNative";var pa={isTest:eW,isElectron:dp,isElectronMain:YG,isElectronRenderer:XG,isNode:JG,isBrowser:QG,isWebWorker:ZG,isEnvWithDom:Vw,isReactNative:tW};function CS(r,e){for(const t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function rW(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return CS(r,t)}catch{t.message=r.message,t.stack=r.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(r)),CS(new s,t)}}var nW=rW;const T=Et(nW);var QO={},YO={},sW=v1,L7=TO();(v1.prototype=Object.create(L7.EventEmitter.prototype)).constructor=v1;function v1(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");L7.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!e,this.responseDelimited=!!t}v1.prototype.rpcCall=function r(e,t,n,s,i){if(!s)throw TypeError("request must be specified");var o=this;if(!i)return L7.asPromise(r,o,e,t,n,s);if(!o.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(c,u){if(c)return o.emit("error",c,e),i(c);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return o.emit("error",l,e),i(l)}return o.emit("data",u,e),i(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){i(a)},0);return}};v1.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(r){var e=r;e.Service=sW})(YO);var iW={};(function(r){var e=r;e.build="minimal",e.Writer=mq,e.BufferWriter=Eq,e.Reader=vq,e.BufferReader=_q,e.util=TO(),e.rpc=YO,e.roots=iW,e.configure=t;function t(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}t()})(QO);var oW=QO;const le=Et(oW),mh=le.Reader,M7=le.Writer,ge=le.util,kr=le.roots["ipfs-unixfs"]||(le.roots["ipfs-unixfs"]={}),aW=kr.Data=(()=>{function r(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Type=0,r.prototype.Data=ge.newBuffer([]),r.prototype.filesize=ge.Long?ge.Long.fromBits(0,0,!0):0,r.prototype.blocksizes=ge.emptyArray,r.prototype.hashType=ge.Long?ge.Long.fromBits(0,0,!0):0,r.prototype.fanout=ge.Long?ge.Long.fromBits(0,0,!0):0,r.prototype.mode=0,r.prototype.mtime=null,r.encode=function(t,n){if(n||(n=M7.create()),n.uint32(8).int32(t.Type),t.Data!=null&&Object.hasOwnProperty.call(t,"Data")&&n.uint32(18).bytes(t.Data),t.filesize!=null&&Object.hasOwnProperty.call(t,"filesize")&&n.uint32(24).uint64(t.filesize),t.blocksizes!=null&&t.blocksizes.length)for(var s=0;s<t.blocksizes.length;++s)n.uint32(32).uint64(t.blocksizes[s]);return t.hashType!=null&&Object.hasOwnProperty.call(t,"hashType")&&n.uint32(40).uint64(t.hashType),t.fanout!=null&&Object.hasOwnProperty.call(t,"fanout")&&n.uint32(48).uint64(t.fanout),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&n.uint32(56).uint32(t.mode),t.mtime!=null&&Object.hasOwnProperty.call(t,"mtime")&&kr.UnixTime.encode(t.mtime,n.uint32(66).fork()).ldelim(),n},r.decode=function(t,n){t instanceof mh||(t=mh.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new kr.Data;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.Type=t.int32();break;case 2:i.Data=t.bytes();break;case 3:i.filesize=t.uint64();break;case 4:if(i.blocksizes&&i.blocksizes.length||(i.blocksizes=[]),(o&7)===2)for(var a=t.uint32()+t.pos;t.pos<a;)i.blocksizes.push(t.uint64());else i.blocksizes.push(t.uint64());break;case 5:i.hashType=t.uint64();break;case 6:i.fanout=t.uint64();break;case 7:i.mode=t.uint32();break;case 8:i.mtime=kr.UnixTime.decode(t,t.uint32());break;default:t.skipType(o&7);break}}if(!i.hasOwnProperty("Type"))throw ge.ProtocolError("missing required 'Type'",{instance:i});return i},r.fromObject=function(t){if(t instanceof kr.Data)return t;var n=new kr.Data;switch(t.Type){case"Raw":case 0:n.Type=0;break;case"Directory":case 1:n.Type=1;break;case"File":case 2:n.Type=2;break;case"Metadata":case 3:n.Type=3;break;case"Symlink":case 4:n.Type=4;break;case"HAMTShard":case 5:n.Type=5;break}if(t.Data!=null&&(typeof t.Data=="string"?ge.base64.decode(t.Data,n.Data=ge.newBuffer(ge.base64.length(t.Data)),0):t.Data.length&&(n.Data=t.Data)),t.filesize!=null&&(ge.Long?(n.filesize=ge.Long.fromValue(t.filesize)).unsigned=!0:typeof t.filesize=="string"?n.filesize=parseInt(t.filesize,10):typeof t.filesize=="number"?n.filesize=t.filesize:typeof t.filesize=="object"&&(n.filesize=new ge.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");n.blocksizes=[];for(var s=0;s<t.blocksizes.length;++s)ge.Long?(n.blocksizes[s]=ge.Long.fromValue(t.blocksizes[s])).unsigned=!0:typeof t.blocksizes[s]=="string"?n.blocksizes[s]=parseInt(t.blocksizes[s],10):typeof t.blocksizes[s]=="number"?n.blocksizes[s]=t.blocksizes[s]:typeof t.blocksizes[s]=="object"&&(n.blocksizes[s]=new ge.LongBits(t.blocksizes[s].low>>>0,t.blocksizes[s].high>>>0).toNumber(!0))}if(t.hashType!=null&&(ge.Long?(n.hashType=ge.Long.fromValue(t.hashType)).unsigned=!0:typeof t.hashType=="string"?n.hashType=parseInt(t.hashType,10):typeof t.hashType=="number"?n.hashType=t.hashType:typeof t.hashType=="object"&&(n.hashType=new ge.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),t.fanout!=null&&(ge.Long?(n.fanout=ge.Long.fromValue(t.fanout)).unsigned=!0:typeof t.fanout=="string"?n.fanout=parseInt(t.fanout,10):typeof t.fanout=="number"?n.fanout=t.fanout:typeof t.fanout=="object"&&(n.fanout=new ge.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),t.mode!=null&&(n.mode=t.mode>>>0),t.mtime!=null){if(typeof t.mtime!="object")throw TypeError(".Data.mtime: object expected");n.mtime=kr.UnixTime.fromObject(t.mtime)}return n},r.toObject=function(t,n){n||(n={});var s={};if((n.arrays||n.defaults)&&(s.blocksizes=[]),n.defaults){if(s.Type=n.enums===String?"Raw":0,n.bytes===String?s.Data="":(s.Data=[],n.bytes!==Array&&(s.Data=ge.newBuffer(s.Data))),ge.Long){var i=new ge.Long(0,0,!0);s.filesize=n.longs===String?i.toString():n.longs===Number?i.toNumber():i}else s.filesize=n.longs===String?"0":0;if(ge.Long){var i=new ge.Long(0,0,!0);s.hashType=n.longs===String?i.toString():n.longs===Number?i.toNumber():i}else s.hashType=n.longs===String?"0":0;if(ge.Long){var i=new ge.Long(0,0,!0);s.fanout=n.longs===String?i.toString():n.longs===Number?i.toNumber():i}else s.fanout=n.longs===String?"0":0;s.mode=0,s.mtime=null}if(t.Type!=null&&t.hasOwnProperty("Type")&&(s.Type=n.enums===String?kr.Data.DataType[t.Type]:t.Type),t.Data!=null&&t.hasOwnProperty("Data")&&(s.Data=n.bytes===String?ge.base64.encode(t.Data,0,t.Data.length):n.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),t.filesize!=null&&t.hasOwnProperty("filesize")&&(typeof t.filesize=="number"?s.filesize=n.longs===String?String(t.filesize):t.filesize:s.filesize=n.longs===String?ge.Long.prototype.toString.call(t.filesize):n.longs===Number?new ge.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){s.blocksizes=[];for(var o=0;o<t.blocksizes.length;++o)typeof t.blocksizes[o]=="number"?s.blocksizes[o]=n.longs===String?String(t.blocksizes[o]):t.blocksizes[o]:s.blocksizes[o]=n.longs===String?ge.Long.prototype.toString.call(t.blocksizes[o]):n.longs===Number?new ge.LongBits(t.blocksizes[o].low>>>0,t.blocksizes[o].high>>>0).toNumber(!0):t.blocksizes[o]}return t.hashType!=null&&t.hasOwnProperty("hashType")&&(typeof t.hashType=="number"?s.hashType=n.longs===String?String(t.hashType):t.hashType:s.hashType=n.longs===String?ge.Long.prototype.toString.call(t.hashType):n.longs===Number?new ge.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),t.fanout!=null&&t.hasOwnProperty("fanout")&&(typeof t.fanout=="number"?s.fanout=n.longs===String?String(t.fanout):t.fanout:s.fanout=n.longs===String?ge.Long.prototype.toString.call(t.fanout):n.longs===Number?new ge.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),t.mode!=null&&t.hasOwnProperty("mode")&&(s.mode=t.mode),t.mtime!=null&&t.hasOwnProperty("mtime")&&(s.mtime=kr.UnixTime.toObject(t.mtime,n)),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),r})();kr.UnixTime=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.Seconds=ge.Long?ge.Long.fromBits(0,0,!1):0,r.prototype.FractionalNanoseconds=0,r.encode=function(t,n){return n||(n=M7.create()),n.uint32(8).int64(t.Seconds),t.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&n.uint32(21).fixed32(t.FractionalNanoseconds),n},r.decode=function(t,n){t instanceof mh||(t=mh.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new kr.UnixTime;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.Seconds=t.int64();break;case 2:i.FractionalNanoseconds=t.fixed32();break;default:t.skipType(o&7);break}}if(!i.hasOwnProperty("Seconds"))throw ge.ProtocolError("missing required 'Seconds'",{instance:i});return i},r.fromObject=function(t){if(t instanceof kr.UnixTime)return t;var n=new kr.UnixTime;return t.Seconds!=null&&(ge.Long?(n.Seconds=ge.Long.fromValue(t.Seconds)).unsigned=!1:typeof t.Seconds=="string"?n.Seconds=parseInt(t.Seconds,10):typeof t.Seconds=="number"?n.Seconds=t.Seconds:typeof t.Seconds=="object"&&(n.Seconds=new ge.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),t.FractionalNanoseconds!=null&&(n.FractionalNanoseconds=t.FractionalNanoseconds>>>0),n},r.toObject=function(t,n){n||(n={});var s={};if(n.defaults){if(ge.Long){var i=new ge.Long(0,0,!1);s.Seconds=n.longs===String?i.toString():n.longs===Number?i.toNumber():i}else s.Seconds=n.longs===String?"0":0;s.FractionalNanoseconds=0}return t.Seconds!=null&&t.hasOwnProperty("Seconds")&&(typeof t.Seconds=="number"?s.Seconds=n.longs===String?String(t.Seconds):t.Seconds:s.Seconds=n.longs===String?ge.Long.prototype.toString.call(t.Seconds):n.longs===Number?new ge.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),t.FractionalNanoseconds!=null&&t.hasOwnProperty("FractionalNanoseconds")&&(s.FractionalNanoseconds=t.FractionalNanoseconds),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r})();kr.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.MimeType="",r.encode=function(t,n){return n||(n=M7.create()),t.MimeType!=null&&Object.hasOwnProperty.call(t,"MimeType")&&n.uint32(10).string(t.MimeType),n},r.decode=function(t,n){t instanceof mh||(t=mh.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new kr.Metadata;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.MimeType=t.string();break;default:t.skipType(o&7);break}}return i},r.fromObject=function(t){if(t instanceof kr.Metadata)return t;var n=new kr.Metadata;return t.MimeType!=null&&(n.MimeType=String(t.MimeType)),n},r.toObject=function(t,n){n||(n={});var s={};return n.defaults&&(s.MimeType=""),t.MimeType!=null&&t.hasOwnProperty("MimeType")&&(s.MimeType=t.MimeType),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r})();const Bo=aW,xS=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],cW=["directory","hamt-sharded-directory"],DS=parseInt("0644",8),PS=parseInt("0755",8);function sh(r){if(r!=null)return typeof r=="number"?r&4095:(r=r.toString(),r.substring(0,1)==="0"?parseInt(r,8)&4095:parseInt(r,10)&4095)}function _1(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){const t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw T(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}class Ot{static unmarshal(e){const t=Bo.decode(e),n=Bo.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),s=new Ot({type:xS[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return s._originalMode=n.mode||0,s}constructor(e={type:"file"}){const{type:t,data:n,blockSizes:s,hashType:i,fanout:o,mtime:a,mode:c}=e;if(t&&!xS.includes(t))throw T(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=i,this.fanout=o,this.blockSizes=s||[],this._originalMode=0,this.mode=sh(c),a&&(this.mtime=_1(a),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?PS:DS;const t=sh(e);t!==void 0&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return!!(this.type&&cW.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach(t=>{e+=t}),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=Bo.DataType.Raw;break;case"directory":e=Bo.DataType.Directory;break;case"file":e=Bo.DataType.File;break;case"metadata":e=Bo.DataType.Metadata;break;case"symlink":e=Bo.DataType.Symlink;break;case"hamt-sharded-directory":e=Bo.DataType.HAMTShard;break;default:throw T(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t=this.data;(!this.data||!this.data.length)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(sh(this.mode)||0),n===DS&&!this.isDirectory()&&(n=void 0),n===PS&&this.isDirectory()&&(n=void 0));let s;if(this.mtime!=null){const o=_1(this.mtime);o&&(s={Seconds:o.secs,FractionalNanoseconds:o.nsecs},s.FractionalNanoseconds===0&&delete s.FractionalNanoseconds)}const i={Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:s};return Bo.encode(i).finish()}}var lW=XO,OS=128,uW=127,hW=~uW,dW=Math.pow(2,31);function XO(r,e,t){e=e||[],t=t||0;for(var n=t;r>=dW;)e[t++]=r&255|OS,r/=128;for(;r&hW;)e[t++]=r&255|OS,r>>>=7;return e[t]=r|0,XO.bytes=t-n+1,e}var fW=Um,pW=128,kS=127;function Um(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Um.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&kS)<<s:(o&kS)*Math.pow(2,s),s+=7}while(o>=pW);return Um.bytes=i-n,t}var yW=Math.pow(2,7),gW=Math.pow(2,14),wW=Math.pow(2,21),bW=Math.pow(2,28),mW=Math.pow(2,35),EW=Math.pow(2,42),vW=Math.pow(2,49),_W=Math.pow(2,56),SW=Math.pow(2,63),AW=function(r){return r<yW?1:r<gW?2:r<wW?3:r<bW?4:r<mW?5:r<EW?6:r<vW?7:r<_W?8:r<SW?9:10},$W={encode:lW,decode:fW,encodingLength:AW},q2=$W;const Bm=(r,e=0)=>[q2.decode(r,e),q2.decode.bytes],H2=(r,e,t=0)=>(q2.encode(r,e,t),e),G2=r=>q2.encodingLength(r),TW=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},U7=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},IW=(r,e)=>{const t=e.byteLength,n=G2(r),s=n+G2(t),i=new Uint8Array(s+t);return H2(r,i,0),H2(t,i,n),i.set(e,s),new B7(r,t,e,i)},RW=r=>{const e=U7(r),[t,n]=Bm(e),[s,i]=Bm(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new B7(t,s,o,e)},CW=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&TW(r.bytes,t.bytes)}};let B7=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function xW(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var DW=xW,PW=DW;let OW=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},kW=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return JO(this,e)}},NW=class{constructor(e){this.decoders=e}or(e){return JO(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const JO=(r,e)=>new NW({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let LW=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new OW(e,t,n),this.decoder=new kW(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ZO=({name:r,prefix:e,encode:t,decode:n})=>new LW(r,e,t,n),ek=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=PW(t,e);return ZO({prefix:r,name:e,encode:n,decode:i=>U7(s(i))})},MW=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},UW=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},ga=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>ZO({prefix:e,name:r,encode(s){return UW(s,n,t)},decode(s){return MW(s,n,t,r)}}),ja=ek({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ek({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const d2=ga({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ga({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ga({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ga({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ga({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ga({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ga({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ga({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ga({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const NS=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return zW(t,zm(r),e||ja.encoder);default:return FW(t,zm(r),e||d2.encoder)}},LS=new WeakMap,zm=r=>{const e=LS.get(r);if(e==null){const t=new Map;return LS.set(r,t),t}return e};let Vf=class An{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Sd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==VW)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return An.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=IW(e,t);return An.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return An.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&CW(e.multihash,n.multihash)}toString(e){return NS(this,e)}toJSON(){return{"/":NS(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof An)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new An(n,s,i,o||MS(n,s,i.bytes))}else if(t[jW]===!0){const{version:n,multihash:s,code:i}=t,o=RW(s);return An.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Sd)throw new Error(`Version 0 CID must use dag-pb (code: ${Sd}) block encoding`);return new An(e,t,n,n.bytes)}case 1:{const s=MS(e,t,n.bytes);return new An(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return An.create(0,Sd,e)}static createV1(e,t){return An.create(1,e,t)}static decode(e){const[t,n]=An.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=An.inspectBytes(e),n=t.size-t.multihashSize,s=U7(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new B7(t.multihashCode,t.digestSize,i,s);return[t.version===0?An.createV0(o):An.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=Bm(e.subarray(t));return t+=f,h};let s=n(),i=Sd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=BW(e,t),i=An.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return zm(i).set(n,e),i}};const BW=(r,e)=>{switch(r[0]){case"Q":{const t=e||ja;return[ja.prefix,t.decode(`${ja.prefix}${r}`)]}case ja.prefix:{const t=e||ja;return[ja.prefix,t.decode(r)]}case d2.prefix:{const t=e||d2;return[d2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},zW=(r,e,t)=>{const{prefix:n}=t;if(n!==ja.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},FW=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Sd=112,VW=18,MS=(r,e,t)=>{const n=G2(r),s=n+G2(e),i=new Uint8Array(s+t.byteLength);return H2(r,i,0),H2(e,i,n),i.set(t,s),i},jW=Symbol.for("@ipld/js-cid/CID"),KW=new TextDecoder;function z7(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const s=r[e++];if(t+=n<28?(s&127)<<n:(s&127)*2**n,s<128)break}return[t,e]}function W2(r,e){let t;[t,e]=z7(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function tk(r,e){let t;return[t,e]=z7(r,e),[t&7,t>>3,e]}function qW(r){const e={},t=r.length;let n=0;for(;n<t;){let s,i;if([s,i,n]=tk(r,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=W2(r,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=W2(r,n),e.Name=KW.decode(o)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(s!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Tsize`);[e.Tsize,n]=z7(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function HW(r){const e=r.length;let t=0,n,s=!1,i;for(;t<e;){let a,c;if([a,c,t]=tk(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,t]=W2(r,t),n&&(s=!0)}else if(c===2){if(s)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,t]=W2(r,t),n.push(qW(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return i&&(o.Data=i),o.Links=n||[],o}const rk=new TextEncoder,US=2**32,GW=2**31;function WW(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=Jf(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=rk.encode(r.Name);t-=n.length,e.set(n,t),t=Jf(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=Jf(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function QW(r){const e=XW(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=Jf(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let s=r.Links.length-1;s>=0;s--){const i=WW(r.Links[s],t.subarray(0,n));n-=i,n=Jf(t,n,i)-1,t[n]=18}return t}function YW(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+ih(t)}if(typeof r.Name=="string"){const t=rk.encode(r.Name).length;e+=1+t+ih(t)}return typeof r.Tsize=="number"&&(e+=1+ih(r.Tsize)),e}function XW(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+ih(t)}if(r.Links)for(const t of r.Links){const n=YW(t);e+=1+n+ih(n)}return e}function Jf(r,e,t){e-=ih(t);const n=e;for(;t>=GW;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function ih(r){return r%2===0&&r++,Math.floor((JW(r)+6)/7)}function JW(r){let e=0;return r>=US&&(r=Math.floor(r/US),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+ZW[r]}const ZW=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],eQ=["Data","Links"],tQ=["Hash","Name","Tsize"],Fm=new TextEncoder;function nk(r,e){if(r===e)return 0;const t=r.Name?Fm.encode(r.Name):[],n=e.Name?Fm.encode(e.Name):[];let s=t.length,i=n.length;for(let o=0,a=Math.min(s,i);o<a;++o)if(t[o]!==n[o]){s=t[o],i=n[o];break}return s<i?-1:i<s?1:0}function BS(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function sk(r){if(typeof r.asCID=="object"){const t=Vf.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=Vf.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=Vf.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=Vf.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function To(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=Fm.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(sk),e.Links.sort(nk);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function ik(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!BS(r,eQ))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!BS(t,tQ))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&nk(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function rQ(r,e=[]){return To({Data:r,Links:e})}function nQ(r,e,t){return sk({Hash:t,Name:r,Tsize:e})}const sQ="dag-pb",jt=112;function Ct(r){ik(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),QW(e)}function hr(r){const e=HW(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{const s={};try{s.Hash=Vf.decode(n.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(s.Name=n.Name),n.Tsize!==void 0&&(s.Tsize=n.Tsize),s})),t}const kc=Object.freeze(Object.defineProperty({__proto__:null,code:jt,createLink:nQ,createNode:rQ,decode:hr,encode:Ct,name:sQ,prepare:To,validate:ik},Symbol.toStringTag,{value:"Module"})),iQ=["string","number","bigint","symbol"],oQ=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function aQ(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(iQ.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(cQ(r))return"Buffer";const t=lQ(r);return t||"Object"}function cQ(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function lQ(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(oQ.includes(e))return e}let B=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};B.uint=new B(0,"uint",!0);B.negint=new B(1,"negint",!0);B.bytes=new B(2,"bytes",!0);B.string=new B(3,"string",!0);B.array=new B(4,"array",!1);B.map=new B(5,"map",!1);B.tag=new B(6,"tag",!1);B.float=new B(7,"float",!0);B.false=new B(7,"false",!0);B.true=new B(7,"true",!0);B.null=new B(7,"null",!0);B.undefined=new B(7,"undefined",!0);B.break=new B(7,"break",!0);let he=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};const Wh=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",uQ=new TextDecoder,hQ=new TextEncoder;function Q2(r){return Wh&&globalThis.Buffer.isBuffer(r)}function ok(r){return r instanceof Uint8Array?Q2(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const dQ=Wh?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):FS(r,e,t):(r,e,t)=>t-e>64?uQ.decode(r.subarray(e,t)):FS(r,e,t),fQ=Wh?r=>r.length>64?globalThis.Buffer.from(r):zS(r):r=>r.length>64?hQ.encode(r):zS(r),zo=r=>Uint8Array.from(r),F7=Wh?(r,e,t)=>Q2(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),pQ=Wh?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),ok(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let s of r)n+s.length>t.length&&(s=s.subarray(0,t.length-n)),t.set(s,n),n+=s.length;return t},yQ=Wh?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function gQ(r,e){if(Q2(r)&&Q2(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function zS(r,e=1/0){let t;const n=r.length;let s=null;const i=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&i.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&i.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&i.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;i.push(t)}else if(t<2048){if((e-=2)<0)break;i.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;i.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return i}function FS(r,e,t){const n=[];for(;e<t;){const s=r[e];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(e+o<=t){let a,c,u,l;switch(o){case 1:s<128&&(i=s);break;case 2:a=r[e+1],(a&192)===128&&(l=(s&31)<<6|a&63,l>127&&(i=l));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(l=(s&15)<<12|(a&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(l=(s&15)<<18|(a&63)<<12|(c&63)<<6|u&63,l>65535&&l<1114112&&(i=l))}}i===null?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=o}return wQ(n)}const VS=4096;function wQ(r){const e=r.length;if(e<=VS)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=VS));return t}const bQ=256;let ak=class{constructor(e=bQ){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const s=t.length-(this.maxCursor-this.cursor)-1;t.set(e,s)}else{if(t){const s=t.length-(this.maxCursor-this.cursor)-1;s<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,s),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=yQ(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=F7(n,0,this.cursor)}else t=pQ(this.chunks,this.cursor);return e&&this.reset(),t}};const Oe="CBOR decode error:",ck="CBOR encode error:";function Qh(r,e,t){if(r.length-e<t)throw new Error(`${Oe} not enough data for type`)}const Lr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function eu(r,e,t){Qh(r,e,1);const n=r[e];if(t.strict===!0&&n<Lr[0])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function tu(r,e,t){Qh(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<Lr[1])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function ru(r,e,t){Qh(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<Lr[2])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);return n}function nu(r,e,t){Qh(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],s=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(t.strict===!0&&i<Lr[3])throw new Error(`${Oe} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${Oe} integers outside of the safe integer range are not supported`)}function mQ(r,e,t,n){return new he(B.uint,eu(r,e+1,n),2)}function EQ(r,e,t,n){return new he(B.uint,tu(r,e+1,n),3)}function vQ(r,e,t,n){return new he(B.uint,ru(r,e+1,n),5)}function _Q(r,e,t,n){return new he(B.uint,nu(r,e+1,n),9)}function su(r,e){return wi(r,0,e.value)}function wi(r,e,t){if(t<Lr[0]){const n=Number(t);r.push([e|n])}else if(t<Lr[1]){const n=Number(t);r.push([e|24,n])}else if(t<Lr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<Lr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<Lr[4]){const s=[e|27,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));s[8]=i&255,i=i>>8,s[7]=i&255,i=i>>8,s[6]=i&255,i=i>>8,s[5]=i&255,s[4]=o&255,o=o>>8,s[3]=o&255,o=o>>8,s[2]=o&255,o=o>>8,s[1]=o&255,r.push(s)}else throw new Error(`${Oe} encountered BigInt larger than allowable range`)}}su.encodedSize=function(e){return wi.encodedSize(e.value)};wi.encodedSize=function(e){return e<Lr[0]?1:e<Lr[1]?2:e<Lr[2]?3:e<Lr[3]?5:9};su.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function SQ(r,e,t,n){return new he(B.negint,-1-eu(r,e+1,n),2)}function AQ(r,e,t,n){return new he(B.negint,-1-tu(r,e+1,n),3)}function $Q(r,e,t,n){return new he(B.negint,-1-ru(r,e+1,n),5)}const V7=BigInt(-1),lk=BigInt(1);function TQ(r,e,t,n){const s=nu(r,e+1,n);if(typeof s!="bigint"){const i=-1-s;if(i>=Number.MIN_SAFE_INTEGER)return new he(B.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${Oe} integers outside of the safe integer range are not supported`);return new he(B.negint,V7-BigInt(s),9)}function j7(r,e){const t=e.value,n=typeof t=="bigint"?t*V7-lk:t*-1-1;wi(r,e.type.majorEncoded,n)}j7.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*V7-lk:t*-1-1;return n<Lr[0]?1:n<Lr[1]?2:n<Lr[2]?3:n<Lr[3]?5:9};j7.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function fp(r,e,t,n){Qh(r,e,t+n);const s=F7(r,e+t,e+t+n);return new he(B.bytes,s,t+n)}function IQ(r,e,t,n){return fp(r,e,1,t)}function RQ(r,e,t,n){return fp(r,e,2,eu(r,e+1,n))}function CQ(r,e,t,n){return fp(r,e,3,tu(r,e+1,n))}function xQ(r,e,t,n){return fp(r,e,5,ru(r,e+1,n))}function DQ(r,e,t,n){const s=nu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer bytes lengths not supported`);return fp(r,e,9,s)}function Y2(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===B.string?fQ(r.value):r.value),r.encodedBytes}function jw(r,e){const t=Y2(e);wi(r,e.type.majorEncoded,t.length),r.push(t)}jw.encodedSize=function(e){const t=Y2(e);return wi.encodedSize(t.length)+t.length};jw.compareTokens=function(e,t){return PQ(Y2(e),Y2(t))};function PQ(r,e){return r.length<e.length?-1:r.length>e.length?1:gQ(r,e)}function pp(r,e,t,n,s){const i=t+n;Qh(r,e,i);const o=new he(B.string,dQ(r,e+t,e+i),i);return s.retainStringBytes===!0&&(o.byteValue=F7(r,e+t,e+i)),o}function OQ(r,e,t,n){return pp(r,e,1,t,n)}function kQ(r,e,t,n){return pp(r,e,2,eu(r,e+1,n),n)}function NQ(r,e,t,n){return pp(r,e,3,tu(r,e+1,n),n)}function LQ(r,e,t,n){return pp(r,e,5,ru(r,e+1,n),n)}function MQ(r,e,t,n){const s=nu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer string lengths not supported`);return pp(r,e,9,s,n)}const UQ=jw;function Yh(r,e,t,n){return new he(B.array,n,t)}function BQ(r,e,t,n){return Yh(r,e,1,t)}function zQ(r,e,t,n){return Yh(r,e,2,eu(r,e+1,n))}function FQ(r,e,t,n){return Yh(r,e,3,tu(r,e+1,n))}function VQ(r,e,t,n){return Yh(r,e,5,ru(r,e+1,n))}function jQ(r,e,t,n){const s=nu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer array lengths not supported`);return Yh(r,e,9,s)}function KQ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return Yh(r,e,1,1/0)}function K7(r,e){wi(r,B.array.majorEncoded,e.value)}K7.compareTokens=su.compareTokens;K7.encodedSize=function(e){return wi.encodedSize(e.value)};function Xh(r,e,t,n){return new he(B.map,n,t)}function qQ(r,e,t,n){return Xh(r,e,1,t)}function HQ(r,e,t,n){return Xh(r,e,2,eu(r,e+1,n))}function GQ(r,e,t,n){return Xh(r,e,3,tu(r,e+1,n))}function WQ(r,e,t,n){return Xh(r,e,5,ru(r,e+1,n))}function QQ(r,e,t,n){const s=nu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Oe} 64-bit integer map lengths not supported`);return Xh(r,e,9,s)}function YQ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return Xh(r,e,1,1/0)}function q7(r,e){wi(r,B.map.majorEncoded,e.value)}q7.compareTokens=su.compareTokens;q7.encodedSize=function(e){return wi.encodedSize(e.value)};function XQ(r,e,t,n){return new he(B.tag,t,1)}function JQ(r,e,t,n){return new he(B.tag,eu(r,e+1,n),2)}function ZQ(r,e,t,n){return new he(B.tag,tu(r,e+1,n),3)}function eY(r,e,t,n){return new he(B.tag,ru(r,e+1,n),5)}function tY(r,e,t,n){return new he(B.tag,nu(r,e+1,n),9)}function H7(r,e){wi(r,B.tag.majorEncoded,e.value)}H7.compareTokens=su.compareTokens;H7.encodedSize=function(e){return wi.encodedSize(e.value)};const rY=20,nY=21,sY=22,iY=23;function oY(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Oe} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new he(B.null,null,1):new he(B.undefined,void 0,1)}function aY(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Oe} indefinite length items not allowed`);return new he(B.break,void 0,1)}function G7(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Oe} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Oe} Infinity values are not supported`)}return new he(B.float,r,e)}function cY(r,e,t,n){return G7(Q7(r,e+1),3,n)}function lY(r,e,t,n){return G7(Y7(r,e+1),5,n)}function uY(r,e,t,n){return G7(fk(r,e+1),9,n)}function W7(r,e,t){const n=e.value;if(n===!1)r.push([B.float.majorEncoded|rY]);else if(n===!0)r.push([B.float.majorEncoded|nY]);else if(n===null)r.push([B.float.majorEncoded|sY]);else if(n===void 0)r.push([B.float.majorEncoded|iY]);else{let s,i=!1;(!t||t.float64!==!0)&&(hk(n),s=Q7(Ci,1),n===s||Number.isNaN(n)?(Ci[0]=249,r.push(Ci.slice(0,3)),i=!0):(dk(n),s=Y7(Ci,1),n===s&&(Ci[0]=250,r.push(Ci.slice(0,5)),i=!0))),i||(hY(n),s=fk(Ci,1),Ci[0]=251,r.push(Ci.slice(0,9)))}}W7.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){hk(n);let s=Q7(Ci,1);if(n===s||Number.isNaN(n))return 3;if(dk(n),s=Y7(Ci,1),n===s)return 5}return 9};const uk=new ArrayBuffer(9),ri=new DataView(uk,1),Ci=new Uint8Array(uk,0);function hk(r){if(r===1/0)ri.setUint16(0,31744,!1);else if(r===-1/0)ri.setUint16(0,64512,!1);else if(Number.isNaN(r))ri.setUint16(0,32256,!1);else{ri.setFloat32(0,r);const e=ri.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)ri.setUint16(0,31744,!1);else if(t===0)ri.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const s=t-127;s<-24?ri.setUint16(0,0):s<-14?ri.setUint16(0,(e&2147483648)>>16|1<<24+s,!1):ri.setUint16(0,(e&2147483648)>>16|s+15<<10|n>>13,!1)}}}function Q7(r,e){if(r.length-e<2)throw new Error(`${Oe} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,s=t&1023;let i;return n===0?i=s*2**-24:n!==31?i=(s+1024)*2**(n-25):i=s===0?1/0:NaN,t&32768?-i:i}function dk(r){ri.setFloat32(0,r,!1)}function Y7(r,e){if(r.length-e<4)throw new Error(`${Oe} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function hY(r){ri.setFloat64(0,r,!1)}function fk(r,e){if(r.length-e<8)throw new Error(`${Oe} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}W7.compareTokens=su.compareTokens;function Xe(r,e,t){throw new Error(`${Oe} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function Kw(r){return()=>{throw new Error(`${Oe} ${r}`)}}const ee=[];for(let r=0;r<=23;r++)ee[r]=Xe;ee[24]=mQ;ee[25]=EQ;ee[26]=vQ;ee[27]=_Q;ee[28]=Xe;ee[29]=Xe;ee[30]=Xe;ee[31]=Xe;for(let r=32;r<=55;r++)ee[r]=Xe;ee[56]=SQ;ee[57]=AQ;ee[58]=$Q;ee[59]=TQ;ee[60]=Xe;ee[61]=Xe;ee[62]=Xe;ee[63]=Xe;for(let r=64;r<=87;r++)ee[r]=IQ;ee[88]=RQ;ee[89]=CQ;ee[90]=xQ;ee[91]=DQ;ee[92]=Xe;ee[93]=Xe;ee[94]=Xe;ee[95]=Kw("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)ee[r]=OQ;ee[120]=kQ;ee[121]=NQ;ee[122]=LQ;ee[123]=MQ;ee[124]=Xe;ee[125]=Xe;ee[126]=Xe;ee[127]=Kw("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)ee[r]=BQ;ee[152]=zQ;ee[153]=FQ;ee[154]=VQ;ee[155]=jQ;ee[156]=Xe;ee[157]=Xe;ee[158]=Xe;ee[159]=KQ;for(let r=160;r<=183;r++)ee[r]=qQ;ee[184]=HQ;ee[185]=GQ;ee[186]=WQ;ee[187]=QQ;ee[188]=Xe;ee[189]=Xe;ee[190]=Xe;ee[191]=YQ;for(let r=192;r<=215;r++)ee[r]=XQ;ee[216]=JQ;ee[217]=ZQ;ee[218]=eY;ee[219]=tY;ee[220]=Xe;ee[221]=Xe;ee[222]=Xe;ee[223]=Xe;for(let r=224;r<=243;r++)ee[r]=Kw("simple values are not supported");ee[244]=Xe;ee[245]=Xe;ee[246]=Xe;ee[247]=oY;ee[248]=Kw("simple values are not supported");ee[249]=cY;ee[250]=lY;ee[251]=uY;ee[252]=Xe;ee[253]=Xe;ee[254]=Xe;ee[255]=aY;const Oo=[];for(let r=0;r<24;r++)Oo[r]=new he(B.uint,r,1);for(let r=-1;r>=-24;r--)Oo[31-r]=new he(B.negint,r,1);Oo[64]=new he(B.bytes,new Uint8Array(0),1);Oo[96]=new he(B.string,"",1);Oo[128]=new he(B.array,0,1);Oo[160]=new he(B.map,0,1);Oo[244]=new he(B.false,!1,1);Oo[245]=new he(B.true,!0,1);Oo[246]=new he(B.null,null,1);function dY(r){switch(r.type){case B.false:return zo([244]);case B.true:return zo([245]);case B.null:return zo([246]);case B.bytes:return r.value.length?void 0:zo([64]);case B.string:return r.value===""?zo([96]):void 0;case B.array:return r.value===0?zo([128]):void 0;case B.map:return r.value===0?zo([160]):void 0;case B.uint:return r.value<24?zo([Number(r.value)]):void 0;case B.negint:if(r.value>=-24)return zo([31-Number(r.value)])}}const fY={float64:!1,mapSorter:gY,quickEncodeToken:dY};function pY(){const r=[];return r[B.uint.major]=su,r[B.negint.major]=j7,r[B.bytes.major]=jw,r[B.string.major]=UQ,r[B.array.major]=K7,r[B.map.major]=q7,r[B.tag.major]=H7,r[B.float.major]=W7,r}const pk=pY(),k3=new ak;let jS=class yk{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${ck} object contains circular references`);return new yk(t,e)}};const Da={null:new he(B.null,null),undefined:new he(B.undefined,void 0),true:new he(B.true,!0),false:new he(B.false,!1),emptyArray:new he(B.array,0),emptyMap:new he(B.map,0)},Nc={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new he(B.float,r):r>=0?new he(B.uint,r):new he(B.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new he(B.uint,r):new he(B.negint,r)},Uint8Array(r,e,t,n){return new he(B.bytes,r)},string(r,e,t,n){return new he(B.string,r)},boolean(r,e,t,n){return r?Da.true:Da.false},null(r,e,t,n){return Da.null},undefined(r,e,t,n){return Da.undefined},ArrayBuffer(r,e,t,n){return new he(B.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new he(B.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[Da.emptyArray,new he(B.break)]:Da.emptyArray;n=jS.createCheck(n,r);const s=[];let i=0;for(const o of r)s[i++]=f2(o,t,n);return t.addBreakTokens?[new he(B.array,r.length),s,new he(B.break)]:[new he(B.array,r.length),s]},Object(r,e,t,n){const s=e!=="Object",i=s?r.keys():Object.keys(r),o=s?r.size:i.length;if(!o)return t.addBreakTokens===!0?[Da.emptyMap,new he(B.break)]:Da.emptyMap;n=jS.createCheck(n,r);const a=[];let c=0;for(const u of i)a[c++]=[f2(u,t,n),f2(s?r.get(u):r[u],t,n)];return yY(a,t),t.addBreakTokens?[new he(B.map,o),a,new he(B.break)]:[new he(B.map,o),a]}};Nc.Map=Nc.Object;Nc.Buffer=Nc.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Nc[`${r}Array`]=Nc.DataView;function f2(r,e={},t){const n=aQ(r),s=e&&e.typeEncoders&&e.typeEncoders[n]||Nc[n];if(typeof s=="function"){const o=s(r,n,e,t);if(o!=null)return o}const i=Nc[n];if(!i)throw new Error(`${ck} unsupported type: ${n}`);return i(r,n,e,t)}function yY(r,e){e.mapSorter&&r.sort(e.mapSorter)}function gY(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const s=t.type.major,i=pk[s].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function gk(r,e,t,n){if(Array.isArray(e))for(const s of e)gk(r,s,t,n);else t[e.type.major](r,e,n)}function wY(r,e,t){const n=f2(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const s=t.quickEncodeToken(n);if(s)return s;const i=e[n.type.major];if(i.encodedSize){const o=i.encodedSize(n,t),a=new ak(o);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return ok(a.chunks[0])}}return k3.reset(),gk(k3,n,e,t),k3.toBytes(!0)}function bY(r,e){return e=Object.assign({},fY,e),wY(r,pk,e)}const mY={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};let EY=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=Oo[e];if(t===void 0){const n=ee[e];if(!n)throw new Error(`${Oe} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=e&31;t=n(this.data,this.pos,s,this.options)}return this.pos+=t.encodedLength,t}};const S1=Symbol.for("DONE"),qw=Symbol.for("BREAK");function vY(r,e,t){const n=[];for(let s=0;s<r.value;s++){const i=A1(e,t);if(i===qw){if(r.value===1/0)break;throw new Error(`${Oe} got unexpected break to lengthed array`)}if(i===S1)throw new Error(`${Oe} found array but not enough entries (got ${s}, expected ${r.value})`);n[s]=i}return n}function _Y(r,e,t){const n=t.useMaps===!0,s=n?void 0:{},i=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=A1(e,t);if(a===qw){if(r.value===1/0)break;throw new Error(`${Oe} got unexpected break to lengthed map`)}if(a===S1)throw new Error(`${Oe} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Oe} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in s))throw new Error(`${Oe} found repeat map key "${a}"`);const c=A1(e,t);if(c===S1)throw new Error(`${Oe} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?i.set(a,c):s[a]=c}return n?i:s}function A1(r,e){if(r.done())return S1;const t=r.next();if(t.type===B.break)return qw;if(t.type.terminal)return t.value;if(t.type===B.array)return vY(t,r,e);if(t.type===B.map)return _Y(t,r,e);if(t.type===B.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=A1(r,e);return e.tags[t.value](n)}throw new Error(`${Oe} tag not supported (${t.value})`)}throw new Error("unsupported")}function SY(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Oe} data to decode must be a Uint8Array`);e=Object.assign({},mY,e);const t=e.tokenizer||new EY(r,e),n=A1(t,e);if(n===S1)throw new Error(`${Oe} did not find any content to decode`);if(n===qw)throw new Error(`${Oe} got unexpected break`);if(!t.done())throw new Error(`${Oe} too many terminals, data makes no sense`);return n}var AY=wk,KS=128,$Y=127,TY=~$Y,IY=Math.pow(2,31);function wk(r,e,t){e=e||[],t=t||0;for(var n=t;r>=IY;)e[t++]=r&255|KS,r/=128;for(;r&TY;)e[t++]=r&255|KS,r>>>=7;return e[t]=r|0,wk.bytes=t-n+1,e}var RY=Vm,CY=128,qS=127;function Vm(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Vm.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&qS)<<s:(o&qS)*Math.pow(2,s),s+=7}while(o>=CY);return Vm.bytes=i-n,t}var xY=Math.pow(2,7),DY=Math.pow(2,14),PY=Math.pow(2,21),OY=Math.pow(2,28),kY=Math.pow(2,35),NY=Math.pow(2,42),LY=Math.pow(2,49),MY=Math.pow(2,56),UY=Math.pow(2,63),BY=function(r){return r<xY?1:r<DY?2:r<PY?3:r<OY?4:r<kY?5:r<NY?6:r<LY?7:r<MY?8:r<UY?9:10},zY={encode:AY,decode:RY,encodingLength:BY},X2=zY;const jm=(r,e=0)=>[X2.decode(r,e),X2.decode.bytes],J2=(r,e,t=0)=>(X2.encode(r,e,t),e),Z2=r=>X2.encodingLength(r),FY=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},X7=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},VY=(r,e)=>{const t=e.byteLength,n=Z2(r),s=n+Z2(t),i=new Uint8Array(s+t);return J2(r,i,0),J2(t,i,n),i.set(e,s),new J7(r,t,e,i)},jY=r=>{const e=X7(r),[t,n]=jm(e),[s,i]=jm(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new J7(t,s,o,e)},KY=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&FY(r.bytes,t.bytes)}};let J7=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function qY(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var HY=qY,GY=HY;let WY=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},QY=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bk(this,e)}},YY=class{constructor(e){this.decoders=e}or(e){return bk(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const bk=(r,e)=>new YY({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let XY=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new WY(e,t,n),this.decoder=new QY(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const mk=({name:r,prefix:e,encode:t,decode:n})=>new XY(r,e,t,n),Ek=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=GY(t,e);return mk({prefix:r,name:e,encode:n,decode:i=>X7(s(i))})},JY=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},ZY=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},wa=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>mk({prefix:e,name:r,encode(s){return ZY(s,n,t)},decode(s){return JY(s,n,t,r)}}),Ka=Ek({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ek({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const p2=wa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});wa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});wa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});wa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});wa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});wa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});wa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});wa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});wa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const HS=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return tX(t,Km(r),e||Ka.encoder);default:return rX(t,Km(r),e||p2.encoder)}},GS=new WeakMap,Km=r=>{const e=GS.get(r);if(e==null){const t=new Map;return GS.set(r,t),t}return e};let vk=class $n{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Ad)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==nX)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $n.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=VY(e,t);return $n.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $n.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&KY(e.multihash,n.multihash)}toString(e){return HS(this,e)}toJSON(){return{"/":HS(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof $n)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new $n(n,s,i,o||WS(n,s,i.bytes))}else if(t[sX]===!0){const{version:n,multihash:s,code:i}=t,o=jY(s);return $n.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Ad)throw new Error(`Version 0 CID must use dag-pb (code: ${Ad}) block encoding`);return new $n(e,t,n,n.bytes)}case 1:{const s=WS(e,t,n.bytes);return new $n(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return $n.create(0,Ad,e)}static createV1(e,t){return $n.create(1,e,t)}static decode(e){const[t,n]=$n.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$n.inspectBytes(e),n=t.size-t.multihashSize,s=X7(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new J7(t.multihashCode,t.digestSize,i,s);return[t.version===0?$n.createV0(o):$n.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=jm(e.subarray(t));return t+=f,h};let s=n(),i=Ad;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=eX(e,t),i=$n.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Km(i).set(n,e),i}};const eX=(r,e)=>{switch(r[0]){case"Q":{const t=e||Ka;return[Ka.prefix,t.decode(`${Ka.prefix}${r}`)]}case Ka.prefix:{const t=e||Ka;return[Ka.prefix,t.decode(r)]}case p2.prefix:{const t=e||p2;return[p2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},tX=(r,e,t)=>{const{prefix:n}=t;if(n!==Ka.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},rX=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Ad=112,nX=18,WS=(r,e,t)=>{const n=Z2(r),s=n+Z2(e),i=new Uint8Array(s+t.byteLength);return J2(r,i,0),J2(e,i,n),i.set(t,s),i},sX=Symbol.for("@ipld/js-cid/CID"),_k=42;function iX(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=vk.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new he(B.tag,_k),new he(B.bytes,t)]}function oX(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function aX(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const cX={float64:!0,typeEncoders:{Object:iX,undefined:oX,number:aX}};function lX(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return vk.decode(r.subarray(1))}const Sk={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Sk.tags[_k]=lX;const uX="dag-cbor",Z7=113,eE=r=>bY(r,cX),Hw=r=>SY(r,Sk),Ak=Object.freeze(Object.defineProperty({__proto__:null,code:Z7,decode:Hw,encode:eE,name:uX},Symbol.toStringTag,{value:"Module"})),hX=["string","number","bigint","symbol"],dX=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function fX(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(hX.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(pX(r))return"Buffer";const t=yX(r);return t||"Object"}function pX(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function yX(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(dX.includes(e))return e}let D=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};D.uint=new D(0,"uint",!0);D.negint=new D(1,"negint",!0);D.bytes=new D(2,"bytes",!0);D.string=new D(3,"string",!0);D.array=new D(4,"array",!1);D.map=new D(5,"map",!1);D.tag=new D(6,"tag",!1);D.float=new D(7,"float",!0);D.false=new D(7,"false",!0);D.true=new D(7,"true",!0);D.null=new D(7,"null",!0);D.undefined=new D(7,"undefined",!0);D.break=new D(7,"break",!0);let J=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};const Jh=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",gX=new TextDecoder,wX=new TextEncoder;function ey(r){return Jh&&globalThis.Buffer.isBuffer(r)}function tE(r){return r instanceof Uint8Array?ey(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const bX=Jh?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):YS(r,e,t):(r,e,t)=>t-e>64?gX.decode(r.subarray(e,t)):YS(r,e,t),$k=Jh?r=>r.length>64?globalThis.Buffer.from(r):QS(r):r=>r.length>64?wX.encode(r):QS(r),rE=Jh?(r,e,t)=>ey(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),mX=Jh?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),tE(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let s of r)n+s.length>t.length&&(s=s.subarray(0,t.length-n)),t.set(s,n),n+=s.length;return t},EX=Jh?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function vX(r,e){if(ey(r)&&ey(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function QS(r,e=1/0){let t;const n=r.length;let s=null;const i=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&i.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&i.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&i.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;i.push(t)}else if(t<2048){if((e-=2)<0)break;i.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;i.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return i}function YS(r,e,t){const n=[];for(;e<t;){const s=r[e];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(e+o<=t){let a,c,u,l;switch(o){case 1:s<128&&(i=s);break;case 2:a=r[e+1],(a&192)===128&&(l=(s&31)<<6|a&63,l>127&&(i=l));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(l=(s&15)<<12|(a&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(l=(s&15)<<18|(a&63)<<12|(c&63)<<6|u&63,l>65535&&l<1114112&&(i=l))}}i===null?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=o}return Tk(n)}const XS=4096;function Tk(r){const e=r.length;if(e<=XS)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=XS));return t}const _X=256;let Ik=class{constructor(e=_X){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const s=t.length-(this.maxCursor-this.cursor)-1;t.set(e,s)}else{if(t){const s=t.length-(this.maxCursor-this.cursor)-1;s<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,s),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=EX(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=rE(n,0,this.cursor)}else t=mX(this.chunks,this.cursor);return e&&this.reset(),t}};const ye="CBOR decode error:",Sl="CBOR encode error:";function Zh(r,e,t){if(r.length-e<t)throw new Error(`${ye} not enough data for type`)}const Mr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function iu(r,e,t){Zh(r,e,1);const n=r[e];if(t.strict===!0&&n<Mr[0])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);return n}function ou(r,e,t){Zh(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<Mr[1])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);return n}function au(r,e,t){Zh(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<Mr[2])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);return n}function cu(r,e,t){Zh(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],s=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(t.strict===!0&&i<Mr[3])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${ye} integers outside of the safe integer range are not supported`)}function SX(r,e,t,n){return new J(D.uint,iu(r,e+1,n),2)}function AX(r,e,t,n){return new J(D.uint,ou(r,e+1,n),3)}function $X(r,e,t,n){return new J(D.uint,au(r,e+1,n),5)}function TX(r,e,t,n){return new J(D.uint,cu(r,e+1,n),9)}function lu(r,e){return bi(r,0,e.value)}function bi(r,e,t){if(t<Mr[0]){const n=Number(t);r.push([e|n])}else if(t<Mr[1]){const n=Number(t);r.push([e|24,n])}else if(t<Mr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<Mr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<Mr[4]){const s=[e|27,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));s[8]=i&255,i=i>>8,s[7]=i&255,i=i>>8,s[6]=i&255,i=i>>8,s[5]=i&255,s[4]=o&255,o=o>>8,s[3]=o&255,o=o>>8,s[2]=o&255,o=o>>8,s[1]=o&255,r.push(s)}else throw new Error(`${ye} encountered BigInt larger than allowable range`)}}lu.encodedSize=function(e){return bi.encodedSize(e.value)};bi.encodedSize=function(e){return e<Mr[0]?1:e<Mr[1]?2:e<Mr[2]?3:e<Mr[3]?5:9};lu.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function IX(r,e,t,n){return new J(D.negint,-1-iu(r,e+1,n),2)}function RX(r,e,t,n){return new J(D.negint,-1-ou(r,e+1,n),3)}function CX(r,e,t,n){return new J(D.negint,-1-au(r,e+1,n),5)}const nE=BigInt(-1),Rk=BigInt(1);function xX(r,e,t,n){const s=cu(r,e+1,n);if(typeof s!="bigint"){const i=-1-s;if(i>=Number.MIN_SAFE_INTEGER)return new J(D.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${ye} integers outside of the safe integer range are not supported`);return new J(D.negint,nE-BigInt(s),9)}function sE(r,e){const t=e.value,n=typeof t=="bigint"?t*nE-Rk:t*-1-1;bi(r,e.type.majorEncoded,n)}sE.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*nE-Rk:t*-1-1;return n<Mr[0]?1:n<Mr[1]?2:n<Mr[2]?3:n<Mr[3]?5:9};sE.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function yp(r,e,t,n){Zh(r,e,t+n);const s=rE(r,e+t,e+t+n);return new J(D.bytes,s,t+n)}function DX(r,e,t,n){return yp(r,e,1,t)}function PX(r,e,t,n){return yp(r,e,2,iu(r,e+1,n))}function OX(r,e,t,n){return yp(r,e,3,ou(r,e+1,n))}function kX(r,e,t,n){return yp(r,e,5,au(r,e+1,n))}function NX(r,e,t,n){const s=cu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ye} 64-bit integer bytes lengths not supported`);return yp(r,e,9,s)}function ty(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===D.string?$k(r.value):r.value),r.encodedBytes}function Gw(r,e){const t=ty(e);bi(r,e.type.majorEncoded,t.length),r.push(t)}Gw.encodedSize=function(e){const t=ty(e);return bi.encodedSize(t.length)+t.length};Gw.compareTokens=function(e,t){return LX(ty(e),ty(t))};function LX(r,e){return r.length<e.length?-1:r.length>e.length?1:vX(r,e)}function gp(r,e,t,n,s){const i=t+n;Zh(r,e,i);const o=new J(D.string,bX(r,e+t,e+i),i);return s.retainStringBytes===!0&&(o.byteValue=rE(r,e+t,e+i)),o}function MX(r,e,t,n){return gp(r,e,1,t,n)}function UX(r,e,t,n){return gp(r,e,2,iu(r,e+1,n),n)}function BX(r,e,t,n){return gp(r,e,3,ou(r,e+1,n),n)}function zX(r,e,t,n){return gp(r,e,5,au(r,e+1,n),n)}function FX(r,e,t,n){const s=cu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ye} 64-bit integer string lengths not supported`);return gp(r,e,9,s,n)}const VX=Gw;function ed(r,e,t,n){return new J(D.array,n,t)}function jX(r,e,t,n){return ed(r,e,1,t)}function KX(r,e,t,n){return ed(r,e,2,iu(r,e+1,n))}function qX(r,e,t,n){return ed(r,e,3,ou(r,e+1,n))}function HX(r,e,t,n){return ed(r,e,5,au(r,e+1,n))}function GX(r,e,t,n){const s=cu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ye} 64-bit integer array lengths not supported`);return ed(r,e,9,s)}function WX(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ye} indefinite length items not allowed`);return ed(r,e,1,1/0)}function iE(r,e){bi(r,D.array.majorEncoded,e.value)}iE.compareTokens=lu.compareTokens;iE.encodedSize=function(e){return bi.encodedSize(e.value)};function td(r,e,t,n){return new J(D.map,n,t)}function QX(r,e,t,n){return td(r,e,1,t)}function YX(r,e,t,n){return td(r,e,2,iu(r,e+1,n))}function XX(r,e,t,n){return td(r,e,3,ou(r,e+1,n))}function JX(r,e,t,n){return td(r,e,5,au(r,e+1,n))}function ZX(r,e,t,n){const s=cu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ye} 64-bit integer map lengths not supported`);return td(r,e,9,s)}function eJ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ye} indefinite length items not allowed`);return td(r,e,1,1/0)}function oE(r,e){bi(r,D.map.majorEncoded,e.value)}oE.compareTokens=lu.compareTokens;oE.encodedSize=function(e){return bi.encodedSize(e.value)};function tJ(r,e,t,n){return new J(D.tag,t,1)}function rJ(r,e,t,n){return new J(D.tag,iu(r,e+1,n),2)}function nJ(r,e,t,n){return new J(D.tag,ou(r,e+1,n),3)}function sJ(r,e,t,n){return new J(D.tag,au(r,e+1,n),5)}function iJ(r,e,t,n){return new J(D.tag,cu(r,e+1,n),9)}function aE(r,e){bi(r,D.tag.majorEncoded,e.value)}aE.compareTokens=lu.compareTokens;aE.encodedSize=function(e){return bi.encodedSize(e.value)};const oJ=20,aJ=21,cJ=22,lJ=23;function uJ(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${ye} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new J(D.null,null,1):new J(D.undefined,void 0,1)}function hJ(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ye} indefinite length items not allowed`);return new J(D.break,void 0,1)}function cE(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${ye} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${ye} Infinity values are not supported`)}return new J(D.float,r,e)}function dJ(r,e,t,n){return cE(uE(r,e+1),3,n)}function fJ(r,e,t,n){return cE(hE(r,e+1),5,n)}function pJ(r,e,t,n){return cE(Pk(r,e+1),9,n)}function lE(r,e,t){const n=e.value;if(n===!1)r.push([D.float.majorEncoded|oJ]);else if(n===!0)r.push([D.float.majorEncoded|aJ]);else if(n===null)r.push([D.float.majorEncoded|cJ]);else if(n===void 0)r.push([D.float.majorEncoded|lJ]);else{let s,i=!1;(!t||t.float64!==!0)&&(xk(n),s=uE(xi,1),n===s||Number.isNaN(n)?(xi[0]=249,r.push(xi.slice(0,3)),i=!0):(Dk(n),s=hE(xi,1),n===s&&(xi[0]=250,r.push(xi.slice(0,5)),i=!0))),i||(yJ(n),s=Pk(xi,1),xi[0]=251,r.push(xi.slice(0,9)))}}lE.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){xk(n);let s=uE(xi,1);if(n===s||Number.isNaN(n))return 3;if(Dk(n),s=hE(xi,1),n===s)return 5}return 9};const Ck=new ArrayBuffer(9),ni=new DataView(Ck,1),xi=new Uint8Array(Ck,0);function xk(r){if(r===1/0)ni.setUint16(0,31744,!1);else if(r===-1/0)ni.setUint16(0,64512,!1);else if(Number.isNaN(r))ni.setUint16(0,32256,!1);else{ni.setFloat32(0,r);const e=ni.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)ni.setUint16(0,31744,!1);else if(t===0)ni.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const s=t-127;s<-24?ni.setUint16(0,0):s<-14?ni.setUint16(0,(e&2147483648)>>16|1<<24+s,!1):ni.setUint16(0,(e&2147483648)>>16|s+15<<10|n>>13,!1)}}}function uE(r,e){if(r.length-e<2)throw new Error(`${ye} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,s=t&1023;let i;return n===0?i=s*2**-24:n!==31?i=(s+1024)*2**(n-25):i=s===0?1/0:NaN,t&32768?-i:i}function Dk(r){ni.setFloat32(0,r,!1)}function hE(r,e){if(r.length-e<4)throw new Error(`${ye} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function yJ(r){ni.setFloat64(0,r,!1)}function Pk(r,e){if(r.length-e<8)throw new Error(`${ye} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}lE.compareTokens=lu.compareTokens;function Je(r,e,t){throw new Error(`${ye} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function Ww(r){return()=>{throw new Error(`${ye} ${r}`)}}const te=[];for(let r=0;r<=23;r++)te[r]=Je;te[24]=SX;te[25]=AX;te[26]=$X;te[27]=TX;te[28]=Je;te[29]=Je;te[30]=Je;te[31]=Je;for(let r=32;r<=55;r++)te[r]=Je;te[56]=IX;te[57]=RX;te[58]=CX;te[59]=xX;te[60]=Je;te[61]=Je;te[62]=Je;te[63]=Je;for(let r=64;r<=87;r++)te[r]=DX;te[88]=PX;te[89]=OX;te[90]=kX;te[91]=NX;te[92]=Je;te[93]=Je;te[94]=Je;te[95]=Ww("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)te[r]=MX;te[120]=UX;te[121]=BX;te[122]=zX;te[123]=FX;te[124]=Je;te[125]=Je;te[126]=Je;te[127]=Ww("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)te[r]=jX;te[152]=KX;te[153]=qX;te[154]=HX;te[155]=GX;te[156]=Je;te[157]=Je;te[158]=Je;te[159]=WX;for(let r=160;r<=183;r++)te[r]=QX;te[184]=YX;te[185]=XX;te[186]=JX;te[187]=ZX;te[188]=Je;te[189]=Je;te[190]=Je;te[191]=eJ;for(let r=192;r<=215;r++)te[r]=tJ;te[216]=rJ;te[217]=nJ;te[218]=sJ;te[219]=iJ;te[220]=Je;te[221]=Je;te[222]=Je;te[223]=Je;for(let r=224;r<=243;r++)te[r]=Ww("simple values are not supported");te[244]=Je;te[245]=Je;te[246]=Je;te[247]=uJ;te[248]=Ww("simple values are not supported");te[249]=dJ;te[250]=fJ;te[251]=pJ;te[252]=Je;te[253]=Je;te[254]=Je;te[255]=hJ;const ko=[];for(let r=0;r<24;r++)ko[r]=new J(D.uint,r,1);for(let r=-1;r>=-24;r--)ko[31-r]=new J(D.negint,r,1);ko[64]=new J(D.bytes,new Uint8Array(0),1);ko[96]=new J(D.string,"",1);ko[128]=new J(D.array,0,1);ko[160]=new J(D.map,0,1);ko[244]=new J(D.false,!1,1);ko[245]=new J(D.true,!0,1);ko[246]=new J(D.null,null,1);function gJ(){const r=[];return r[D.uint.major]=lu,r[D.negint.major]=sE,r[D.bytes.major]=Gw,r[D.string.major]=VX,r[D.array.major]=iE,r[D.map.major]=oE,r[D.tag.major]=aE,r[D.float.major]=lE,r}gJ();const N3=new Ik;let JS=class Ok{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Sl} object contains circular references`);return new Ok(t,e)}};const Pa={null:new J(D.null,null),undefined:new J(D.undefined,void 0),true:new J(D.true,!0),false:new J(D.false,!1),emptyArray:new J(D.array,0),emptyMap:new J(D.map,0)},Lc={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new J(D.float,r):r>=0?new J(D.uint,r):new J(D.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new J(D.uint,r):new J(D.negint,r)},Uint8Array(r,e,t,n){return new J(D.bytes,r)},string(r,e,t,n){return new J(D.string,r)},boolean(r,e,t,n){return r?Pa.true:Pa.false},null(r,e,t,n){return Pa.null},undefined(r,e,t,n){return Pa.undefined},ArrayBuffer(r,e,t,n){return new J(D.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new J(D.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[Pa.emptyArray,new J(D.break)]:Pa.emptyArray;n=JS.createCheck(n,r);const s=[];let i=0;for(const o of r)s[i++]=y2(o,t,n);return t.addBreakTokens?[new J(D.array,r.length),s,new J(D.break)]:[new J(D.array,r.length),s]},Object(r,e,t,n){const s=e!=="Object",i=s?r.keys():Object.keys(r),o=s?r.size:i.length;if(!o)return t.addBreakTokens===!0?[Pa.emptyMap,new J(D.break)]:Pa.emptyMap;n=JS.createCheck(n,r);const a=[];let c=0;for(const u of i)a[c++]=[y2(u,t,n),y2(s?r.get(u):r[u],t,n)];return wJ(a,t),t.addBreakTokens?[new J(D.map,o),a,new J(D.break)]:[new J(D.map,o),a]}};Lc.Map=Lc.Object;Lc.Buffer=Lc.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Lc[`${r}Array`]=Lc.DataView;function y2(r,e={},t){const n=fX(r),s=e&&e.typeEncoders&&e.typeEncoders[n]||Lc[n];if(typeof s=="function"){const o=s(r,n,e,t);if(o!=null)return o}const i=Lc[n];if(!i)throw new Error(`${Sl} unsupported type: ${n}`);return i(r,n,e,t)}function wJ(r,e){e.mapSorter&&r.sort(e.mapSorter)}function kk(r,e,t,n){if(Array.isArray(e))for(const s of e)kk(r,s,t,n);else t[e.type.major](r,e,n)}function bJ(r,e,t){const n=y2(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const s=t.quickEncodeToken(n);if(s)return s;const i=e[n.type.major];if(i.encodedSize){const o=i.encodedSize(n,t),a=new Ik(o);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return tE(a.chunks[0])}}return N3.reset(),kk(N3,n,e,t),N3.toBytes(!0)}const mJ={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};let EJ=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=ko[e];if(t===void 0){const n=te[e];if(!n)throw new Error(`${ye} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=e&31;t=n(this.data,this.pos,s,this.options)}return this.pos+=t.encodedLength,t}};const $1=Symbol.for("DONE"),Qw=Symbol.for("BREAK");function vJ(r,e,t){const n=[];for(let s=0;s<r.value;s++){const i=T1(e,t);if(i===Qw){if(r.value===1/0)break;throw new Error(`${ye} got unexpected break to lengthed array`)}if(i===$1)throw new Error(`${ye} found array but not enough entries (got ${s}, expected ${r.value})`);n[s]=i}return n}function _J(r,e,t){const n=t.useMaps===!0,s=n?void 0:{},i=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=T1(e,t);if(a===Qw){if(r.value===1/0)break;throw new Error(`${ye} got unexpected break to lengthed map`)}if(a===$1)throw new Error(`${ye} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${ye} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in s))throw new Error(`${ye} found repeat map key "${a}"`);const c=T1(e,t);if(c===$1)throw new Error(`${ye} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?i.set(a,c):s[a]=c}return n?i:s}function T1(r,e){if(r.done())return $1;const t=r.next();if(t.type===D.break)return Qw;if(t.type.terminal)return t.value;if(t.type===D.array)return vJ(t,r,e);if(t.type===D.map)return _J(t,r,e);if(t.type===D.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=T1(r,e);return e.tags[t.value](n)}throw new Error(`${ye} tag not supported (${t.value})`)}throw new Error("unsupported")}function SJ(r,e){if(!(r instanceof Uint8Array))throw new Error(`${ye} data to decode must be a Uint8Array`);e=Object.assign({},mJ,e);const t=e.tokenizer||new EJ(r,e),n=T1(t,e);if(n===$1)throw new Error(`${ye} did not find any content to decode`);if(n===Qw)throw new Error(`${ye} got unexpected break`);if(!t.done())throw new Error(`${ye} too many terminals, data makes no sense`);return n}class AJ extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===D.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===D.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[D.uint.major](e,t){this.prefix(e);const n=String(t.value),s=[];for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);e.push(s)}[D.negint.major](e,t){this[D.uint.major](e,t)}[D.bytes.major](e,t){throw new Error(`${Sl} unsupported type: Uint8Array`)}[D.string.major](e,t){this.prefix(e);const n=$k(JSON.stringify(t.value));e.push(n.length>32?tE(n):n)}[D.array.major](e,t){this.prefix(e),this.inRecursive.push({type:D.array,elements:0}),e.push([91])}[D.map.major](e,t){this.prefix(e),this.inRecursive.push({type:D.map,elements:0}),e.push([123])}[D.tag.major](e,t){}[D.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===D.array)e.push([93]);else if(o.type===D.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${Sl} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),s=[];let i=!1;for(let o=0;o<n.length;o++)s[o]=n.charCodeAt(o),!i&&(s[o]===46||s[o]===101||s[o]===69)&&(i=!0);i||(s.push(46),s.push(48)),e.push(s)}}function $J(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${Sl} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==D.string||n.type!==D.string)throw new Error(`${Sl} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${Sl} unexpected duplicate map keys, this is not supported`)}const TJ={addBreakTokens:!0,mapSorter:$J};function IJ(r,e){return e=Object.assign({},TJ,e),bJ(r,new AJ,e)}class Nk{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${ye} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${ye} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,n=!1;const s=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this.pos++;else break}};if(this.ch()===45&&(t=!0,this.pos++),this.ch()===48)if(this.pos++,this.ch()===46)this.pos++,n=!0;else return new J(D.uint,0,this.pos-e);if(s([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${ye} unexpected token at position ${this.pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${ye} unexpected token at position ${this.pos}`);n=!0,this.pos++,s([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this.pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this.pos++,s([48,49,50,51,52,53,54,55,56,57]));const i=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),o=parseFloat(i);return n?new J(D.float,o,this.pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new J(o>=0?D.uint:D.negint,o,this.pos-e):new J(o>=0?D.uint:D.negint,BigInt(i),this.pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${ye} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let i=this.pos,o=0;i<this.data.length&&o<65536;i++,o++){const a=this.data[i];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this.pos,i));return this.pos=i+1,new J(D.string,c,o)}}const e=this.pos,t=[],n=()=>{if(this.pos+4>=this.data.length)throw new Error(`${ye} unexpected end of unicode escape sequence at position ${this.pos}`);let i=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${ye} unexpected unicode escape character at position ${this.pos}`);i=i*16+a,this.pos++}return i},s=()=>{const i=this.ch();let o=null,a=i>239?4:i>223?3:i>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${ye} unexpected unicode sequence at position ${this.pos}`);let c,u,l,h;switch(a){case 1:i<128&&(o=i);break;case 2:c=this.data[this.pos+1],(c&192)===128&&(h=(i&31)<<6|c&63,h>127&&(o=h));break;case 3:c=this.data[this.pos+1],u=this.data[this.pos+2],(c&192)===128&&(u&192)===128&&(h=(i&15)<<12|(c&63)<<6|u&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=this.data[this.pos+1],u=this.data[this.pos+2],l=this.data[this.pos+3],(c&192)===128&&(u&192)===128&&(l&192)===128&&(h=(i&15)<<18|(c&63)<<12|(u&63)<<6|l&63,h>65535&&h<1114112&&(o=h))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this.pos+=a};for(;!this.done();){const i=this.ch();let o;switch(i){case 92:if(this.pos++,this.done())throw new Error(`${ye} unexpected string termination at position ${this.pos}`);switch(o=this.ch(),this.pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${ye} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new J(D.string,Tk(t),this.pos-e);default:if(i<32)throw new Error(`${ye} invalid control character at position ${this.pos}`);i<128?(t.push(i),this.pos++):s()}}throw new Error(`${ye} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new J(D.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new J(D.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new J(D.null,null,4);case 102:return this.expect([102,97,108,115,101]),new J(D.false,!1,5);case 116:return this.expect([116,114,117,101]),new J(D.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${ye} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this.pos++,this.skipWhitespace(),new J(D.break,void 0,1);if(this.ch()!==44)throw new Error(`${ye} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this.pos++,this.skipWhitespace(),new J(D.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new J(D.break,void 0,1);if(this.ch()!==44)throw new Error(`${ye} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this.pos++,this.skipWhitespace(),new J(D.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${ye} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${ye} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function RJ(r,e){return e=Object.assign({tokenizer:new Nk(r,e)},e),SJ(r,e)}var CJ=Lk,ZS=128,xJ=127,DJ=~xJ,PJ=Math.pow(2,31);function Lk(r,e,t){e=e||[],t=t||0;for(var n=t;r>=PJ;)e[t++]=r&255|ZS,r/=128;for(;r&DJ;)e[t++]=r&255|ZS,r>>>=7;return e[t]=r|0,Lk.bytes=t-n+1,e}var OJ=qm,kJ=128,eA=127;function qm(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw qm.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&eA)<<s:(o&eA)*Math.pow(2,s),s+=7}while(o>=kJ);return qm.bytes=i-n,t}var NJ=Math.pow(2,7),LJ=Math.pow(2,14),MJ=Math.pow(2,21),UJ=Math.pow(2,28),BJ=Math.pow(2,35),zJ=Math.pow(2,42),FJ=Math.pow(2,49),VJ=Math.pow(2,56),jJ=Math.pow(2,63),KJ=function(r){return r<NJ?1:r<LJ?2:r<MJ?3:r<UJ?4:r<BJ?5:r<zJ?6:r<FJ?7:r<VJ?8:r<jJ?9:10},qJ={encode:CJ,decode:OJ,encodingLength:KJ},ry=qJ;const Hm=(r,e=0)=>[ry.decode(r,e),ry.decode.bytes],ny=(r,e,t=0)=>(ry.encode(r,e,t),e),sy=r=>ry.encodingLength(r),HJ=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},dE=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},GJ=(r,e)=>{const t=e.byteLength,n=sy(r),s=n+sy(t),i=new Uint8Array(s+t);return ny(r,i,0),ny(t,i,n),i.set(e,s),new fE(r,t,e,i)},WJ=r=>{const e=dE(r),[t,n]=Hm(e),[s,i]=Hm(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new fE(t,s,o,e)},QJ=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&HJ(r.bytes,t.bytes)}};let fE=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function YJ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var XJ=YJ,JJ=XJ;let ZJ=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},eZ=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Mk(this,e)}},tZ=class{constructor(e){this.decoders=e}or(e){return Mk(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Mk=(r,e)=>new tZ({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let rZ=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new ZJ(e,t,n),this.decoder=new eZ(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Uk=({name:r,prefix:e,encode:t,decode:n})=>new rZ(r,e,t,n),Bk=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=JJ(t,e);return Uk({prefix:r,name:e,encode:n,decode:i=>dE(s(i))})},nZ=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},sZ=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ps=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Uk({prefix:e,name:r,encode(s){return sZ(s,n,t)},decode(s){return nZ(s,n,t,r)}}),qa=Bk({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Bk({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const g2=Ps({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ps({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ps({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ps({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ps({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ps({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ps({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ps({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ps({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const tA=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return oZ(t,Gm(r),e||qa.encoder);default:return aZ(t,Gm(r),e||g2.encoder)}},rA=new WeakMap,Gm=r=>{const e=rA.get(r);if(e==null){const t=new Map;return rA.set(r,t),t}return e};let zk=class Tn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==$d)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cZ)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Tn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=GJ(e,t);return Tn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Tn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&QJ(e.multihash,n.multihash)}toString(e){return tA(this,e)}toJSON(){return{"/":tA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Tn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Tn(n,s,i,o||nA(n,s,i.bytes))}else if(t[lZ]===!0){const{version:n,multihash:s,code:i}=t,o=WJ(s);return Tn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==$d)throw new Error(`Version 0 CID must use dag-pb (code: ${$d}) block encoding`);return new Tn(e,t,n,n.bytes)}case 1:{const s=nA(e,t,n.bytes);return new Tn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Tn.create(0,$d,e)}static createV1(e,t){return Tn.create(1,e,t)}static decode(e){const[t,n]=Tn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Tn.inspectBytes(e),n=t.size-t.multihashSize,s=dE(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new fE(t.multihashCode,t.digestSize,i,s);return[t.version===0?Tn.createV0(o):Tn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=Hm(e.subarray(t));return t+=f,h};let s=n(),i=$d;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=iZ(e,t),i=Tn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Gm(i).set(n,e),i}};const iZ=(r,e)=>{switch(r[0]){case"Q":{const t=e||qa;return[qa.prefix,t.decode(`${qa.prefix}${r}`)]}case qa.prefix:{const t=e||qa;return[qa.prefix,t.decode(r)]}case g2.prefix:{const t=e||g2;return[g2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},oZ=(r,e,t)=>{const{prefix:n}=t;if(n!==qa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},aZ=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},$d=112,cZ=18,nA=(r,e,t)=>{const n=sy(r),s=n+sy(e),i=new Uint8Array(s+t.byteLength);return ny(r,i,0),ny(e,i,n),i.set(t,s),i},lZ=Symbol.for("@ipld/js-cid/CID"),Fk=Ps({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Ps({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Ps({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Ps({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function uZ(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=zk.asCID(r);if(!e)return null;const t=e.toString();return[new J(D.map,1/0,1),new J(D.string,"/",1),new J(D.string,t,t.length),new J(D.break,void 0,1)]}function iy(r){const e=Fk.encode(r).slice(1);return[new J(D.map,1/0,1),new J(D.string,"/",1),new J(D.map,1/0,1),new J(D.string,"bytes",5),new J(D.string,e,e.length),new J(D.break,void 0,1),new J(D.break,void 0,1)]}function Ai(r){return iy(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function hZ(r){return iy(new Uint8Array(r))}function dZ(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function fZ(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const pZ={typeEncoders:{Object:uZ,Buffer:iy,Uint8Array:iy,Int8Array:Ai,Uint16Array:Ai,Int16Array:Ai,Uint32Array:Ai,Int32Array:Ai,Float32Array:Ai,Float64Array:Ai,Uint8ClampedArray:Ai,BigInt64Array:Ai,BigUint64Array:Ai,DataView:Ai,ArrayBuffer:hZ,undefined:dZ,number:fZ}};class yZ extends Nk{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===D.map){const t=this._next();if(t.type===D.string&&t.value==="/"){const n=this._next();if(n.type===D.string){if(this._next().type!==D.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new J(D.tag,42,0)}if(n.type===D.map){const s=this._next();if(s.type===D.string&&s.value==="bytes"){const i=this._next();if(i.type===D.string){for(let a=0;a<2;a++)if(this._next().type!==D.break)throw new Error("Invalid encoded Bytes form");const o=Fk.decode(`m${i.value}`);return new J(D.bytes,o,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(s)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const Wm={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Wm.tags[42]=zk.parse;const gZ="dag-json",Vk=297,jk=r=>IJ(r,pZ),Kk=r=>{const e=Object.assign(Wm,{tokenizer:new yZ(r,Wm)});return RJ(r,e)},sA=r=>wZ.decode(jk(r)),wZ=new TextDecoder,bZ=r=>Kk(mZ.encode(r)),mZ=new TextEncoder,qk=Object.freeze(Object.defineProperty({__proto__:null,code:Vk,decode:Kk,encode:jk,format:sA,name:gZ,parse:bZ,stringify:sA},Symbol.toStringTag,{value:"Module"}));function EZ(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var vZ=EZ,_Z=vZ;const SZ=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},pE=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};let AZ=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},$Z=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Hk(this,e)}},TZ=class{constructor(e){this.decoders=e}or(e){return Hk(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Hk=(r,e)=>new TZ({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let IZ=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new AZ(e,t,n),this.decoder=new $Z(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Gk=({name:r,prefix:e,encode:t,decode:n})=>new IZ(r,e,t,n),Wk=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=_Z(t,e);return Gk({prefix:r,name:e,encode:n,decode:i=>pE(s(i))})},RZ=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},CZ=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Os=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Gk({prefix:e,name:r,encode(s){return CZ(s,n,t)},decode(s){return RZ(s,n,t,r)}});Os({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Os({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const Qk=Os({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Os({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function ta(r){return Qk.encode(r).slice(1)}function mo(r){return Qk.decode(`u${r}`)}var xZ=Yk,iA=128,DZ=127,PZ=~DZ,OZ=Math.pow(2,31);function Yk(r,e,t){e=e||[],t=t||0;for(var n=t;r>=OZ;)e[t++]=r&255|iA,r/=128;for(;r&PZ;)e[t++]=r&255|iA,r>>>=7;return e[t]=r|0,Yk.bytes=t-n+1,e}var kZ=Qm,NZ=128,oA=127;function Qm(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Qm.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&oA)<<s:(o&oA)*Math.pow(2,s),s+=7}while(o>=NZ);return Qm.bytes=i-n,t}var LZ=Math.pow(2,7),MZ=Math.pow(2,14),UZ=Math.pow(2,21),BZ=Math.pow(2,28),zZ=Math.pow(2,35),FZ=Math.pow(2,42),VZ=Math.pow(2,49),jZ=Math.pow(2,56),KZ=Math.pow(2,63),qZ=function(r){return r<LZ?1:r<MZ?2:r<UZ?3:r<BZ?4:r<zZ?5:r<FZ?6:r<VZ?7:r<jZ?8:r<KZ?9:10},HZ={encode:xZ,decode:kZ,encodingLength:qZ},oy=HZ;const Ym=(r,e=0)=>[oy.decode(r,e),oy.decode.bytes],ay=(r,e,t=0)=>(oy.encode(r,e,t),e),cy=r=>oy.encodingLength(r),GZ=(r,e)=>{const t=e.byteLength,n=cy(r),s=n+cy(t),i=new Uint8Array(s+t);return ay(r,i,0),ay(t,i,n),i.set(e,s),new yE(r,t,e,i)},WZ=r=>{const e=pE(r),[t,n]=Ym(e),[s,i]=Ym(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new yE(t,s,o,e)},QZ=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&SZ(r.bytes,t.bytes)}};let yE=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const Ha=Wk({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Wk({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const w2=Os({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Os({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Os({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Os({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Os({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Os({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Os({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Os({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Os({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const aA=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return XZ(t,Xm(r),e||Ha.encoder);default:return JZ(t,Xm(r),e||w2.encoder)}},cA=new WeakMap,Xm=r=>{const e=cA.get(r);if(e==null){const t=new Map;return cA.set(r,t),t}return e};let gE=class In{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Td)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ZZ)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return In.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=GZ(e,t);return In.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return In.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&QZ(e.multihash,n.multihash)}toString(e){return aA(this,e)}toJSON(){return{"/":aA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof In)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new In(n,s,i,o||lA(n,s,i.bytes))}else if(t[eee]===!0){const{version:n,multihash:s,code:i}=t,o=WZ(s);return In.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Td)throw new Error(`Version 0 CID must use dag-pb (code: ${Td}) block encoding`);return new In(e,t,n,n.bytes)}case 1:{const s=lA(e,t,n.bytes);return new In(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return In.create(0,Td,e)}static createV1(e,t){return In.create(1,e,t)}static decode(e){const[t,n]=In.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=In.inspectBytes(e),n=t.size-t.multihashSize,s=pE(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new yE(t.multihashCode,t.digestSize,i,s);return[t.version===0?In.createV0(o):In.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=Ym(e.subarray(t));return t+=f,h};let s=n(),i=Td;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=YZ(e,t),i=In.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Xm(i).set(n,e),i}};const YZ=(r,e)=>{switch(r[0]){case"Q":{const t=e||Ha;return[Ha.prefix,t.decode(`${Ha.prefix}${r}`)]}case Ha.prefix:{const t=e||Ha;return[Ha.prefix,t.decode(r)]}case w2.prefix:{const t=e||w2;return[w2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},XZ=(r,e,t)=>{const{prefix:n}=t;if(n!==Ha.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},JZ=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Td=112,ZZ=18,lA=(r,e,t)=>{const n=cy(r),s=n+cy(e),i=new Uint8Array(s+t.byteLength);return ay(r,i,0),ay(e,i,n),i.set(t,s),i},eee=Symbol.for("@ipld/js-cid/CID");function tee(r){const[e,t,n]=r;return{payload:t,signatures:[{protected:e,signature:n}],link:gE.decode(mo(t))}}function ree(r){const e={signature:mo(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=mo(r.protected)),e}function nee(r){const e=mo(r.payload);try{gE.decode(e)}catch{throw new Error("Not a valid DagJWS")}return{payload:e,signatures:r.signatures.map(ree)}}function see(r){const e={signature:ta(r.signature)};return r.header&&(e.header=r.header),r.protected&&(e.protected=ta(r.protected)),e}function iee(r){const e={payload:ta(r.payload),signatures:r.signatures.map(see)};return e.link=gE.decode(new Uint8Array(r.payload)),e}function oee(r){const[e,t,n,s,i]=r,o={ciphertext:s,iv:n,protected:e,tag:i};return t&&(o.recipients=[{encrypted_key:t}]),o}function aee(r){const e={};return r.encrypted_key&&(e.encrypted_key=mo(r.encrypted_key)),r.header&&(e.header=r.header),e}function cee(r){const e={ciphertext:mo(r.ciphertext),protected:mo(r.protected),iv:mo(r.iv),tag:mo(r.tag)};return r.aad&&(e.aad=mo(r.aad)),r.recipients&&(e.recipients=r.recipients.map(aee)),r.unprotected&&(e.unprotected=r.unprotected),e}function lee(r){const e={};return r.encrypted_key&&(e.encrypted_key=ta(r.encrypted_key)),r.header&&(e.header=r.header),e}function uee(r){const e={ciphertext:ta(r.ciphertext),protected:ta(r.protected),iv:ta(r.iv),tag:ta(r.tag)};return r.aad&&(e.aad=ta(r.aad)),r.recipients&&(e.recipients=r.recipients.map(lee)),r.unprotected&&(e.unprotected=r.unprotected),e}const hee="dag-jose",dee=133;function Xk(r){return"payload"in r&&typeof r.payload=="string"&&"signatures"in r&&Array.isArray(r.signatures)}function fee(r){return"payload"in r&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures)}function pee(r){return"ciphertext"in r&&r.ciphertext instanceof Uint8Array&&"iv"in r&&r.iv instanceof Uint8Array&&"protected"in r&&r.protected instanceof Uint8Array&&"tag"in r&&r.tag instanceof Uint8Array}function Jk(r){return"ciphertext"in r&&typeof r.ciphertext=="string"&&"iv"in r&&typeof r.iv=="string"&&"protected"in r&&typeof r.protected=="string"&&"tag"in r&&typeof r.tag=="string"}function Zk(r){if(typeof r=="string"){const e=r.split(".");if(e.length===3)return tee(e);if(e.length===5)return oee(e);throw new Error("Not a valid JOSE string")}if(Xk(r)||Jk(r))return r;throw new Error("Not a valid unencoded JOSE object")}function yee(r){typeof r=="string"&&(r=Zk(r));let e;if(Xk(r))e=nee(r);else if(Jk(r))e=cee(r);else throw new Error("Not a valid JOSE object");return new Uint8Array(eE(e))}function gee(r){let e;try{e=Hw(r)}catch{throw new Error("Not a valid DAG-JOSE object")}if(fee(e))return iee(e);if(pee(e))return uee(e);throw new Error("Not a valid DAG-JOSE object")}const eN=Object.freeze(Object.defineProperty({__proto__:null,code:dee,decode:gee,encode:yee,name:hee,toGeneral:Zk},Symbol.toStringTag,{value:"Module"})),wee=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},rd=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},bee=r=>new TextEncoder().encode(r),mee=r=>new TextDecoder().decode(r);var Eee=tN,uA=128,vee=127,_ee=~vee,See=Math.pow(2,31);function tN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=See;)e[t++]=r&255|uA,r/=128;for(;r&_ee;)e[t++]=r&255|uA,r>>>=7;return e[t]=r|0,tN.bytes=t-n+1,e}var Aee=Jm,$ee=128,hA=127;function Jm(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Jm.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&hA)<<s:(o&hA)*Math.pow(2,s),s+=7}while(o>=$ee);return Jm.bytes=i-n,t}var Tee=Math.pow(2,7),Iee=Math.pow(2,14),Ree=Math.pow(2,21),Cee=Math.pow(2,28),xee=Math.pow(2,35),Dee=Math.pow(2,42),Pee=Math.pow(2,49),Oee=Math.pow(2,56),kee=Math.pow(2,63),Nee=function(r){return r<Tee?1:r<Iee?2:r<Ree?3:r<Cee?4:r<xee?5:r<Dee?6:r<Pee?7:r<Oee?8:r<kee?9:10},Lee={encode:Eee,decode:Aee,encodingLength:Nee},ly=Lee;const Zm=(r,e=0)=>[ly.decode(r,e),ly.decode.bytes],uy=(r,e,t=0)=>(ly.encode(r,e,t),e),hy=r=>ly.encodingLength(r),dy=(r,e)=>{const t=e.byteLength,n=hy(r),s=n+hy(t),i=new Uint8Array(s+t);return uy(r,i,0),uy(t,i,n),i.set(e,s),new bE(r,t,e,i)},wE=r=>{const e=rd(r),[t,n]=Zm(e),[s,i]=Zm(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new bE(t,s,o,e)},Mee=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&wee(r.bytes,t.bytes)}};let bE=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const rN=0,Uee="identity",nN=rd,Bee=r=>dy(rN,nN(r)),e4={code:rN,name:Uee,encode:nN,digest:Bee},zee=Object.freeze(Object.defineProperty({__proto__:null,identity:e4},Symbol.toStringTag,{value:"Module"}));function Fee(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var Vee=Fee,jee=Vee;let Kee=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},qee=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sN(this,e)}},Hee=class{constructor(e){this.decoders=e}or(e){return sN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const sN=(r,e)=>new Hee({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Gee=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Kee(e,t,n),this.decoder=new qee(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Yw=({name:r,prefix:e,encode:t,decode:n})=>new Gee(r,e,t,n),wp=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=jee(t,e);return Yw({prefix:r,name:e,encode:n,decode:i=>rd(s(i))})},Wee=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Qee=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Kr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Yw({prefix:e,name:r,encode(s){return Qee(s,n,t)},decode(s){return Wee(s,n,t,r)}}),Yee=Yw({prefix:"\0",name:"identity",encode:r=>mee(r),decode:r=>bee(r)}),Xee=Object.freeze(Object.defineProperty({__proto__:null,identity:Yee},Symbol.toStringTag,{value:"Module"})),Jee=Kr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Zee=Object.freeze(Object.defineProperty({__proto__:null,base2:Jee},Symbol.toStringTag,{value:"Module"})),ete=Kr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),tte=Object.freeze(Object.defineProperty({__proto__:null,base8:ete},Symbol.toStringTag,{value:"Module"})),rte=wp({prefix:"9",name:"base10",alphabet:"0123456789"}),nte=Object.freeze(Object.defineProperty({__proto__:null,base10:rte},Symbol.toStringTag,{value:"Module"})),ste=Kr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ite=Kr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ote=Object.freeze(Object.defineProperty({__proto__:null,base16:ste,base16upper:ite},Symbol.toStringTag,{value:"Module"})),Al=Kr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ate=Kr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),cte=Kr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),lte=Kr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ute=Kr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),hte=Kr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),dte=Kr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fte=Kr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),pte=Kr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),yte=Object.freeze(Object.defineProperty({__proto__:null,base32:Al,base32hex:ute,base32hexpad:dte,base32hexpadupper:fte,base32hexupper:hte,base32pad:cte,base32padupper:lte,base32upper:ate,base32z:pte},Symbol.toStringTag,{value:"Module"})),fy=wp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gte=wp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),wte=Object.freeze(Object.defineProperty({__proto__:null,base36:fy,base36upper:gte},Symbol.toStringTag,{value:"Module"})),is=wp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bte=wp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),mte=Object.freeze(Object.defineProperty({__proto__:null,base58btc:is,base58flickr:bte},Symbol.toStringTag,{value:"Module"})),Ete=Kr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vte=Kr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),_te=Kr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ste=Kr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Ate=Object.freeze(Object.defineProperty({__proto__:null,base64:Ete,base64pad:vte,base64url:_te,base64urlpad:Ste},Symbol.toStringTag,{value:"Module"})),iN=Array.from(""),$te=iN.reduce((r,e,t)=>(r[t]=e,r),[]),Tte=iN.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Ite(r){return r.reduce((e,t)=>(e+=$te[t],e),"")}function Rte(r){const e=[];for(const t of r){const n=Tte[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const Cte=Yw({prefix:"",name:"base256emoji",encode:Ite,decode:Rte}),xte=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Cte},Symbol.toStringTag,{value:"Module"})),oN=({name:r,code:e,encode:t})=>new Dte(r,e,t);let Dte=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?dy(this.code,t):t.then(n=>dy(this.code,n))}else throw Error("Unknown type, must be binary type")}};const aN=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Eh=oN({name:"sha2-256",code:18,encode:aN("SHA-256")}),Pte=oN({name:"sha2-512",code:19,encode:aN("SHA-512")}),Ote=Object.freeze(Object.defineProperty({__proto__:null,sha256:Eh,sha512:Pte},Symbol.toStringTag,{value:"Module"})),kte="raw",mE=85,Nte=r=>rd(r),Lte=r=>rd(r),Mte=Object.freeze(Object.defineProperty({__proto__:null,code:mE,decode:Lte,encode:Nte,name:kte},Symbol.toStringTag,{value:"Module"})),Ute=new TextEncoder,Bte=new TextDecoder,zte="json",cN=512,Fte=r=>Ute.encode(JSON.stringify(r)),Vte=r=>JSON.parse(Bte.decode(r)),jte=Object.freeze(Object.defineProperty({__proto__:null,code:cN,decode:Vte,encode:Fte,name:zte},Symbol.toStringTag,{value:"Module"})),dA=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return qte(t,t4(r),e||is.encoder);default:return Hte(t,t4(r),e||Al.encoder)}},fA=new WeakMap,t4=r=>{const e=fA.get(r);if(e==null){const t=new Map;return fA.set(r,t),t}return e};let we=class Rn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Id)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Gte)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Rn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=dy(e,t);return Rn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Rn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&Mee(e.multihash,n.multihash)}toString(e){return dA(this,e)}toJSON(){return{"/":dA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Rn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Rn(n,s,i,o||pA(n,s,i.bytes))}else if(t[Wte]===!0){const{version:n,multihash:s,code:i}=t,o=wE(s);return Rn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Id)throw new Error(`Version 0 CID must use dag-pb (code: ${Id}) block encoding`);return new Rn(e,t,n,n.bytes)}case 1:{const s=pA(e,t,n.bytes);return new Rn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Rn.create(0,Id,e)}static createV1(e,t){return Rn.create(1,e,t)}static decode(e){const[t,n]=Rn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Rn.inspectBytes(e),n=t.size-t.multihashSize,s=rd(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new bE(t.multihashCode,t.digestSize,i,s);return[t.version===0?Rn.createV0(o):Rn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=Zm(e.subarray(t));return t+=f,h};let s=n(),i=Id;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=Kte(e,t),i=Rn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return t4(i).set(n,e),i}};const Kte=(r,e)=>{switch(r[0]){case"Q":{const t=e||is;return[is.prefix,t.decode(`${is.prefix}${r}`)]}case is.prefix:{const t=e||is;return[is.prefix,t.decode(r)]}case Al.prefix:{const t=e||Al;return[Al.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},qte=(r,e,t)=>{const{prefix:n}=t;if(n!==is.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},Hte=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Id=112,Gte=18,pA=(r,e,t)=>{const n=hy(r),s=n+hy(e),i=new Uint8Array(s+t.byteLength);return uy(r,i,0),uy(e,i,n),i.set(t,s),i},Wte=Symbol.for("@ipld/js-cid/CID"),lN={...Xee,...Zee,...tte,...nte,...ote,...yte,...wte,...mte,...Ate,...xte},Qte={...Ote,...zee},Yte={raw:Mte,json:jte};class bp extends Error{constructor(e="not initialized"){super(e),this.name="NotInitializedError",this.code=bp.code}}bp.code="ERR_NOT_INITIALIZED";class Xte extends Error{constructor(e="cannot initialize an initializing node"){super(e),this.name="AlreadyInitializingError",this.code=Bl.code}}Xte.code="ERR_ALREADY_INITIALIZING";class Bl extends Error{constructor(e="cannot re-initialize an initialized node"){super(e),this.name="AlreadyInitializedError",this.code=Bl.code}}Bl.code="ERR_ALREADY_INITIALIZED";class mp extends Error{constructor(e="not started"){super(e),this.name="NotStartedError",this.code=mp.code}}mp.code="ERR_NOT_STARTED";class Xw extends Error{constructor(e="cannot start, already startin"){super(e),this.name="AlreadyStartingError",this.code=Xw.code}}Xw.code="ERR_ALREADY_STARTING";class Jw extends Error{constructor(e="cannot start, already started"){super(e),this.name="AlreadyStartedError",this.code=Jw.code}}Jw.code="ERR_ALREADY_STARTED";class nd extends Error{constructor(e="not enabled"){super(e),this.name="NotEnabledError",this.code=nd.code}}nd.code="ERR_NOT_ENABLED";function Jte(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var Zte=Jte,ere=Zte;const tre=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},EE=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},rre=r=>new TextEncoder().encode(r),nre=r=>new TextDecoder().decode(r);let sre=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ire=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return uN(this,e)}},ore=class{constructor(e){this.decoders=e}or(e){return uN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const uN=(r,e)=>new ore({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let are=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new sre(e,t,n),this.decoder=new ire(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Zw=({name:r,prefix:e,encode:t,decode:n})=>new are(r,e,t,n),Ep=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=ere(t,e);return Zw({prefix:r,name:e,encode:n,decode:i=>EE(s(i))})},cre=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},lre=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},qr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Zw({prefix:e,name:r,encode(s){return lre(s,n,t)},decode(s){return cre(s,n,t,r)}}),Jo=Ep({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ure=Ep({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),hre=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Jo,base58flickr:ure},Symbol.toStringTag,{value:"Module"})),Zf=qr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),dre=qr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fre=qr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pre=qr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yre=qr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),gre=qr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wre=qr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bre=qr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mre=qr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Ere=Object.freeze(Object.defineProperty({__proto__:null,base32:Zf,base32hex:yre,base32hexpad:wre,base32hexpadupper:bre,base32hexupper:gre,base32pad:fre,base32padupper:pre,base32upper:dre,base32z:mre},Symbol.toStringTag,{value:"Module"}));var vre=hN,yA=128,_re=127,Sre=~_re,Are=Math.pow(2,31);function hN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Are;)e[t++]=r&255|yA,r/=128;for(;r&Sre;)e[t++]=r&255|yA,r>>>=7;return e[t]=r|0,hN.bytes=t-n+1,e}var $re=r4,Tre=128,gA=127;function r4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw r4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&gA)<<s:(o&gA)*Math.pow(2,s),s+=7}while(o>=Tre);return r4.bytes=i-n,t}var Ire=Math.pow(2,7),Rre=Math.pow(2,14),Cre=Math.pow(2,21),xre=Math.pow(2,28),Dre=Math.pow(2,35),Pre=Math.pow(2,42),Ore=Math.pow(2,49),kre=Math.pow(2,56),Nre=Math.pow(2,63),Lre=function(r){return r<Ire?1:r<Rre?2:r<Cre?3:r<xre?4:r<Dre?5:r<Pre?6:r<Ore?7:r<kre?8:r<Nre?9:10},Mre={encode:vre,decode:$re,encodingLength:Lre},py=Mre;const n4=(r,e=0)=>[py.decode(r,e),py.decode.bytes],yy=(r,e,t=0)=>(py.encode(r,e,t),e),gy=r=>py.encodingLength(r),Ure=(r,e)=>{const t=e.byteLength,n=gy(r),s=n+gy(t),i=new Uint8Array(s+t);return yy(r,i,0),yy(t,i,n),i.set(e,s),new vE(r,t,e,i)},Bre=r=>{const e=EE(r),[t,n]=n4(e),[s,i]=n4(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new vE(t,s,o,e)},zre=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&tre(r.bytes,t.bytes)}};let vE=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};class Fre{constructor(){N(this,"index",0);N(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,s){return this.readAtomically(()=>{let i=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",u=2**(8*s)-1;for(;;){const l=this.readAtomically(()=>{const h=this.readChar();if(h===void 0)return;const f=Number.parseInt(h,e);if(!Number.isNaN(f))return f});if(l===void 0)break;if(i*=e,i+=l,i>u||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const s=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3],[s+4,!0]}const i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];t[s]=i>>8,t[s+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,s]=e(t);if(n===16)return t;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const i=new Uint8Array(14),o=16-(n+2),[a]=e(i.subarray(0,o));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const dN=45,Vre=15,vh=new Fre;function jre(r){if(!(r.length>Vre))return vh.new(r).parseWith(()=>vh.readIPv4Addr())}function Kre(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>dN))return vh.new(r).parseWith(()=>vh.readIPv6Addr())}function qre(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>dN))return vh.new(r).parseWith(()=>vh.readIPAddr())}function mi(r){return!!jre(r)}function Ei(r){return!!Kre(r)}function Nt(r){return!!qre(r)}const Ms=-1,s4={},i4={},Hre=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Ms,"ip6zone"],[43,8,"ipcidr"],[53,Ms,"dns",!0],[54,Ms,"dns4",!0],[55,Ms,"dns6",!0],[56,Ms,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Ms,"unix",!1,!0],[421,Ms,"ipfs"],[421,Ms,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Ms,"garlic64"],[448,0,"tls"],[449,Ms,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Ms,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Ms,"memory"]];Hre.forEach(r=>{const e=Gre(...r);i4[e.code]=e,s4[e.name]=e});function Gre(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function p0(r){if(typeof r=="number"){if(i4[r]!=null)return i4[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(s4[r]!=null)return s4[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const wA=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return Qre(t,o4(r),e||Jo.encoder);default:return Yre(t,o4(r),e||Zf.encoder)}},bA=new WeakMap,o4=r=>{const e=bA.get(r);if(e==null){const t=new Map;return bA.set(r,t),t}return e};let L3=class Cn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Rd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Xre)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Cn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Ure(e,t);return Cn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Cn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&zre(e.multihash,n.multihash)}toString(e){return wA(this,e)}toJSON(){return{"/":wA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Cn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Cn(n,s,i,o||mA(n,s,i.bytes))}else if(t[Jre]===!0){const{version:n,multihash:s,code:i}=t,o=Bre(s);return Cn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Rd)throw new Error(`Version 0 CID must use dag-pb (code: ${Rd}) block encoding`);return new Cn(e,t,n,n.bytes)}case 1:{const s=mA(e,t,n.bytes);return new Cn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Cn.create(0,Rd,e)}static createV1(e,t){return Cn.create(1,e,t)}static decode(e){const[t,n]=Cn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Cn.inspectBytes(e),n=t.size-t.multihashSize,s=EE(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new vE(t.multihashCode,t.digestSize,i,s);return[t.version===0?Cn.createV0(o):Cn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=n4(e.subarray(t));return t+=f,h};let s=n(),i=Rd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=Wre(e,t),i=Cn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return o4(i).set(n,e),i}};const Wre=(r,e)=>{switch(r[0]){case"Q":{const t=e||Jo;return[Jo.prefix,t.decode(`${Jo.prefix}${r}`)]}case Jo.prefix:{const t=e||Jo;return[Jo.prefix,t.decode(r)]}case Zf.prefix:{const t=e||Zf;return[Zf.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Qre=(r,e,t)=>{const{prefix:n}=t;if(n!==Jo.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},Yre=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Rd=112,Xre=18,mA=(r,e,t)=>{const n=gy(r),s=n+gy(e),i=new Uint8Array(s+t.byteLength);return yy(r,i,0),yy(e,i,n),i.set(t,s),i},Jre=Symbol.for("@ipld/js-cid/CID"),Zre=Zw({prefix:"\0",name:"identity",encode:r=>nre(r),decode:r=>rre(r)}),ene=Object.freeze(Object.defineProperty({__proto__:null,identity:Zre},Symbol.toStringTag,{value:"Module"})),tne=qr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),rne=Object.freeze(Object.defineProperty({__proto__:null,base2:tne},Symbol.toStringTag,{value:"Module"})),nne=qr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),sne=Object.freeze(Object.defineProperty({__proto__:null,base8:nne},Symbol.toStringTag,{value:"Module"})),ine=Ep({prefix:"9",name:"base10",alphabet:"0123456789"}),one=Object.freeze(Object.defineProperty({__proto__:null,base10:ine},Symbol.toStringTag,{value:"Module"})),ane=qr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),cne=qr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),lne=Object.freeze(Object.defineProperty({__proto__:null,base16:ane,base16upper:cne},Symbol.toStringTag,{value:"Module"})),une=Ep({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hne=Ep({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),dne=Object.freeze(Object.defineProperty({__proto__:null,base36:une,base36upper:hne},Symbol.toStringTag,{value:"Module"})),fne=qr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),pne=qr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),yne=qr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gne=qr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),wne=Object.freeze(Object.defineProperty({__proto__:null,base64:fne,base64pad:pne,base64url:yne,base64urlpad:gne},Symbol.toStringTag,{value:"Module"})),fN=Array.from(""),bne=fN.reduce((r,e,t)=>(r[t]=e,r),[]),mne=fN.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Ene(r){return r.reduce((e,t)=>(e+=bne[t],e),"")}function vne(r){const e=[];for(const t of r){const n=mne[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const _ne=Zw({prefix:"",name:"base256emoji",encode:Ene,decode:vne}),Sne=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:_ne},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Ane={...ene,...rne,...sne,...one,...lne,...Ere,...dne,...hre,...wne,...Sne},M3=Object.values(Ane).map(r=>r.decoder);(function(){let r=M3[0].or(M3[1]);return M3.slice(2).forEach(e=>r=r.or(e)),r})();globalThis&&globalThis.__classPrivateFieldGet;globalThis&&globalThis.__classPrivateFieldSet;p0("dns").code,p0("dns4").code,p0("dns6").code,p0("dnsaddr").code;function $ne(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var Tne=$ne,Ine=Tne;const Rne=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Cne=r=>new TextEncoder().encode(r),xne=r=>new TextDecoder().decode(r);let Dne=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Pne=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return pN(this,e)}},One=class{constructor(e){this.decoders=e}or(e){return pN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const pN=(r,e)=>new One({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let kne=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Dne(e,t,n),this.decoder=new Pne(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const eb=({name:r,prefix:e,encode:t,decode:n})=>new kne(r,e,t,n),vp=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=Ine(t,e);return eb({prefix:r,name:e,encode:n,decode:i=>Rne(s(i))})},Nne=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Lne=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Hr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>eb({prefix:e,name:r,encode(s){return Lne(s,n,t)},decode(s){return Nne(s,n,t,r)}}),Mne=vp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Une=vp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Bne=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Mne,base58flickr:Une},Symbol.toStringTag,{value:"Module"})),zne=Hr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Fne=Hr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vne=Hr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),jne=Hr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Kne=Hr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qne=Hr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hne=Hr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Gne=Hr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Wne=Hr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Qne=Object.freeze(Object.defineProperty({__proto__:null,base32:zne,base32hex:Kne,base32hexpad:Hne,base32hexpadupper:Gne,base32hexupper:qne,base32pad:Vne,base32padupper:jne,base32upper:Fne,base32z:Wne},Symbol.toStringTag,{value:"Module"})),Yne=eb({prefix:"\0",name:"identity",encode:r=>xne(r),decode:r=>Cne(r)}),Xne=Object.freeze(Object.defineProperty({__proto__:null,identity:Yne},Symbol.toStringTag,{value:"Module"})),Jne=Hr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Zne=Object.freeze(Object.defineProperty({__proto__:null,base2:Jne},Symbol.toStringTag,{value:"Module"})),ese=Hr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),tse=Object.freeze(Object.defineProperty({__proto__:null,base8:ese},Symbol.toStringTag,{value:"Module"})),rse=vp({prefix:"9",name:"base10",alphabet:"0123456789"}),nse=Object.freeze(Object.defineProperty({__proto__:null,base10:rse},Symbol.toStringTag,{value:"Module"})),sse=Hr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ise=Hr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ose=Object.freeze(Object.defineProperty({__proto__:null,base16:sse,base16upper:ise},Symbol.toStringTag,{value:"Module"})),ase=vp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),cse=vp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),lse=Object.freeze(Object.defineProperty({__proto__:null,base36:ase,base36upper:cse},Symbol.toStringTag,{value:"Module"})),use=Hr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),hse=Hr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),dse=Hr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),fse=Hr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),pse=Object.freeze(Object.defineProperty({__proto__:null,base64:use,base64pad:hse,base64url:dse,base64urlpad:fse},Symbol.toStringTag,{value:"Module"})),yN=Array.from(""),yse=yN.reduce((r,e,t)=>(r[t]=e,r),[]),gse=yN.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function wse(r){return r.reduce((e,t)=>(e+=yse[t],e),"")}function bse(r){const e=[];for(const t of r){const n=gse[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const mse=eb({prefix:"",name:"base256emoji",encode:wse,decode:bse}),Ese=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:mse},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const vse={...Xne,...Zne,...tse,...nse,...ose,...Qne,...lse,...Bne,...pse,...Ese},Us=-1,a4={},c4={},_se=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Us,"ip6zone"],[43,8,"ipcidr"],[53,Us,"dns",!0],[54,Us,"dns4",!0],[55,Us,"dns6",!0],[56,Us,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Us,"unix",!1,!0],[421,Us,"ipfs"],[421,Us,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Us,"garlic64"],[448,0,"tls"],[449,Us,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Us,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Us,"memory"]];_se.forEach(r=>{const e=Sse(...r);c4[e.code]=e,a4[e.name]=e});function Sse(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function wl(r){if(typeof r=="number"){if(c4[r]!=null)return c4[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(a4[r]!=null)return a4[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}wl("ip4");wl("ip6");wl("ipcidr");const U3=Object.values(vse).map(r=>r.decoder);(function(){let r=U3[0].or(U3[1]);return U3.slice(2).forEach(e=>r=r.or(e)),r})();wl("dns").code,wl("dns4").code,wl("dns6").code,wl("dnsaddr").code;const Ase=typeof navigator<"u"&&navigator.product==="ReactNative";function $se(){return Ase?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}const e1=self.URL,gN=$se();let Tse=class{constructor(e="",t=gN){this.super=new e1(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return e1.createObjectURL(e)}static revokeObjectURL(e){e1.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}};function Ise(r){if(typeof r=="string")return new e1(r).toString();if(!(r instanceof e1)){const e=r.username&&r.password?`${r.username}:${r.password}@`:"",t=r.auth?r.auth+"@":"",n=r.port?":"+r.port:"",s=r.protocol?r.protocol+"//":"",i=r.host||"",o=r.hostname||"",a=r.search||(r.query?"?"+r.query:""),c=r.hash||"",u=r.pathname||"",l=r.path||u+a;return`${s}${e||t}${i||o+n}${l}${c}`}}var wN={URLWithLegacySupport:Tse,URLSearchParams:self.URLSearchParams,defaultBase:gN,format:Ise};const{URLWithLegacySupport:EA,format:Rse}=wN;var Cse=(r,e={},t={},n)=>{let s=e.protocol?e.protocol.replace(":",""):"http";s=(t[s]||n||s)+":";let i;try{i=new EA(r)}catch{i={}}const o=Object.assign({},e,{protocol:s||i.protocol,host:e.host||i.host});return new EA(r,Rse(o)).toString()};const{URLWithLegacySupport:xse,format:Dse,URLSearchParams:Pse,defaultBase:Ose}=wN,kse=Cse;var _E={URL:xse,URLSearchParams:Pse,format:Dse,relative:kse,defaultBase:Ose};const wy=/^\/(ip[fn]s)\/([^/?#]+)/,bN=1,mN=2,EN=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/,Nse=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function SE(r){try{return SN(r)?!!L3.parse(r):r instanceof Uint8Array?!!L3.decode(r):!!L3.asCID(r)}catch{return!1}}function vN(r,e,t=bN,n=mN){const s=AN(r);if(s===!1)return!1;const i=s.match(e);if(i==null||i[t]!=="ipfs")return!1;let o=i[n];return o!=null&&e===EN&&(o=o.toLowerCase()),SE(o)}function _N(r,e,t=bN,n=mN){const s=AN(r);if(s===!1)return!1;const i=s.match(e);if(i==null||i[t]!=="ipns")return!1;let o=i[n];if(o!=null&&e===EN){if(o=o.toLowerCase(),SE(o))return!0;try{!o.includes(".")&&o.includes("-")&&(o=o.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));const{hostname:a}=new _E.URL(`http://${o}`);return Nse.test(a)}catch{return!1}}return!0}function SN(r){return typeof r=="string"}function AN(r){return r instanceof Uint8Array?R(r,"base58btc"):SN(r)?r:!1}const $N=r=>vN(r,wy)||_N(r,wy),Lse=r=>vN(r,wy),TN=r=>_N(r,wy);let IN=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const Qo="/",RN=new TextEncoder().encode(Qo),y0=RN[0];class be{constructor(e,t){if(typeof e=="string")this._buf=M(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==y0)throw new Error("Invalid key")}toString(e="utf8"){return R(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new be(e.join(Qo))}static random(){return new be(IN().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new be(e):typeof e.uint8Array=="function"?new be(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=RN),this._buf[0]!==y0){const e=new Uint8Array(this._buf.byteLength+1);e.fill(y0,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===y0;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let s=0;s<t.length;s++){if(n.length<s+1)return!1;const i=t[s],o=n[s];if(i<o)return!0;if(i>o)return!1}return t.length<n.length}reverse(){return be.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Qo).slice(1)}type(){return Mse(this.baseNamespace())}name(){return Use(this.baseNamespace())}instance(e){return new be(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Qo)||(e+=Qo),e+=this.type(),new be(e)}parent(){const e=this.list();return e.length===1?new be(Qo):new be(e.slice(0,-1).join(Qo))}child(e){return this.toString()===Qo?e:e.toString()===Qo?this:new be(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return be.withNamespaces([...this.namespaces(),...Bse(e.map(t=>t.namespaces()))])}}function Mse(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Use(r){const e=r.split(":");return e[e.length-1]}function Bse(r){return[].concat(...r)}var AE={exports:{}};function CN(r){const e=new globalThis.AbortController;function t(){e.abort();for(const n of r)!n||!n.removeEventListener||n.removeEventListener("abort",t)}for(const n of r)if(!(!n||!n.addEventListener)){if(n.aborted){t();break}n.addEventListener("abort",t)}return e.signal}AE.exports=CN;var Io=AE.exports.anySignal=CN,zse=AE.exports;let Fse=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/uig;Te.nanosecond=Te.ns=1/1e6;Te.s=Te.s=Te.us=Te.microsecond=1/1e3;Te.millisecond=Te.ms=Te[""]=1;Te.second=Te.sec=Te.s=Te.ms*1e3;Te.minute=Te.min=Te.m=Te.s*60;Te.hour=Te.hr=Te.h=Te.m*60;Te.day=Te.d=Te.h*24;Te.week=Te.wk=Te.w=Te.d*7;Te.month=Te.b=Te.d*(365.25/12);Te.year=Te.yr=Te.y=Te.d*365.25;function Te(r="",e="ms"){var t=null;r=(r+"").replace(/(\d)[,_](\d)/g,"$1$2");var n=r[0]==="-";return r.replace(Fse,function(s,i,o){o=vA(o),o&&(t=(t||0)+Math.abs(parseFloat(i,10))*o)}),t&&t/(vA(e)||1)*(n?-1:1)}function vA(r){return Te[r]||Te[r.toLowerCase().replace(/s$/,"")]}let b2=class xN extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=xN.code}};b2.code="ERR_TIMEOUT";function Y(r,e){return(...t)=>{const n=t[e??t.length-1];if(!n||!n.timeout)return r(...t);const s=typeof n.timeout=="string"?Te(n.timeout):n.timeout,i=new Xt.TimeoutController(s);n.signal=Io([n.signal,i.signal]);const o=r(...t),a=new Promise((l,h)=>{i.signal.addEventListener("abort",()=>{h(new b2)})}),c=Date.now(),u=()=>{if(i.signal.aborted)throw new b2;if(Date.now()-c>s)throw i.abort(),new b2};return o[Symbol.asyncIterator]?async function*(){const l=o[Symbol.asyncIterator]();try{for(;;){const{value:h,done:f}=await Promise.race([l.next(),a]);if(f)break;u(),yield h}}catch(h){throw u(),h}finally{i.clear(),l.return&&l.return()}}():(async()=>{try{const l=await Promise.race([o,a]);return u(),l}catch(l){throw u(),l}finally{i.clear()}})()}}var Vse=DN,_A=128,jse=127,Kse=~jse,qse=Math.pow(2,31);function DN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=qse;)e[t++]=r&255|_A,r/=128;for(;r&Kse;)e[t++]=r&255|_A,r>>>=7;return e[t]=r|0,DN.bytes=t-n+1,e}var Hse=l4,Gse=128,SA=127;function l4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw l4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&SA)<<s:(o&SA)*Math.pow(2,s),s+=7}while(o>=Gse);return l4.bytes=i-n,t}var Wse=Math.pow(2,7),Qse=Math.pow(2,14),Yse=Math.pow(2,21),Xse=Math.pow(2,28),Jse=Math.pow(2,35),Zse=Math.pow(2,42),eie=Math.pow(2,49),tie=Math.pow(2,56),rie=Math.pow(2,63),nie=function(r){return r<Wse?1:r<Qse?2:r<Yse?3:r<Xse?4:r<Jse?5:r<Zse?6:r<eie?7:r<tie?8:r<rie?9:10},sie={encode:Vse,decode:Hse,encodingLength:nie},by=sie;const u4=(r,e=0)=>[by.decode(r,e),by.decode.bytes],my=(r,e,t=0)=>(by.encode(r,e,t),e),Ey=r=>by.encodingLength(r),iie=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},$E=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},oie=r=>new TextEncoder().encode(r),aie=r=>new TextDecoder().decode(r),cie=(r,e)=>{const t=e.byteLength,n=Ey(r),s=n+Ey(t),i=new Uint8Array(s+t);return my(r,i,0),my(t,i,n),i.set(e,s),new TE(r,t,e,i)},PN=r=>{const e=$E(r),[t,n]=u4(e),[s,i]=u4(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new TE(t,s,o,e)},lie=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&iie(r.bytes,t.bytes)}};let TE=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function uie(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var hie=uie,die=hie;let fie=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},pie=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ON(this,e)}},yie=class{constructor(e){this.decoders=e}or(e){return ON(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ON=(r,e)=>new yie({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let gie=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new fie(e,t,n),this.decoder=new pie(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const tb=({name:r,prefix:e,encode:t,decode:n})=>new gie(r,e,t,n),_p=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=die(t,e);return tb({prefix:r,name:e,encode:n,decode:i=>$E(s(i))})},wie=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},bie=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Gr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>tb({prefix:e,name:r,encode(s){return bie(s,n,t)},decode(s){return wie(s,n,t,r)}}),Mi=_p({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mie=_p({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Eie=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Mi,base58flickr:mie},Symbol.toStringTag,{value:"Module"})),$l=Gr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vie=Gr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_ie=Gr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sie=Gr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Aie=Gr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$ie=Gr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Tie=Gr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Iie=Gr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Rie=Gr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Cie=Object.freeze(Object.defineProperty({__proto__:null,base32:$l,base32hex:Aie,base32hexpad:Tie,base32hexpadupper:Iie,base32hexupper:$ie,base32pad:_ie,base32padupper:Sie,base32upper:vie,base32z:Rie},Symbol.toStringTag,{value:"Module"})),AA=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return Die(t,h4(r),e||Mi.encoder);default:return Pie(t,h4(r),e||$l.encoder)}},$A=new WeakMap,h4=r=>{const e=$A.get(r);if(e==null){const t=new Map;return $A.set(r,t),t}return e};let Tl=class xn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Cd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Oie)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return xn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=cie(e,t);return xn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return xn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&lie(e.multihash,n.multihash)}toString(e){return AA(this,e)}toJSON(){return{"/":AA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof xn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new xn(n,s,i,o||TA(n,s,i.bytes))}else if(t[kie]===!0){const{version:n,multihash:s,code:i}=t,o=PN(s);return xn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Cd)throw new Error(`Version 0 CID must use dag-pb (code: ${Cd}) block encoding`);return new xn(e,t,n,n.bytes)}case 1:{const s=TA(e,t,n.bytes);return new xn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return xn.create(0,Cd,e)}static createV1(e,t){return xn.create(1,e,t)}static decode(e){const[t,n]=xn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=xn.inspectBytes(e),n=t.size-t.multihashSize,s=$E(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new TE(t.multihashCode,t.digestSize,i,s);return[t.version===0?xn.createV0(o):xn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=u4(e.subarray(t));return t+=f,h};let s=n(),i=Cd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=xie(e,t),i=xn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return h4(i).set(n,e),i}};const xie=(r,e)=>{switch(r[0]){case"Q":{const t=e||Mi;return[Mi.prefix,t.decode(`${Mi.prefix}${r}`)]}case Mi.prefix:{const t=e||Mi;return[Mi.prefix,t.decode(r)]}case $l.prefix:{const t=e||$l;return[$l.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Die=(r,e,t)=>{const{prefix:n}=t;if(n!==Mi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},Pie=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Cd=112,Oie=18,TA=(r,e,t)=>{const n=Ey(r),s=n+Ey(e),i=new Uint8Array(s+t.byteLength);return my(r,i,0),my(e,i,n),i.set(t,s),i},kie=Symbol.for("@ipld/js-cid/CID"),IA="/ipfs/";function Sp(r){if(r instanceof Uint8Array)try{r=Tl.decode(r)}catch(s){throw T(s,"ERR_INVALID_CID")}let e=Tl.asCID(r);if(e)return{cid:e,path:void 0};r=r.toString(),r.startsWith(IA)&&(r=r.substring(IA.length));const t=r.split("/");let n;try{e=Tl.parse(t.shift()||"")}catch(s){throw T(s,"ERR_INVALID_CID")}return t.length&&(n=`/${t.join("/")}`),{cid:e,path:n}}const Nie="ERR_BAD_PATH",kN="This command must be run in online mode. Try running 'ipfs daemon' first.",d4=new be("/local/filesroot"),Lie=262144,Mie=r=>{if(we.asCID(r))return`/ipfs/${r}`;const t=r.toString();try{return`/ipfs/${we.parse(t)}`}catch{}if($N(t))return t;throw T(new Error(`invalid path: ${r}`),Nie)},IE=r=>r instanceof Uint8Array?we.decode(r).toString():(r=r.toString(),r.indexOf("/ipfs/")===0&&(r=r.substring(6)),r.charAt(r.length-1)==="/"&&(r=r.substring(0,r.length-1)),r),rb=async function(r,e,t,n={}){const{cid:s,path:i}=Sp(t);i&&(n.path=i);let o=s,a=n.path||"";if(a.startsWith("/")&&(a=a.substring(1)),n.path)try{for await(const{value:c,remainderPath:u}of I1(s,n.path,e,r,{signal:n.signal})){if(!we.asCID(c))break;a=u,o=c}}catch(c){throw c.message.startsWith("Object has no property")&&(c.message=`no link named "${a.split("/")[0]}" under ${o}`,c.code="ERR_NO_LINK"),c}return{cid:o,remainderPath:a||""}},RA=r=>{if(r.type!=="file"&&r.type!=="directory"&&r.type!=="raw")throw new Error(`Unknown node type '${r.type}'`);const e={cid:r.cid,path:r.path,name:r.name,size:r.size,type:"file"};return r.type==="directory"&&(e.type="dir"),r.type==="file"&&(e.size=r.unixfs.fileSize()),(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,r.unixfs.mtime!==void 0&&(e.mtime=r.unixfs.mtime)),e},Uie=Y(async(r,e)=>await r),I1=async function*(r,e,t,n,s){const i=async u=>{const l=await t.getCodec(u.code),h=await n.blocks.get(u,s);return l.decode(h)},o=e.split("/").filter(Boolean);let a=await i(r),c=r;for(;o.length;){const u=o.shift();if(!u)throw T(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(r.code===jt&&Array.isArray(a.Links)){const l=a.Links.find(h=>h.Name===u);if(l){yield{value:l.Hash,remainderPath:o.join("/")},a=await i(l.Hash),c=l.Hash;continue}}if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:o.join("/")};else throw T(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");we.asCID(a)&&(c=a,a=await i(a))}yield{value:a,remainderPath:""}};class ki{static create({start:e,stop:t}){return new ki(e,t)}static async start(e,t){const{state:n,activate:s}=e;switch(n.status){case"stopped":try{const i=s(t);e.state={status:"starting",ready:i};const o=await i;return e.state={status:"started",value:o},o}catch(i){throw e.state={status:"stopped"},i}case"starting":throw new Xw;case"started":throw new Jw;case"stopping":return await n.ready,await ki.start(e,t);default:return ki.panic(e)}}static async stop(e){const{state:t,deactivate:n}=e;switch(t.status){case"stopped":break;case"starting":{try{await t.ready}catch{}return await ki.stop(e)}case"stopping":return await t.ready;case"started":{n&&await n(t.value),e.state={status:"stopped"};break}default:ki.panic(t)}}static try({state:e}){switch(e.status){case"started":return e.value;default:return null}}static async use({state:e},t){switch(e.status){case"started":return e.value;case"starting":return await Uie(e.ready,t);default:throw new mp}}static panic({state:e}){const t=JSON.stringify({status:e.status});throw RangeError(`Service in invalid state ${t}, should never happen if you see this please report a bug`)}constructor(e,t){this.activate=e,this.deactivate=t,this.state={status:"stopped"}}async use(e){return await ki.use(this,e)}try(){return ki.try(this)}}function Bie({network:r,preload:e,peerId:t,keychain:n,repo:s,ipns:i,mfsPreload:o,print:a,hashers:c,options:u}){return async()=>{const{libp2p:h}=await ki.start(r,{peerId:t,repo:s,print:a,hashers:c,options:u});await Promise.all([i.startOnline({keychain:n,libp2p:h,peerId:t,repo:s}),e.start(),o.start()])}}function zie({network:r,preload:e,ipns:t,repo:n,mfsPreload:s}){return async()=>{await Promise.all([e.stop(),t.stop(),s.stop()]),await ki.stop(r),await n.close()}}var Fie=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function s(i,o){t[i]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||n[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),n[i]!==void 0&&(n[i]=void 0)},get:function(i){var o=t[i];if(o!==void 0)return o;if((o=n[i])!==void 0)return s(i,o),o},set:function(i,o){t[i]!==void 0?t[i]=o:s(i,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}};const nb=Et(Fie);let Vie=class{constructor(e){this.lru=nb(e)}get(e){const t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}};var NN={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function i(c,u,l,h,f){if(typeof l!="function")throw new TypeError("The listener must be a function");var y=new s(l,h||c,f),d=t?t+u:u;return c._events[d]?c._events[d].fn?c._events[d]=[c._events[d],y]:c._events[d].push(y):(c._events[d]=y,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],l,h;if(this._eventsCount===0)return u;for(h in l=this._events)e.call(l,h)&&u.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},a.prototype.listeners=function(u){var l=t?t+u:u,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,y=h.length,d=new Array(y);f<y;f++)d[f]=h[f].fn;return d},a.prototype.listenerCount=function(u){var l=t?t+u:u,h=this._events[l];return h?h.fn?1:h.length:0},a.prototype.emit=function(u,l,h,f,y,d){var p=t?t+u:u;if(!this._events[p])return!1;var b=this._events[p],w=arguments.length,S,E;if(b.fn){switch(b.once&&this.removeListener(u,b.fn,void 0,!0),w){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,l),!0;case 3:return b.fn.call(b.context,l,h),!0;case 4:return b.fn.call(b.context,l,h,f),!0;case 5:return b.fn.call(b.context,l,h,f,y),!0;case 6:return b.fn.call(b.context,l,h,f,y,d),!0}for(E=1,S=new Array(w-1);E<w;E++)S[E-1]=arguments[E];b.fn.apply(b.context,S)}else{var m=b.length,v;for(E=0;E<m;E++)switch(b[E].once&&this.removeListener(u,b[E].fn,void 0,!0),w){case 1:b[E].fn.call(b[E].context);break;case 2:b[E].fn.call(b[E].context,l);break;case 3:b[E].fn.call(b[E].context,l,h);break;case 4:b[E].fn.call(b[E].context,l,h,f);break;default:if(!S)for(v=1,S=new Array(w-1);v<w;v++)S[v-1]=arguments[v];b[E].fn.apply(b[E].context,S)}}return!0},a.prototype.on=function(u,l,h){return i(this,u,l,h,!1)},a.prototype.once=function(u,l,h){return i(this,u,l,h,!0)},a.prototype.removeListener=function(u,l,h,f){var y=t?t+u:u;if(!this._events[y])return this;if(!l)return o(this,y),this;var d=this._events[y];if(d.fn)d.fn===l&&(!f||d.once)&&(!h||d.context===h)&&o(this,y);else{for(var p=0,b=[],w=d.length;p<w;p++)(d[p].fn!==l||f&&!d[p].once||h&&d[p].context!==h)&&b.push(d[p]);b.length?this._events[y]=b.length===1?b[0]:b:o(this,y)}return this},a.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&o(this,l)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(NN);var jie=NN.exports;const Kie=Et(jie);function qie(r,e,t){let n=0,s=r.length;for(;s>0;){const i=Math.trunc(s/2);let o=n+i;t(r[o],e)<=0?(n=++o,s-=i+1):s=i}return n}var Zc=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Yo;class Hie{constructor(){Yo.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&Zc(this,Yo,"f")[this.size-1].priority>=t.priority){Zc(this,Yo,"f").push(n);return}const s=qie(Zc(this,Yo,"f"),n,(i,o)=>o.priority-i.priority);Zc(this,Yo,"f").splice(s,0,n)}dequeue(){const e=Zc(this,Yo,"f").shift();return e?.run}filter(e){return Zc(this,Yo,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return Zc(this,Yo,"f").length}}Yo=new WeakMap;var qt=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ae=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},cr,t1,r1,sc,vy,n1,m2,Ri,jf,As,E2,Ts,s1,Ga,v2,CA,xA,LN,DA,PA,_2,B3,z3,_y,MN,S2;let UN=class extends Error{};class Cr extends Kie{constructor(e){var t,n,s,i;if(super(),cr.add(this),t1.set(this,void 0),r1.set(this,void 0),sc.set(this,0),vy.set(this,void 0),n1.set(this,void 0),m2.set(this,0),Ri.set(this,void 0),jf.set(this,void 0),As.set(this,void 0),E2.set(this,void 0),Ts.set(this,0),s1.set(this,void 0),Ga.set(this,void 0),v2.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Hie,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);qt(this,t1,e.carryoverConcurrencyCount,"f"),qt(this,r1,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),qt(this,vy,e.intervalCap,"f"),qt(this,n1,e.interval,"f"),qt(this,As,new e.queueClass,"f"),qt(this,E2,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,qt(this,v2,e.throwOnTimeout===!0,"f"),qt(this,Ga,e.autoStart===!1,"f")}get concurrency(){return ae(this,s1,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);qt(this,s1,e,"f"),ae(this,cr,"m",_y).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:ae(this,v2,"f"),...t},new Promise((n,s)=>{ae(this,As,"f").enqueue(async()=>{var i,o,a;qt(this,Ts,(o=ae(this,Ts,"f"),o++,o),"f"),qt(this,sc,(a=ae(this,sc,"f"),a++,a),"f");try{if(!((i=t.signal)===null||i===void 0)&&i.aborted)throw new UN("The task was aborted.");let c=e({signal:t.signal});t.timeout&&(c=IO(Promise.resolve(c),t.timeout)),t.signal&&(c=Promise.race([c,ae(this,cr,"m",MN).call(this,t.signal)]));const u=await c;n(u),this.emit("completed",u)}catch(c){if(c instanceof Sq&&!t.throwOnTimeout){n();return}s(c),this.emit("error",c)}finally{ae(this,cr,"m",LN).call(this)}},t),this.emit("add"),ae(this,cr,"m",_2).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return ae(this,Ga,"f")?(qt(this,Ga,!1,"f"),ae(this,cr,"m",_y).call(this),this):this}pause(){qt(this,Ga,!0,"f")}clear(){qt(this,As,new(ae(this,E2,"f")),"f")}async onEmpty(){ae(this,As,"f").size!==0&&await ae(this,cr,"m",S2).call(this,"empty")}async onSizeLessThan(e){ae(this,As,"f").size<e||await ae(this,cr,"m",S2).call(this,"next",()=>ae(this,As,"f").size<e)}async onIdle(){ae(this,Ts,"f")===0&&ae(this,As,"f").size===0||await ae(this,cr,"m",S2).call(this,"idle")}get size(){return ae(this,As,"f").size}sizeBy(e){return ae(this,As,"f").filter(e).length}get pending(){return ae(this,Ts,"f")}get isPaused(){return ae(this,Ga,"f")}}t1=new WeakMap,r1=new WeakMap,sc=new WeakMap,vy=new WeakMap,n1=new WeakMap,m2=new WeakMap,Ri=new WeakMap,jf=new WeakMap,As=new WeakMap,E2=new WeakMap,Ts=new WeakMap,s1=new WeakMap,Ga=new WeakMap,v2=new WeakMap,cr=new WeakSet,CA=function(){return ae(this,r1,"f")||ae(this,sc,"f")<ae(this,vy,"f")},xA=function(){return ae(this,Ts,"f")<ae(this,s1,"f")},LN=function(){var e;qt(this,Ts,(e=ae(this,Ts,"f"),e--,e),"f"),ae(this,cr,"m",_2).call(this),this.emit("next")},DA=function(){ae(this,cr,"m",z3).call(this),ae(this,cr,"m",B3).call(this),qt(this,jf,void 0,"f")},PA=function(){const e=Date.now();if(ae(this,Ri,"f")===void 0){const t=ae(this,m2,"f")-e;if(t<0)qt(this,sc,ae(this,t1,"f")?ae(this,Ts,"f"):0,"f");else return ae(this,jf,"f")===void 0&&qt(this,jf,setTimeout(()=>{ae(this,cr,"m",DA).call(this)},t),"f"),!0}return!1},_2=function(){if(ae(this,As,"f").size===0)return ae(this,Ri,"f")&&clearInterval(ae(this,Ri,"f")),qt(this,Ri,void 0,"f"),this.emit("empty"),ae(this,Ts,"f")===0&&this.emit("idle"),!1;if(!ae(this,Ga,"f")){const e=!ae(this,cr,"a",PA);if(ae(this,cr,"a",CA)&&ae(this,cr,"a",xA)){const t=ae(this,As,"f").dequeue();return t?(this.emit("active"),t(),e&&ae(this,cr,"m",B3).call(this),!0):!1}}return!1},B3=function(){ae(this,r1,"f")||ae(this,Ri,"f")!==void 0||(qt(this,Ri,setInterval(()=>{ae(this,cr,"m",z3).call(this)},ae(this,n1,"f")),"f"),qt(this,m2,Date.now()+ae(this,n1,"f"),"f"))},z3=function(){ae(this,sc,"f")===0&&ae(this,Ts,"f")===0&&ae(this,Ri,"f")&&(clearInterval(ae(this,Ri,"f")),qt(this,Ri,void 0,"f")),qt(this,sc,ae(this,t1,"f")?ae(this,Ts,"f"):0,"f"),ae(this,cr,"m",_y).call(this)},_y=function(){for(;ae(this,cr,"m",_2).call(this););},MN=async function(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new UN("The task was aborted."))},{once:!0})})},S2=async function(e,t){return new Promise(n=>{const s=()=>{t&&!t()||(this.off(e,s),n())};this.on(e,s)})};var Ap={};let Gie=class extends Error{constructor(e="Request timed out"){super(e),this.name="TimeoutError"}};Ap.TimeoutError=Gie;let Wie=class extends Error{constructor(e="The operation was aborted."){super(e),this.name="AbortError"}};Ap.AbortError=Wie;let Qie=class extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.response=e}};Ap.HTTPError=Qie;var f4={exports:{}},g0={exports:{}},OA;function w0(){return OA||(OA=1,function(r,e){var t=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Is<"u")return Is;throw new Error("unable to locate global object")},n=t();r.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response}(g0,g0.exports)),g0.exports}globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?f4.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:f4.exports={default:w0().default,Headers:w0().Headers,Request:w0().Request,Response:w0().Response};var Yie=f4.exports,Xie=Yie;const{TimeoutError:Jie,AbortError:Zie}=Ap,{Response:BN,Request:eoe,Headers:RE,default:toe}=Xie,roe=(r,e={})=>{const t=new XMLHttpRequest;t.open(e.method||"GET",r.toString(),!0);const{timeout:n,headers:s}=e;if(n&&n>0&&n<1/0&&(t.timeout=n),e.overrideMimeType!=null&&t.overrideMimeType(e.overrideMimeType),s)for(const[i,o]of new RE(s))t.setRequestHeader(i,o);return e.signal&&(e.signal.onabort=()=>t.abort()),e.onUploadProgress&&(t.upload.onprogress=e.onUploadProgress),t.responseType="arraybuffer",new Promise((i,o)=>{const a=c=>{switch(c.type){case"error":{i(BN.error());break}case"load":{i(new ooe(t.responseURL,t.response,{status:t.status,statusText:t.statusText,headers:ioe(t.getAllResponseHeaders())}));break}case"timeout":{o(new Jie);break}case"abort":{o(new Zie);break}}};t.onerror=a,t.onload=a,t.ontimeout=a,t.onabort=a,t.send(e.body)})},noe=toe,soe=(r,e={})=>e.onUploadProgress!=null?roe(r,e):noe(r,e),ioe=r=>{const e=new RE;for(const t of r.trim().split(/[\r\n]+/)){const n=t.indexOf(": ");n>0&&e.set(t.slice(0,n),t.slice(n+1))}return e};class ooe extends BN{constructor(e,t,n){super(t,n),Object.defineProperty(this,"url",{value:e})}}var aoe={fetch:soe,Request:eoe,Headers:RE};const coe=Aq(GG);async function*loe(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&t.cancel(),t.releaseLock()}}var uoe=loe;const hoe=async r=>{const e=[];for await(const t of r)e.push(t);return e};var doe=hoe;const{fetch:foe,Request:poe,Headers:yoe}=aoe,{TimeoutError:p4,HTTPError:zN}=Ap,kA=coe.bind({ignoreUndefined:!0}),{URL:NA,URLSearchParams:LA}=_E,goe=zse,woe=uoe,{isBrowser:boe,isWebWorker:moe}=pa,Eoe=doe,voe=(r,e,t)=>{if(e===void 0)return r;const n=Date.now(),s=()=>Date.now()-n>=e;return new Promise((i,o)=>{const a=setTimeout(()=>{s()&&(o(new p4),t.abort())},e),c=u=>h=>{if(clearTimeout(a),s()){o(new p4);return}u(h)};r.then(c(i),c(o))})},_oe={throwHttpErrors:!0,credentials:"same-origin"};let bs=class{constructor(e={}){this.opts=kA(_oe,e)}async fetch(e,t={}){const n=kA(this.opts,t),s=new yoe(n.headers);if(typeof e!="string"&&!(e instanceof NA||e instanceof poe))throw new TypeError("`resource` must be a string, URL, or Request");const i=new NA(e.toString(),n.base),{searchParams:o,transformSearchParams:a,json:c}=n;o&&(typeof a=="function"?i.search=a(new LA(n.searchParams)):i.search=new LA(n.searchParams)),c&&(n.body=JSON.stringify(n.json),s.set("content-type","application/json"));const u=new AbortController,l=goe([u.signal,n.signal]);globalThis.ReadableStream!=null&&n.body instanceof globalThis.ReadableStream&&(boe||moe)&&(n.body=new Blob(await Eoe(woe(n.body))));const h=await voe(foe(i.toString(),{...n,signal:l,timeout:void 0,headers:s,duplex:"half"}),n.timeout,u);if(!h.ok&&n.throwHttpErrors)throw n.handleError&&await n.handleError(h),new zN(h);return h.iterator=async function*(){yield*FN(h.body)},h.ndjson=async function*(){for await(const f of Soe(h.iterator()))t.transform?yield t.transform(f):yield f},h}post(e,t={}){return this.fetch(e,{...t,method:"POST"})}get(e,t={}){return this.fetch(e,{...t,method:"GET"})}put(e,t={}){return this.fetch(e,{...t,method:"PUT"})}delete(e,t={}){return this.fetch(e,{...t,method:"DELETE"})}options(e,t={}){return this.fetch(e,{...t,method:"OPTIONS"})}};const Soe=async function*(r){const e=new TextDecoder;let t="";for await(const n of r){t+=e.decode(n,{stream:!0});const s=t.split(/\r?\n/);for(let i=0;i<s.length-1;i++){const o=s[i].trim();o.length>0&&(yield JSON.parse(o))}t=s[s.length-1]}t+=e.decode(),t=t.trim(),t.length!==0&&(yield JSON.parse(t))},FN=r=>{if(Aoe(r))return r;if(Toe(r)){const e=r[Symbol.asyncIterator]();return{[Symbol.asyncIterator](){return{next:e.next.bind(e),return(t){return r.destroy(),typeof e.return=="function"?e.return():Promise.resolve({done:!0,value:t})}}}}}if($oe(r)){const e=r.getReader();return async function*(){try{for(;;){const{done:t,value:n}=await e.read();if(t)return;n&&(yield n)}}finally{e.releaseLock()}}()}throw new TypeError("Body can't be converted to AsyncIterable")},Aoe=r=>typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function",$oe=r=>r&&typeof r.getReader=="function",Toe=r=>Object.prototype.hasOwnProperty.call(r,"readable")&&Object.prototype.hasOwnProperty.call(r,"writable");bs.HTTPError=zN;bs.TimeoutError=p4;bs.streamToAsyncIterator=FN;bs.post=(r,e)=>new bs(e).post(r,e);bs.get=(r,e)=>new bs(e).get(r,e);bs.put=(r,e)=>new bs(e).put(r,e);bs.delete=(r,e)=>new bs(e).delete(r,e);bs.options=(r,e)=>new bs(e).options(r,e);var Ioe=bs;const aa=Et(Ioe),F3=new Vie(1e3),Roe=60*1e3,Coe=Cr.default?Cr.default:Cr,xoe=new Coe({concurrency:4}),MA=r=>{if(r.Path)return r.Path;throw new Error(r.Message)};async function Doe(r,e){return(async(n,s={})=>{const i=new URLSearchParams(s);i.set("arg",n);const o=i.toString();if(!s.nocache&&F3.has(o)){const c=F3.get(o);return MA(c)}const a=await xoe.add(async()=>{const c=await aa.get("https://ipfs.io/api/v0/dns",{searchParams:i}),u=new URL(c.url).search.slice(1),l=await c.json();return F3.set(u,l,Roe),l});return MA(a)})(r,e)}function Poe(r){return r.endsWith(".eth")&&(r=r.replace(/.eth$/,".eth.link")),r}function Ooe(){return Y(async(e,t={recursive:!0})=>{if(typeof e!="string")throw new Error("Invalid arguments, domain must be a string");return e=Poe(e),Doe(e,t)})}function koe({network:r}){return()=>{const e=r.try();return e!=null&&!!e.libp2p.isStarted()}}const VN=Symbol.for("@libp2p/peer-id");function ua(r){return r!=null&&!!r[VN]}function Noe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var Loe=Noe,Moe=Loe;const Uoe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},sb=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Boe=r=>new TextEncoder().encode(r),zoe=r=>new TextDecoder().decode(r);let Foe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Voe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return jN(this,e)}},joe=class{constructor(e){this.decoders=e}or(e){return jN(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const jN=(r,e)=>new joe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Koe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Foe(e,t,n),this.decoder=new Voe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ib=({name:r,prefix:e,encode:t,decode:n})=>new Koe(r,e,t,n),$p=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=Moe(t,e);return ib({prefix:r,name:e,encode:n,decode:i=>sb(s(i))})},qoe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Hoe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Wr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>ib({prefix:e,name:r,encode(s){return Hoe(s,n,t)},decode(s){return qoe(s,n,t,r)}}),Ui=$p({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Goe=$p({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Woe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ui,base58flickr:Goe},Symbol.toStringTag,{value:"Module"})),Qoe=ib({prefix:"\0",name:"identity",encode:r=>zoe(r),decode:r=>Boe(r)}),Yoe=Object.freeze(Object.defineProperty({__proto__:null,identity:Qoe},Symbol.toStringTag,{value:"Module"})),Xoe=Wr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Joe=Object.freeze(Object.defineProperty({__proto__:null,base2:Xoe},Symbol.toStringTag,{value:"Module"})),Zoe=Wr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),eae=Object.freeze(Object.defineProperty({__proto__:null,base8:Zoe},Symbol.toStringTag,{value:"Module"})),tae=$p({prefix:"9",name:"base10",alphabet:"0123456789"}),rae=Object.freeze(Object.defineProperty({__proto__:null,base10:tae},Symbol.toStringTag,{value:"Module"})),nae=Wr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),sae=Wr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),iae=Object.freeze(Object.defineProperty({__proto__:null,base16:nae,base16upper:sae},Symbol.toStringTag,{value:"Module"})),i1=Wr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),oae=Wr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),aae=Wr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),cae=Wr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),lae=Wr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),uae=Wr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hae=Wr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),dae=Wr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fae=Wr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),pae=Object.freeze(Object.defineProperty({__proto__:null,base32:i1,base32hex:lae,base32hexpad:hae,base32hexpadupper:dae,base32hexupper:uae,base32pad:aae,base32padupper:cae,base32upper:oae,base32z:fae},Symbol.toStringTag,{value:"Module"})),yae=$p({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gae=$p({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),wae=Object.freeze(Object.defineProperty({__proto__:null,base36:yae,base36upper:gae},Symbol.toStringTag,{value:"Module"})),bae=Wr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),mae=Wr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Eae=Wr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vae=Wr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),_ae=Object.freeze(Object.defineProperty({__proto__:null,base64:bae,base64pad:mae,base64url:Eae,base64urlpad:vae},Symbol.toStringTag,{value:"Module"})),KN=Array.from(""),Sae=KN.reduce((r,e,t)=>(r[t]=e,r),[]),Aae=KN.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function $ae(r){return r.reduce((e,t)=>(e+=Sae[t],e),"")}function Tae(r){const e=[];for(const t of r){const n=Aae[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const Iae=ib({prefix:"",name:"base256emoji",encode:$ae,decode:Tae}),Rae=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Iae},Symbol.toStringTag,{value:"Module"}));var Cae=qN,UA=128,xae=127,Dae=~xae,Pae=Math.pow(2,31);function qN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Pae;)e[t++]=r&255|UA,r/=128;for(;r&Dae;)e[t++]=r&255|UA,r>>>=7;return e[t]=r|0,qN.bytes=t-n+1,e}var Oae=y4,kae=128,BA=127;function y4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw y4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&BA)<<s:(o&BA)*Math.pow(2,s),s+=7}while(o>=kae);return y4.bytes=i-n,t}var Nae=Math.pow(2,7),Lae=Math.pow(2,14),Mae=Math.pow(2,21),Uae=Math.pow(2,28),Bae=Math.pow(2,35),zae=Math.pow(2,42),Fae=Math.pow(2,49),Vae=Math.pow(2,56),jae=Math.pow(2,63),Kae=function(r){return r<Nae?1:r<Lae?2:r<Mae?3:r<Uae?4:r<Bae?5:r<zae?6:r<Fae?7:r<Vae?8:r<jae?9:10},qae={encode:Cae,decode:Oae,encodingLength:Kae},Sy=qae;const g4=(r,e=0)=>[Sy.decode(r,e),Sy.decode.bytes],Ay=(r,e,t=0)=>(Sy.encode(r,e,t),e),$y=r=>Sy.encodingLength(r),_h=(r,e)=>{const t=e.byteLength,n=$y(r),s=n+$y(t),i=new Uint8Array(s+t);return Ay(r,i,0),Ay(t,i,n),i.set(e,s),new xE(r,t,e,i)},CE=r=>{const e=sb(r),[t,n]=g4(e),[s,i]=g4(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new xE(t,s,o,e)},Hae=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Uoe(r.bytes,t.bytes)}};let xE=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const Gae=({name:r,code:e,encode:t})=>new Wae(r,e,t);let Wae=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?_h(this.code,t):t.then(n=>_h(this.code,n))}else throw Error("Unknown type, must be binary type")}};const Qae=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),DE=Gae({name:"sha2-256",code:18,encode:Qae("SHA-256")}),HN=0,Yae="identity",GN=sb,Xae=r=>_h(HN,GN(r)),Ty={code:HN,name:Yae,encode:GN,digest:Xae};new TextEncoder;new TextDecoder;const zA=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return Zae(t,w4(r),e||Ui.encoder);default:return ece(t,w4(r),e||i1.encoder)}},FA=new WeakMap,w4=r=>{const e=FA.get(r);if(e==null){const t=new Map;return FA.set(r,t),t}return e};let WN=class Dn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==xd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==tce)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Dn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=_h(e,t);return Dn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Dn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&Hae(e.multihash,n.multihash)}toString(e){return zA(this,e)}toJSON(){return{"/":zA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Dn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Dn(n,s,i,o||VA(n,s,i.bytes))}else if(t[rce]===!0){const{version:n,multihash:s,code:i}=t,o=CE(s);return Dn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==xd)throw new Error(`Version 0 CID must use dag-pb (code: ${xd}) block encoding`);return new Dn(e,t,n,n.bytes)}case 1:{const s=VA(e,t,n.bytes);return new Dn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Dn.create(0,xd,e)}static createV1(e,t){return Dn.create(1,e,t)}static decode(e){const[t,n]=Dn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Dn.inspectBytes(e),n=t.size-t.multihashSize,s=sb(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new xE(t.multihashCode,t.digestSize,i,s);return[t.version===0?Dn.createV0(o):Dn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=g4(e.subarray(t));return t+=f,h};let s=n(),i=xd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=Jae(e,t),i=Dn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return w4(i).set(n,e),i}};const Jae=(r,e)=>{switch(r[0]){case"Q":{const t=e||Ui;return[Ui.prefix,t.decode(`${Ui.prefix}${r}`)]}case Ui.prefix:{const t=e||Ui;return[Ui.prefix,t.decode(r)]}case i1.prefix:{const t=e||i1;return[i1.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Zae=(r,e,t)=>{const{prefix:n}=t;if(n!==Ui.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},ece=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},xd=112,tce=18,VA=(r,e,t)=>{const n=$y(r),s=n+$y(e),i=new Uint8Array(s+t.byteLength);return Ay(r,i,0),Ay(e,i,n),i.set(t,s),i},rce=Symbol.for("@ipld/js-cid/CID"),jA={...Yoe,...Joe,...eae,...rae,...iae,...pae,...wae,...Woe,..._ae,...Rae},nce=Symbol.for("nodejs.util.inspect.custom"),sce=Object.values(jA).map(r=>r.decoder).reduce((r,e)=>r.or(e),jA.identity.decoder),QN=114,PE=36,OE=37;var int;let kE=class{constructor(e){N(this,"type");N(this,"multihash");N(this,"privateKey");N(this,"publicKey");N(this,"string");N(this,int,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Ui.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return WN.createV1(QN,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Ie(this.multihash.bytes,e);if(typeof e=="string")return Ae(e).equals(this);if(e?.multihash?.bytes!=null)return Ie(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(int=VN,nce)](){return`PeerId(${this.toString()})`}},Tp=class extends kE{constructor(t){super({...t,type:"RSA"});N(this,"type","RSA");N(this,"publicKey");this.publicKey=t.publicKey}},Ip=class extends kE{constructor(t){super({...t,type:"Ed25519"});N(this,"type","Ed25519");N(this,"publicKey");this.publicKey=t.multihash.digest}},Rp=class extends kE{constructor(t){super({...t,type:"secp256k1"});N(this,"type","secp256k1");N(this,"publicKey");this.publicKey=t.multihash.digest}};function Nr(r){if(r.type==="RSA")return new Tp(r);if(r.type==="Ed25519")return new Ip(r);if(r.type==="secp256k1")return new Rp(r);throw new L("Not a PeerId","ERR_INVALID_PARAMETERS")}function Ae(r,e){if(r.charAt(0)==="1"||r.charAt(0)==="Q"){const t=CE(Ui.decode(`z${r}`));return r.startsWith("12D")?new Ip({multihash:t}):r.startsWith("16U")?new Rp({multihash:t}):new Tp({multihash:t})}return No(sce.decode(r))}function No(r){try{const e=CE(r);if(e.code===Ty.code){if(e.digest.length===PE)return new Ip({multihash:e});if(e.digest.length===OE)return new Rp({multihash:e})}if(e.code===DE.code)return new Tp({multihash:e})}catch{return ice(WN.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function ice(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==QN)throw new Error("Supplied PeerID CID is invalid");const e=r.multihash;if(e.code===DE.code)return new Tp({multihash:r.multihash});if(e.code===Ty.code){if(e.digest.length===PE)return new Ip({multihash:r.multihash});if(e.digest.length===OE)return new Rp({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function vi(r,e){return r.length===PE?new Ip({multihash:_h(Ty.code,r),privateKey:e}):r.length===OE?new Rp({multihash:_h(Ty.code,r),privateKey:e}):new Tp({multihash:await DE.digest(r),publicKey:r,privateKey:e})}function oce({repo:r,codecs:e,bases:t,name:n}){async function s(i,o={}){if(!$N(i))throw new Error("invalid argument "+i);if(TN(i))for await(const b of n.resolve(i,o))i=b;const[,a,c,...u]=i.split("/"),l=o.cidBase?await t.getBase(o.cidBase):void 0,h=ace(c);if(u.length===0){const b=l?l.encoder.encode(h):c;return`/${a}/${b}`}const f=we.decode(h);i=u.join("/");const y=I1(f,i,e,r,o);let d=f,p=i;for await(const b of y)we.asCID(b.value)&&(d=b.value,p=b.remainderPath);return`/ipfs/${d.toString(l&&l.encoder)}${p?"/"+p:""}`}return Y(s)}function ace(r){try{return Ae(r).toBytes()}catch{return we.parse(r).bytes}}async function ks(r){let e;for await(const t of r)e=t;return e}function cce({addAll:r}){return(e,t={})=>{let n;const s=we.asCID(e);return s?n=r([{cid:s,...t}],t):n=r([{path:e.toString(),...t}],t),ks(n)}}function lce(r){return Symbol.iterator in r}function uce(r){return Symbol.asyncIterator in r}function KA(r){return Tl.asCID(r)!=null}async function*Cp(r){if(r==null)throw T(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");const e=Tl.asCID(r);if(e){yield ss({cid:e});return}if(r instanceof String||typeof r=="string"){yield ss({path:r});return}if(r.cid!=null||r.path!=null)return yield ss(r);if(lce(r)){const t=r[Symbol.iterator](),n=t.next();if(n.done)return t;if(KA(n.value)){yield ss({cid:n.value});for(const s of t)yield ss({cid:s});return}if(n.value instanceof String||typeof n.value=="string"){yield ss({path:n.value});for(const s of t)yield ss({path:s});return}if(n.value.cid!=null||n.value.path!=null){yield ss(n.value);for(const s of t)yield ss(s);return}throw T(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}if(uce(r)){const t=r[Symbol.asyncIterator](),n=await t.next();if(n.done)return t;if(KA(n.value)){yield ss({cid:n.value});for await(const s of t)yield ss({cid:s});return}if(n.value instanceof String||typeof n.value=="string"){yield ss({path:n.value});for await(const s of t)yield ss({path:s});return}if(n.value.cid!=null||n.value.path!=null){yield ss(n.value);for await(const s of t)yield ss(s);return}throw T(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}throw T(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}function ss(r){const e=r.cid||`${r.path}`;if(!e)throw T(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");const t={path:e,recursive:r.recursive!==!1};return r.metadata!=null&&(t.metadata=r.metadata),t}const nt={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function hce({repo:r,codecs:e}){async function*t(n,s={}){const i=async function*(){for await(const{path:c,recursive:u,metadata:l}of Cp(n)){const{cid:h}=await rb(r,e,c),{reason:f}=await r.pins.isPinnedWithType(h,[nt.recursive,nt.direct]);if(f==="recursive"&&!u)throw new Error(`${h} already pinned recursively`);u?await r.pins.pinRecursively(h,{metadata:l}):await r.pins.pinDirectly(h,{metadata:l}),yield h}};if(!!!s.lock){yield*i();return}const a=await r.gcLock.readLock();try{yield*i()}finally{a()}}return Y(t)}function Dd(r,e,t){const n={type:r,cid:e};return t&&(n.metadata=t),n}function dce({repo:r,codecs:e}){async function*t(n={}){let s=nt.all;if(n.type&&(s=n.type,!Object.keys(nt).includes(s)))throw T(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(n.paths){let i=!1;for await(const{path:o}of Cp(n.paths)){const{cid:a}=await rb(r,e,o),{reason:c,pinned:u,parent:l,metadata:h}=await r.pins.isPinnedWithType(a,s);if(!u)throw T(new Error(`path '${o}' is not pinned`),"ERR_NOT_PINNED");switch(c){case nt.direct:case nt.recursive:i=!0,yield Dd(c,a,h);break;default:i=!0,yield Dd(`${nt.indirect} through ${l}`,a,h)}}if(!i)throw new Error("No match found");return}if(s===nt.recursive||s===nt.all)for await(const{cid:i,metadata:o}of r.pins.recursiveKeys())yield Dd(nt.recursive,i,o);if(s===nt.indirect||s===nt.all)for await(const i of r.pins.indirectKeys(n))yield Dd(nt.indirect,i);if(s===nt.direct||s===nt.all)for await(const{cid:i,metadata:o}of r.pins.directKeys())yield Dd(nt.direct,i,o)}return Y(t)}function fce({rmAll:r}){async function e(t,n={}){const s=await ks(r([{path:t,...n}],n));if(!s)throw new Error("CID expected");return s}return e}function pce({repo:r,codecs:e}){async function*t(n,s={}){const i=await r.gcLock.readLock();try{for await(const{path:o,recursive:a}of Cp(n)){const{cid:c}=await rb(r,e,o),{pinned:u,reason:l}=await r.pins.isPinnedWithType(c,nt.all);if(!u)throw new Error(`${c} is not pinned`);switch(l){case nt.recursive:if(!a)throw new Error(`${c} is pinned recursively`);await r.pins.unpin(c),yield c;break;case nt.direct:await r.pins.unpin(c),yield c;break;default:throw new Error(`${c} is pinned indirectly under ${l}`)}}}finally{i()}}return Y(t)}class yce{constructor({codecs:e,repo:t}){const n=hce({codecs:e,repo:t});this.addAll=n,this.add=cce({addAll:n});const s=pce({codecs:e,repo:t});this.rmAll=s,this.rm=fce({rmAll:s}),this.ls=dce({codecs:e,repo:t}),this.remote={add:(i,o={})=>Promise.reject(new Error("Not implemented")),ls:async function*(i,o={}){return Promise.reject(new Error("Not implemented"))},rm:(i,o={})=>Promise.reject(new Error("Not implemented")),rmAll:(i,o={})=>Promise.reject(new Error("Not implemented")),service:{add:(i,o)=>Promise.reject(new Error("Not implemented")),rm:(i,o={})=>Promise.reject(new Error("Not implemented")),ls:(i={})=>Promise.reject(new Error("Not implemented"))}}}}function YN(r){return r=r||new Error("Cannot open database"),T(r,"ERR_DB_OPEN_FAILED")}function XN(r){return r=r||new Error("Delete failed"),T(r,"ERR_DB_DELETE_FAILED")}function b4(r){return r=r||new Error("Write failed"),T(r,"ERR_DB_WRITE_FAILED")}function Ro(r){return r=r||new Error("Not Found"),T(r,"ERR_NOT_FOUND")}var JN={exports:{}};(function(r){(function(){r.exports=b;var e=86400,t=3200,n=146097*t/400,s=e*n,i=1e3*s,o=864e13,a=4294967296,c=1e6,u="000000000",l=Math.trunc||function($){var x=$-$%1;return x==0&&($<0||$===0&&1/$!=1/0)?-0:x},h=b.prototype,f=(b.fromDate=function($){return new b(+$)},b.fromInt64BE=v(0,1,2,3,0,4),b.fromInt64LE=v(3,2,1,0,4,0),b.fromString=function(j){var x,k=new b,j=(j+="").replace(/^\s*[+\-]?\d+/,function(Q){var Q=+Q,V=1970+(Q-1970)%400;return k.year=Q-V,V}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(G,Q,V){return Q<0&&(V*=-1),x=6e4*(60*+Q+ +V),""}).replace(/\.\d+$/,function(G){return k.nano=+(G+u).substr(1,9),""}).split(/\D+/);if(1<j.length?j[1]--:j[1]=0,k.time=x=Date.UTC.apply(Date,j)-(x||0),isNaN(x))throw new TypeError("Invalid Date");return w(k)},b.fromTimeT=function($){return E($,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function($){return this.nano+=+$||0,this},h.getNano=function(){var $=w(this);return($.time%1e3*c+ +$.nano+1e9)%1e9},h.getTimeT=function(){var x=w(this),$=Math.floor(x.time/1e3),x=x.year;return x&&($+=x*n*e/t),$},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return S(w(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function($){var x=this,k=x.toDate(),j={H:function(){return g(k.getUTCHours())},L:function(){return _(k.getUTCMilliseconds(),3)},M:function(){return g(k.getUTCMinutes())},N:function(){return _(x.getNano(),9)},S:function(){return g(k.getUTCSeconds())},Y:function(){var G=x.getYear();return 999999<G?"+"+G:9999<G?"+"+_(G,6):0<=G?_(G,4):-999999<=G?"-"+_(-G,6):G},a:function(){return d[k.getUTCDay()]},b:function(){return y[k.getUTCMonth()]},d:function(){return g(k.getUTCDate())},e:function(){return function(G){return(9<G?"":" ")+(0|G)}(k.getUTCDate())},m:function(){return g(k.getUTCMonth()+1)}};return function G(Q){return Q.replace(/%./g,function(V){var W=V[1],ne=p[W],W=j[W];return ne?G(ne):W?W():V})}($||f)},h.writeInt64BE=m(0,1,2,3,0,4),h.writeInt64LE=m(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],p={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return b;function b($,x,k){var j=this;if(!(j instanceof b))return new b($,x,k);j.time=+$||0,j.nano=+x||0,j.year=+k||0,w(j)}function w($){var x,k,j,G=$.year,Q=$.time,V=$.nano,ne=((V<0||c<=V)&&(V-=(k=Math.floor(V/c))*c,Q+=k,k=1),G%t);return(Q<-o||o<Q||ne)&&((x=l(Q/i))&&(G+=x*t,Q-=x*i),(j=S(Q)).setUTCFullYear(ne+j.getUTCFullYear()),j=(Q=+j)+(x=l((G-=ne)/t))*i,x&&-o<=j&&j<=o&&(G-=x*t,Q=j),k=1),k&&($.year=G,$.time=Q,$.nano=V),$}function S($){var x=new Date(0);return x.setTime($),x}function E(G,j){G=+G||0;var k=l((j=(j|0)*a)/s)+l(G/s),j=j%s+G%s,G=l(j/s);return G&&(k+=G,j-=G*s),new b(1e3*j,0,k*t)}function m($,x,k,j,G,Q){return function(ne,W){var Me=w(this);ne=ne||new Array(8),A(ne,W|=0);var yt=Math.floor(Me.time/1e3),Me=Me.year*(n*e/t),ue=l(Me/a)+l(yt/a),Me=Me%a+yt%a,yt=Math.floor(Me/a);return yt&&(ue+=yt,Me-=yt*a),V(ne,W+G,ue),V(ne,W+Q,Me),ne};function V(ne,W,ue){ne[W+$]=ue>>24&255,ne[W+x]=ue>>16&255,ne[W+k]=ue>>8&255,ne[W+j]=255&ue}}function v($,x,k,j,G,Q){return function(ne,W){A(ne,W|=0);var ue=V(ne,W+G);return E(V(ne,W+Q),ue)};function V(ne,W){return 16777216*ne[W+$]+(ne[W+x]<<16|ne[W+k]<<8|ne[W+j])}}function A($,x){if($=$&&$.length,$==null)throw new TypeError("Invalid Buffer");if($<x+8)throw new RangeError("Out of range")}function g($){return(9<$?"":"0")+(0|$)}function _($,x){return(u+(0|$)).substr(-x)}})()})(JN);var gce=JN.exports;const wce=Et(gce);function bce(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var mce=bce,Ece=mce;const ZN=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};let vce=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_ce=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return eL(this,e)}},Sce=class{constructor(e){this.decoders=e}or(e){return eL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const eL=(r,e)=>new Sce({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Ace=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new vce(e,t,n),this.decoder=new _ce(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const tL=({name:r,prefix:e,encode:t,decode:n})=>new Ace(r,e,t,n),rL=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=Ece(t,e);return tL({prefix:r,name:e,encode:n,decode:i=>ZN(s(i))})},$ce=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Tce=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},ob=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>tL({prefix:e,name:r,encode(s){return Tce(s,n,t)},decode(s){return $ce(s,n,t,r)}}),Ice=rL({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});rL({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Rce=nL,qA=128,Cce=127,xce=~Cce,Dce=Math.pow(2,31);function nL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Dce;)e[t++]=r&255|qA,r/=128;for(;r&xce;)e[t++]=r&255|qA,r>>>=7;return e[t]=r|0,nL.bytes=t-n+1,e}var Pce=m4,Oce=128,HA=127;function m4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw m4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&HA)<<s:(o&HA)*Math.pow(2,s),s+=7}while(o>=Oce);return m4.bytes=i-n,t}var kce=Math.pow(2,7),Nce=Math.pow(2,14),Lce=Math.pow(2,21),Mce=Math.pow(2,28),Uce=Math.pow(2,35),Bce=Math.pow(2,42),zce=Math.pow(2,49),Fce=Math.pow(2,56),Vce=Math.pow(2,63),jce=function(r){return r<kce?1:r<Nce?2:r<Lce?3:r<Mce?4:r<Uce?5:r<Bce?6:r<zce?7:r<Fce?8:r<Vce?9:10},Kce={encode:Rce,decode:Pce,encodingLength:jce},sL=Kce;const GA=(r,e,t=0)=>(sL.encode(r,e,t),e),WA=r=>sL.encodingLength(r),E4=(r,e)=>{const t=e.byteLength,n=WA(r),s=n+WA(t),i=new Uint8Array(s+t);return GA(r,i,0),GA(t,i,n),i.set(e,s),new qce(r,t,e,i)};let qce=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const iL=0,Hce="identity",oL=ZN,Gce=r=>E4(iL,oL(r)),Wce={code:iL,name:Hce,encode:oL,digest:Gce},Qce=({name:r,code:e,encode:t})=>new Yce(r,e,t);let Yce=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?E4(this.code,t):t.then(n=>E4(this.code,n))}else throw Error("Unknown type, must be binary type")}};const Xce=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),jc=Qce({name:"sha2-256",code:18,encode:Xce("SHA-256")});var aL=D7();const Jce=Et(aL),cL=Mq({__proto__:null,default:Jce},[aL]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Br=BigInt(0),Ge=BigInt(1),ic=BigInt(2),Zce=BigInt(8),QA=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),Pt=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:QA,n:QA,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")}),lL=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),o1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const ele=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),tle=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),rle=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),nle=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class Ke{constructor(e,t,n,s){this.x=e,this.y=t,this.z=n,this.t=s}static fromAffine(e){if(!(e instanceof Tr))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Tr.ZERO)?Ke.ZERO:new Ke(e.x,e.y,Ge,q(e.x*e.y))}static toAffineBatch(e){const t=ole(e.map(n=>n.z));return e.map((n,s)=>n.toAffine(t[s]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){XA(e);const{x:t,y:n,z:s}=this,{x:i,y:o,z:a}=e,c=q(t*a),u=q(i*s),l=q(n*a),h=q(o*s);return c===u&&l===h}negate(){return new Ke(q(-this.x),this.y,this.z,q(-this.t))}double(){const{x:e,y:t,z:n}=this,{a:s}=Pt,i=q(e*e),o=q(t*t),a=q(ic*q(n*n)),c=q(s*i),u=e+t,l=q(q(u*u)-i-o),h=c+o,f=h-a,y=c-o,d=q(l*f),p=q(h*y),b=q(l*y),w=q(f*h);return new Ke(d,p,w,b)}add(e){XA(e);const{x:t,y:n,z:s,t:i}=this,{x:o,y:a,z:c,t:u}=e,l=q((n-t)*(a+o)),h=q((n+t)*(a-o)),f=q(h-l);if(f===Br)return this.double();const y=q(s*ic*u),d=q(i*ic*c),p=d+y,b=h+l,w=d-y,S=q(p*f),E=q(b*w),m=q(p*w),v=q(f*b);return new Ke(S,E,v,m)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,n=[];let s=this,i=s;for(let o=0;o<t;o++){i=s,n.push(i);for(let a=1;a<2**(e-1);a++)i=i.add(s),n.push(i);s=i.double()}return n}wNAF(e,t){!t&&this.equals(Ke.BASE)&&(t=Tr.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=t&&v4.get(t);s||(s=this.precomputeWindow(n),t&&n!==1&&(s=Ke.normalizeZ(s),v4.set(t,s)));let i=Ke.ZERO,o=Ke.BASE;const a=1+256/n,c=2**(n-1),u=BigInt(2**n-1),l=2**n,h=BigInt(n);for(let f=0;f<a;f++){const y=f*c;let d=Number(e&u);e>>=h,d>c&&(d-=l,e+=Ge);const p=y,b=y+Math.abs(d)-1,w=f%2!==0,S=d<0;d===0?o=o.add(YA(w,s[p])):i=i.add(YA(S,s[b]))}return Ke.normalizeZ([i,o])[0]}multiply(e,t){return this.wNAF(Ry(e,Pt.l),t)}multiplyUnsafe(e){let t=Ry(e,Pt.l,!1);const n=Ke.BASE,s=Ke.ZERO;if(t===Br)return s;if(this.equals(s)||t===Ge)return this;if(this.equals(n))return this.wNAF(t);let i=s,o=this;for(;t>Br;)t&Ge&&(i=i.add(o)),o=o.double(),t>>=Ge;return i}isSmallOrder(){return this.multiplyUnsafe(Pt.h).equals(Ke.ZERO)}isTorsionFree(){let e=this.multiplyUnsafe(Pt.l/ic).double();return Pt.l%ic&&(e=e.add(this)),e.equals(Ke.ZERO)}toAffine(e){const{x:t,y:n,z:s}=this,i=this.equals(Ke.ZERO);e==null&&(e=i?Zce:ab(s));const o=q(t*e),a=q(n*e),c=q(s*e);if(i)return Tr.ZERO;if(c!==Ge)throw new Error("invZ was invalid");return new Tr(o,a)}fromRistrettoBytes(){j3()}toRistrettoBytes(){j3()}fromRistrettoHash(){j3()}}Ke.BASE=new Ke(Pt.Gx,Pt.Gy,Ge,q(Pt.Gx*Pt.Gy));Ke.ZERO=new Ke(Br,Ge,Ge,Br);function YA(r,e){const t=e.negate();return r?t:e}function XA(r){if(!(r instanceof Ke))throw new TypeError("ExtendedPoint expected")}function V3(r){if(!(r instanceof oi))throw new TypeError("RistrettoPoint expected")}function j3(){throw new Error("Legacy method: switch to RistrettoPoint")}class oi{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=Pt,n=q(o1*e*e),s=q((n+Ge)*rle);let i=BigInt(-1);const o=q((i-t*n)*q(n+t));let{isValid:a,value:c}=LE(s,o),u=q(c*e);Fa(u)||(u=q(-u)),a||(c=u),a||(i=n);const l=q(i*(n-Ge)*nle-o),h=c*c,f=q((c+c)*o),y=q(l*ele),d=q(Ge-h),p=q(Ge+h);return new Ke(q(f*p),q(d*y),q(y*p),q(f*d))}static hashToCurve(e){e=Mc(e,64);const t=K3(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),s=K3(e.slice(32,64)),i=this.calcElligatorRistrettoMap(s);return new oi(n.add(i))}static fromHex(e){e=Mc(e,32);const{a:t,d:n}=Pt,s="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=K3(e);if(!cle(R1(i),e)||Fa(i))throw new Error(s);const o=q(i*i),a=q(Ge+t*o),c=q(Ge-t*o),u=q(a*a),l=q(c*c),h=q(t*n*u-l),{isValid:f,value:y}=ZA(q(h*l)),d=q(y*c),p=q(y*d*h);let b=q((i+i)*d);Fa(b)&&(b=q(-b));const w=q(a*p),S=q(b*w);if(!f||Fa(S)||w===Br)throw new Error(s);return new oi(new Ke(b,w,Ge,S))}toRawBytes(){let{x:e,y:t,z:n,t:s}=this.ep;const i=q(q(n+t)*q(n-t)),o=q(e*t),a=q(o*o),{value:c}=ZA(q(i*a)),u=q(c*i),l=q(c*o),h=q(u*l*s);let f;if(Fa(s*h)){let d=q(t*o1),p=q(e*o1);e=d,t=p,f=q(u*tle)}else f=l;Fa(e*h)&&(t=q(-t));let y=q((n-t)*f);return Fa(y)&&(y=q(-y)),R1(y)}toHex(){return xp(this.toRawBytes())}toString(){return this.toHex()}equals(e){V3(e);const t=this.ep,n=e.ep,s=q(t.x*n.y)===q(t.y*n.x),i=q(t.y*n.y)===q(t.x*n.x);return s||i}add(e){return V3(e),new oi(this.ep.add(e.ep))}subtract(e){return V3(e),new oi(this.ep.subtract(e.ep))}multiply(e){return new oi(this.ep.multiply(e))}multiplyUnsafe(e){return new oi(this.ep.multiplyUnsafe(e))}}oi.BASE=new oi(Ke.BASE);oi.ZERO=new oi(Ke.ZERO);const v4=new WeakMap;let Tr=class _4{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,v4.delete(this)}static fromHex(e,t=!0){const{d:n,P:s}=Pt;e=Mc(e,32);const i=e.slice();i[31]=e[31]&-129;const o=Dp(i);if(t&&o>=s)throw new Error("Expected 0 < hex < P");if(!t&&o>=lL)throw new Error("Expected 0 < hex < 2**256");const a=q(o*o),c=q(a-Ge),u=q(n*a+Ge);let{isValid:l,value:h}=LE(c,u);if(!l)throw new Error("Point.fromHex: invalid y coordinate");const f=(h&Ge)===Ge;return(e[31]&128)!==0!==f&&(h=q(-h)),new _4(h,o)}static async fromPrivateKey(e){return(await cb(e)).point}toRawBytes(){const e=R1(this.y);return e[31]|=this.x&Ge?128:0,e}toHex(){return xp(this.toRawBytes())}toX25519(){const{y:e}=this,t=q((Ge+e)*ab(Ge-e));return R1(t)}isTorsionFree(){return Ke.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new _4(q(-this.x),this.y)}add(e){return Ke.fromAffine(this).add(Ke.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Ke.fromAffine(this).multiply(e,this).toAffine()}};Tr.BASE=new Tr(Pt.Gx,Pt.Gy);Tr.ZERO=new Tr(Br,Ge);let S4=class uL{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=Mc(e,64),n=Tr.fromHex(t.slice(0,32),!1),s=Dp(t.slice(32,64));return new uL(n,s)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof Tr))throw new Error("Expected Point instance");return Ry(t,Pt.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(R1(this.s),32),e}toHex(){return xp(this.toRawBytes())}};function JA(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(r.length===1)return r[0];const e=r.reduce((n,s)=>n+s.length,0),t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}const sle=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function xp(r){if(!(r instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=sle[r[t]];return e}function NE(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){const n=t*2,s=r.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[t]=i}return e}function hL(r){const t=r.toString(16).padStart(64,"0");return NE(t)}function R1(r){return hL(r).reverse()}function Fa(r){return(q(r)&Ge)===Ge}function Dp(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+xp(Uint8Array.from(r).reverse()))}const ile=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function K3(r){return q(Dp(r)&ile)}function q(r,e=Pt.P){const t=r%e;return t>=Br?t:e+t}function ab(r,e=Pt.P){if(r===Br||e<=Br)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=q(r,e),n=e,s=Br,i=Ge;for(;t!==Br;){const a=n/t,c=n%t,u=s-i*a;n=t,t=c,s=i,i=u}if(n!==Ge)throw new Error("invert: does not exist");return q(s,e)}function ole(r,e=Pt.P){const t=new Array(r.length),n=r.reduce((i,o,a)=>o===Br?i:(t[a]=i,q(i*o,e)),Ge),s=ab(n,e);return r.reduceRight((i,o,a)=>o===Br?i:(t[a]=q(i*t[a],e),q(i*o,e)),s),t}function so(r,e){const{P:t}=Pt;let n=r;for(;e-- >Br;)n*=n,n%=t;return n}function ale(r){const{P:e}=Pt,t=BigInt(5),n=BigInt(10),s=BigInt(20),i=BigInt(40),o=BigInt(80),c=r*r%e*r%e,u=so(c,ic)*c%e,l=so(u,Ge)*r%e,h=so(l,t)*l%e,f=so(h,n)*h%e,y=so(f,s)*f%e,d=so(y,i)*y%e,p=so(d,o)*d%e,b=so(p,o)*d%e,w=so(b,n)*h%e;return{pow_p_5_8:so(w,ic)*r%e,b2:c}}function LE(r,e){const t=q(e*e*e),n=q(t*t*e),s=ale(r*n).pow_p_5_8;let i=q(r*t*s);const o=q(e*i*i),a=i,c=q(i*o1),u=o===r,l=o===q(-r),h=o===q(-r*o1);return u&&(i=a),(l||h)&&(i=c),Fa(i)&&(i=q(-i)),{isValid:u||l,value:i}}function ZA(r){return LE(Ge,r)}function Iy(r){return q(Dp(r),Pt.l)}function cle(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Mc(r,e){const t=r instanceof Uint8Array?Uint8Array.from(r):NE(r);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Ry(r,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof r=="number"&&Number.isSafeInteger(r)&&(r=BigInt(r)),typeof r=="bigint"&&r<e){if(t){if(Br<r)return r}else if(Br<=r)return r}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function lle(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function ule(r){if(r=typeof r=="bigint"||typeof r=="number"?hL(Ry(r,lL)):Mc(r),r.length!==32)throw new Error("Expected 32 bytes");return r}function hle(r){const e=lle(r.slice(0,32)),t=r.slice(32,64),n=Iy(e),s=Tr.BASE.multiply(n),i=s.toRawBytes();return{head:e,prefix:t,scalar:n,point:s,pointBytes:i}}let q3;async function cb(r){return hle(await zl.sha512(ule(r)))}async function dL(r){return(await cb(r)).pointBytes}async function dle(r,e){r=Mc(r);const{prefix:t,scalar:n,pointBytes:s}=await cb(e),i=Iy(await zl.sha512(t,r)),o=Tr.BASE.multiply(i),a=Iy(await zl.sha512(o.toRawBytes(),s,r)),c=q(i+a*n,Pt.l);return new S4(o,c).toRawBytes()}function fle(r,e,t){e=Mc(e),t instanceof Tr||(t=Tr.fromHex(t,!1));const{r:n,s}=r instanceof S4?r.assertValidity():S4.fromHex(r),i=Ke.BASE.multiplyUnsafe(s);return{r:n,s,SB:i,pub:t,msg:e}}function ple(r,e,t,n){const s=Iy(n),i=Ke.fromAffine(r).multiplyUnsafe(s);return Ke.fromAffine(e).add(i).subtract(t).multiplyUnsafe(Pt.h).equals(Ke.ZERO)}async function yle(r,e,t){const{r:n,SB:s,msg:i,pub:o}=fle(r,e,t),a=await zl.sha512(n.toRawBytes(),o.toRawBytes(),i);return ple(o,n,s,a)}Tr.BASE._setWindowSize(8);const Oa={node:cL,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},zl={bytesToHex:xp,hexToBytes:NE,concatBytes:JA,getExtendedPublicKey:cb,mod:q,invert:ab,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:r=>{if(r=Mc(r),r.length<40||r.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return q(Dp(r),Pt.l-Ge)+Ge},randomBytes:(r=32)=>{if(Oa.web)return Oa.web.getRandomValues(new Uint8Array(r));if(Oa.node){const{randomBytes:e}=Oa.node;return new Uint8Array(e(r).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>zl.randomBytes(32),sha512:async(...r)=>{const e=JA(...r);if(Oa.web){const t=await Oa.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}else{if(Oa.node)return Uint8Array.from(Oa.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(r=8,e=Tr.BASE){const t=e.equals(Tr.BASE)?e:new Tr(e.x,e.y);return t._setWindowSize(r),t.multiply(ic),t},sha512Sync:void 0};Object.defineProperties(zl,{sha512Sync:{configurable:!1,get(){return q3},set(r){q3||(q3=r)}}});const C1=32,Wa=64,Cy=32;async function gle(){const r=zl.randomPrivateKey(),e=await dL(r);return{privateKey:fL(r,e),publicKey:e}}async function wle(r){if(r.length!==Cy)throw new TypeError('"seed" must be 32 bytes in length.');if(!(r instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=r,t=await dL(e);return{privateKey:fL(e,t),publicKey:t}}async function ble(r,e){const t=r.subarray(0,Cy);return dle(e,t)}async function mle(r,e,t){return yle(e,t,r)}function fL(r,e){const t=new Uint8Array(Wa);for(let n=0;n<Cy;n++)t[n]=r[n],t[Cy+n]=e[n];return t}const pL=ob({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});ob({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});ob({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});ob({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const Co={get(r=globalThis){const e=r.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},H3={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function yL(r){const e=r?.algorithm??"AES-GCM";let t=r?.keyLength??16;const n=r?.nonceLength??12,s=r?.digest??"SHA-256",i=r?.saltLength??16,o=r?.iterations??32767,a=Co.get();t*=8;async function c(h,f){const y=a.getRandomValues(new Uint8Array(i)),d=a.getRandomValues(new Uint8Array(n)),p={name:e,iv:d};typeof f=="string"&&(f=M(f));let b;if(f.length===0){b=await a.subtle.importKey("jwk",H3,{name:"AES-GCM"},!0,["encrypt"]);try{const S={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);b=await a.subtle.deriveKey(S,E,{name:e,length:t},!0,["encrypt"])}catch{b=await a.subtle.importKey("jwk",H3,{name:"AES-GCM"},!0,["encrypt"])}}else{const S={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);b=await a.subtle.deriveKey(S,E,{name:e,length:t},!0,["encrypt"])}const w=await a.subtle.encrypt(p,b,h);return z([y,p.iv,new Uint8Array(w)])}async function u(h,f){const y=h.subarray(0,i),d=h.subarray(i,i+n),p=h.subarray(i+n),b={name:e,iv:d};typeof f=="string"&&(f=M(f));let w;if(f.length===0)try{const E={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},m=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(E,m,{name:e,length:t},!0,["decrypt"])}catch{w=await a.subtle.importKey("jwk",H3,{name:"AES-GCM"},!0,["decrypt"])}else{const E={name:"PBKDF2",salt:y,iterations:o,hash:{name:s}},m=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(E,m,{name:e,length:t},!0,["decrypt"])}const S=await a.subtle.decrypt(b,w,p);return new Uint8Array(S)}return{encrypt:c,decrypt:u}}async function ME(r,e){const n=await yL().encrypt(r,e);return pL.encode(n)}var Ar;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.Secp256k1="Secp256k1"})(Ar||(Ar={}));var A4;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.Secp256k1=2]="Secp256k1"})(A4||(A4={}));(function(r){r.codec=()=>Pm(A4)})(Ar||(Ar={}));var Sh;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ar.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.Type=Ar.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(Sh||(Sh={}));var Ah;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ar.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.Type=Ar.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(Ah||(Ah={}));class UE{constructor(e){N(this,"_key");this._key=$h(e,C1)}async verify(e,t){return mle(this._key,t,e)}marshal(){return this._key}get bytes(){return Sh.encode({Type:Ar.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ie(this.bytes,e.bytes)}async hash(){const{bytes:e}=await jc.digest(this.bytes);return e}}class x1{constructor(e,t){N(this,"_key");N(this,"_publicKey");this._key=$h(e,Wa),this._publicKey=$h(t,C1)}async sign(e){return ble(this._key,e)}get public(){return new UE(this._publicKey)}marshal(){return this._key}get bytes(){return Ah.encode({Type:Ar.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ie(this.bytes,e.bytes)}async hash(){const{bytes:e}=await jc.digest(this.bytes);return e}async id(){const e=Wce.digest(this.public.bytes);return Ice.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return ME(this.bytes,e);throw new L(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Ele(r){if(r.length>Wa){r=$h(r,Wa+C1);const n=r.subarray(0,Wa),s=r.subarray(Wa,r.length);return new x1(n,s)}r=$h(r,Wa);const e=r.subarray(0,Wa),t=r.subarray(C1);return new x1(e,t)}function vle(r){return r=$h(r,C1),new UE(r)}async function _le(){const{privateKey:r,publicKey:e}=await gle();return new x1(r,e)}async function Sle(r){const{privateKey:e,publicKey:t}=await wle(r);return new x1(e,t)}function $h(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new L(`Key must be a Uint8Array of length ${e}, got ${r.length}`,"ERR_INVALID_KEY_TYPE");return r}const Ale=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey:x1,Ed25519PublicKey:UE,generateKeyPair:_le,generateKeyPairFromSeed:Sle,unmarshalEd25519PrivateKey:Ele,unmarshalEd25519PublicKey:vle},Symbol.toStringTag,{value:"Module"}));function ho(r,e){let t=Uint8Array.from(r.abs().toByteArray());if(t=t[0]===0?t.subarray(1):t,e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=z([new Uint8Array(e-t.length),t])}return R(t,"base64url")}function Oi(r){const e=$le(r);return new At.jsbn.BigInteger(R(e,"base16"),16)}function $le(r,e){let t=M(r,"base64urlpad");if(e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=z([new Uint8Array(e-t.length),t])}return t}const Tle={"P-256":256,"P-384":384,"P-521":521},Ile=Object.keys(Tle);Ile.join(" / ");async function Rle(r,e){const t=pL.decode(r);return yL().decrypt(t,e)}/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const qe=BigInt(0),zt=BigInt(1),fc=BigInt(2),a1=BigInt(3),e$=BigInt(8),ir=Object.freeze({a:qe,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:zt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),t$=(r,e)=>(r+e/fc)/e,b0={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(r){const{n:e}=ir,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-zt*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=t$(i*r,e),c=t$(-n*r,e);let u=ie(r-a*t-c*s,e),l=ie(-a*n-c*i,e);const h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+r);return{k1neg:h,k1:u,k2neg:f,k2:l}}},Xi=32,Th=32,Cle=32,r$=Xi+1,n$=2*Xi+1;function s$(r){const{a:e,b:t}=ir,n=ie(r*r),s=ie(n*r);return ie(s+e*r+t)}const m0=ir.a===qe;class gL extends Error{constructor(e){super(e)}}function i$(r){if(!(r instanceof rt))throw new TypeError("JacobianPoint expected")}class rt{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof mt))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(mt.ZERO)?rt.ZERO:new rt(e.x,e.y,zt)}static toAffineBatch(e){const t=kle(e.map(n=>n.z));return e.map((n,s)=>n.toAffine(t[s]))}static normalizeZ(e){return rt.toAffineBatch(e).map(rt.fromAffine)}equals(e){i$(e);const{x:t,y:n,z:s}=this,{x:i,y:o,z:a}=e,c=ie(s*s),u=ie(a*a),l=ie(t*u),h=ie(i*c),f=ie(ie(n*a)*u),y=ie(ie(o*s)*c);return l===h&&f===y}negate(){return new rt(this.x,ie(-this.y),this.z)}double(){const{x:e,y:t,z:n}=this,s=ie(e*e),i=ie(t*t),o=ie(i*i),a=e+i,c=ie(fc*(ie(a*a)-s-o)),u=ie(a1*s),l=ie(u*u),h=ie(l-fc*c),f=ie(u*(c-h)-e$*o),y=ie(fc*t*n);return new rt(h,f,y)}add(e){i$(e);const{x:t,y:n,z:s}=this,{x:i,y:o,z:a}=e;if(i===qe||o===qe)return this;if(t===qe||n===qe)return e;const c=ie(s*s),u=ie(a*a),l=ie(t*u),h=ie(i*c),f=ie(ie(n*a)*u),y=ie(ie(o*s)*c),d=ie(h-l),p=ie(y-f);if(d===qe)return p===qe?this.double():rt.ZERO;const b=ie(d*d),w=ie(d*b),S=ie(l*b),E=ie(p*p-w-fc*S),m=ie(p*(S-E)-f*w),v=ie(s*a*d);return new rt(E,m,v)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){const t=rt.ZERO;if(typeof e=="bigint"&&e===qe)return t;let n=c$(e);if(n===zt)return this;if(!m0){let h=t,f=this;for(;n>qe;)n&zt&&(h=h.add(f)),f=f.double(),n>>=zt;return h}let{k1neg:s,k1:i,k2neg:o,k2:a}=b0.splitScalar(n),c=t,u=t,l=this;for(;i>qe||a>qe;)i&zt&&(c=c.add(l)),a&zt&&(u=u.add(l)),l=l.double(),i>>=zt,a>>=zt;return s&&(c=c.negate()),o&&(u=u.negate()),u=new rt(ie(u.x*b0.beta),u.y,u.z),c.add(u)}precomputeWindow(e){const t=m0?128/e+1:256/e+1,n=[];let s=this,i=s;for(let o=0;o<t;o++){i=s,n.push(i);for(let a=1;a<2**(e-1);a++)i=i.add(s),n.push(i);s=i.double()}return n}wNAF(e,t){!t&&this.equals(rt.BASE)&&(t=mt.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=t&&$4.get(t);s||(s=this.precomputeWindow(n),t&&n!==1&&(s=rt.normalizeZ(s),$4.set(t,s)));let i=rt.ZERO,o=rt.BASE;const a=1+(m0?128/n:256/n),c=2**(n-1),u=BigInt(2**n-1),l=2**n,h=BigInt(n);for(let f=0;f<a;f++){const y=f*c;let d=Number(e&u);e>>=h,d>c&&(d-=l,e+=zt);const p=y,b=y+Math.abs(d)-1,w=f%2!==0,S=d<0;d===0?o=o.add(E0(w,s[p])):i=i.add(E0(S,s[b]))}return{p:i,f:o}}multiply(e,t){let n=c$(e),s,i;if(m0){const{k1neg:o,k1:a,k2neg:c,k2:u}=b0.splitScalar(n);let{p:l,f:h}=this.wNAF(a,t),{p:f,f:y}=this.wNAF(u,t);l=E0(o,l),f=E0(c,f),f=new rt(ie(f.x*b0.beta),f.y,f.z),s=l.add(f),i=h.add(y)}else{const{p:o,f:a}=this.wNAF(n,t);s=o,i=a}return rt.normalizeZ([s,i])[0]}toAffine(e){const{x:t,y:n,z:s}=this,i=this.equals(rt.ZERO);e==null&&(e=i?e$:sd(s));const o=e,a=ie(o*o),c=ie(a*o),u=ie(t*a),l=ie(n*c),h=ie(s*o);if(i)return mt.ZERO;if(h!==zt)throw new Error("invZ was invalid");return new mt(u,l)}}rt.BASE=new rt(ir.Gx,ir.Gy,zt);rt.ZERO=new rt(qe,zt,qe);function E0(r,e){const t=e.negate();return r?t:e}const $4=new WeakMap;class mt{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,$4.delete(this)}hasEvenY(){return this.y%fc===qe}static fromCompressedHex(e){const t=e.length===32,n=Ac(t?e:e.subarray(1));if(!G3(n))throw new Error("Point is not on curve");const s=s$(n);let i=Ole(s);const o=(i&zt)===zt;t?o&&(i=ie(-i)):(e[0]&1)===1!==o&&(i=ie(-i));const a=new mt(n,i);return a.assertValidity(),a}static fromUncompressedHex(e){const t=Ac(e.subarray(1,Xi+1)),n=Ac(e.subarray(Xi+1,Xi*2+1)),s=new mt(t,n);return s.assertValidity(),s}static fromHex(e){const t=Rh(e),n=t.length,s=t[0];if(n===Xi)return this.fromCompressedHex(t);if(n===r$&&(s===2||s===3))return this.fromCompressedHex(t);if(n===n$&&s===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${r$} compressed bytes or ${n$} uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return mt.BASE.multiply(Dy(e))}static fromSignature(e,t,n){const{r:s,s:i}=wL(t);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");const o=BE(Rh(e)),{n:a}=ir,c=n===2||n===3?s+a:s,u=sd(c,a),l=ie(-o*u,a),h=ie(i*u,a),f=n&1?"03":"02",y=mt.fromHex(f+oh(c)),d=mt.BASE.multiplyAndAddUnsafe(y,l,h);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(e=!1){return Il(this.toHex(e))}toHex(e=!1){const t=oh(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${oh(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{x:t,y:n}=this;if(!G3(t)||!G3(n))throw new Error(e);const s=ie(n*n),i=s$(t);if(ie(s-i)!==qe)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new mt(this.x,ie(-this.y))}double(){return rt.fromAffine(this).double().toAffine()}add(e){return rt.fromAffine(this).add(rt.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return rt.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){const s=rt.fromAffine(this),i=t===qe||t===zt||this!==mt.BASE?s.multiplyUnsafe(t):s.multiply(t),o=rt.fromAffine(e).multiplyUnsafe(n),a=i.add(o);return a.equals(rt.ZERO)?void 0:a.toAffine()}}mt.BASE=new mt(ir.Gx,ir.Gy);mt.ZERO=new mt(qe,qe);function o$(r){return Number.parseInt(r[0],16)>=8?"00"+r:r}function a$(r){if(r.length<2||r[0]!==2)throw new Error(`Invalid signature integer tag: ${Ih(r)}`);const e=r[1],t=r.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:Ac(t),left:r.subarray(e+2)}}function xle(r){if(r.length<2||r[0]!=48)throw new Error(`Invalid signature tag: ${Ih(r)}`);if(r[1]!==r.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:t}=a$(r.subarray(2)),{data:n,left:s}=a$(t);if(s.length)throw new Error(`Invalid signature: left bytes after parsing: ${Ih(s)}`);return{r:e,s:n}}class Sc{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){const t=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);const s=t?Ih(e):e;if(s.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Sc(xy(s.slice(0,64)),xy(s.slice(64,128)))}static fromDER(e){const t=e instanceof Uint8Array;if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:n,s}=xle(t?e:Il(e));return new Sc(n,s)}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!D1(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!D1(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const e=ir.n>>zt;return this.s>e}normalizeS(){return this.hasHighS()?new Sc(this.r,ie(-this.s,ir.n)):this}toDERRawBytes(){return Il(this.toDERHex())}toDERHex(){const e=o$(Pd(this.s)),t=o$(Pd(this.r)),n=e.length/2,s=t.length/2,i=Pd(n),o=Pd(s);return`30${Pd(s+n+4)}02${o}${t}02${i}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return Il(this.toCompactHex())}toCompactHex(){return oh(this.r)+oh(this.s)}}function oc(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];const e=r.reduce((n,s)=>n+s.length,0),t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}const Dle=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Ih(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=Dle[r[t]];return e}const Ple=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function oh(r){if(typeof r!="bigint")throw new Error("Expected bigint");if(!(qe<=r&&r<Ple))throw new Error("Expected number 0 <= n < 2^256");return r.toString(16).padStart(64,"0")}function T4(r){const e=Il(oh(r));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function Pd(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function xy(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function Il(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+r.length);const e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){const n=t*2,s=r.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[t]=i}return e}function Ac(r){return xy(Ih(r))}function Rh(r){return r instanceof Uint8Array?Uint8Array.from(r):Il(r)}function c$(r){if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)return BigInt(r);if(typeof r=="bigint"&&D1(r))return r;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function ie(r,e=ir.P){const t=r%e;return t>=qe?t:e+t}function Bs(r,e){const{P:t}=ir;let n=r;for(;e-- >qe;)n*=n,n%=t;return n}function Ole(r){const{P:e}=ir,t=BigInt(6),n=BigInt(11),s=BigInt(22),i=BigInt(23),o=BigInt(44),a=BigInt(88),c=r*r*r%e,u=c*c*r%e,l=Bs(u,a1)*u%e,h=Bs(l,a1)*u%e,f=Bs(h,fc)*c%e,y=Bs(f,n)*f%e,d=Bs(y,s)*y%e,p=Bs(d,o)*d%e,b=Bs(p,a)*p%e,w=Bs(b,o)*d%e,S=Bs(w,a1)*u%e,E=Bs(S,i)*y%e,m=Bs(E,t)*c%e,v=Bs(m,fc);if(v*v%e!==r)throw new Error("Cannot find square root");return v}function sd(r,e=ir.P){if(r===qe||e<=qe)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=ie(r,e),n=e,s=qe,i=zt;for(;t!==qe;){const a=n/t,c=n%t,u=s-i*a;n=t,t=c,s=i,i=u}if(n!==zt)throw new Error("invert: does not exist");return ie(s,e)}function kle(r,e=ir.P){const t=new Array(r.length),n=r.reduce((i,o,a)=>o===qe?i:(t[a]=i,ie(i*o,e)),zt),s=sd(n,e);return r.reduceRight((i,o,a)=>o===qe?i:(t[a]=ie(i*t[a],e),ie(i*o,e)),s),t}function Nle(r){const e=r.length*8-Th*8,t=Ac(r);return e>0?t>>BigInt(e):t}function BE(r,e=!1){const t=Nle(r);if(e)return t;const{n}=ir;return t>=n?t-n:t}let ah,c1;class Lle{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return ca.hmacSha256(this.k,...e)}hmacSync(...e){return c1(this.k,...e)}checkSync(){if(typeof c1!="function")throw new gL("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0;const t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);const n=this.v.slice();t.push(n),e+=this.v.length}return oc(...t)}generateSync(){this.checkSync(),this.incr();let e=0;const t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);const n=this.v.slice();t.push(n),e+=this.v.length}return oc(...t)}}function D1(r){return qe<r&&r<ir.n}function G3(r){return qe<r&&r<ir.P}function Mle(r,e,t,n=!0){const{n:s}=ir,i=BE(r,!0);if(!D1(i))return;const o=sd(i,s),a=mt.BASE.multiply(i),c=ie(a.x,s);if(c===qe)return;const u=ie(o*ie(e+t*c,s),s);if(u===qe)return;let l=new Sc(c,u),h=(a.x===l.r?0:2)|Number(a.y&zt);return n&&l.hasHighS()&&(l=l.normalizeS(),h^=1),{sig:l,recovery:h}}function Dy(r){let e;if(typeof r=="bigint")e=r;else if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)e=BigInt(r);else if(typeof r=="string"){if(r.length!==2*Th)throw new Error("Expected 32 bytes of private key");e=xy(r)}else if(r instanceof Uint8Array){if(r.length!==Th)throw new Error("Expected 32 bytes of private key");e=Ac(r)}else throw new TypeError("Expected valid private key");if(!D1(e))throw new Error("Expected private key: 0 < key < n");return e}function Ule(r){return r instanceof mt?(r.assertValidity(),r):mt.fromHex(r)}function wL(r){if(r instanceof Sc)return r.assertValidity(),r;try{return Sc.fromDER(r)}catch{return Sc.fromCompact(r)}}function bL(r,e=!1){return mt.fromPrivateKey(r).toRawBytes(e)}function mL(r){const e=r.length>Xi?r.slice(0,Xi):r;return Ac(e)}function Ble(r){const e=mL(r),t=ie(e,ir.n);return EL(t<qe?e:t)}function EL(r){return T4(r)}function zle(r,e,t){if(r==null)throw new Error(`sign: expected valid message hash, not "${r}"`);const n=Rh(r),s=Dy(e),i=[EL(s),Ble(n)];if(t!=null){t===!0&&(t=ca.randomBytes(Xi));const c=Rh(t);if(c.length!==Xi)throw new Error(`sign: Expected ${Xi} bytes of extra data`);i.push(c)}const o=oc(...i),a=mL(n);return{seed:o,m:a,d:s}}function Fle(r,e){const{sig:t,recovery:n}=r,{der:s,recovered:i}=Object.assign({canonical:!0,der:!0},e),o=s?t.toDERRawBytes():t.toCompactRawBytes();return i?[o,n]:o}async function Vle(r,e,t={}){const{seed:n,m:s,d:i}=zle(r,e,t.extraEntropy),o=new Lle(Cle,Th);await o.reseed(n);let a;for(;!(a=Mle(await o.generate(),s,i,t.canonical));)await o.reseed();return Fle(a,t)}const jle={strict:!0};function Kle(r,e,t,n=jle){let s;try{s=wL(r),e=Rh(e)}catch{return!1}const{r:i,s:o}=s;if(n.strict&&s.hasHighS())return!1;const a=BE(e);let c;try{c=Ule(t)}catch{return!1}const{n:u}=ir,l=sd(o,u),h=ie(a*l,u),f=ie(i*l,u),y=mt.BASE.multiplyAndAddUnsafe(c,h,f);return y?ie(y.x,u)===i:!1}mt.BASE._setWindowSize(8);const vs={node:cL,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},v0={},ca={bytesToHex:Ih,hexToBytes:Il,concatBytes:oc,mod:ie,invert:sd,isValidPrivateKey(r){try{return Dy(r),!0}catch{return!1}},_bigintTo32Bytes:T4,_normalizePrivateKey:Dy,hashToPrivateKey:r=>{r=Rh(r);const e=Th+8;if(r.length<e||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const t=ie(Ac(r),ir.n-zt)+zt;return T4(t)},randomBytes:(r=32)=>{if(vs.web)return vs.web.getRandomValues(new Uint8Array(r));if(vs.node){const{randomBytes:e}=vs.node;return Uint8Array.from(e(r))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>ca.hashToPrivateKey(ca.randomBytes(Th+8)),precompute(r=8,e=mt.BASE){const t=e===mt.BASE?e:new mt(e.x,e.y);return t._setWindowSize(r),t.multiply(a1),t},sha256:async(...r)=>{if(vs.web){const e=await vs.web.subtle.digest("SHA-256",oc(...r));return new Uint8Array(e)}else if(vs.node){const{createHash:e}=vs.node,t=e("sha256");return r.forEach(n=>t.update(n)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(r,...e)=>{if(vs.web){const t=await vs.web.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=oc(...e),s=await vs.web.subtle.sign("HMAC",t,n);return new Uint8Array(s)}else if(vs.node){const{createHmac:t}=vs.node,n=t("sha256",r);return e.forEach(s=>n.update(s)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(r,...e)=>{let t=v0[r];if(t===void 0){const n=await ca.sha256(Uint8Array.from(r,s=>s.charCodeAt(0)));t=oc(n,n),v0[r]=t}return ca.sha256(t,...e)},taggedHashSync:(r,...e)=>{if(typeof ah!="function")throw new gL("sha256Sync is undefined, you need to set it");let t=v0[r];if(t===void 0){const n=ah(Uint8Array.from(r,s=>s.charCodeAt(0)));t=oc(n,n),v0[r]=t}return ah(t,...e)},_JacobianPoint:rt};Object.defineProperties(ca,{sha256Sync:{configurable:!1,get(){return ah},set(r){ah||(ah=r)}},hmacSha256Sync:{configurable:!1,get(){return c1},set(r){c1||(c1=r)}}});function Pp(r){if(isNaN(r)||r<=0)throw new L("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return ca.randomBytes(r)}function vL(r,e){return e.map(t=>Oi(r[t]))}function qle(r){return At.pki.setRsaPrivateKey(...vL(r,["n","e","d","p","q","dp","dq","qi"]))}function Hle(r){return At.pki.setRsaPublicKey(...vL(r,["n","e"]))}function Gle(r){const e=At.asn1.fromDer(R(r,"ascii")),t=At.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:ho(t.n),e:ho(t.e),d:ho(t.d),p:ho(t.p),q:ho(t.q),dp:ho(t.dP),dq:ho(t.dQ),qi:ho(t.qInv),alg:"RS256"}}function Wle(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new L("JWK was missing components","ERR_INVALID_PARAMETERS");const e=At.pki.privateKeyToAsn1({n:Oi(r.n),e:Oi(r.e),d:Oi(r.d),p:Oi(r.p),q:Oi(r.q),dP:Oi(r.dp),dQ:Oi(r.dq),qInv:Oi(r.qi)});return M(At.asn1.toDer(e).getBytes(),"ascii")}function Qle(r){const e=At.asn1.fromDer(R(r,"ascii")),t=At.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:ho(t.n),e:ho(t.e)}}function Yle(r){if(r.n==null||r.e==null)throw new L("JWK was missing components","ERR_INVALID_PARAMETERS");const e=At.pki.publicKeyToAsn1({n:Oi(r.n),e:Oi(r.e)});return M(At.asn1.toDer(e).getBytes(),"ascii")}async function Xle(r){const e=await Co.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await SL(e);return{privateKey:t[0],publicKey:t[1]}}async function _L(r){const t=[await Co.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await eue(r)],n=await SL({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function Jle(r,e){const t=await Co.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Co.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function Zle(r,e,t){const n=await Co.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Co.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t)}async function SL(r){if(r.privateKey==null||r.publicKey==null)throw new L("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Co.get().subtle.exportKey("jwk",r.privateKey),Co.get().subtle.exportKey("jwk",r.publicKey)])}async function eue(r){return Co.get().subtle.importKey("jwk",{kty:r.kty,n:r.n,e:r.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function AL(r,e,t,n){const s=e?Hle(r):qle(r),i=R(Uint8Array.from(t),"ascii"),o=n(i,s);return M(o,"ascii")}function tue(r,e){return AL(r,!0,e,(t,n)=>n.encrypt(t))}function rue(r,e){return AL(r,!1,e,(t,n)=>n.decrypt(t))}class zE{constructor(e){N(this,"_key");this._key=e}async verify(e,t){return Zle(this._key,t,e)}marshal(){return Yle(this._key)}get bytes(){return Sh.encode({Type:Ar.RSA,Data:this.marshal()}).subarray()}encrypt(e){return tue(this._key,e)}equals(e){return Ie(this.bytes,e.bytes)}async hash(){const{bytes:e}=await jc.digest(this.bytes);return e}}class lb{constructor(e,t){N(this,"_key");N(this,"_publicKey");this._key=e,this._publicKey=t}genSecret(){return Pp(16)}async sign(e){return Jle(this._key,e)}get public(){if(this._publicKey==null)throw new L("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new zE(this._publicKey)}decrypt(e){return rue(this._key,e)}marshal(){return Wle(this._key)}get bytes(){return Ah.encode({Type:Ar.RSA,Data:this.marshal()}).subarray()}equals(e){return Ie(this.bytes,e.bytes)}async hash(){const{bytes:e}=await jc.digest(this.bytes);return e}async id(){const e=await this.public.hash();return R(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8"){const n=new At.util.ByteBuffer(this.marshal()),s=At.asn1.fromDer(n),i=At.pki.privateKeyFromAsn1(s),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return At.pki.encryptRsaPrivateKey(i,e,o)}else{if(t==="libp2p-key")return ME(this.bytes,e);throw new L(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}}async function nue(r){const e=Gle(r),t=await _L(e);return new lb(t.privateKey,t.publicKey)}function sue(r){const e=Qle(r);return new zE(e)}async function iue(r){const e=await _L(r);return new lb(e.privateKey,e.publicKey)}async function oue(r){const e=await Xle(r);return new lb(e.privateKey,e.publicKey)}const aue=Object.freeze(Object.defineProperty({__proto__:null,RsaPrivateKey:lb,RsaPublicKey:zE,fromJwk:iue,generateKeyPair:oue,unmarshalRsaPrivateKey:nue,unmarshalRsaPublicKey:sue},Symbol.toStringTag,{value:"Module"}));function cue(){return ca.randomPrivateKey()}async function lue(r,e){const{digest:t}=await jc.digest(e);try{return await Vle(t,r)}catch(n){throw new L(String(n),"ERR_INVALID_INPUT")}}async function uue(r,e,t){try{const{digest:n}=await jc.digest(t);return Kle(e,n,r)}catch(n){throw new L(String(n),"ERR_INVALID_INPUT")}}function hue(r){return mt.fromHex(r).toRawBytes(!0)}function due(r){try{bL(r,!0)}catch(e){throw new L(String(e),"ERR_INVALID_PRIVATE_KEY")}}function $L(r){try{mt.fromHex(r)}catch(e){throw new L(String(e),"ERR_INVALID_PUBLIC_KEY")}}function fue(r){try{return bL(r,!0)}catch(e){throw new L(String(e),"ERR_INVALID_PRIVATE_KEY")}}class FE{constructor(e){N(this,"_key");$L(e),this._key=e}async verify(e,t){return uue(this._key,t,e)}marshal(){return hue(this._key)}get bytes(){return Sh.encode({Type:Ar.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ie(this.bytes,e.bytes)}async hash(){const{bytes:e}=await jc.digest(this.bytes);return e}}class VE{constructor(e,t){N(this,"_key");N(this,"_publicKey");this._key=e,this._publicKey=t??fue(e),due(this._key),$L(this._publicKey)}async sign(e){return lue(this._key,e)}get public(){return new FE(this._publicKey)}marshal(){return this._key}get bytes(){return Ah.encode({Type:Ar.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ie(this.bytes,e.bytes)}async hash(){const{bytes:e}=await jc.digest(this.bytes);return e}async id(){const e=await this.public.hash();return R(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return ME(this.bytes,e);throw new L(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function pue(r){return new VE(r)}function yue(r){return new FE(r)}async function gue(){const r=cue();return new VE(r)}const wue=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey:VE,Secp256k1PublicKey:FE,generateKeyPair:gue,unmarshalSecp256k1PrivateKey:pue,unmarshalSecp256k1PublicKey:yue},Symbol.toStringTag,{value:"Module"})),ha={rsa:aue,ed25519:Ale,secp256k1:wue};function jE(r){const e=Object.keys(ha).join(" / ");return new L(`invalid or unsupported key type ${r}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function KE(r){if(r=r.toLowerCase(),r==="rsa"||r==="ed25519"||r==="secp256k1")return ha[r];throw jE(r)}async function qE(r,e){return KE(r).generateKeyPair(e??2048)}function Fl(r){const e=Sh.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Ar.RSA:return ha.rsa.unmarshalRsaPublicKey(t);case Ar.Ed25519:return ha.ed25519.unmarshalEd25519PublicKey(t);case Ar.Secp256k1:return ha.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw jE(e.Type??"RSA")}}function HE(r,e){return e=(e??"rsa").toLowerCase(),KE(e),r.bytes}async function ba(r){const e=Ah.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Ar.RSA:return ha.rsa.unmarshalRsaPrivateKey(t);case Ar.Ed25519:return ha.ed25519.unmarshalEd25519PrivateKey(t);case Ar.Secp256k1:return ha.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw jE(e.Type??"RSA")}}function bue(r,e){return e=(e??"rsa").toLowerCase(),KE(e),r.bytes}async function Yu(r,e){try{const s=await Rle(r,e);return await ba(s)}catch{}const t=At.pki.decryptRsaPrivateKey(r,e);if(t===null)throw new L("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=At.asn1.toDer(At.pki.privateKeyToAsn1(t));return n=M(n.getBytes(),"ascii"),ha.rsa.unmarshalRsaPrivateKey(n)}const TL=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};let mue=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Eue=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return IL(this,e)}},vue=class{constructor(e){this.decoders=e}or(e){return IL(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const IL=(r,e)=>new vue({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let _ue=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new mue(e,t,n),this.decoder=new Eue(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Sue=({name:r,prefix:e,encode:t,decode:n})=>new _ue(r,e,t,n),Aue=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},$ue=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},ma=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Sue({prefix:e,name:r,encode(s){return $ue(s,n,t)},decode(s){return Aue(s,n,t,r)}});ma({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});const Tue=ma({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});ma({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});ma({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});ma({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});ma({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});ma({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});ma({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});ma({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Iue="ERR_IPNS_EXPIRED_RECORD",GE="ERR_UNRECOGNIZED_VALIDITY",Rue="ERR_SIGNATURE_CREATION",al="ERR_SIGNATURE_VERIFICATION",Cue="ERR_UNRECOGNIZED_FORMAT",l$="ERR_UNDEFINED_PARAMETER",xue="ERR_INVALID_RECORD_DATA",Due="ERR_INVALID_EMBEDDED_KEY",Pue="ERR_MISSING_PRIVATE_KEY";function Oue(){RO._configure(),Mw._configure(CO),Uw._configure(xO)}Oue();const RL=["uint64","int64","sint64","fixed64","sfixed64"];function kue(r){for(const e of RL){if(r[e]==null)continue;const t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function Nue(r){return kue(new Mw(r))}function Lue(r){for(const e of RL){if(r[e]==null)continue;const t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function Mue(){return Lue(Uw.create())}function Uue(r,e){const t=Nue(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}function Bue(r,e){const t=Mue();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var Py;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Py||(Py={}));function CL(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function zue(r){function e(s){if(r[s.toString()]==null)throw new Error("Invalid enum value");return r[s]}const t=function(i,o){const a=e(i);o.int32(a)},n=function(i){const o=i.int32();return e(o)};return CL("enum",Py.VARINT,t,n)}function Fue(r,e){return CL("message",Py.LENGTH_DELIMITED,r,e)}var xo;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),function(n){n.codec=()=>zue(e)}(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=Fue((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.value!=null&&(s.uint32(10),s.bytes(n.value)),n.signature!=null&&(s.uint32(18),s.bytes(n.signature)),n.validityType!=null&&(s.uint32(24),r.ValidityType.codec().encode(n.validityType,s)),n.validity!=null&&(s.uint32(34),s.bytes(n.validity)),n.sequence!=null&&(s.uint32(40),s.uint64(n.sequence)),n.ttl!=null&&(s.uint32(48),s.uint64(n.ttl)),n.pubKey!=null&&(s.uint32(58),s.bytes(n.pubKey)),n.signatureV2!=null&&(s.uint32(66),s.bytes(n.signatureV2)),n.data!=null&&(s.uint32(74),s.bytes(n.data)),i.lengthDelimited!==!1&&s.ldelim()},(n,s)=>{const i={},o=s==null?n.len:n.pos+s;for(;n.pos<o;){const a=n.uint32();switch(a>>>3){case 1:i.value=n.bytes();break;case 2:i.signature=n.bytes();break;case 3:i.validityType=r.ValidityType.codec().decode(n);break;case 4:i.validity=n.bytes();break;case 5:i.sequence=n.uint64();break;case 6:i.ttl=n.uint64();break;case 7:i.pubKey=n.bytes();break;case 8:i.signatureV2=n.bytes();break;case 9:i.data=n.bytes();break;default:n.skipType(a&7);break}}return i})),t),r.encode=n=>Bue(n,r.codec()),r.decode=n=>Uue(n,r.codec())})(xo||(xo={}));const Vue=["string","number","bigint","symbol"],jue=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Kue(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(Vue.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(que(r))return"Buffer";const t=Hue(r);return t||"Object"}function que(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function Hue(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(jue.includes(e))return e}class F{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}F.uint=new F(0,"uint",!0);F.negint=new F(1,"negint",!0);F.bytes=new F(2,"bytes",!0);F.string=new F(3,"string",!0);F.array=new F(4,"array",!1);F.map=new F(5,"map",!1);F.tag=new F(6,"tag",!1);F.float=new F(7,"float",!0);F.false=new F(7,"false",!0);F.true=new F(7,"true",!0);F.null=new F(7,"null",!0);F.undefined=new F(7,"undefined",!0);F.break=new F(7,"break",!0);class fe{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const id=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Gue=new TextDecoder,Wue=new TextEncoder;function Oy(r){return id&&globalThis.Buffer.isBuffer(r)}function xL(r){return r instanceof Uint8Array?Oy(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const Que=id?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):h$(r,e,t):(r,e,t)=>t-e>64?Gue.decode(r.subarray(e,t)):h$(r,e,t),Yue=id?r=>r.length>64?globalThis.Buffer.from(r):u$(r):r=>r.length>64?Wue.encode(r):u$(r),Fo=r=>Uint8Array.from(r),WE=id?(r,e,t)=>Oy(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),Xue=id?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),xL(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let s of r)n+s.length>t.length&&(s=s.subarray(0,t.length-n)),t.set(s,n),n+=s.length;return t},Jue=id?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function Zue(r,e){if(Oy(r)&&Oy(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function u$(r,e=1/0){let t;const n=r.length;let s=null;const i=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&i.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&i.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&i.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;i.push(t)}else if(t<2048){if((e-=2)<0)break;i.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;i.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return i}function h$(r,e,t){const n=[];for(;e<t;){const s=r[e];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(e+o<=t){let a,c,u,l;switch(o){case 1:s<128&&(i=s);break;case 2:a=r[e+1],(a&192)===128&&(l=(s&31)<<6|a&63,l>127&&(i=l));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(l=(s&15)<<12|(a&63)<<6|c&63,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:a=r[e+1],c=r[e+2],u=r[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(l=(s&15)<<18|(a&63)<<12|(c&63)<<6|u&63,l>65535&&l<1114112&&(i=l))}}i===null?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=o}return ehe(n)}const d$=4096;function ehe(r){const e=r.length;if(e<=d$)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=d$));return t}const the=256;class DL{constructor(e=the){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const s=t.length-(this.maxCursor-this.cursor)-1;t.set(e,s)}else{if(t){const s=t.length-(this.maxCursor-this.cursor)-1;s<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,s),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Jue(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=WE(n,0,this.cursor)}else t=Xue(this.chunks,this.cursor);return e&&this.reset(),t}}const ke="CBOR decode error:",PL="CBOR encode error:";function od(r,e,t){if(r.length-e<t)throw new Error(`${ke} not enough data for type`)}const Ur=[24,256,65536,4294967296,BigInt("18446744073709551616")];function uu(r,e,t){od(r,e,1);const n=r[e];if(t.strict===!0&&n<Ur[0])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function hu(r,e,t){od(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<Ur[1])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function du(r,e,t){od(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<Ur[2])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);return n}function fu(r,e,t){od(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],s=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(t.strict===!0&&i<Ur[3])throw new Error(`${ke} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${ke} integers outside of the safe integer range are not supported`)}function rhe(r,e,t,n){return new fe(F.uint,uu(r,e+1,n),2)}function nhe(r,e,t,n){return new fe(F.uint,hu(r,e+1,n),3)}function she(r,e,t,n){return new fe(F.uint,du(r,e+1,n),5)}function ihe(r,e,t,n){return new fe(F.uint,fu(r,e+1,n),9)}function pu(r,e){return _i(r,0,e.value)}function _i(r,e,t){if(t<Ur[0]){const n=Number(t);r.push([e|n])}else if(t<Ur[1]){const n=Number(t);r.push([e|24,n])}else if(t<Ur[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<Ur[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<Ur[4]){const s=[e|27,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));s[8]=i&255,i=i>>8,s[7]=i&255,i=i>>8,s[6]=i&255,i=i>>8,s[5]=i&255,s[4]=o&255,o=o>>8,s[3]=o&255,o=o>>8,s[2]=o&255,o=o>>8,s[1]=o&255,r.push(s)}else throw new Error(`${ke} encountered BigInt larger than allowable range`)}}pu.encodedSize=function(e){return _i.encodedSize(e.value)};_i.encodedSize=function(e){return e<Ur[0]?1:e<Ur[1]?2:e<Ur[2]?3:e<Ur[3]?5:9};pu.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function ohe(r,e,t,n){return new fe(F.negint,-1-uu(r,e+1,n),2)}function ahe(r,e,t,n){return new fe(F.negint,-1-hu(r,e+1,n),3)}function che(r,e,t,n){return new fe(F.negint,-1-du(r,e+1,n),5)}const QE=BigInt(-1),OL=BigInt(1);function lhe(r,e,t,n){const s=fu(r,e+1,n);if(typeof s!="bigint"){const i=-1-s;if(i>=Number.MIN_SAFE_INTEGER)return new fe(F.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${ke} integers outside of the safe integer range are not supported`);return new fe(F.negint,QE-BigInt(s),9)}function YE(r,e){const t=e.value,n=typeof t=="bigint"?t*QE-OL:t*-1-1;_i(r,e.type.majorEncoded,n)}YE.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*QE-OL:t*-1-1;return n<Ur[0]?1:n<Ur[1]?2:n<Ur[2]?3:n<Ur[3]?5:9};YE.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Op(r,e,t,n){od(r,e,t+n);const s=WE(r,e+t,e+t+n);return new fe(F.bytes,s,t+n)}function uhe(r,e,t,n){return Op(r,e,1,t)}function hhe(r,e,t,n){return Op(r,e,2,uu(r,e+1,n))}function dhe(r,e,t,n){return Op(r,e,3,hu(r,e+1,n))}function fhe(r,e,t,n){return Op(r,e,5,du(r,e+1,n))}function phe(r,e,t,n){const s=fu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ke} 64-bit integer bytes lengths not supported`);return Op(r,e,9,s)}function ky(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===F.string?Yue(r.value):r.value),r.encodedBytes}function ub(r,e){const t=ky(e);_i(r,e.type.majorEncoded,t.length),r.push(t)}ub.encodedSize=function(e){const t=ky(e);return _i.encodedSize(t.length)+t.length};ub.compareTokens=function(e,t){return yhe(ky(e),ky(t))};function yhe(r,e){return r.length<e.length?-1:r.length>e.length?1:Zue(r,e)}function kp(r,e,t,n,s){const i=t+n;od(r,e,i);const o=new fe(F.string,Que(r,e+t,e+i),i);return s.retainStringBytes===!0&&(o.byteValue=WE(r,e+t,e+i)),o}function ghe(r,e,t,n){return kp(r,e,1,t,n)}function whe(r,e,t,n){return kp(r,e,2,uu(r,e+1,n),n)}function bhe(r,e,t,n){return kp(r,e,3,hu(r,e+1,n),n)}function mhe(r,e,t,n){return kp(r,e,5,du(r,e+1,n),n)}function Ehe(r,e,t,n){const s=fu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ke} 64-bit integer string lengths not supported`);return kp(r,e,9,s,n)}const vhe=ub;function ad(r,e,t,n){return new fe(F.array,n,t)}function _he(r,e,t,n){return ad(r,e,1,t)}function She(r,e,t,n){return ad(r,e,2,uu(r,e+1,n))}function Ahe(r,e,t,n){return ad(r,e,3,hu(r,e+1,n))}function $he(r,e,t,n){return ad(r,e,5,du(r,e+1,n))}function The(r,e,t,n){const s=fu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ke} 64-bit integer array lengths not supported`);return ad(r,e,9,s)}function Ihe(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return ad(r,e,1,1/0)}function XE(r,e){_i(r,F.array.majorEncoded,e.value)}XE.compareTokens=pu.compareTokens;XE.encodedSize=function(e){return _i.encodedSize(e.value)};function cd(r,e,t,n){return new fe(F.map,n,t)}function Rhe(r,e,t,n){return cd(r,e,1,t)}function Che(r,e,t,n){return cd(r,e,2,uu(r,e+1,n))}function xhe(r,e,t,n){return cd(r,e,3,hu(r,e+1,n))}function Dhe(r,e,t,n){return cd(r,e,5,du(r,e+1,n))}function Phe(r,e,t,n){const s=fu(r,e+1,n);if(typeof s=="bigint")throw new Error(`${ke} 64-bit integer map lengths not supported`);return cd(r,e,9,s)}function Ohe(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return cd(r,e,1,1/0)}function JE(r,e){_i(r,F.map.majorEncoded,e.value)}JE.compareTokens=pu.compareTokens;JE.encodedSize=function(e){return _i.encodedSize(e.value)};function khe(r,e,t,n){return new fe(F.tag,t,1)}function Nhe(r,e,t,n){return new fe(F.tag,uu(r,e+1,n),2)}function Lhe(r,e,t,n){return new fe(F.tag,hu(r,e+1,n),3)}function Mhe(r,e,t,n){return new fe(F.tag,du(r,e+1,n),5)}function Uhe(r,e,t,n){return new fe(F.tag,fu(r,e+1,n),9)}function ZE(r,e){_i(r,F.tag.majorEncoded,e.value)}ZE.compareTokens=pu.compareTokens;ZE.encodedSize=function(e){return _i.encodedSize(e.value)};const Bhe=20,zhe=21,Fhe=22,Vhe=23;function jhe(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${ke} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new fe(F.null,null,1):new fe(F.undefined,void 0,1)}function Khe(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${ke} indefinite length items not allowed`);return new fe(F.break,void 0,1)}function ev(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${ke} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${ke} Infinity values are not supported`)}return new fe(F.float,r,e)}function qhe(r,e,t,n){return ev(rv(r,e+1),3,n)}function Hhe(r,e,t,n){return ev(nv(r,e+1),5,n)}function Ghe(r,e,t,n){return ev(ML(r,e+1),9,n)}function tv(r,e,t){const n=e.value;if(n===!1)r.push([F.float.majorEncoded|Bhe]);else if(n===!0)r.push([F.float.majorEncoded|zhe]);else if(n===null)r.push([F.float.majorEncoded|Fhe]);else if(n===void 0)r.push([F.float.majorEncoded|Vhe]);else{let s,i=!1;(!t||t.float64!==!0)&&(NL(n),s=rv(Di,1),n===s||Number.isNaN(n)?(Di[0]=249,r.push(Di.slice(0,3)),i=!0):(LL(n),s=nv(Di,1),n===s&&(Di[0]=250,r.push(Di.slice(0,5)),i=!0))),i||(Whe(n),s=ML(Di,1),Di[0]=251,r.push(Di.slice(0,9)))}}tv.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){NL(n);let s=rv(Di,1);if(n===s||Number.isNaN(n))return 3;if(LL(n),s=nv(Di,1),n===s)return 5}return 9};const kL=new ArrayBuffer(9),si=new DataView(kL,1),Di=new Uint8Array(kL,0);function NL(r){if(r===1/0)si.setUint16(0,31744,!1);else if(r===-1/0)si.setUint16(0,64512,!1);else if(Number.isNaN(r))si.setUint16(0,32256,!1);else{si.setFloat32(0,r);const e=si.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)si.setUint16(0,31744,!1);else if(t===0)si.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const s=t-127;s<-24?si.setUint16(0,0):s<-14?si.setUint16(0,(e&2147483648)>>16|1<<24+s,!1):si.setUint16(0,(e&2147483648)>>16|s+15<<10|n>>13,!1)}}}function rv(r,e){if(r.length-e<2)throw new Error(`${ke} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,s=t&1023;let i;return n===0?i=s*2**-24:n!==31?i=(s+1024)*2**(n-25):i=s===0?1/0:NaN,t&32768?-i:i}function LL(r){si.setFloat32(0,r,!1)}function nv(r,e){if(r.length-e<4)throw new Error(`${ke} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function Whe(r){si.setFloat64(0,r,!1)}function ML(r,e){if(r.length-e<8)throw new Error(`${ke} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}tv.compareTokens=pu.compareTokens;function Ze(r,e,t){throw new Error(`${ke} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function hb(r){return()=>{throw new Error(`${ke} ${r}`)}}const re=[];for(let r=0;r<=23;r++)re[r]=Ze;re[24]=rhe;re[25]=nhe;re[26]=she;re[27]=ihe;re[28]=Ze;re[29]=Ze;re[30]=Ze;re[31]=Ze;for(let r=32;r<=55;r++)re[r]=Ze;re[56]=ohe;re[57]=ahe;re[58]=che;re[59]=lhe;re[60]=Ze;re[61]=Ze;re[62]=Ze;re[63]=Ze;for(let r=64;r<=87;r++)re[r]=uhe;re[88]=hhe;re[89]=dhe;re[90]=fhe;re[91]=phe;re[92]=Ze;re[93]=Ze;re[94]=Ze;re[95]=hb("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)re[r]=ghe;re[120]=whe;re[121]=bhe;re[122]=mhe;re[123]=Ehe;re[124]=Ze;re[125]=Ze;re[126]=Ze;re[127]=hb("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)re[r]=_he;re[152]=She;re[153]=Ahe;re[154]=$he;re[155]=The;re[156]=Ze;re[157]=Ze;re[158]=Ze;re[159]=Ihe;for(let r=160;r<=183;r++)re[r]=Rhe;re[184]=Che;re[185]=xhe;re[186]=Dhe;re[187]=Phe;re[188]=Ze;re[189]=Ze;re[190]=Ze;re[191]=Ohe;for(let r=192;r<=215;r++)re[r]=khe;re[216]=Nhe;re[217]=Lhe;re[218]=Mhe;re[219]=Uhe;re[220]=Ze;re[221]=Ze;re[222]=Ze;re[223]=Ze;for(let r=224;r<=243;r++)re[r]=hb("simple values are not supported");re[244]=Ze;re[245]=Ze;re[246]=Ze;re[247]=jhe;re[248]=hb("simple values are not supported");re[249]=qhe;re[250]=Hhe;re[251]=Ghe;re[252]=Ze;re[253]=Ze;re[254]=Ze;re[255]=Khe;const Lo=[];for(let r=0;r<24;r++)Lo[r]=new fe(F.uint,r,1);for(let r=-1;r>=-24;r--)Lo[31-r]=new fe(F.negint,r,1);Lo[64]=new fe(F.bytes,new Uint8Array(0),1);Lo[96]=new fe(F.string,"",1);Lo[128]=new fe(F.array,0,1);Lo[160]=new fe(F.map,0,1);Lo[244]=new fe(F.false,!1,1);Lo[245]=new fe(F.true,!0,1);Lo[246]=new fe(F.null,null,1);function Qhe(r){switch(r.type){case F.false:return Fo([244]);case F.true:return Fo([245]);case F.null:return Fo([246]);case F.bytes:return r.value.length?void 0:Fo([64]);case F.string:return r.value===""?Fo([96]):void 0;case F.array:return r.value===0?Fo([128]):void 0;case F.map:return r.value===0?Fo([160]):void 0;case F.uint:return r.value<24?Fo([Number(r.value)]):void 0;case F.negint:if(r.value>=-24)return Fo([31-Number(r.value)])}}const Yhe={float64:!1,mapSorter:Zhe,quickEncodeToken:Qhe};function Xhe(){const r=[];return r[F.uint.major]=pu,r[F.negint.major]=YE,r[F.bytes.major]=ub,r[F.string.major]=vhe,r[F.array.major]=XE,r[F.map.major]=JE,r[F.tag.major]=ZE,r[F.float.major]=tv,r}const UL=Xhe(),W3=new DL;class Ny{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${PL} object contains circular references`);return new Ny(t,e)}}const ka={null:new fe(F.null,null),undefined:new fe(F.undefined,void 0),true:new fe(F.true,!0),false:new fe(F.false,!1),emptyArray:new fe(F.array,0),emptyMap:new fe(F.map,0)},Uc={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new fe(F.float,r):r>=0?new fe(F.uint,r):new fe(F.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new fe(F.uint,r):new fe(F.negint,r)},Uint8Array(r,e,t,n){return new fe(F.bytes,r)},string(r,e,t,n){return new fe(F.string,r)},boolean(r,e,t,n){return r?ka.true:ka.false},null(r,e,t,n){return ka.null},undefined(r,e,t,n){return ka.undefined},ArrayBuffer(r,e,t,n){return new fe(F.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new fe(F.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[ka.emptyArray,new fe(F.break)]:ka.emptyArray;n=Ny.createCheck(n,r);const s=[];let i=0;for(const o of r)s[i++]=A2(o,t,n);return t.addBreakTokens?[new fe(F.array,r.length),s,new fe(F.break)]:[new fe(F.array,r.length),s]},Object(r,e,t,n){const s=e!=="Object",i=s?r.keys():Object.keys(r),o=s?r.size:i.length;if(!o)return t.addBreakTokens===!0?[ka.emptyMap,new fe(F.break)]:ka.emptyMap;n=Ny.createCheck(n,r);const a=[];let c=0;for(const u of i)a[c++]=[A2(u,t,n),A2(s?r.get(u):r[u],t,n)];return Jhe(a,t),t.addBreakTokens?[new fe(F.map,o),a,new fe(F.break)]:[new fe(F.map,o),a]}};Uc.Map=Uc.Object;Uc.Buffer=Uc.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Uc[`${r}Array`]=Uc.DataView;function A2(r,e={},t){const n=Kue(r),s=e&&e.typeEncoders&&e.typeEncoders[n]||Uc[n];if(typeof s=="function"){const o=s(r,n,e,t);if(o!=null)return o}const i=Uc[n];if(!i)throw new Error(`${PL} unsupported type: ${n}`);return i(r,n,e,t)}function Jhe(r,e){e.mapSorter&&r.sort(e.mapSorter)}function Zhe(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const s=t.type.major,i=UL[s].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function BL(r,e,t,n){if(Array.isArray(e))for(const s of e)BL(r,s,t,n);else t[e.type.major](r,e,n)}function ede(r,e,t){const n=A2(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const s=t.quickEncodeToken(n);if(s)return s;const i=e[n.type.major];if(i.encodedSize){const o=i.encodedSize(n,t),a=new DL(o);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return xL(a.chunks[0])}}return W3.reset(),BL(W3,n,e,t),W3.toBytes(!0)}function P1(r,e){return e=Object.assign({},Yhe,e),ede(r,UL,e)}const tde={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class rde{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=Lo[e];if(t===void 0){const n=re[e];if(!n)throw new Error(`${ke} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=e&31;t=n(this.data,this.pos,s,this.options)}return this.pos+=t.encodedLength,t}}const O1=Symbol.for("DONE"),db=Symbol.for("BREAK");function nde(r,e,t){const n=[];for(let s=0;s<r.value;s++){const i=k1(e,t);if(i===db){if(r.value===1/0)break;throw new Error(`${ke} got unexpected break to lengthed array`)}if(i===O1)throw new Error(`${ke} found array but not enough entries (got ${s}, expected ${r.value})`);n[s]=i}return n}function sde(r,e,t){const n=t.useMaps===!0,s=n?void 0:{},i=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=k1(e,t);if(a===db){if(r.value===1/0)break;throw new Error(`${ke} got unexpected break to lengthed map`)}if(a===O1)throw new Error(`${ke} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${ke} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in s))throw new Error(`${ke} found repeat map key "${a}"`);const c=k1(e,t);if(c===O1)throw new Error(`${ke} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?i.set(a,c):s[a]=c}return n?i:s}function k1(r,e){if(r.done())return O1;const t=r.next();if(t.type===F.break)return db;if(t.type.terminal)return t.value;if(t.type===F.array)return nde(t,r,e);if(t.type===F.map)return sde(t,r,e);if(t.type===F.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=k1(r,e);return e.tags[t.value](n)}throw new Error(`${ke} tag not supported (${t.value})`)}throw new Error("unsupported")}function Qa(r,e){if(!(r instanceof Uint8Array))throw new Error(`${ke} data to decode must be a Uint8Array`);e=Object.assign({},tde,e);const t=e.tokenizer||new rde(r,e),n=k1(t,e);if(n===O1)throw new Error(`${ke} did not find any content to decode`);if(n===db)throw new Error(`${ke} got unexpected break`);if(!t.done())throw new Error(`${ke} too many terminals, data makes no sense`);return n}const f$=U("ipns:utils"),zL=M("/ipns/");function I4(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,u))}const ide=async(r,e)=>{if(e==null||r==null){const n=new Error("one or more of the provided parameters are not defined");throw f$.error(n),T(n,l$)}let t;if(e.pubKey!=null){try{t=Fl(e.pubKey)}catch(s){throw f$.error(s),s}if(!(await vi(e.pubKey)).equals(r))throw T(new Error("Embedded public key did not match PeerID"),Due)}else r.publicKey!=null&&(t=Fl(r.publicKey));if(t!=null)return t;throw T(new Error("no public key is available"),l$)},ode=(r,e,t)=>{const n=M(e);return z([r,t,n])},FL=r=>{const e=M("ipns-signature:");return z([e,r])},ade=r=>xo.encode(r),fb=r=>{const e=xo.decode(r);return e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),{value:e.value??new Uint8Array(0),signature:e.signature??new Uint8Array(0),validityType:e.validityType??xo.ValidityType.EOL,validity:e.validity??new Uint8Array(0),sequence:e.sequence??0n,pubKey:e.pubKey,ttl:e.ttl??void 0,signatureV2:e.signatureV2,data:e.data}},Ly=r=>z([zL,r.toBytes()]),cde=r=>No(r.slice(zL.length)),lde=(r,e,t,n,s)=>{let i;if(t===xo.ValidityType.EOL)i=0;else throw T(new Error("Unknown validity type"),GE);return P1({Value:r,Validity:e,ValidityType:i,Sequence:n,TTL:s})},ude=r=>{const e=Qa(r);if(e.ValidityType===0)e.ValidityType=xo.ValidityType.EOL;else throw T(new Error("Unknown validity type"),GE);return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e};var hde=VL,p$=128,dde=127,fde=~dde,pde=Math.pow(2,31);function VL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=pde;)e[t++]=r&255|p$,r/=128;for(;r&fde;)e[t++]=r&255|p$,r>>>=7;return e[t]=r|0,VL.bytes=t-n+1,e}var yde=R4,gde=128,y$=127;function R4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw R4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&y$)<<s:(o&y$)*Math.pow(2,s),s+=7}while(o>=gde);return R4.bytes=i-n,t}var wde=Math.pow(2,7),bde=Math.pow(2,14),mde=Math.pow(2,21),Ede=Math.pow(2,28),vde=Math.pow(2,35),_de=Math.pow(2,42),Sde=Math.pow(2,49),Ade=Math.pow(2,56),$de=Math.pow(2,63),Tde=function(r){return r<wde?1:r<bde?2:r<mde?3:r<Ede?4:r<vde?5:r<_de?6:r<Sde?7:r<Ade?8:r<$de?9:10},Ide={encode:hde,decode:yde,encodingLength:Tde},My=Ide;const g$=(r,e=0)=>[My.decode(r,e),My.decode.bytes],w$=(r,e,t=0)=>(My.encode(r,e,t),e),b$=r=>My.encodingLength(r),Rde=(r,e)=>{const t=e.byteLength,n=b$(r),s=n+b$(t),i=new Uint8Array(s+t);return w$(r,i,0),w$(t,i,n),i.set(e,s),new jL(r,t,e,i)},Cde=r=>{const e=TL(r),[t,n]=g$(e),[s,i]=g$(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new jL(t,s,o,e)};let jL=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const KL=0,xde="identity",qL=TL,Dde=r=>Rde(KL,qL(r)),Pde={code:KL,name:xde,encode:qL,digest:Dde},HL=U("ipns"),Ode=Pde.code,$2="/ipns/",Q3=$2.length,kde=async(r,e,t,n)=>{const s=new wce(Date.now()+Number(n)),i=xo.ValidityType.EOL,[o,a]=n.toString().split("."),c=BigInt(o)*BigInt(1e5)+BigInt(a??"0");return await Nde(r,e,t,i,s,c)},Nde=async(r,e,t,n,s,i)=>{t=BigInt(t);const o=M(s.toString());if(r.privateKey==null)throw T(new Error("Missing private key"),Pue);const a=await ba(r.privateKey),c=await Mde(a,e,n,o),u=lde(e,o,n,t,i),l=FL(u),h=await a.sign(l),f={value:e,signature:c,validityType:n,validity:o,sequence:t,ttl:i,signatureV2:h,data:u};if(r.publicKey!=null){const y=Cde(r.toBytes());(y.code!==Ode||!Ie(r.publicKey,y.digest))&&(f.pubKey=r.publicKey)}return HL("ipns entry for %b created",e),f},Lde=r=>Tue.encode(r).slice(1),C4=r=>new be(`/ipns/${Lde(r)}`),Mde=async(r,e,t,n)=>{try{const s=ode(e,t,n);return await r.sign(s)}catch(s){throw HL.error("record signature creation failed",s),T(new Error("record signature creation failed"),Rue)}},zs=U("ipfs:ipns:publisher"),m$=Ro().code,GL=60*60*1e3;class T2{constructor(e,t){this._routing=e,this._datastore=t}async publishWithEOL(e,t,n,s){const i=await this._updateOrCreateRecord(e,t,n,s);return this._putRecordToRouting(i,e,s)}publish(e,t,n){return this.publishWithEOL(e,t,GL,n)}async _putRecordToRouting(e,t,n){if(!ua(t)){const i="peerId received is not valid";throw zs.error(i),T(new Error(i),"ERR_INVALID_PEER_ID")}if(t.publicKey==null)throw T(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");const s=Ly(t);return await this._publishEntry(s,e,n),e}async _publishEntry(e,t,n){try{const s=await this._routing.put(e,t,n);return zs(`ipns record for ${R(e,"base32")} was stored in the routing`),s}catch(s){const i=`ipns record for ${R(e,"base32")} could not be stored in the routing - ${s.stack}`;throw zs.error(i),zs.error(s),T(new Error(i),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(e,t={}){if(!ua(e)){const s="peerId received is not valid";throw zs.error(s),T(new Error(s),"ERR_INVALID_PEER_ID")}const n=t.checkRouting!==!1;try{const s=await this._datastore.get(C4(e.toBytes()));return this._unmarshalData(s)}catch(s){if(s.code!==m$){const i=`unexpected error getting the ipns record ${e.toString()} from datastore`;throw zs.error(i),T(new Error(i),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!n)throw T(s,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{const i=Ly(e),o=await this._routing.get(i);return this._unmarshalData(o)}catch(i){throw zs.error(i),i}}}_unmarshalData(e){try{return fb(e)}catch(t){throw T(t,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(e,t,n,s){if(!ua(e)){const u="peerId received is not valid";throw zs.error(u),T(new Error(u),"ERR_INVALID_PEER_ID")}const i={checkRouting:!0};let o;try{o=await this._getPublished(e,i)}catch(u){if(u.code!==m$){const l=`unexpected error when determining the last published IPNS record for ${e.toString()} ${u.stack}`;throw zs.error(l),T(new Error(l),"ERR_DETERMINING_PUBLISHED_RECORD")}}let a=0n;o&&o.sequence!==void 0&&(a=Ie(o.value,t)?o.sequence:o.sequence+BigInt(1));let c;try{c=await kde(e,t,a,n)}catch(u){const l=`ipns record for ${t} could not be created`;throw zs.error(u),T(new Error(l),"ERR_CREATING_IPNS_RECORD")}try{const u=ade(c);return await this._datastore.put(C4(e.toBytes()),u,s),zs(`ipns record for ${R(t,"base32")} was stored in the datastore`),u}catch{const l=`ipns record for ${t} could not be stored in the datastore`;throw zs.error(l),T(new Error(l),"ERR_STORING_IN_DATASTORE")}}}T2.defaultRecordLifetime=GL;const _0=U("ipfs:ipns:republisher"),WL=60*1e3,QL=60*WL,Ude=4*QL,Bde=24*QL;class zde{constructor(e,t,n,s,i={pass:""}){this._publisher=e,this._datastore=t,this._peerId=n,this._keychain=s,this._options=i,this._republishHandle=null}async start(){if(this._republishHandle)throw T(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");const e={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:s=>{e._timeoutId=setTimeout(async()=>{e._timeoutId=null;try{e._inflightTask=e._task(),await e._inflightTask,e._task&&e.runPeriodically(s)}catch(i){_0.error(i)}},s())},cancel:async()=>{e._timeoutId!=null&&clearTimeout(e._timeoutId),e._task=null,await e._inflightTask}},{pass:t}=this._options;let n=!0;e._task=async()=>{const s=new Xt.TimeoutController(3e4);try{await this._republishEntries(this._peerId,t,{signal:s.signal})}finally{s.clear()}},e.runPeriodically(()=>n?(n=!1,this._options.initialBroadcastInterval||WL):this._options.broadcastInterval||Ude),this._republishHandle=e}async stop(){const e=this._republishHandle;if(!e)throw T(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await e.cancel()}async _republishEntries(e,t,n){try{await this._republishEntry(e,n)}catch{const i="cannot republish entry for the node's private key";_0.error(i);return}if(t)try{const s=await this._keychain.listKeys();for(const i of s){if(i.name==="self")continue;const o=await this._keychain.exportKey(i.name,t),a=await Yu(o,t),c=await vi(a.public.bytes,a.bytes);await this._republishEntry(c,n)}}catch(s){_0.error(s)}}async _republishEntry(e,t){try{const n=await this._getPreviousValue(e);await this._publisher.publishWithEOL(e,n,Bde,t)}catch(n){if(n.code==="ERR_NO_ENTRY_FOUND")return;throw n}}async _getPreviousValue(e){if(!ua(e))throw T(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{const t=await this._datastore.get(C4(e.toBytes()));if(!(t instanceof Uint8Array))throw T(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{return fb(t).value}catch(n){throw _0.error(n),T(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(t){throw t&&t.notFound?T(new Error(`no previous entry for record with id: ${e.toString()}`),"ERR_NO_ENTRY_FOUND"):t}}}const Od=U("ipns:validator"),Fde=async(r,e)=>{const{value:t,validityType:n,validity:s}=e;let i,o;if(e.signatureV2!=null&&e.data!=null)o=e.signatureV2,i=FL(e.data),Vde(e);else throw T(new Error("missing data or signatureV2"),al);let a;try{a=await r.verify(i,o)}catch{a=!1}if(!a)throw Od.error("record signature verification failed"),T(new Error("record signature verification failed"),al);if(s!=null&&n===xo.ValidityType.EOL){let c;try{c=I4(R(s))}catch{throw Od.error("unrecognized validity format (not an rfc3339 format)"),T(new Error("unrecognized validity format (not an rfc3339 format)"),Cue)}if(c.getTime()<Date.now())throw Od.error("record has expired"),T(new Error("record has expired"),Iue)}else if(n!=null)throw Od.error("unrecognized validity type"),T(new Error("unrecognized validity type"),GE);Od("ipns entry for %b is valid",t)},Vde=r=>{if(r.data==null)throw T(new Error("Record data is missing"),xue);const e=ude(r.data);if(!Ie(e.Value,r.value))throw T(new Error('Field "value" did not match between protobuf and CBOR'),al);if(!Ie(e.Validity,r.validity))throw T(new Error('Field "validity" did not match between protobuf and CBOR'),al);if(e.ValidityType!==r.validityType)throw T(new Error('Field "validityType" did not match between protobuf and CBOR'),al);if(e.Sequence!==r.sequence)throw T(new Error('Field "sequence" did not match between protobuf and CBOR'),al);if(e.TTL!==r.ttl)throw T(new Error('Field "ttl" did not match between protobuf and CBOR'),al)},sv=async(r,e)=>{const t=cde(r),n=fb(e),s=await ide(t,n);await Fde(s,n)},Y3=U("ipfs:ipns:resolver"),jde=Ro().code,E$=32;class Kde{constructor(e){this._routing=e}async resolve(e,t={}){if(typeof e!="string")throw T(new Error("invalid name"),"ERR_INVALID_NAME");const n=t.recursive&&t.recursive.toString()==="true",s=e.split("/");if(s.length!==3||s[0]!=="")throw T(new Error("invalid name"),"ERR_INVALID_NAME");const i=s[2];let o=1/0;n&&(o=E$);const a=await this.resolver(i,o,t);return Y3(`${e} was locally resolved correctly`),a}async resolver(e,t,n){if(t===0){const o=`could not resolve name (recursion limit of ${E$} exceeded)`;throw Y3.error(o),T(new Error(o),"ERR_RESOLVE_RECURSION_LIMIT")}const s=await this._resolveName(e,n),i=s.split("/");return i[1]==="ipfs"||!t?s:this.resolver(i[2],t-1,n)}async _resolveName(e,t){const n=Ae(e),s=Ly(n);let i;try{i=await this._routing.get(s,t)}catch(o){throw Y3.error("could not get record from routing",o),o.code===jde?T(new Error(`record requested for ${e} was not found in the network`),"ERR_NO_RECORD_FOUND"):T(new Error(`unexpected error getting the ipns record ${n.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(n,i)}async _validateRecord(e,t){await sv(z([M("/ipns/"),e.toBytes()]),t);const n=fb(t);return R(n.value)}}class qde{constructor(e){this.lru=nb(e)}get(e){const t=this.lru.get(e);if(t){if(t.expire&&t.expire<Date.now()){this.lru.remove(e);return}return t.value}}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}const kd=U("ipfs:ipns"),v$=60*1e3;class _${constructor(e,t,n,s,i){this.publisher=new T2(e,t),this.republisher=new zde(this.publisher,t,n,s,i),this.resolver=new Kde(e),this.cache=new qde(1e3),this.routing=e}async publish(e,t,n=T2.defaultRecordLifetime,s){try{await this.publisher.publishWithEOL(e,t,n,s),kd(`IPNS value ${R(t,"base32")} was published correctly`);const i=e.toString(),o=parseFloat(n),a=o<v$?o:v$;return this.cache.set(i,t,a),kd(`IPNS value ${R(t,"base32")} was cached correctly`),{name:i,value:t}}catch(i){throw kd.error(i),i}}async resolve(e,t={}){if(typeof e!="string")throw T(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!t.nocache&&!t.recursive){const n=e.split("/")[2],s=this.cache.get(n);if(s)return s}try{const n=await this.resolver.resolve(e,t);return kd(`IPNS record from ${e} was resolved correctly`),n}catch(n){throw kd.error(n),n}}async initializeKeyspace(e,t,n){return this.publish(e,t,T2.defaultRecordLifetime,n)}}async function Kc(r){const e=[];for await(const t of r)e.push(t);return e}const S$=(r,e)=>async function*(){yield*(await Kc(r)).sort(e)}();async function jr(r){for await(const e of r);}async function*Yt(r,e){for await(const t of r)await e(t)&&(yield t)}async function*Vl(r,e){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}class pb{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:s}of e)await this.put(n,s,t),yield{key:n,value:s}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,s){e.push({key:n,value:s})},delete(n){t.push(n)},commit:async n=>{await jr(this.putMany(e,n)),e=[],await jr(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=Yt(n,s=>s.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Yt(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>S$(s,i),n)),e.offset!=null){let s=0;n=Yt(n,()=>s++>=e.offset)}return e.limit!=null&&(n=Vl(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=Yt(n,s=>s.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Yt(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>S$(s,i),n)),e.offset!=null){let s=0;n=Yt(n,()=>s++>=e.offset)}return e.limit!=null&&(n=Vl(n,e.limit)),n}}const Hde=U("datastore:core:tiered");class Gde extends pb{constructor(e){super(),this.stores=e.slice()}async open(){try{await Promise.all(this.stores.map(e=>e.open()))}catch(e){throw YN(e)}}async put(e,t,n){try{await Promise.all(this.stores.map(s=>s.put(e,t,n)))}catch(s){throw b4(s)}}async get(e,t){for(const n of this.stores)try{const s=await n.get(e,t);if(s)return s}catch(s){Hde.error(s)}throw Ro()}async has(e,t){for(const n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map(n=>n.delete(e,t)))}catch(n){throw XN(n)}}async*putMany(e,t={}){let n;const s=this.stores.map(i=>{const o=$r({objectMode:!0});return jr(i.putMany(o,t)).catch(a=>{n=a}),o});try{for await(const i of e){if(n)throw n;s.forEach(o=>o.push(i)),yield i}}finally{s.forEach(i=>i.end())}}async*deleteMany(e,t={}){let n;const s=this.stores.map(i=>{const o=$r({objectMode:!0});return jr(i.deleteMany(o,t)).catch(a=>{n=a}),o});try{for await(const i of e){if(n)throw n;s.forEach(o=>o.push(i)),yield i}}finally{s.forEach(i=>i.end())}}async close(){await Promise.all(this.stores.map(e=>e.close()))}batch(){const e=this.stores.map(t=>t.batch());return{put:(t,n)=>{e.forEach(s=>s.put(t,n))},delete:t=>{e.forEach(n=>n.delete(t))},commit:async t=>{for(const n of e)await n.commit(t)}}}query(e,t){return this.stores[this.stores.length-1].query(e,t)}queryKeys(e,t){return this.stores[this.stores.length-1].queryKeys(e,t)}}function Be(r,e,t,n,s){for(e=e.split?e.split("."):e,n=0;n<e.length;n++)r=r?r[e[n]]:s;return r===s?t:r}const YL=(r,e)=>{const t=e.map((n,s)=>({entry:xo.decode(n),index:s}));return t.sort((n,s)=>{if(n.entry.signatureV2!=null&&s.entry.signatureV2==null)return-1;if(n.entry.signatureV2==null&&s.entry.signatureV2!=null)return 1;const i=n.entry.sequence??0n,o=s.entry.sequence??0n;if(i>o)return-1;if(i<o)return 1;const a=n.entry.validity??new Uint8Array(0),c=s.entry.validity??new Uint8Array(0),u=I4(R(a)),l=I4(R(c));return u.getTime()>l.getTime()?-1:u.getTime()<l.getTime()?1:0}),t[0].index},Wde="SHARDING",Qde="_README";class Yde extends pb{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw Ro();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:new be(e),value:t}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>new be(e))}}async function*ls(r,e){for await(const t of r)yield e(t)}async function*ys(...r){const e=$r({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async t=>{for await(const n of t)e.push(n)})),e.end()}catch(t){e.end(t)}}),yield*e}const Xde=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},XL=r=>r!=null&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),X3=r=>r!=null&&typeof r.sink=="function"&&XL(r.source),Jde=r=>e=>{const t=r.sink(e);if(t.then!=null){const n=$r({objectMode:!0});return t.then(()=>{n.end()},i=>{n.end(i)}),ys(n,async function*(){yield*r.source,n.end()}())}return r.source};function Ve(r,...e){if(X3(r)){const n=r;r=()=>n.source}else if(XL(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&X3(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)X3(t[n])&&(t[n]=Jde(t[n]));return Xde(...t)}new be(Wde);new be(Qde);const I2="/record/";function A$(r){return R(r,"base32")}function S0(r){(typeof r=="string"||r instanceof String)&&(r=M(r.toString()));const e=R(r,"base64url");return`${I2}${e}`}function Zde(r){if(r.substring(0,I2.length)!==I2)throw new L("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");const e=r.substring(I2.length);return M(e,"base64url")}const Pr=U("datastore-pubsub:publisher");class efe extends pb{constructor(e,t,n,s,i,o){if(super(),!s)throw new L("missing validator","ERR_INVALID_PARAMETERS");if(typeof s!="function")throw new L("missing validate function","ERR_INVALID_PARAMETERS");if(typeof i!="function")throw new L("missing select function","ERR_INVALID_PARAMETERS");if(o&&typeof o!="function")throw new L("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=n,this._validator=s,this._selector=i,this._handleSubscriptionKeyFn=o,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,n){if(!(e instanceof Uint8Array)){const i="datastore key does not have a valid format";throw Pr.error(i),new L(i,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){const i="received value is not a Uint8Array";throw Pr.error(i),new L(i,"ERR_INVALID_VALUE_RECEIVED")}const s=S0(e);Pr(`publish value for topic ${s}`),await this._pubsub.publish(s,t)}async get(e,t){if(!(e instanceof Uint8Array)){const i="datastore key does not have a valid format";throw Pr.error(i),new L(i,"ERR_INVALID_DATASTORE_KEY")}const n=S0(e),s=await this._pubsub.getTopics();if(s&&Array.isArray(s)&&s.indexOf(n)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(n)}catch{const o=`cannot subscribe topic ${n}`;throw Pr.error(o),new L(o,"ERR_SUBSCRIBING_TOPIC")}return Pr(`subscribed values for key ${n}`),this._getLocal(e)}unsubscribe(e){const t=S0(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){const n=new be("/"+A$(e),!1);let s;try{s=await this._datastore.get(n,t)}catch(i){if(i.code!=="ERR_NOT_FOUND"){const a=`unexpected error getting the ipns record for ${n.toString()}`;throw Pr.error(a),new L(a,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const o=`local record requested was not found for ${n.toString()}`;throw Pr.error(o),new L(o,"ERR_NOT_FOUND")}if(!(s instanceof Uint8Array)){const i="found record that we couldn't convert to a value";throw Pr.error(i),new L(i,"ERR_INVALID_RECORD_RECEIVED")}return s}async _onMessage(e){const t=e.detail;if(t.type!=="signed"){Pr.error("unsigned message received, this module can only work with signed messages");return}const{data:n,from:s,topic:i}=t;let o;try{o=Zde(i)}catch(a){Pr.error(a);return}if(Pr(`message received for topic ${i}`),this._peerId.equals(s)){Pr("message discarded as it is from the same peer");return}if(this._handleSubscriptionKeyFn){let a;try{a=await this._handleSubscriptionKeyFn(o)}catch{Pr.error("message discarded by the subscriptionKeyFn");return}o=a}try{await this._storeIfSubscriptionIsBetter(o,n)}catch(a){Pr.error(a)}}async _storeIfSubscriptionIsBetter(e,t,n){let s=!1;try{s=await this._isBetter(e,t)}catch(i){if(i.code!=="ERR_NOT_VALID_RECORD")throw i}s&&await this._storeRecord(e,t,n)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return await this._selector(e,t)===0}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch{const o="record received through pubsub is not valid";throw Pr.error(o),new L(o,"ERR_NOT_VALID_RECORD")}const n=new be(e);let s;try{s=await this._getLocal(n.uint8Array())}catch{return!0}return Ie(s,t)?!1:this._selectRecord(e,[s,t])}async _storeRecord(e,t,n){const s=new be("/"+A$(e),!1);await this._datastore.put(s,t,n),Pr(`record for ${S0(e)} was stored in the datastore`)}}const A0=U("ipfs:ipns:pubsub");class x4{constructor(e,t,n){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new efe(e,t,n,sv,YL,this._handleSubscriptionKey)}async put(e,t,n){try{await this._pubsubDs.put(e,t,n)}catch(s){throw A0.error(s),s}}async get(e,t){let n,s;try{n=await this._pubsubDs.get(e,t)}catch(o){s=o}const i=e.slice(0,Q3);if(R(i)===$2){const o=is.encode(e).substring(1),a=is.encode(e.slice(Q3)).substring(1);this._subscriptions[o]=a,A0(`subscribed to pubsub topic ${o}, id ${a}`)}if(s)throw s;return n}_handleSubscriptionKey(e){e instanceof Uint8Array&&(e=R(e,"base58btc"));const t=this._subscriptions[e];if(!t)throw T(new Error(`key ${e} does not correspond to a subscription`),"ERR_INVALID_KEY");try{return Ly(Ae(t))}catch(n){throw A0.error(n),n}}getSubscriptions(){return Object.values(this._subscriptions).filter(Boolean).map(t=>`${$2}${t}`)}async cancel(e){if(typeof e!="string")throw T(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");e.startsWith($2)&&(e=e.substring(Q3));const t=Object.keys(this._subscriptions).find(s=>this._subscriptions[s]===e);if(!t)return{canceled:!1};const n=M(t);return this._pubsubDs.unsubscribe(n),delete this._subscriptions[t],A0(`unsubscribed pubsub ${t}: ${e}`),{canceled:!0}}}var Uy;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.key=t.bytes();break;case 2:s.value=t.bytes();break;case 5:s.timeReceived=t.string();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(Uy||(Uy={}));function tfe(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),s=String(r.getUTCHours()).padStart(2,"0"),i=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${s}:${i}:${o}.${c}Z`}function rfe(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),u=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,u))}class os{constructor(e,t,n){N(this,"key");N(this,"value");N(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return Uy.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:tfe(this.timeReceived)}}static deserialize(e){const t=Uy.decode(e);return new os(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=rfe(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new os(e.key,e.value,t)}}const J3=U("ipfs:ipns:offline-datastore");class JL{constructor(e){this._datastore=e,this.stores=[]}async put(e,t,n){if(!(e instanceof Uint8Array))throw T(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(t instanceof Uint8Array))throw T(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let s;try{s=this._routingKey(e)}catch(o){throw J3.error(o),T(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const i=new os(e,t,new Date);await this._datastore.put(s,i.serialize(),n)}async get(e,t){if(!(e instanceof Uint8Array))throw T(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let n;try{n=this._routingKey(e)}catch(o){throw J3.error(o),T(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const s=await this._datastore.get(n,t);let i;try{i=os.deserialize(s)}catch(o){throw J3.error(o),o}return i.value}_routingKey(e){return new be("/dht/record/"+R(e,"base32"),!1)}}const nfe=U("ipfs:ipns:dht-datastore");class sfe{constructor(e){this._dht=e}async put(e,t,n){try{await jr(this._dht.put(e,t,n))}catch(s){throw nfe.error(s),s}}async get(e,t){for await(const n of this._dht.get(e,t))if(n.name==="VALUE")return n.value;throw Ro()}}function ife({libp2p:r,repo:e,peerId:t,options:n}){const s=[];let i;if(Be(n,"EXPERIMENTAL.ipnsPubsub",!1)&&(i=new x4(r.pubsub,e.datastore,t),s.push(i)),Be(n,"offline",!1)!==!0&&["dht","dhtclient","dhtserver"].includes(Be(n,"config.Routing.Type","none"))&&s.push(new sfe(r.dht)),Be(n,"offline",!1)||s.length===0){const o=new JL(e.datastore);s.push(o)}return new Gde(s)}const ofe=U("ipfs:components:ipns");class afe{constructor(e={pass:""}){this.options=e,this.offline=null,this.online=null}getIPNS(){const e=this.online||this.offline;if(e)return e;throw new bp}get routing(){return this.getIPNS().routing}startOffline({repo:e,peerId:t,keychain:n}){if(this.offline!=null)throw new Bl;ofe("initializing IPNS keyspace (offline)");const s=new JL(e.datastore),i=new _$(s,e.datastore,t,n,this.options);this.offline=i}async startOnline({libp2p:e,repo:t,peerId:n,keychain:s}){if(this.online!=null)throw new Bl;const i=ife({libp2p:e,repo:t,peerId:n,options:this.options}),o=new _$(i,t.datastore,n,s,this.options);await o.republisher.start(),this.online=o}async stop(){const e=this.online;e&&(await e.republisher.stop(),this.online=null)}publish(e,t,n,s){return this.getIPNS().publish(e,t,n,s)}resolve(e,t){return this.getIPNS().resolve(e,t)}initializeKeyspace(e,t,n){return this.getIPNS().initializeKeyspace(e,t,n)}}async function cfe({ipns:r,repo:e,codecs:t},n,s){if(TN(n))return r.resolve(n);const{cid:i,path:o}=Sp(n);await jr(I1(i,o||"",t,e,s))}const Z3=U("ipfs:name:publish");function lfe({ipns:r,repo:e,codecs:t,peerId:n,isOnline:s,keychain:i}){const o=async c=>{let u;if(c==="self"&&n.privateKey!=null)u=await ba(n.privateKey);else try{const l=await i.exportKey(c,"temp");u=await Yu(l,"temp")}catch(l){throw Z3.error(l),T(l,"ERR_CANNOT_GET_KEY")}return vi(u.public.bytes,u.bytes)};async function a(c,u={}){const l=u.resolve!==!1,h=u.lifetime||"24h",f=u.key||"self";if(!s())throw T(new Error(kN),"OFFLINE_ERROR");try{c=Mie(c)}catch(w){throw Z3.error(w),w}let y=0;try{y=Te(h)||0,y=parseFloat(y.toFixed(6))}catch(w){throw Z3.error(w),w}const d=await Promise.all([o(f),l?cfe({ipns:r,repo:e,codecs:t},c):Promise.resolve()]),p=M(c),b=await r.publish(d[0],p,y,u);return{name:b.name,value:R(b.value)}}return Y(a)}var ufe=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i,hfe=function(e,t){if(t==null&&(t=!1),e.length<2||e.length>255)return!1;var n=e[e.length-1];if(t){if(n!==".")return!1}else if(n===".")return!1;return ufe.test(e)};const dfe=Et(hfe),ffe=kt.bind({ignoreUndefined:!0}),pfe=U("ipfs:name:resolve"),$$=(r,e)=>e.length>0?r+"/"+e.join("/"):r;function yfe({dns:r,ipns:e,isOnline:t,options:{offline:n}}){async function*s(i,o={}){if(o=ffe({nocache:!1,recursive:!0},o),n&&o&&o.nocache)throw T(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!t()&&!n)throw T(new Error(kN),"OFFLINE_ERROR");let a=i.toString();a.startsWith("/ipns/")||(a=`/ipns/${a}`);let[c,u,...l]=a.slice(1).split("/");try{if(u.substring(0,1)==="1"){const f=Ae(u),y=wE(f.toBytes());u=we.createV1(114,y).toString(fy)}else{const f=we.parse(u);f.version===1&&(u=f.toString(fy))}}catch(f){if(dfe(u)){yield $$(await r(u,o),l);return}throw pfe.error(f),T(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}const h=await e.resolve(`/${c}/${u}`,o);yield $$(h instanceof Uint8Array?R(h):h,l)}return Y(s)}function iv(r,e){if(!r||!(e&&e.ipnsPubsub))throw T(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(r.routing instanceof x4)return r.routing;const t=(r.routing.stores||[]).find(n=>n instanceof x4);if(!t)throw T(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return t}function gfe({ipns:r,options:e}){const t=e.EXPERIMENTAL;async function n(s,i={}){return iv(r,t).cancel(s,i)}return Y(n)}function wfe({ipns:r,options:e}){const t=e.EXPERIMENTAL;async function n(s={}){try{return{enabled:!!iv(r,t)}}catch{return{enabled:!1}}}return Y(n)}function bfe({ipns:r,options:e}){const t=e.EXPERIMENTAL;async function n(s={}){return iv(r,t).getSubscriptions(s)}return Y(n)}class mfe{constructor({ipns:e,options:t}){this.cancel=gfe({ipns:e,options:t}),this.state=wfe({ipns:e,options:t}),this.subs=bfe({ipns:e,options:t})}}class Efe{constructor({dns:e,ipns:t,repo:n,codecs:s,peerId:i,isOnline:o,keychain:a,options:c}){this.publish=lfe({ipns:t,repo:n,codecs:s,peerId:i,isOnline:o,keychain:a}),this.resolve=yfe({dns:e,ipns:t,isOnline:o,options:c}),this.pubsub=new mfe({ipns:t,options:c})}}const vfe=Ro().code,D4={default:"<dst>",edges:"<src> -> <dst>"};function _fe({repo:r,codecs:e,resolve:t,preload:n}){async function*s(i,o={}){if(o.maxDepth===0)return;if(o.edges&&o.format&&o.format!==D4.default)throw new Error("Cannot set edges to true and also specify format");if(o.format=o.edges?D4.edges:o.format,typeof o.maxDepth!="number"&&(o.maxDepth=o.recursive?1/0:1),o.timeout){const l=[new Xt.TimeoutController(o.timeout).signal];o.signal&&l.push(o.signal),o.signal=Io(l)}const c=(Array.isArray(i)?i:[i]).map(u=>Sfe(n,u,o));for(const u of c)try{yield*Afe(t,r,e,u,o)}catch(l){yield{ref:"",err:l.message}}}return s}function Sfe(r,e,t){const{cid:n,path:s}=Sp(e);return t.preload!==!1&&r(n),`/ipfs/${n}${s||""}`}async function*Afe(r,e,t,n,s){const i=await r(n,s),{cid:o}=Sp(i),a=s.maxDepth!=null?s.maxDepth:1/0,c=s.unique||!1;for await(const u of Tfe(e,t,o,a,c,s))u.parent&&(u.isDuplicate||(yield{ref:$fe(u.parent.cid,u.node.cid,u.node.name,s.format)}))}function $fe(r,e,t="",n=D4.default){let s=n.replace(/<src>/g,r.toString());return s=s.replace(/<dst>/g,e.toString()),s=s.replace(/<linkname>/g,t),s}async function*Tfe(r,e,t,n,s,i){const o=new Set;async function*a(c,u){const l=u+1;if(!(l>n))try{for await(const h of Ife(r,e,c.cid,i))yield{parent:c,node:h,isDuplicate:s&&o.has(h.cid.toString())},s&&o.add(h.cid.toString()),yield*a(h,l)}catch(h){throw h.code===vfe&&(h.message=`Could not find object with CID: ${c.cid}`),h}}yield*a({cid:t},0)}async function*Ife(r,e,t,n){const s=await r.blocks.get(t,n),o=(await e.getCodec(t.code)).decode(s),a=t.code===jt,c=[];for(const[u,l]of P4(o,c)){if(a){const h=u.match(/^Links\/(\d+)\/Hash$/);if(h){const f=Number(h[1]);if(f<o.Links.length){yield{name:o.Links[f].Name,cid:l};continue}}}yield{name:u,cid:l}}}const P4=function*(r,e){if(r!=null&&!(r instanceof Uint8Array)){for(const[t,n]of Object.entries(r)){const s=[...e,t];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(const[i,o]of n.entries()){const a=[...s,i],c=we.asCID(o);c?yield[a.join("/"),c]:typeof o=="object"&&(yield*P4(o,a))}else{const i=we.asCID(n);i?yield[s.join("/"),i]:yield*P4(n,s)}}return[]}};function Rfe({repo:r}){async function*e(t={}){for await(const n of r.blocks.queryKeys({},{signal:t.signal}))yield{ref:n.toString()}}return Y(e)}function Cfe({network:r}){async function e(t={}){const{bitswap:n}=await r.use(t),s=n.getWantlist();return Array.from(s).map(i=>i[1].cid)}return Y(e)}function xfe({network:r}){async function e(t,n={}){const{bitswap:s}=await r.use(n),i=s.wantlistForPeer(t);return Array.from(i).map(o=>o[1].cid)}return Y(e)}function Dfe({network:r}){async function e(t,n={}){const{bitswap:s}=await r.use(n);return Array.isArray(t)||(t=[t]),s.unwant(t)}return Y(e)}function ZL({network:r}){async function e(t={}){const n=(await r.use(t)).bitswap,s=n.stat().snapshot;return{provideBufLen:parseInt(s.providesBufferLength.toString()),blocksReceived:BigInt(s.blocksReceived.toString()),wantlist:Array.from(n.getWantlist()).map(i=>i[1].cid),peers:n.peers(),dupBlksReceived:BigInt(s.dupBlksReceived.toString()),dupDataReceived:BigInt(s.dupDataReceived.toString()),dataReceived:BigInt(s.dataReceived.toString()),blocksSent:BigInt(s.blocksSent.toString()),dataSent:BigInt(s.dataSent.toString())}}return Y(e)}class Pfe{constructor({network:e}){this.wantlist=Cfe({network:e}),this.wantlistForPeer=xfe({network:e}),this.unwant=Dfe({network:e}),this.stat=ZL({network:e})}}function Ofe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var kfe=Ofe,Nfe=kfe;const Lfe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},ov=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Mfe=r=>new TextEncoder().encode(r),Ufe=r=>new TextDecoder().decode(r);let Bfe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},zfe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return eM(this,e)}},Ffe=class{constructor(e){this.decoders=e}or(e){return eM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const eM=(r,e)=>new Ffe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Vfe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Bfe(e,t,n),this.decoder=new zfe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const yb=({name:r,prefix:e,encode:t,decode:n})=>new Vfe(r,e,t,n),Np=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=Nfe(t,e);return yb({prefix:r,name:e,encode:n,decode:i=>ov(s(i))})},jfe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Kfe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Qr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>yb({prefix:e,name:r,encode(s){return Kfe(s,n,t)},decode(s){return jfe(s,n,t,r)}}),Bi=Np({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),qfe=Np({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Hfe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Bi,base58flickr:qfe},Symbol.toStringTag,{value:"Module"}));var Gfe=tM,T$=128,Wfe=127,Qfe=~Wfe,Yfe=Math.pow(2,31);function tM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Yfe;)e[t++]=r&255|T$,r/=128;for(;r&Qfe;)e[t++]=r&255|T$,r>>>=7;return e[t]=r|0,tM.bytes=t-n+1,e}var Xfe=O4,Jfe=128,I$=127;function O4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw O4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&I$)<<s:(o&I$)*Math.pow(2,s),s+=7}while(o>=Jfe);return O4.bytes=i-n,t}var Zfe=Math.pow(2,7),e1e=Math.pow(2,14),t1e=Math.pow(2,21),r1e=Math.pow(2,28),n1e=Math.pow(2,35),s1e=Math.pow(2,42),i1e=Math.pow(2,49),o1e=Math.pow(2,56),a1e=Math.pow(2,63),c1e=function(r){return r<Zfe?1:r<e1e?2:r<t1e?3:r<r1e?4:r<n1e?5:r<s1e?6:r<i1e?7:r<o1e?8:r<a1e?9:10},l1e={encode:Gfe,decode:Xfe,encodingLength:c1e},By=l1e;const k4=(r,e=0)=>[By.decode(r,e),By.decode.bytes],zy=(r,e,t=0)=>(By.encode(r,e,t),e),Fy=r=>By.encodingLength(r),u1e=(r,e)=>{const t=e.byteLength,n=Fy(r),s=n+Fy(t),i=new Uint8Array(s+t);return zy(r,i,0),zy(t,i,n),i.set(e,s),new av(r,t,e,i)},rM=r=>{const e=ov(r),[t,n]=k4(e),[s,i]=k4(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new av(t,s,o,e)},h1e=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Lfe(r.bytes,t.bytes)}};let av=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const Rl=Qr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),d1e=Qr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),f1e=Qr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),p1e=Qr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),y1e=Qr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),g1e=Qr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),w1e=Qr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),b1e=Qr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),m1e=Qr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),E1e=Object.freeze(Object.defineProperty({__proto__:null,base32:Rl,base32hex:y1e,base32hexpad:w1e,base32hexpadupper:b1e,base32hexupper:g1e,base32pad:f1e,base32padupper:p1e,base32upper:d1e,base32z:m1e},Symbol.toStringTag,{value:"Module"})),R$=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return _1e(t,N4(r),e||Bi.encoder);default:return S1e(t,N4(r),e||Rl.encoder)}},C$=new WeakMap,N4=r=>{const e=C$.get(r);if(e==null){const t=new Map;return C$.set(r,t),t}return e};let nM=class Pn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Nd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==A1e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Pn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=u1e(e,t);return Pn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Pn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&h1e(e.multihash,n.multihash)}toString(e){return R$(this,e)}toJSON(){return{"/":R$(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Pn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Pn(n,s,i,o||x$(n,s,i.bytes))}else if(t[$1e]===!0){const{version:n,multihash:s,code:i}=t,o=rM(s);return Pn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Nd)throw new Error(`Version 0 CID must use dag-pb (code: ${Nd}) block encoding`);return new Pn(e,t,n,n.bytes)}case 1:{const s=x$(e,t,n.bytes);return new Pn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Pn.create(0,Nd,e)}static createV1(e,t){return Pn.create(1,e,t)}static decode(e){const[t,n]=Pn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Pn.inspectBytes(e),n=t.size-t.multihashSize,s=ov(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new av(t.multihashCode,t.digestSize,i,s);return[t.version===0?Pn.createV0(o):Pn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=k4(e.subarray(t));return t+=f,h};let s=n(),i=Nd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=v1e(e,t),i=Pn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return N4(i).set(n,e),i}};const v1e=(r,e)=>{switch(r[0]){case"Q":{const t=e||Bi;return[Bi.prefix,t.decode(`${Bi.prefix}${r}`)]}case Bi.prefix:{const t=e||Bi;return[Bi.prefix,t.decode(r)]}case Rl.prefix:{const t=e||Rl;return[Rl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},_1e=(r,e,t)=>{const{prefix:n}=t;if(n!==Bi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},S1e=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Nd=112,A1e=18,x$=(r,e,t)=>{const n=Fy(r),s=n+Fy(e),i=new Uint8Array(s+t.byteLength);return zy(r,i,0),zy(e,i,n),i.set(t,s),i},$1e=Symbol.for("@ipld/js-cid/CID"),T1e=Math.pow(2,7),I1e=Math.pow(2,14),R1e=Math.pow(2,21),cv=Math.pow(2,28),lv=Math.pow(2,35),uv=Math.pow(2,42),hv=Math.pow(2,49),at=128,Xn=127;function qc(r){if(r<T1e)return 1;if(r<I1e)return 2;if(r<R1e)return 3;if(r<cv)return 4;if(r<lv)return 5;if(r<uv)return 6;if(r<hv)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function C1e(r,e,t=0){switch(qc(r)){case 8:e[t++]=r&255|at,r/=128;case 7:e[t++]=r&255|at,r/=128;case 6:e[t++]=r&255|at,r/=128;case 5:e[t++]=r&255|at,r/=128;case 4:e[t++]=r&255|at,r>>>=7;case 3:e[t++]=r&255|at,r>>>=7;case 2:e[t++]=r&255|at,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function x1e(r,e,t=0){switch(qc(r)){case 8:e.set(t++,r&255|at),r/=128;case 7:e.set(t++,r&255|at),r/=128;case 6:e.set(t++,r&255|at),r/=128;case 5:e.set(t++,r&255|at),r/=128;case 4:e.set(t++,r&255|at),r>>>=7;case 3:e.set(t++,r&255|at),r>>>=7;case 2:e.set(t++,r&255|at),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function D1e(r,e){let t=r[e],n=0;if(n+=t&Xn,t<at||(t=r[e+1],n+=(t&Xn)<<7,t<at)||(t=r[e+2],n+=(t&Xn)<<14,t<at)||(t=r[e+3],n+=(t&Xn)<<21,t<at)||(t=r[e+4],n+=(t&Xn)*cv,t<at)||(t=r[e+5],n+=(t&Xn)*lv,t<at)||(t=r[e+6],n+=(t&Xn)*uv,t<at)||(t=r[e+7],n+=(t&Xn)*hv,t<at))return n;throw new RangeError("Could not decode varint")}function P1e(r,e){let t=r.get(e),n=0;if(n+=t&Xn,t<at||(t=r.get(e+1),n+=(t&Xn)<<7,t<at)||(t=r.get(e+2),n+=(t&Xn)<<14,t<at)||(t=r.get(e+3),n+=(t&Xn)<<21,t<at)||(t=r.get(e+4),n+=(t&Xn)*cv,t<at)||(t=r.get(e+5),n+=(t&Xn)*lv,t<at)||(t=r.get(e+6),n+=(t&Xn)*uv,t<at)||(t=r.get(e+7),n+=(t&Xn)*hv,t<at))return n;throw new RangeError("Could not decode varint")}function gb(r,e,t=0){return e==null&&(e=$o(qc(r))),e instanceof Uint8Array?C1e(r,e,t):x1e(r,e,t)}function Lp(r,e=0){return r instanceof Uint8Array?D1e(r,e):P1e(r,e)}const O1e=yb({prefix:"\0",name:"identity",encode:r=>Ufe(r),decode:r=>Mfe(r)}),k1e=Object.freeze(Object.defineProperty({__proto__:null,identity:O1e},Symbol.toStringTag,{value:"Module"})),N1e=Qr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),L1e=Object.freeze(Object.defineProperty({__proto__:null,base2:N1e},Symbol.toStringTag,{value:"Module"})),M1e=Qr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),U1e=Object.freeze(Object.defineProperty({__proto__:null,base8:M1e},Symbol.toStringTag,{value:"Module"})),B1e=Np({prefix:"9",name:"base10",alphabet:"0123456789"}),z1e=Object.freeze(Object.defineProperty({__proto__:null,base10:B1e},Symbol.toStringTag,{value:"Module"})),F1e=Qr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),V1e=Qr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),j1e=Object.freeze(Object.defineProperty({__proto__:null,base16:F1e,base16upper:V1e},Symbol.toStringTag,{value:"Module"})),K1e=Np({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),q1e=Np({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),H1e=Object.freeze(Object.defineProperty({__proto__:null,base36:K1e,base36upper:q1e},Symbol.toStringTag,{value:"Module"})),G1e=Qr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),W1e=Qr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Q1e=Qr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Y1e=Qr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),X1e=Object.freeze(Object.defineProperty({__proto__:null,base64:G1e,base64pad:W1e,base64url:Q1e,base64urlpad:Y1e},Symbol.toStringTag,{value:"Module"})),sM=Array.from(""),J1e=sM.reduce((r,e,t)=>(r[t]=e,r),[]),Z1e=sM.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function epe(r){return r.reduce((e,t)=>(e+=J1e[t],e),"")}function tpe(r){const e=[];for(const t of r){const n=Z1e[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const rpe=yb({prefix:"",name:"base256emoji",encode:epe,decode:tpe}),npe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:rpe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const spe={...k1e,...L1e,...U1e,...z1e,...j1e,...E1e,...H1e,...Hfe,...X1e,...npe},D$=mi,ipe=Ei,iM=function(r){let e=0;if(r=r.toString().trim(),D$(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(ipe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=D$(t[n]);let o;i&&(o=iM(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},ope=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Fs=-1,N1={},L4={},ape=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Fs,"ip6zone"],[43,8,"ipcidr"],[53,Fs,"dns",!0],[54,Fs,"dns4",!0],[55,Fs,"dns6",!0],[56,Fs,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Fs,"unix",!1,!0],[421,Fs,"ipfs"],[421,Fs,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Fs,"garlic64"],[448,0,"tls"],[449,Fs,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Fs,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Fs,"memory"]];ape.forEach(r=>{const e=cpe(...r);L4[e.code]=e,N1[e.name]=e});function cpe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function Gt(r){if(typeof r=="number"){if(L4[r]!=null)return L4[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(N1[r]!=null)return N1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}Gt("ip4");Gt("ip6");Gt("ipcidr");function oM(r,e){switch(Gt(r).code){case 4:case 41:return upe(e);case 42:return N$(e);case 6:case 273:case 33:case 132:return aM(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return N$(e);case 421:return ppe(e);case 444:return L$(e);case 445:return L$(e);case 466:return fpe(e);default:return R(e,"base16")}}function P$(r,e){switch(Gt(r).code){case 4:return O$(e);case 41:return O$(e);case 42:return k$(e);case 6:case 273:case 33:case 132:return dv(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return k$(e);case 421:return hpe(e);case 444:return ype(e);case 445:return gpe(e);case 466:return dpe(e);default:return M(e,"base16")}}const e6=Object.values(spe).map(r=>r.decoder),lpe=function(){let r=e6[0].or(e6[1]);return e6.slice(2).forEach(e=>r=r.or(e)),r}();function O$(r){if(!Nt(r))throw new Error("invalid ip address");return iM(r)}function upe(r){const e=ope(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function dv(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function aM(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function k$(r){const e=M(r),t=Uint8Array.from(gb(e.length));return z([t,e],t.length+e.length)}function N$(r){const e=Lp(r);if(r=r.slice(qc(e)),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function hpe(r){let e;r[0]==="Q"||r[0]==="1"?e=rM(Bi.decode(`z${r}`)).bytes:e=nM.parse(r).multihash.bytes;const t=Uint8Array.from(gb(e.length));return z([t,e],t.length+e.length)}function dpe(r){const e=lpe.decode(r),t=Uint8Array.from(gb(e.length));return z([t,e],t.length+e.length)}function fpe(r){const e=Lp(r),t=r.slice(qc(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function ppe(r){const e=Lp(r),t=r.slice(qc(e));if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function ype(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Rl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=dv(n);return z([t,s],t.length+s.length)}function gpe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Rl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=dv(n);return z([t,s],t.length+s.length)}function L$(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=aM(t);return`${n}:${s}`}function wpe(r){r=M4(r);const e=[],t=[];let n=null;const s=r.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){const o=s[i],a=Gt(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw uM("invalid address: "+r);if(a.path===!0){n=M4(s.slice(i).join("/")),e.push([a.code,P$(a.code,n)]),t.push([a.code,n]);break}const c=P$(a.code,s[i]);e.push([a.code,c]),t.push([a.code,oM(a.code,c)])}return{string:cM(t),bytes:lM(e),tuples:e,stringTuples:t,path:n}}function M$(r){const e=[],t=[];let n=null,s=0;for(;s<r.length;){const i=Lp(r,s),o=qc(i),a=Gt(i),c=bpe(a,r.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}const u=r.slice(s+o,s+o+c);if(s+=c+o,s>r.length)throw uM("Invalid address Uint8Array: "+R(r,"base16"));e.push([i,u]);const l=oM(i,u);if(t.push([i,l]),a.path===!0){n=l;break}}return{bytes:Uint8Array.from(r),string:cM(t),tuples:e,stringTuples:t,path:n}}function cM(r){const e=[];return r.map(t=>{const n=Gt(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),M4(e.join("/"))}function lM(r){return z(r.map(e=>{const t=Gt(e[0]);let n=Uint8Array.from(gb(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n}))}function bpe(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=Lp(e instanceof Uint8Array?e:Uint8Array.from(e));return t+qc(t)}}function M4(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function uM(r){return new Error("Error parsing address: "+r)}const mpe=Symbol.for("nodejs.util.inspect.custom"),Epe=[Gt("dns").code,Gt("dns4").code,Gt("dns6").code,Gt("dnsaddr").code],vpe=new Map,hM=Symbol.for("@multiformats/js-multiaddr/multiaddr");function _pe(r){return!!r?.[hM]}var ph,lc,np,sp,ont,na;let Spe=(na=class{constructor(e){N(this,"bytes");ar(this,ph,void 0);ar(this,lc,void 0);ar(this,np,void 0);ar(this,sp,void 0);N(this,ont,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=M$(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=wpe(e)}else if(_pe(e))t=M$(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,Dt(this,ph,t.string),Dt(this,lc,t.tuples),Dt(this,np,t.stringTuples),Dt(this,sp,t.path)}toString(){return ve(this,ph)}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=Gt("tcp"),a=Gt("udp"),c=Gt("ip4"),u=Gt("ip6"),l=Gt("dns6"),h=Gt("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),Epe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=Gt(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=Gt(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return ve(this,lc).map(([e])=>Object.assign({},Gt(e)))}protoCodes(){return ve(this,lc).map(([e])=>e)}protoNames(){return ve(this,lc).map(([e])=>Gt(e).name)}tuples(){return ve(this,lc)}stringTuples(){return ve(this,np)}encapsulate(e){return e=new na(e),new na(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new na(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new na(lM(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,s])=>{n===N1.p2p.code&&e.push([n,s]),n===N1["p2p-circuit"].code&&(e=[])});const t=e.pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Bi.decode(`z${n}`),"base58btc"):R(nM.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ve(this,sp)}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=vpe.get(t.name);if(n==null)throw new Bw(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new na(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(ont=hM,mpe)](){return`Multiaddr(${ve(this,ph)})`}},ph=new WeakMap,lc=new WeakMap,np=new WeakMap,sp=new WeakMap,na);function dM(r){return new Spe(r)}const Ape=me("dns4"),$pe=me("dns6"),Tpe=me("dnsaddr"),jl=us(me("dns"),Tpe,Ape,$pe),wb=us(me("ip4"),me("ip6")),Ch=us(Pe(wb,me("tcp")),Pe(jl,me("tcp"))),fv=Pe(wb,me("udp")),Ipe=Pe(fv,me("utp")),Rpe=Pe(fv,me("quic")),U4=us(Pe(Ch,me("ws")),Pe(jl,me("ws"))),B4=us(Pe(Ch,me("wss")),Pe(jl,me("wss")),Pe(Ch,me("tls"),me("ws")),Pe(jl,me("tls"),me("ws"))),z4=us(Pe(Ch,me("http")),Pe(wb,me("http")),Pe(jl,me("http"))),F4=us(Pe(Ch,me("https")),Pe(wb,me("https")),Pe(jl,me("https"))),U$=Pe(fv,me("webrtc"),me("certhash")),fM=us(Pe(U$,me("p2p")),U$),pM=us(Pe(U4,me("p2p-webrtc-star"),me("p2p")),Pe(B4,me("p2p-webrtc-star"),me("p2p")),Pe(U4,me("p2p-webrtc-star")),Pe(B4,me("p2p-webrtc-star"))),yM=us(Pe(z4,me("p2p-webrtc-direct"),me("p2p")),Pe(F4,me("p2p-webrtc-direct"),me("p2p")),Pe(z4,me("p2p-webrtc-direct")),Pe(F4,me("p2p-webrtc-direct"))),V4=us(U4,B4,z4,F4,pM,yM,Ch,Ipe,Rpe,jl,fM),pc=us(Pe(V4,me("p2p")),pM,yM,fM,me("p2p")),B$=us(Pe(pc,me("p2p-circuit"),pc),Pe(pc,me("p2p-circuit")),Pe(me("p2p-circuit"),pc),Pe(V4,me("p2p-circuit")),Pe(me("p2p-circuit"),V4),me("p2p-circuit")),gM=()=>us(Pe(B$,gM),B$),Ld=gM(),Cpe=us(Pe(Ld,pc,Ld),Pe(pc,Ld),Pe(Ld,pc),Ld,pc),xpe=Cpe;function wM(r){function e(t){let n;try{n=dM(t)}catch{return!1}const s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return e}function Pe(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(s=>(n=typeof s=="function"?s().partialMatch(t):s.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:wM(e),partialMatch:e}}function us(...r){function e(n){let s=null;return r.some(i=>{const o=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return o!=null?(s=o,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:wM(e),partialMatch:e}}function me(r){const e=r;function t(s){let i;try{i=dM(s)}catch{return!1}const o=i.protoNames();return o.length===1&&o[0]===e}function n(s){return s.length===0?null:s[0]===e?s.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}function bM(r){try{return xpe.matches(r)}catch{return!1}}function Dpe({repo:r}){async function e(t,n={}){if(!bM(t))throw new Error(`${t} is not a valid Multiaddr`);const s=await r.config.getAll(n),i=s.Bootstrap||[];return i.push(t.toString()),s.Bootstrap=Array.from(new Set(i)).sort((o,a)=>o.localeCompare(a)),await r.config.replace(s),{Peers:[t]}}return Y(e)}const z$=mi,Ppe=Ei,mM=function(r){let e=0;if(r=r.toString().trim(),z$(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Ppe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=z$(t[n]);let o;i&&(o=mM(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},Ope=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Vs=-1,Vy={},j4={},kpe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Vs,"ip6zone"],[43,8,"ipcidr"],[53,Vs,"dns",!0],[54,Vs,"dns4",!0],[55,Vs,"dns6",!0],[56,Vs,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Vs,"unix",!1,!0],[421,Vs,"ipfs"],[421,Vs,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Vs,"garlic64"],[448,0,"tls"],[449,Vs,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Vs,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Vs,"memory"]];kpe.forEach(r=>{const e=Npe(...r);j4[e.code]=e,Vy[e.name]=e});function Npe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function wr(r){if(typeof r=="number"){if(j4[r]!=null)return j4[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Vy[r]!=null)return Vy[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}function Lpe(r,e){switch(wr(r).code){case 4:case 41:return Bpe(e);case 42:return j$(e);case 6:case 273:case 33:case 132:return EM(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return j$(e);case 421:return jpe(e);case 444:return K$(e);case 445:return K$(e);case 466:return Vpe(e);default:return R(e,"base16")}}function Mpe(r,e){switch(wr(r).code){case 4:return F$(e);case 41:return F$(e);case 42:return V$(e);case 6:case 273:case 33:case 132:return pv(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return V$(e);case 421:return zpe(e);case 444:return Kpe(e);case 445:return qpe(e);case 466:return Fpe(e);default:return M(e,"base16")}}const t6=Object.values(lN).map(r=>r.decoder),Upe=function(){let r=t6[0].or(t6[1]);return t6.slice(2).forEach(e=>r=r.or(e)),r}();function F$(r){if(!Nt(r))throw new Error("invalid ip address");return mM(r)}function Bpe(r){const e=Ope(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function pv(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function EM(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function V$(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function j$(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function zpe(r){let e;r[0]==="Q"||r[0]==="1"?e=wE(is.decode(`z${r}`)).bytes:e=we.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function Fpe(r){const e=Upe.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function Vpe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function jpe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function Kpe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Al.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=pv(n);return z([t,s],t.length+s.length)}function qpe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Al.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=pv(n);return z([t,s],t.length+s.length)}function K$(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=EM(t);return`${n}:${s}`}function Hpe(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=wr(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw AM("invalid address: "+r);if(i.path===!0){e.push([s,gv(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function Gpe(r){const e=[];return r.map(t=>{const n=bb(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),gv(e.join("/"))}function Wpe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=bb(e);return e.length>1?[t.code,Mpe(t.code,e[1])]:[t.code]})}function vM(r){return r.map(e=>{const t=bb(e);return e[1]!=null?[t.code,Lpe(t.code,e[1])]:[t.code]})}function _M(r){return K4(z(r.map(e=>{const t=bb(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function SM(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function yv(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=wr(n),o=SM(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw AM("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function q$(r){const e=yv(r),t=vM(e);return Gpe(t)}function Qpe(r){r=gv(r);const e=Hpe(r),t=Wpe(e);return _M(t)}function Ype(r){return Qpe(r)}function K4(r){const e=Xpe(r);if(e!=null)throw e;return Uint8Array.from(r)}function Xpe(r){try{yv(r)}catch(e){return e}}function gv(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function AM(r){return new Error("Error parsing address: "+r)}function bb(r){return wr(r[0])}var Au=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},r6=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Md,Ud,Bd,H$;const Jpe=Symbol.for("nodejs.util.inspect.custom"),Zpe=[wr("dns").code,wr("dns4").code,wr("dns6").code,wr("dnsaddr").code],e0e=new Map,$M=Symbol.for("@multiformats/js-multiaddr/multiaddr");function t0e(r){return!!r?.[$M]}let r0e=class Fu{constructor(e){if(Md.set(this,void 0),Ud.set(this,void 0),Bd.set(this,void 0),this[H$]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=K4(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Ype(e)}else if(t0e(e))this.bytes=K4(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Au(this,Md,"f")==null&&r6(this,Md,q$(this.bytes),"f"),Au(this,Md,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=wr("tcp"),a=wr("udp"),c=wr("ip4"),u=wr("ip6"),l=wr("dns6"),h=wr("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),Zpe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=wr(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=wr(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},wr(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=wr(s),a=SM(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Au(this,Ud,"f")==null&&r6(this,Ud,yv(this.bytes),"f"),Au(this,Ud,"f")}stringTuples(){return Au(this,Bd,"f")==null&&r6(this,Bd,vM(this.tuples()),"f"),Au(this,Bd,"f")}encapsulate(e){return e=new Fu(e),new Fu(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Fu(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Fu(_M(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===Vy.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(is.decode(`z${n}`),"base58btc"):R(we.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>wr(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=e0e.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new Fu(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Md=new WeakMap,Ud=new WeakMap,Bd=new WeakMap,H$=$M,Jpe)](){return`Multiaddr(${q$(this.bytes)})`}};function ld(r){return new r0e(r)}function n0e({repo:r}){async function e(t={}){const n=await r.config.getAll(t),s=n.Bootstrap||[];return n.Bootstrap=[],await r.config.replace(n),{Peers:s.map(i=>ld(i))}}return Y(e)}function s0e({repo:r}){async function e(t={}){return{Peers:(await r.config.get("Bootstrap",t)||[]).map(s=>ld(s))}}return Y(e)}const ch=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}});function i0e({repo:r}){async function e(t={}){const n=await r.config.getAll(t);return n.Bootstrap=ch().Bootstrap,await r.config.replace(n),{Peers:ch().Bootstrap.map(s=>ld(s))}}return Y(e)}function o0e({repo:r}){async function e(t,n={}){if(!bM(t))throw new Error(`${t} is not a valid Multiaddr`);const s=await r.config.getAll(n);return s.Bootstrap=(s.Bootstrap||[]).filter(i=>i.toString()!==t.toString()),await r.config.replace(s),{Peers:[t]}}return Y(e)}class a0e{constructor({repo:e}){this.add=Dpe({repo:e}),this.list=s0e({repo:e}),this.rm=o0e({repo:e}),this.clear=n0e({repo:e}),this.reset=i0e({repo:e})}}function c0e({preload:r,repo:e}){async function t(n,s={}){return s.preload!==!1&&r(n),e.blocks.get(n,s)}return Y(t)}function l0e({codecs:r,hashers:e,repo:t,preload:n}){async function s(i,o={}){const a=o.pin?await t.gcLock.readLock():null;try{const c=o.version!=null?o.version:0,u=o.format||(c===0?"dag-pb":"raw"),h=await(await e.getHasher(o.mhtype||"sha2-256")).digest(i),f=await r.getCodec(u),y=we.create(c,f.code,h);return await t.blocks.put(y,i,{signal:o.signal}),o.preload!==!1&&n(y),o.pin===!0&&await t.pins.pinRecursively(y,{signal:o.signal}),y}finally{a&&a()}}return Y(s)}const $0=globalThis.CustomEvent??Event;async function*mb(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered==null?!1:e.ordered,s=new EventTarget,i=[];let o=pt(),a=pt(),c=!1,u,l=!1;s.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const d of r){if(i.length===t&&(o=pt(),await o.promise),l)break;const p={done:!1};i.push(p),d().then(b=>{p.done=!0,p.ok=!0,p.value=b,s.dispatchEvent(new $0("task-complete"))},b=>{p.done=!0,p.err=b,s.dispatchEvent(new $0("task-complete"))})}c=!0,s.dispatchEvent(new $0("task-complete"))}catch(d){u=d,s.dispatchEvent(new $0("task-complete"))}});function h(){return n?i[0]?.done:!!i.find(d=>d.done)}function*f(){for(;i.length>0&&i[0].done;){const d=i[0];if(i.shift(),d.ok)yield d.value;else throw l=!0,o.resolve(),d.err;o.resolve()}}function*y(){for(;h();)for(let d=0;d<i.length;d++)if(i[d].done){const p=i[d];if(i.splice(d,1),d--,p.ok)yield p.value;else throw l=!0,o.resolve(),p.err;o.resolve()}}for(;;){if(h()||(a=pt(),await a.promise),u!=null)throw u;if(n?yield*f():yield*y(),c&&i.length===0)break}}function TM(r){return r instanceof Uint8Array?we.decode(r):we.parse(r.toString())}const u0e=8;function h0e({repo:r}){async function*e(t,n={}){Array.isArray(t)||(t=[t]);const s=await r.gcLock.writeLock();try{yield*Ve(t,i=>ls(i,o=>async()=>{o=TM(o);const a={cid:o};try{if(!await r.blocks.has(o))throw T(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await r.blocks.delete(o)}catch(c){n.force||(c.message=`cannot remove ${o}: ${c.message}`,a.error=c)}return a}),i=>mb(i,{concurrency:u0e}),i=>Yt(i,()=>!n.quiet))}finally{s()}}return Y(e)}function d0e({repo:r,preload:e}){async function t(n,s={}){n=TM(n),s.preload!==!1&&e(n);const i=await r.blocks.get(n);return{cid:n,size:i.length}}return Y(t)}class f0e{constructor({codecs:e,hashers:t,preload:n,repo:s}){this.get=c0e({preload:n,repo:s}),this.put=l0e({codecs:e,hashers:t,preload:n,repo:s}),this.rm=h0e({repo:s}),this.stat=d0e({preload:n,repo:s})}}async function*Kl(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}function p0e(r){return typeof r.stream=="function"?Kl(r.stream()):Kl(new Response(r).body)}function Mp(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:s=>{n.push(s)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function Bc(r){return ArrayBuffer.isView(r)||r instanceof ArrayBuffer}function L1(r){return r.constructor&&(r.constructor.name==="Blob"||r.constructor.name==="File")&&typeof r.stream=="function"}function q4(r){return typeof r=="object"&&(r.path||r.content)}const M1=r=>r&&typeof r.getReader=="function";async function*T0(r){yield r}async function IM(r){if(Bc(r))return T0(n6(r));if(typeof r=="string"||r instanceof String)return T0(n6(r.toString()));if(L1(r))return p0e(r);if(M1(r)&&(r=Kl(r)),Symbol.iterator in r||Symbol.asyncIterator in r){const e=Mp(r),{value:t,done:n}=await e.peek();if(n)return T0(new Uint8Array(0));if(e.push(t),Number.isInteger(t))return T0(Uint8Array.from(await Kc(e)));if(Bc(t)||typeof t=="string"||t instanceof String)return ls(e,n6)}throw T(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}function n6(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new Uint8Array(r):Array.isArray(r)?Uint8Array.from(r):M(r.toString())}async function*y0e(r,e){if(r==null)throw T(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT");if(typeof r=="string"||r instanceof String){yield I0(r.toString(),e);return}if(Bc(r)||L1(r)){yield I0(r,e);return}if(M1(r)&&(r=Kl(r)),Symbol.iterator in r||Symbol.asyncIterator in r){const t=Mp(r),{value:n,done:s}=await t.peek();if(s){yield{content:[]};return}if(t.push(n),Number.isInteger(n)||Bc(n)||typeof n=="string"||n instanceof String){yield I0(t,e);return}throw T(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(q4(r)){yield I0(r,e);return}throw T(new Error('Unexpected input: cannot convert "'+typeof r+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT")}async function I0(r,e){const{path:t,mode:n,mtime:s,content:i}=r,o={path:t||"",mode:sh(n),mtime:_1(s)};return i?o.content=await e(i):t||(o.content=await e(r)),o}function RM(r){return y0e(r,IM)}function g0e({addAll:r}){async function e(t,n={}){const s=await ks(r(RM(t),n));if(s==null)throw Error("Failed to add a file, if you see this please report a bug");return s}return e}async function*wv(r,e=1){let t=[];e<1&&(e=1);for await(const n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)}async function*bv(r,e=1){for await(const t of wv(r,e)){const n=t.map(async s=>await s().then(i=>({ok:!0,value:i}),i=>({ok:!1,err:i})));for(let s=0;s<n.length;s++){const i=await n[s];if(i.ok)yield i.value;else throw i.err}}}const w0e=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Up=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var b0e=CM,G$=128,m0e=127,E0e=~m0e,v0e=Math.pow(2,31);function CM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=v0e;)e[t++]=r&255|G$,r/=128;for(;r&E0e;)e[t++]=r&255|G$,r>>>=7;return e[t]=r|0,CM.bytes=t-n+1,e}var _0e=H4,S0e=128,W$=127;function H4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw H4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&W$)<<s:(o&W$)*Math.pow(2,s),s+=7}while(o>=S0e);return H4.bytes=i-n,t}var A0e=Math.pow(2,7),$0e=Math.pow(2,14),T0e=Math.pow(2,21),I0e=Math.pow(2,28),R0e=Math.pow(2,35),C0e=Math.pow(2,42),x0e=Math.pow(2,49),D0e=Math.pow(2,56),P0e=Math.pow(2,63),O0e=function(r){return r<A0e?1:r<$0e?2:r<T0e?3:r<I0e?4:r<R0e?5:r<C0e?6:r<x0e?7:r<D0e?8:r<P0e?9:10},k0e={encode:b0e,decode:_0e,encodingLength:O0e},jy=k0e;const G4=(r,e=0)=>[jy.decode(r,e),jy.decode.bytes],Ky=(r,e,t=0)=>(jy.encode(r,e,t),e),qy=r=>jy.encodingLength(r),W4=(r,e)=>{const t=e.byteLength,n=qy(r),s=n+qy(t),i=new Uint8Array(s+t);return Ky(r,i,0),Ky(t,i,n),i.set(e,s),new mv(r,t,e,i)},N0e=r=>{const e=Up(r),[t,n]=G4(e),[s,i]=G4(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new mv(t,s,o,e)},L0e=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&w0e(r.bytes,t.bytes)}};let mv=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const M0e=({name:r,code:e,encode:t})=>new U0e(r,e,t);let U0e=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?W4(this.code,t):t.then(n=>W4(this.code,n))}else throw Error("Unknown type, must be binary type")}};const B0e=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Q4=M0e({name:"sha2-256",code:18,encode:B0e("SHA-256")});var z0e=xM,Q$=128,F0e=127,V0e=~F0e,j0e=Math.pow(2,31);function xM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=j0e;)e[t++]=r&255|Q$,r/=128;for(;r&V0e;)e[t++]=r&255|Q$,r>>>=7;return e[t]=r|0,xM.bytes=t-n+1,e}var K0e=Y4,q0e=128,Y$=127;function Y4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Y4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&Y$)<<s:(o&Y$)*Math.pow(2,s),s+=7}while(o>=q0e);return Y4.bytes=i-n,t}var H0e=Math.pow(2,7),G0e=Math.pow(2,14),W0e=Math.pow(2,21),Q0e=Math.pow(2,28),Y0e=Math.pow(2,35),X0e=Math.pow(2,42),J0e=Math.pow(2,49),Z0e=Math.pow(2,56),e2e=Math.pow(2,63),t2e=function(r){return r<H0e?1:r<G0e?2:r<W0e?3:r<Q0e?4:r<Y0e?5:r<X0e?6:r<J0e?7:r<Z0e?8:r<e2e?9:10},r2e={encode:z0e,decode:K0e,encodingLength:t2e},DM=r2e;const X$=(r,e,t=0)=>(DM.encode(r,e,t),e),J$=r=>DM.encodingLength(r),n2e=new Uint8Array(0),s2e=r=>{const e=r.match(/../g);return e?new Uint8Array(e.map(t=>parseInt(t,16))):n2e},i2e=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Z$=(r,e)=>{const t=e.byteLength,n=J$(r),s=n+J$(t),i=new Uint8Array(s+t);return X$(r,i,0),X$(t,i,n),i.set(e,s),new o2e(r,t,e,i)};let o2e=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function a2e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var c2e=a2e,l2e=c2e;let u2e=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},h2e=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return PM(this,e)}},d2e=class{constructor(e){this.decoders=e}or(e){return PM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const PM=(r,e)=>new d2e({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let f2e=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new u2e(e,t,n),this.decoder=new h2e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const OM=({name:r,prefix:e,encode:t,decode:n})=>new f2e(r,e,t,n),kM=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=l2e(t,e);return OM({prefix:r,name:e,encode:n,decode:i=>i2e(s(i))})},p2e=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},y2e=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ea=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>OM({prefix:e,name:r,encode(s){return y2e(s,n,t)},decode(s){return p2e(s,n,t,r)}});kM({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});kM({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});Ea({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ea({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ea({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ea({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ea({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ea({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ea({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ea({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ea({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const g2e=({name:r,code:e,encode:t})=>new w2e(r,e,t);let w2e=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Z$(this.code,t):t.then(n=>Z$(this.code,n))}else throw Error("Unknown type, must be binary type")}};var X4={exports:{}};(function(r,e){(function(t,n){var s={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function i(p){if(!Array.isArray(p)&&!ArrayBuffer.isView(p))return!1;for(var b=0;b<p.length;b++)if(!Number.isInteger(p[b])||p[b]<0||p[b]>255)return!1;return!0}function o(p,b){return(p&65535)*b+(((p>>>16)*b&65535)<<16)}function a(p,b){return p<<b|p>>>32-b}function c(p){return p^=p>>>16,p=o(p,2246822507),p^=p>>>13,p=o(p,3266489909),p^=p>>>16,p}function u(p,b){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],b=[b[0]>>>16,b[0]&65535,b[1]>>>16,b[1]&65535];var w=[0,0,0,0];return w[3]+=p[3]+b[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=p[2]+b[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=p[1]+b[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=p[0]+b[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function l(p,b){p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535],b=[b[0]>>>16,b[0]&65535,b[1]>>>16,b[1]&65535];var w=[0,0,0,0];return w[3]+=p[3]*b[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=p[2]*b[3],w[1]+=w[2]>>>16,w[2]&=65535,w[2]+=p[3]*b[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=p[1]*b[3],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=p[2]*b[2],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=p[3]*b[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=p[0]*b[3]+p[1]*b[2]+p[2]*b[1]+p[3]*b[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function h(p,b){return b%=64,b===32?[p[1],p[0]]:b<32?[p[0]<<b|p[1]>>>32-b,p[1]<<b|p[0]>>>32-b]:(b-=32,[p[1]<<b|p[0]>>>32-b,p[0]<<b|p[1]>>>32-b])}function f(p,b){return b%=64,b===0?p:b<32?[p[0]<<b|p[1]>>>32-b,p[1]<<b]:[p[1]<<b-32,0]}function y(p,b){return[p[0]^b[0],p[1]^b[1]]}function d(p){return p=y(p,[0,p[0]>>>1]),p=l(p,[4283543511,3981806797]),p=y(p,[0,p[0]>>>1]),p=l(p,[3301882366,444984403]),p=y(p,[0,p[0]>>>1]),p}s.x86.hash32=function(p,b){if(s.inputValidation&&!i(p))return n;b=b||0;for(var w=p.length%4,S=p.length-w,E=b,m=0,v=3432918353,A=461845907,g=0;g<S;g=g+4)m=p[g]|p[g+1]<<8|p[g+2]<<16|p[g+3]<<24,m=o(m,v),m=a(m,15),m=o(m,A),E^=m,E=a(E,13),E=o(E,5)+3864292196;switch(m=0,w){case 3:m^=p[g+2]<<16;case 2:m^=p[g+1]<<8;case 1:m^=p[g],m=o(m,v),m=a(m,15),m=o(m,A),E^=m}return E^=p.length,E=c(E),E>>>0},s.x86.hash128=function(p,b){if(s.inputValidation&&!i(p))return n;b=b||0;for(var w=p.length%16,S=p.length-w,E=b,m=b,v=b,A=b,g=0,_=0,$=0,x=0,k=597399067,j=2869860233,G=951274213,Q=2716044179,V=0;V<S;V=V+16)g=p[V]|p[V+1]<<8|p[V+2]<<16|p[V+3]<<24,_=p[V+4]|p[V+5]<<8|p[V+6]<<16|p[V+7]<<24,$=p[V+8]|p[V+9]<<8|p[V+10]<<16|p[V+11]<<24,x=p[V+12]|p[V+13]<<8|p[V+14]<<16|p[V+15]<<24,g=o(g,k),g=a(g,15),g=o(g,j),E^=g,E=a(E,19),E+=m,E=o(E,5)+1444728091,_=o(_,j),_=a(_,16),_=o(_,G),m^=_,m=a(m,17),m+=v,m=o(m,5)+197830471,$=o($,G),$=a($,17),$=o($,Q),v^=$,v=a(v,15),v+=A,v=o(v,5)+2530024501,x=o(x,Q),x=a(x,18),x=o(x,k),A^=x,A=a(A,13),A+=E,A=o(A,5)+850148119;switch(g=0,_=0,$=0,x=0,w){case 15:x^=p[V+14]<<16;case 14:x^=p[V+13]<<8;case 13:x^=p[V+12],x=o(x,Q),x=a(x,18),x=o(x,k),A^=x;case 12:$^=p[V+11]<<24;case 11:$^=p[V+10]<<16;case 10:$^=p[V+9]<<8;case 9:$^=p[V+8],$=o($,G),$=a($,17),$=o($,Q),v^=$;case 8:_^=p[V+7]<<24;case 7:_^=p[V+6]<<16;case 6:_^=p[V+5]<<8;case 5:_^=p[V+4],_=o(_,j),_=a(_,16),_=o(_,G),m^=_;case 4:g^=p[V+3]<<24;case 3:g^=p[V+2]<<16;case 2:g^=p[V+1]<<8;case 1:g^=p[V],g=o(g,k),g=a(g,15),g=o(g,j),E^=g}return E^=p.length,m^=p.length,v^=p.length,A^=p.length,E+=m,E+=v,E+=A,m+=E,v+=E,A+=E,E=c(E),m=c(m),v=c(v),A=c(A),E+=m,E+=v,E+=A,m+=E,v+=E,A+=E,("00000000"+(E>>>0).toString(16)).slice(-8)+("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(v>>>0).toString(16)).slice(-8)+("00000000"+(A>>>0).toString(16)).slice(-8)},s.x64.hash128=function(p,b){if(s.inputValidation&&!i(p))return n;b=b||0;for(var w=p.length%16,S=p.length-w,E=[0,b],m=[0,b],v=[0,0],A=[0,0],g=[2277735313,289559509],_=[1291169091,658871167],$=0;$<S;$=$+16)v=[p[$+4]|p[$+5]<<8|p[$+6]<<16|p[$+7]<<24,p[$]|p[$+1]<<8|p[$+2]<<16|p[$+3]<<24],A=[p[$+12]|p[$+13]<<8|p[$+14]<<16|p[$+15]<<24,p[$+8]|p[$+9]<<8|p[$+10]<<16|p[$+11]<<24],v=l(v,g),v=h(v,31),v=l(v,_),E=y(E,v),E=h(E,27),E=u(E,m),E=u(l(E,[0,5]),[0,1390208809]),A=l(A,_),A=h(A,33),A=l(A,g),m=y(m,A),m=h(m,31),m=u(m,E),m=u(l(m,[0,5]),[0,944331445]);switch(v=[0,0],A=[0,0],w){case 15:A=y(A,f([0,p[$+14]],48));case 14:A=y(A,f([0,p[$+13]],40));case 13:A=y(A,f([0,p[$+12]],32));case 12:A=y(A,f([0,p[$+11]],24));case 11:A=y(A,f([0,p[$+10]],16));case 10:A=y(A,f([0,p[$+9]],8));case 9:A=y(A,[0,p[$+8]]),A=l(A,_),A=h(A,33),A=l(A,g),m=y(m,A);case 8:v=y(v,f([0,p[$+7]],56));case 7:v=y(v,f([0,p[$+6]],48));case 6:v=y(v,f([0,p[$+5]],40));case 5:v=y(v,f([0,p[$+4]],32));case 4:v=y(v,f([0,p[$+3]],24));case 3:v=y(v,f([0,p[$+2]],16));case 2:v=y(v,f([0,p[$+1]],8));case 1:v=y(v,[0,p[$]]),v=l(v,g),v=h(v,31),v=l(v,_),E=y(E,v)}return E=y(E,[0,p.length]),m=y(m,[0,p.length]),E=u(E,m),m=u(m,E),E=d(E),m=d(m),E=u(E,m),m=u(m,E),("00000000"+(E[0]>>>0).toString(16)).slice(-8)+("00000000"+(E[1]>>>0).toString(16)).slice(-8)+("00000000"+(m[0]>>>0).toString(16)).slice(-8)+("00000000"+(m[1]>>>0).toString(16)).slice(-8)},r.exports&&(e=r.exports=s),e.murmurHash3=s})()})(X4,X4.exports);var b2e=X4.exports,m2e=b2e;const E2e=Et(m2e),Eb=g2e({name:"murmur3-128",code:34,encode:r=>s2e(E2e.x64.hash128(r))});async function v2e(r){return(await Eb.encode(r)).slice(0,8).reverse()}const _2e={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:Q4,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:v2e,hamtHashCode:34,hamtBucketBits:8},S2e=(r={})=>kt.bind({ignoreUndefined:!0})(_2e,r);function A2e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var $2e=A2e,T2e=$2e;let I2e=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},R2e=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return NM(this,e)}},C2e=class{constructor(e){this.decoders=e}or(e){return NM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const NM=(r,e)=>new C2e({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let x2e=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new I2e(e,t,n),this.decoder=new R2e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const LM=({name:r,prefix:e,encode:t,decode:n})=>new x2e(r,e,t,n),MM=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=T2e(t,e);return LM({prefix:r,name:e,encode:n,decode:i=>Up(s(i))})},D2e=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},P2e=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},va=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>LM({prefix:e,name:r,encode(s){return P2e(s,n,t)},decode(s){return D2e(s,n,t,r)}}),Ya=MM({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});MM({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const R2=va({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});va({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});va({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});va({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});va({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});va({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});va({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});va({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});va({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const eT=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return N2e(t,J4(r),e||Ya.encoder);default:return L2e(t,J4(r),e||R2.encoder)}},tT=new WeakMap,J4=r=>{const e=tT.get(r);if(e==null){const t=new Map;return tT.set(r,t),t}return e};let O2e=class On{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==zd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==M2e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return On.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=W4(e,t);return On.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return On.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&L0e(e.multihash,n.multihash)}toString(e){return eT(this,e)}toJSON(){return{"/":eT(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof On)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new On(n,s,i,o||rT(n,s,i.bytes))}else if(t[U2e]===!0){const{version:n,multihash:s,code:i}=t,o=N0e(s);return On.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==zd)throw new Error(`Version 0 CID must use dag-pb (code: ${zd}) block encoding`);return new On(e,t,n,n.bytes)}case 1:{const s=rT(e,t,n.bytes);return new On(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return On.create(0,zd,e)}static createV1(e,t){return On.create(1,e,t)}static decode(e){const[t,n]=On.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=On.inspectBytes(e),n=t.size-t.multihashSize,s=Up(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new mv(t.multihashCode,t.digestSize,i,s);return[t.version===0?On.createV0(o):On.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=G4(e.subarray(t));return t+=f,h};let s=n(),i=zd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=k2e(e,t),i=On.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return J4(i).set(n,e),i}};const k2e=(r,e)=>{switch(r[0]){case"Q":{const t=e||Ya;return[Ya.prefix,t.decode(`${Ya.prefix}${r}`)]}case Ya.prefix:{const t=e||Ya;return[Ya.prefix,t.decode(r)]}case R2.prefix:{const t=e||R2;return[R2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},N2e=(r,e,t)=>{const{prefix:n}=t;if(n!==Ya.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},L2e=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},zd=112,M2e=18,rT=(r,e,t)=>{const n=qy(r),s=n+qy(e),i=new Uint8Array(s+t.byteLength);return Ky(r,i,0),Ky(e,i,n),i.set(t,s),i},U2e=Symbol.for("@ipld/js-cid/CID"),xh=async(r,e,t)=>{t.codec||(t.codec=kc),t.hasher||(t.hasher=Q4),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===kc&&t.hasher!==Q4&&(t.cidVersion=1);const n=await t.hasher.digest(r),s=O2e.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(s,r,{signal:t.signal}),s},B2e=async(r,e,t)=>{const n=new Ot({type:"directory",mtime:r.mtime,mode:r.mode}),s=Ct(To({Data:n.marshal()})),i=await xh(s,e,t),o=r.path;return{cid:i,path:o,unixfs:n,size:s.length}},z2e="raw",Z4=85,F2e=r=>Up(r),V2e=r=>Up(r),j2e=Object.freeze(Object.defineProperty({__proto__:null,code:Z4,decode:V2e,encode:F2e,name:z2e},Symbol.toStringTag,{value:"Module"}));async function K2e(r,e){return e(await Kc(r))}function q2e(r,e,t){return UM(r,e,t)}async function UM(r,e,t){const n=[];for await(const s of wv(r,t.maxChildrenPerNode))n.push(await e(s));return n.length>1?UM(n,e,t):n[0]}async function H2e(r,e,t){const n=new G2e(t.layerRepeat);let s=0,i=1,o=n;for await(const a of wv(r,t.maxChildrenPerNode))o.isFull()&&(o!==n&&n.addChild(await o.reduce(e)),s&&s%t.layerRepeat===0&&i++,o=new BM(i,t.layerRepeat,s),s++),o.append(a);return o&&o!==n&&n.addChild(await o.reduce(e)),n.reduce(e)}class BM{constructor(e,t,n=0){this.maxDepth=e,this.layerRepeat=t,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:e,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;const e=this._findParent(this.node,this.currentDepth);return e?(this._addNextNodeToParent(e),!1):!0}_addNextNodeToParent(e){this.parent=e;const t={children:[],depth:e.depth+1,parent:e,maxDepth:this.maxDepth,maxChildren:Math.floor(e.children.length/this.layerRepeat)*this.layerRepeat};e.children.push(t),this.currentDepth=t.depth,this.node=t}append(e){this.node.data=e}reduce(e){return this._reduce(this.root,e)}async _reduce(e,t){let n=[];return e.children.length&&(n=await Promise.all(e.children.filter(s=>s.data).map(s=>this._reduce(s,t)))),t((e.data||[]).concat(n))}_findParent(e,t){const n=e.parent;if(!(!n||n.depth===0))return n.children.length===n.maxChildren||!n.maxChildren?this._findParent(n,t):n}}class G2e extends BM{constructor(e){super(0,e),this.root.depth=0,this.currentDepth=1}addChild(e){this.root.children.push(e)}reduce(e){return e((this.root.data||[]).concat(this.root.children))}}async function*W2e(r,e,t){for await(let n of r.content)yield async()=>{t.progress(n.length,r.path);let s;const i={codec:kc,cidVersion:t.cidVersion,hasher:t.hasher,onlyHash:t.onlyHash};return t.rawLeaves?(i.codec=j2e,i.cidVersion=1):(s=new Ot({type:t.leafType,data:n}),n=Ct({Data:s.marshal(),Links:[]})),{cid:await xh(n,e,i),unixfs:s,size:n.length}}}const Q2e={flat:K2e,balanced:q2e,trickle:H2e};async function*Y2e(r,e,t){let n=-1,s,i;typeof t.bufferImporter=="function"?i=t.bufferImporter:i=W2e;for await(const o of bv(i(r,e,t),t.blockWriteConcurrency)){if(n++,n===0){s=o;continue}else n===1&&s&&(yield s,s=null);yield o}s&&(s.single=!0,yield s)}const X2e=(r,e,t)=>{async function n(s){if(s.length===1&&s[0].single&&t.reduceSingleLeafToSelf){const l=s[0];if(r.mtime!==void 0||r.mode!==void 0){let h=await e.get(l.cid);l.unixfs=new Ot({type:"file",mtime:r.mtime,mode:r.mode,data:h}),h=Ct(To({Data:l.unixfs.marshal()})),l.cid=await xh(h,e,{...t,codec:kc,hasher:t.hasher,cidVersion:t.cidVersion}),l.size=h.length}return{cid:l.cid,path:r.path,unixfs:l.unixfs,size:l.size}}const i=new Ot({type:"file",mtime:r.mtime,mode:r.mode}),o=s.filter(l=>l.cid.code===Z4&&l.size||l.unixfs&&!l.unixfs.data&&l.unixfs.fileSize()?!0:!!(l.unixfs&&l.unixfs.data&&l.unixfs.data.length)).map(l=>l.cid.code===Z4?(i.addBlockSize(l.size),{Name:"",Tsize:l.size,Hash:l.cid}):(!l.unixfs||!l.unixfs.data?i.addBlockSize(l.unixfs&&l.unixfs.fileSize()||0):i.addBlockSize(l.unixfs.data.length),{Name:"",Tsize:l.size,Hash:l.cid})),a={Data:i.marshal(),Links:o},c=Ct(To(a));return{cid:await xh(c,e,t),path:r.path,unixfs:i,size:c.length+a.Links.reduce((l,h)=>l+h.Tsize,0)}}return n};function J2e(r,e,t){const n=Q2e[t.strategy];if(!n)throw T(new Error(`Unknown importer build strategy name: ${t.strategy}`),"ERR_BAD_STRATEGY");return n(Y2e(r,e,t),X2e(r,e,t),t)}let Z2e=class{constructor(e,t=12,n=8*1024,s=32*1024,i=64,o){this.bits=t,this.min=n,this.max=s,this.asModule=e,this.rabin=new e.Rabin(t,n,s,i,o),this.polynomial=o}fingerprint(e){const{__retain:t,__release:n,__allocArray:s,__getInt32Array:i,Int32Array_ID:o,Uint8Array_ID:a}=this.asModule,c=new Int32Array(Math.ceil(e.length/this.min)),u=t(s(o,c)),l=t(s(a,e)),h=this.rabin.fingerprint(l,u),f=i(h);n(l),n(u);const y=f.indexOf(0);return y>=0?f.subarray(0,y):f}};var eye=Z2e,Bp={};const s6=-8,C2=-4,tye=0,nT=1,sT=1,R0=2,rye=5,iT=1024,oT=2048,nye=8192,sye=0,i6=4,iye=8,oye=12,aT=12,aye=16,cye=typeof BigUint64Array<"u",Fd=Symbol(),Vd=1024;function zM(r,e){const t=new Uint32Array(r),n=new Uint16Array(r);var s=t[e+C2>>>2]>>>1,i=e>>>1;if(s<=Vd)return String.fromCharCode.apply(String,n.subarray(i,i+s));const o=[];do{const a=n[i+Vd-1],c=a>=55296&&a<56320?Vd-1:Vd;o.push(String.fromCharCode.apply(String,n.subarray(i,i+=c))),s-=c}while(s>Vd);return o.join("")+String.fromCharCode.apply(String,n.subarray(i,i+s))}function Ev(r){const e={};function t(s,i){return s?zM(s.buffer,i):"<yet unknown>"}const n=r.env=r.env||{};return n.abort=n.abort||function(i,o,a,c){const u=e.memory||n.memory;throw Error("abort: "+t(u,i)+" at "+t(u,o)+":"+a+":"+c)},n.trace=n.trace||function(i,o){const a=e.memory||n.memory;console.log("trace: "+t(a,i)+(o?" ":"")+Array.prototype.slice.call(arguments,2,2+o).join(", "))},r.Math=r.Math||Math,r.Date=r.Date||Date,e}function vv(r,e){const t=e.exports,n=t.memory,s=t.table,i=t.__alloc,o=t.__retain,a=t.__rtti_base||-1;function c(v){const A=new Uint32Array(n.buffer),g=A[a>>>2];if((v>>>=0)>=g)throw Error("invalid id: "+v);return A[(a+4>>>2)+v*2]}function u(v){const A=new Uint32Array(n.buffer),g=A[a>>>2];if((v>>>=0)>=g)throw Error("invalid id: "+v);return A[(a+4>>>2)+v*2+1]}function l(v){return 31-Math.clz32(v>>>rye&31)}function h(v){const A=v.length,g=i(A<<1,nT),_=new Uint16Array(n.buffer);for(var $=0,x=g>>>1;$<A;++$)_[x+$]=v.charCodeAt($);return g}r.__allocString=h;function f(v){const A=n.buffer;if(new Uint32Array(A)[v+s6>>>2]!==nT)throw Error("not a string: "+v);return zM(A,v)}r.__getString=f;function y(v,A,g){const _=n.buffer;if(g)switch(v){case 2:return new Float32Array(_);case 3:return new Float64Array(_)}else switch(v){case 0:return new(A?Int8Array:Uint8Array)(_);case 1:return new(A?Int16Array:Uint16Array)(_);case 2:return new(A?Int32Array:Uint32Array)(_);case 3:return new(A?BigInt64Array:BigUint64Array)(_)}throw Error("unsupported align: "+v)}function d(v,A){const g=c(v);if(!(g&(sT|R0)))throw Error("not an array: "+v+" @ "+g);const _=l(g),$=A.length,x=i($<<_,tye),k=i(g&R0?aye:oye,v),j=new Uint32Array(n.buffer);j[k+sye>>>2]=o(x),j[k+i6>>>2]=x,j[k+iye>>>2]=$<<_,g&R0&&(j[k+aT>>>2]=$);const G=y(_,g&iT,g&oT);if(g&nye)for(let Q=0;Q<$;++Q)G[(x>>>_)+Q]=o(A[Q]);else G.set(A,x>>>_);return k}r.__allocArray=d;function p(v){const A=new Uint32Array(n.buffer),g=A[v+s6>>>2],_=c(g);if(!(_&sT))throw Error("not an array: "+g);const $=l(_);var x=A[v+i6>>>2];const k=_&R0?A[v+aT>>>2]:A[x+C2>>>2]>>>$;return y($,_&iT,_&oT).subarray(x>>>=$,x+k)}r.__getArrayView=p;function b(v){const A=p(v),g=A.length,_=new Array(g);for(let $=0;$<g;$++)_[$]=A[$];return _}r.__getArray=b;function w(v){const A=n.buffer,g=new Uint32Array(A)[v+C2>>>2];return A.slice(v,v+g)}r.__getArrayBuffer=w;function S(v,A,g){return new v(E(v,A,g))}function E(v,A,g){const _=n.buffer,$=new Uint32Array(_),x=$[g+i6>>>2];return new v(_,x,$[x+C2>>>2]>>>A)}r.__getInt8Array=S.bind(null,Int8Array,0),r.__getInt8ArrayView=E.bind(null,Int8Array,0),r.__getUint8Array=S.bind(null,Uint8Array,0),r.__getUint8ArrayView=E.bind(null,Uint8Array,0),r.__getUint8ClampedArray=S.bind(null,Uint8ClampedArray,0),r.__getUint8ClampedArrayView=E.bind(null,Uint8ClampedArray,0),r.__getInt16Array=S.bind(null,Int16Array,1),r.__getInt16ArrayView=E.bind(null,Int16Array,1),r.__getUint16Array=S.bind(null,Uint16Array,1),r.__getUint16ArrayView=E.bind(null,Uint16Array,1),r.__getInt32Array=S.bind(null,Int32Array,2),r.__getInt32ArrayView=E.bind(null,Int32Array,2),r.__getUint32Array=S.bind(null,Uint32Array,2),r.__getUint32ArrayView=E.bind(null,Uint32Array,2),cye&&(r.__getInt64Array=S.bind(null,BigInt64Array,3),r.__getInt64ArrayView=E.bind(null,BigInt64Array,3),r.__getUint64Array=S.bind(null,BigUint64Array,3),r.__getUint64ArrayView=E.bind(null,BigUint64Array,3)),r.__getFloat32Array=S.bind(null,Float32Array,2),r.__getFloat32ArrayView=E.bind(null,Float32Array,2),r.__getFloat64Array=S.bind(null,Float64Array,3),r.__getFloat64ArrayView=E.bind(null,Float64Array,3);function m(v,A){const g=new Uint32Array(n.buffer);var _=g[v+s6>>>2];if(_<=g[a>>>2])do if(_==A)return!0;while(_=u(_));return!1}return r.__instanceof=m,r.memory=r.memory||n,r.table=r.table||s,KM(t,r)}function FM(r){return typeof Response<"u"&&r instanceof Response}async function VM(r,e){return FM(r=await r)?jM(r,e):vv(Ev(e||(e={})),await WebAssembly.instantiate(r instanceof WebAssembly.Module?r:await WebAssembly.compile(r),e))}Bp.instantiate=VM;function lye(r,e){return vv(Ev(e||(e={})),new WebAssembly.Instance(r instanceof WebAssembly.Module?r:new WebAssembly.Module(r),e))}Bp.instantiateSync=lye;async function jM(r,e){return WebAssembly.instantiateStreaming?vv(Ev(e||(e={})),(await WebAssembly.instantiateStreaming(r,e)).instance):VM(FM(r=await r)?r.arrayBuffer():r,e)}Bp.instantiateStreaming=jM;function KM(r,e){var t=e?Object.create(e):{},n=r.__argumentsLength?function(s){r.__argumentsLength.value=s}:r.__setArgumentsLength||r.__setargc||function(){};for(let s in r){if(!Object.prototype.hasOwnProperty.call(r,s))continue;const i=r[s];let o=s.split("."),a=t;for(;o.length>1;){let l=o.shift();Object.prototype.hasOwnProperty.call(a,l)||(a[l]={}),a=a[l]}let c=o[0],u=c.indexOf("#");if(u>=0){let l=c.substring(0,u),h=a[l];if(typeof h>"u"||!h.prototype){let f=function(...y){return f.wrap(f.prototype.constructor(0,...y))};f.prototype={valueOf:function(){return this[Fd]}},f.wrap=function(y){return Object.create(f.prototype,{[Fd]:{value:y,writable:!1}})},h&&Object.getOwnPropertyNames(h).forEach(y=>Object.defineProperty(f,y,Object.getOwnPropertyDescriptor(h,y))),a[l]=f}if(c=c.substring(u+1),a=a[l].prototype,/^(get|set):/.test(c)){if(!Object.prototype.hasOwnProperty.call(a,c=c.substring(4))){let f=r[s.replace("set:","get:")],y=r[s.replace("get:","set:")];Object.defineProperty(a,c,{get:function(){return f(this[Fd])},set:function(d){y(this[Fd],d)},enumerable:!0})}}else c==="constructor"?(a[c]=(...f)=>(n(f.length),i(...f))).original=i:(a[c]=function(...f){return n(f.length),i(this[Fd],...f)}).original=i}else/^(get|set):/.test(c)?Object.prototype.hasOwnProperty.call(a,c=c.substring(4))||Object.defineProperty(a,c,{get:r[s.replace("set:","get:")],set:r[s.replace("get:","set:")],enumerable:!0}):typeof i=="function"&&i!==n?(a[c]=(...l)=>(n(l.length),i(...l))).original=i:a[c]=i}return t}Bp.demangle=KM;const{instantiate:uye}=Bp;_v.supported=typeof WebAssembly<"u";function _v(r={}){if(!_v.supported)return null;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return uye(new Response(new Blob([e],{type:"application/wasm"})),r)}var hye=_v;const qM=eye,dye=hye,fye=async(r,e,t,n,s)=>{const i=await dye();return new qM(i,r,e,t,n,s)};var pye={Rabin:qM,create:fye};async function*yye(r,e){let t,n,s;if(e.minChunkSize&&e.maxChunkSize&&e.avgChunkSize)s=e.avgChunkSize,t=e.minChunkSize,n=e.maxChunkSize;else if(e.avgChunkSize)s=e.avgChunkSize,t=s/3,n=s+s/2;else throw T(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");if(t<16)throw T(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");n<t&&(n=t),s<t&&(s=t);const i=Math.floor(Math.log2(s));for await(const o of gye(r,{min:t,max:n,bits:i,window:e.window,polynomial:e.polynomial}))yield o}async function*gye(r,e){const t=await pye.create(e.bits,e.min,e.max,e.window),n=new Se;for await(const s of r){n.append(s);const i=t.fingerprint(s);for(let o=0;o<i.length;o++){const a=i[o],c=n.slice(0,a);n.consume(a),yield c}}n.length&&(yield n.subarray(0))}async function*wye(r,e){let t=new Se,n=0,s=!1;const i=e.maxChunkSize;for await(const o of r)for(t.append(o),n+=o.length;n>=i;)if(yield t.slice(0,i),s=!0,i===t.length)t=new Se,n=0;else{const a=new Se;a.append(t.sublist(i)),t=a,n-=i}(!s||n)&&(yield t.subarray(0,n))}async function*bye(r){for await(const e of r){if(e.length===void 0)throw T(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof e=="string"||e instanceof String)yield M(e.toString());else if(Array.isArray(e))yield Uint8Array.from(e);else if(e instanceof Uint8Array)yield e;else throw T(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}}function mye(r){return Symbol.iterator in r}function Eye(r){return Symbol.asyncIterator in r}function vye(r){try{if(r instanceof Uint8Array)return async function*(){yield r}();if(mye(r))return async function*(){yield*r}();if(Eye(r))return r}catch{throw T(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw T(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*_ye(r,e,t){for await(const n of r)if(n.path&&(n.path.substring(0,2)==="./"&&(t.wrapWithDirectory=!0),n.path=n.path.split("/").filter(s=>s&&s!==".").join("/")),n.content){let s;typeof t.chunker=="function"?s=t.chunker:t.chunker==="rabin"?s=yye:s=wye;let i;typeof t.chunkValidator=="function"?i=t.chunkValidator:i=bye;const o={path:n.path,mtime:n.mtime,mode:n.mode,content:s(i(vye(n.content),t),t)};yield()=>J2e(o,e,t)}else if(n.path){const s={path:n.path,mtime:n.mtime,mode:n.mode};yield()=>B2e(s,e,t)}else throw new Error("Import candidate must have content or path or both")}let U1=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}};class Sv extends U1{constructor(e,t){super(e,t),this._children={}}async put(e,t){this.cid=void 0,this.size=void 0,this._children[e]=t}get(e){return Promise.resolve(this._children[e])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){const e=Object.keys(this._children);for(let t=0;t<e.length;t++){const n=e[t];yield{key:n,child:this._children[n]}}}async*flush(e){const t=Object.keys(this._children),n=[];for(let u=0;u<t.length;u++){let l=this._children[t[u]];if(l instanceof U1)for await(const h of l.flush(e))l=h,yield l;l.size!=null&&l.cid&&n.push({Name:t[u],Tsize:l.size,Hash:l.cid})}const s=new Ot({type:"directory",mtime:this.mtime,mode:this.mode}),i={Data:s.marshal(),Links:n},o=Ct(To(i)),a=await xh(o,e,this.options),c=o.length+i.Links.reduce((u,l)=>u+(l.Tsize==null?0:l.Tsize),0);this.cid=a,this.size=c,yield{cid:a,unixfs:s,path:this.path,size:c}}}const C0=7;var Sye=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(t===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let s=!1;n===-1?(n=this._data.length,this._setBit(e),this._changedData=!0):s=!0,this._setInternalPos(n,e,t,s),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const t=this._internalPositionFor(e,!0);if(t!==-1)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,s=t;for(;n<this.length;){const i=this.get(n);s=e(s,i,n),n++}return s}find(e){let t=0,n,s;for(;t<this.length&&!n;)s=this.get(t),n=e(s),t++;return n?s:void 0}_internalPositionFor(e,t){const n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;const s=this._bitArrays[n],i=e-n*C0;if(!((s&1<<i)>0))return-1;const a=this._bitArrays.slice(0,n).reduce(Aye,0),c=~(4294967295<<i+1),u=HM(s&c);return a+u-1}_bytePosFor(e,t){const n=Math.floor(e/C0),s=n+1;for(;!t&&this._bitArrays.length<s;)this._bitArrays.push(0);return n}_setBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*C0}_unsetBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*C0)}_setInternalPos(e,t,n,s){const i=this._data,o=[t,n];if(s)this._sortData(),i[e]=o;else{if(i.length)if(i[i.length-1][0]>=t)i.push(o);else if(i[0][0]<=t)i.unshift(o);else{const a=Math.round(i.length/2);this._data=i.slice(0,a).concat(o).concat(i.slice(a))}else this._data.push(o);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort($ye),this._changedData=!1}bitField(){const e=[];let t=8,n=0,s=0,i;const o=this._bitArrays.slice();for(;o.length||n;){n===0&&(i=o.shift(),n=7);const c=Math.min(n,t),u=~(255<<c),l=i&u;s|=l<<8-t,i=i>>>c,n-=c,t-=c,(!t||!n&&!o.length)&&(e.push(s),s=0,t=8)}for(var a=e.length-1;a>0&&e[a]===0;a--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(Tye)}};function Aye(r,e){return r+HM(e)}function HM(r){let e=r;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function $ye(r,e){return r[0]-e[0]}function Tye(r){return r[1]}const Iye=Et(Sye);class rs{constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new Iye,this.key=null}async put(e,t){const n=await this._findNewBucketAndPos(e);await n.bucket._putAt(n,e,t)}async get(e){const t=await this._findChild(e);if(t!=null)return t.value}async del(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof rs?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof rs?yield*t.eachLeafSeries():yield t}serialize(e,t){const n=[];return t(this._children.reduce((s,i,o)=>(i!=null&&(i instanceof rs?s.push(i.serialize(e,t)):s.push(e(i,o))),s),n))}async asyncTransform(e,t){return await GM(this,e,t)}toJSON(){return this.serialize(Cye,xye)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof rs)&&n!=null&&n.key===e)return n}async _findPlace(e){const t=this._options.hash(typeof e=="string"?M(e):e),n=await t.take(this._options.bits),s=this._children.get(n);return s instanceof rs?await s._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:s}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){const n=new rs(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);const s=await n._findPlace(t.existingChild.hash);return s.bucket._putAt(s,t.existingChild.key,t.existingChild.value),await n._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){const e=this._children.find(Rye);if(e!=null&&!(e instanceof rs)){const t=e.hash;t.untake(this._options.bits);const n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function Rye(r){return!!r}function Cye(r,e){return r.key}function xye(r){return r}async function GM(r,e,t){const n=[];for(const s of r._children.compactArray())if(s instanceof rs)await GM(s,e,t);else{const i=await e(s);n.push({bitField:r._children.bitField(),children:i})}return await t(n)}const Dye=[255,254,252,248,240,224,192,128],Pye=[1,3,7,15,31,63,127,255];class Oye{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){const s=this._value[this._currentBytePos],i=this._currentBitPos+1,o=Math.min(i,t),a=kye(s,i-o,o);n=(n<<o)+a,t-=o,this._currentBitPos-=o,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function kye(r,e,t){const n=Nye(e,t);return(r&n)>>>e}function Nye(r,e){return Dye[r]&Pye[Math.min(e+r-1,7)]}function Lye(r){function e(t){return t instanceof cT?t:new cT(t,r)}return e}class cT{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){const s=this._buffers[this._currentBufferIndex],i=Math.min(s.availableBits(),t),o=s.take(i);n=(n<<i)+o,t-=i,this._availableBits-=i,s.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){const n=this._buffers[this._currentBufferIndex],s=Math.min(n.totalBits()-n.availableBits(),t);n.untake(s),t-=s,this._availableBits+=s,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?z([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new Oye(t);this._buffers.push(n),this._availableBits+=n.availableBits()}}function vb(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");const e={bits:r.bits??8,hash:Lye(r.hashFn)};return new rs(e)}let Mye=class extends U1{constructor(e,t){super(e,t),this._bucket=vb({hashFn:t.hamtHashFn,bits:t.hamtBucketBits})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){for await(const t of WM(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*WM(r,e,t,n){const s=r._children,i=[];let o=0;for(let y=0;y<s.length;y++){const d=s.get(y);if(!d)continue;const p=y.toString(16).toUpperCase().padStart(2,"0");if(d instanceof rs){let b;for await(const w of await WM(d,e,null,n))b=w;if(!b)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:p,Tsize:b.size,Hash:b.cid}),o+=b.size}else if(typeof d.value.flush=="function"){const b=d.value;let w;for await(const E of b.flush(e))w=E,yield w;const S=p+d.key;i.push({Name:S,Tsize:w.size,Hash:w.cid}),o+=w.size}else{const b=d.value;if(!b.cid)continue;const w=p+d.key,S=b.size;i.push({Name:w,Tsize:S,Hash:b.cid}),o+=S}}const a=Uint8Array.from(s.bitField().reverse()),c=new Ot({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:n.hamtHashCode,mtime:t&&t.mtime,mode:t&&t.mode}),u={Data:c.marshal(),Links:i},l=Ct(To(u)),h=await xh(l,e,n),f=l.length+o;yield{cid:h,unixfs:c,size:f}}async function QM(r,e,t,n){let s=e;e instanceof Sv&&e.directChildrenCount()>=t&&(s=await Uye(e,n));const i=s.parent;if(i){if(s!==e){if(r&&(r.parent=s),!s.parentKey)throw new Error("No parent key found");await i.put(s.parentKey,s)}return QM(s,i,t,n)}return s}async function Uye(r,e){const t=new Mye({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for await(const{key:n,child:s}of r.eachChildSeries())await t.put(n,s);return t}const Bye=(r="")=>(r.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean);async function zye(r,e,t){const n=Bye(r.path||""),s=n.length-1;let i=e,o="";for(let a=0;a<n.length;a++){const c=n[a];o+=`${o?"/":""}${c}`;const u=a===s;if(i.dirty=!0,i.cid=void 0,i.size=void 0,u)await i.put(c,r),e=await QM(null,i,t.shardSplitThreshold,t);else{let l=await i.get(c);(!l||!(l instanceof U1))&&(l=new Sv({root:!1,dir:!0,parent:i,parentKey:c,path:o,dirty:!0,flat:!0,mtime:l&&l.unixfs&&l.unixfs.mtime,mode:l&&l.unixfs&&l.unixfs.mode},t)),await i.put(c,l),i=l}}return e}async function*lT(r,e){if(!(r instanceof U1)){r&&r.unixfs&&r.unixfs.isDirectory()&&(yield r);return}yield*r.flush(e)}async function*Fye(r,e,t){let n=new Sv({root:!0,dir:!0,path:"",dirty:!0,flat:!0},t);for await(const s of r)s&&(n=await zye(s,n,t),(!s.unixfs||!s.unixfs.isDirectory())&&(yield s));if(t.wrapWithDirectory)yield*lT(n,e);else for await(const s of n.eachChildSeries())s&&(yield*lT(s.child,e))}async function*Av(r,e,t={}){const n=S2e(t);let s;typeof t.dagBuilder=="function"?s=t.dagBuilder:s=_ye;let i;typeof t.treeBuilder=="function"?i=t.treeBuilder:i=Fye;let o;Symbol.asyncIterator in r||Symbol.iterator in r?o=r:o=[r];for await(const a of i(bv(s(o,e,n),n.fileImportConcurrency),e,n))yield{cid:a.cid,path:a.path,unixfs:a.unixfs,size:a.size}}async function*YM(r,e){if(typeof r=="string"||r instanceof String||Bc(r)||L1(r)||r._readableState)throw T(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(M1(r)&&(r=Kl(r)),Symbol.iterator in r||Symbol.asyncIterator in r){const t=Mp(r),{value:n,done:s}=await t.peek();if(s){yield*[];return}if(t.push(n),Number.isInteger(n))throw T(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(n._readableState){yield*ls(t,i=>o6({content:i},e));return}if(Bc(n)){yield o6({content:t},e);return}if(q4(n)||n[Symbol.iterator]||n[Symbol.asyncIterator]||M1(n)||L1(n)){yield*ls(t,i=>o6(i,e));return}}throw q4(r)?T(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT"):T(new Error("Unexpected input: "+typeof r),"ERR_UNEXPECTED_INPUT")}async function o6(r,e){const{path:t,mode:n,mtime:s,content:i}=r,o={path:t||"",mode:sh(n),mtime:_1(s)};return i?o.content=await e(i):t||(o.content=await e(r)),o}function Vye(r){return YM(r,IM)}const jye=r=>{if(r)if(r.startsWith("size-")){const e=r.split("-")[1],t=parseInt(e);if(isNaN(t))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:t}}else{if(r.startsWith("rabin"))return{chunker:"rabin",...Kye(r)};throw new Error(`Unrecognized chunker option: ${r}`)}else return{chunker:"fixed"}},Kye=r=>{const e={},t=r.split("-");switch(t.length){case 1:e.avgChunkSize=262144;break;case 2:e.avgChunkSize=x0(t[1],"avg");break;case 4:e.minChunkSize=x0(t[1],"min"),e.avgChunkSize=x0(t[2],"avg"),e.maxChunkSize=x0(t[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return e},x0=(r,e)=>{const t=parseInt(r);if(isNaN(t))throw new Error(`Chunker parameter ${e} must be an integer`);return t},qye=kt.bind({ignoreUndefined:!0});function Hye({repo:r,preload:e,hashers:t,options:n}){const s=n&&n.sharding;async function*i(o,a={}){const c=qye({shardSplitThreshold:s?1e3:1/0,strategy:"balanced"},a,{...jye(a.chunker)});c.hashAlg&&c.hashAlg!=="sha2-256"&&c.cidVersion!==1&&(c.cidVersion=1),c.trickle&&(c.strategy="trickle"),c.strategy==="trickle"&&(c.leafType="raw",c.reduceSingleLeafToSelf=!1),c.cidVersion>0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),c.hashAlg!==void 0&&c.rawLeaves===void 0&&(c.rawLeaves=!0),delete c.trickle;const u={};if(c.progress){const y=c.progress;c.progress=(d,p)=>{u[p]||(u[p]=0),u[p]+=d,y(u[p],p)}}let l;c.hashAlg!=null&&(l=await t.getHasher(c.hashAlg));const h=Ve(Vye(o),y=>Av(y,r.blocks,{...c,hasher:l,pin:!1}),Gye(c),Wye(e,c),Qye(r,c)),f=await r.gcLock.readLock();try{for await(const y of h){const d=y.path??y.cid.toString();delete u[d],yield{...y,path:d}}}finally{f()}}return Y(i)}function Gye(r){async function*e(t){for await(const n of t){let s=n.cid;r.cidVersion===1&&(s=s.toV1());let i=n.path?n.path:s.toString();r.wrapWithDirectory&&!n.path&&(i=""),yield{path:i,cid:s,size:n.size,mode:n.unixfs&&n.unixfs.mode,mtime:n.unixfs&&n.unixfs.mtime}}}return e}function Wye(r,e){async function*t(n){for await(const s of n)(!s.path||e.wrapWithDirectory?s.path==="":!s.path.includes("/"))&&!e.onlyHash&&e.preload!==!1&&r(s.cid),yield s}return t}function Qye(r,e){async function*t(n){for await(const s of n){const i=!(s.path&&s.path.includes("/"));(e.pin==null?!0:e.pin)&&i&&!e.onlyHash&&await r.pins.pinRecursively(s.cid),yield s}}return t}var Yye=XM,uT=128,Xye=127,Jye=~Xye,Zye=Math.pow(2,31);function XM(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Zye;)e[t++]=r&255|uT,r/=128;for(;r&Jye;)e[t++]=r&255|uT,r>>>=7;return e[t]=r|0,XM.bytes=t-n+1,e}var ege=e5,tge=128,hT=127;function e5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw e5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&hT)<<s:(o&hT)*Math.pow(2,s),s+=7}while(o>=tge);return e5.bytes=i-n,t}var rge=Math.pow(2,7),nge=Math.pow(2,14),sge=Math.pow(2,21),ige=Math.pow(2,28),oge=Math.pow(2,35),age=Math.pow(2,42),cge=Math.pow(2,49),lge=Math.pow(2,56),uge=Math.pow(2,63),hge=function(r){return r<rge?1:r<nge?2:r<sge?3:r<ige?4:r<oge?5:r<age?6:r<cge?7:r<lge?8:r<uge?9:10},dge={encode:Yye,decode:ege,encodingLength:hge},Hy=dge;const t5=(r,e=0)=>[Hy.decode(r,e),Hy.decode.bytes],Gy=(r,e,t=0)=>(Hy.encode(r,e,t),e),Wy=r=>Hy.encodingLength(r),fge=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},_b=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},JM=(r,e)=>{const t=e.byteLength,n=Wy(r),s=n+Wy(t),i=new Uint8Array(s+t);return Gy(r,i,0),Gy(t,i,n),i.set(e,s),new $v(r,t,e,i)},ZM=r=>{const e=_b(r),[t,n]=t5(e),[s,i]=t5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new $v(t,s,o,e)},pge=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&fge(r.bytes,t.bytes)}};let $v=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function yge(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var gge=yge,wge=gge;let bge=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},mge=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return eU(this,e)}},Ege=class{constructor(e){this.decoders=e}or(e){return eU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const eU=(r,e)=>new Ege({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let vge=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new bge(e,t,n),this.decoder=new mge(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const tU=({name:r,prefix:e,encode:t,decode:n})=>new vge(r,e,t,n),rU=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=wge(t,e);return tU({prefix:r,name:e,encode:n,decode:i=>_b(s(i))})},_ge=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Sge=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},_a=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>tU({prefix:e,name:r,encode(s){return Sge(s,n,t)},decode(s){return _ge(s,n,t,r)}}),Xa=rU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});rU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const x2=_a({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});_a({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});_a({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});_a({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});_a({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});_a({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});_a({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});_a({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});_a({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const dT=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return $ge(t,r5(r),e||Xa.encoder);default:return Tge(t,r5(r),e||x2.encoder)}},fT=new WeakMap,r5=r=>{const e=fT.get(r);if(e==null){const t=new Map;return fT.set(r,t),t}return e};let D2=class kn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==jd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ige)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return kn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=JM(e,t);return kn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return kn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&pge(e.multihash,n.multihash)}toString(e){return dT(this,e)}toJSON(){return{"/":dT(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof kn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new kn(n,s,i,o||pT(n,s,i.bytes))}else if(t[Rge]===!0){const{version:n,multihash:s,code:i}=t,o=ZM(s);return kn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==jd)throw new Error(`Version 0 CID must use dag-pb (code: ${jd}) block encoding`);return new kn(e,t,n,n.bytes)}case 1:{const s=pT(e,t,n.bytes);return new kn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return kn.create(0,jd,e)}static createV1(e,t){return kn.create(1,e,t)}static decode(e){const[t,n]=kn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=kn.inspectBytes(e),n=t.size-t.multihashSize,s=_b(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new $v(t.multihashCode,t.digestSize,i,s);return[t.version===0?kn.createV0(o):kn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=t5(e.subarray(t));return t+=f,h};let s=n(),i=jd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=Age(e,t),i=kn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return r5(i).set(n,e),i}};const Age=(r,e)=>{switch(r[0]){case"Q":{const t=e||Xa;return[Xa.prefix,t.decode(`${Xa.prefix}${r}`)]}case Xa.prefix:{const t=e||Xa;return[Xa.prefix,t.decode(r)]}case x2.prefix:{const t=e||x2;return[x2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},$ge=(r,e,t)=>{const{prefix:n}=t;if(n!==Xa.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},Tge=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},jd=112,Ige=18,pT=(r,e,t)=>{const n=Wy(r),s=n+Wy(e),i=new Uint8Array(s+t.byteLength);return Gy(r,i,0),Gy(e,i,n),i.set(t,s),i},Rge=Symbol.for("@ipld/js-cid/CID"),nU=85,sU=0,Cge="identity",iU=_b,xge=r=>JM(sU,iU(r)),Dge={code:sU,name:Cge,encode:iU,digest:xge},Pge=async function(r){return(await Eb.encode(r)).slice(0,8).reverse()},Oge=(r,e,t)=>Promise.all(r.map(n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){const s=parseInt(n.Name,16);return e._putObjectAt(s,new rs({hash:t._options.hash,bits:t._options.bits},e,s))}return t.put(n.Name.substring(2),!0)})),yT=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),kge=r=>{let e=r.bucket;const t=[];for(;e._parent;)t.push(e),e=e._parent;return t.push(e),t.reverse()},oU=async(r,e,t,n,s)=>{if(!n){const l=vb({hashFn:Pge});n={rootBucket:l,hamtDepth:1,lastBucket:l}}await Oge(r.Links,n.lastBucket,n.rootBucket);const i=await n.rootBucket._findNewBucketAndPos(e);let o=yT(i.pos);const a=kge(i);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],o=yT(n.lastBucket._posAtParent));const c=r.Links.find(l=>{if(l.Name==null)return!1;const h=l.Name.substring(0,2),f=l.Name.substring(2);return!(h!==o||f&&f!==e)});if(!c)return null;if(c.Name!=null&&c.Name.substring(2)===e)return c.Hash;n.hamtDepth++;const u=await t.get(c.Hash,s);return r=hr(u),oU(r,e,t,n,s)};function Qy(r,e,t,n){const s=r.length,i=e+s;return t>=i||n<e?new Uint8Array(0):(n>=e&&n<i&&(r=r.subarray(0,n-e)),t>=e&&t<i&&(r=r.subarray(t-e)),r)}const Tv=(r,e,t)=>{if(e||(e=0),e<0)throw T(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(e>r)throw T(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(!t&&t!==0&&(t=r-e),t<0)throw T(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return e+t>r&&(t=r-e),{offset:e,length:t}};async function aU(r,e,t,n,s,i,o,a){if(e instanceof Uint8Array){t.push(Qy(e,n,s,i));return}if(e.Data==null)throw T(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=Ot.unmarshal(e.Data)}catch(l){throw T(l,"ERR_NOT_UNIXFS")}if(c.data!=null){const l=c.data,h=Qy(l,n,s,i);t.push(h),n+=h.byteLength}const u=[];for(let l=0;l<e.Links.length;l++){const h=e.Links[l],f=n,y=f+c.blockSizes[l];if((s>=f&&s<y||i>=f&&i<=y||s<f&&i>y)&&u.push({link:h,blockStart:n}),n=y,n>i)break}await Ve(u,l=>ls(l,h=>async()=>{const f=await r.get(h.link.Hash,{signal:a.signal});return{...h,block:f}}),l=>mb(l,{ordered:!0}),async l=>{for await(const{link:h,block:f,blockStart:y}of l){let d;switch(h.Hash.code){case jt:d=hr(f);break;case nU:d=f;break;default:t.end(T(new Error(`Unsupported codec: ${h.Hash.code}`),"ERR_NOT_UNIXFS"));return}o.add(async()=>{await aU(r,d,t,y,s,i,o,a)})}})}const gT=(r,e,t,n,s,i,o)=>{async function*a(c={}){const u=t.fileSize();if(u===void 0)throw new Error("File was a directory");const{offset:l,length:h}=Tv(u,c.offset,c.length);if(h===0)return;const f=new Cr({concurrency:1}),y=$r();f.add(async()=>{await aU(o,e,y,0,l,l+h,f,c)}),f.on("error",p=>{y.end(p)});let d=0;for await(const p of y)p!=null&&(d+=p.byteLength,d===h&&y.end(),yield p)}return a},Nge=(r,e,t,n,s,i,o)=>{async function*a(c={}){const u=c.offset||0,l=c.length||e.Links.length,h=e.Links.slice(u,l);for(const f of h){const y=await s(f.Hash,f.Name||"",`${n}/${f.Name||""}`,[],i+1,o,c);y.entry&&(yield y.entry)}}return a},Lge=(r,e,t,n,s,i,o)=>{function a(c={}){return cU(e,n,s,i,o,c)}return a};async function*cU(r,e,t,n,s,i){const o=r.Links;for(const a of o){const c=a.Name!=null?a.Name.substring(2):null;if(c)yield(await t(a.Hash,c,`${e}/${c}`,[],n+1,s,i)).entry;else{const u=await s.get(a.Hash);r=hr(u);for await(const l of cU(r,e,t,n,s,i))yield l}}}const Mge=(r,e)=>{const t=r.Links.find(n=>n.Name===e);return t&&t.Hash},Uge={raw:gT,file:gT,directory:Nge,"hamt-sharded-directory":Lge,metadata:(r,e,t,n,s,i,o)=>()=>[],symlink:(r,e,t,n,s,i,o)=>()=>[]},Bge=async(r,e,t,n,s,i,o,a)=>{const c=await o.get(r,a),u=hr(c);let l,h;if(e||(e=r.toString()),u.Data==null)throw T(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=Ot.unmarshal(u.Data)}catch(f){throw T(f,"ERR_NOT_UNIXFS")}if(t||(t=e),n.length){let f;if(l&&l.type==="hamt-sharded-directory"?f=await oU(u,n[0],o):f=Mge(u,n[0]),!f)throw T(new Error("file does not exist"),"ERR_NOT_FOUND");const y=n.shift(),d=`${t}/${y}`;h={cid:f,toResolve:n,name:y||"",path:d}}return{entry:{type:l.isDirectory()?"directory":"file",name:e,path:t,cid:r,content:Uge[l.type](r,u,l,t,s,i,o),unixfs:l,depth:i,node:u,size:l.fileSize()},next:h}},zge=r=>{async function*e(t={}){const{offset:n,length:s}=Tv(r.length,t.offset,t.length);yield Qy(r,0,n,n+s)}return e},Fge=async(r,e,t,n,s,i,o,a)=>{if(n.length)throw T(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");const c=await o.get(r,a);return{entry:{type:"raw",name:e,path:t,cid:r,content:zge(c),depth:i,size:c.length,node:c}}},Vge=async(r,e,t,n,s,i,o,a)=>{const c=await o.get(r),u=Hw(c);let l=u,h=t;for(;n.length;){const f=n[0];if(f in l){n.shift(),h=`${h}/${f}`;const y=D2.asCID(l[f]);if(y)return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:i,size:c.length,content:async function*(){yield u}},next:{cid:y,name:f,path:h,toResolve:n}};l=l[f]}else throw T(new Error(`No property named ${f} found in cbor node ${r}`),"ERR_NO_PROP")}return{entry:{type:"object",name:e,path:t,cid:r,node:c,depth:i,size:c.length,content:async function*(){yield u}}}},jge=r=>{async function*e(t={}){const{offset:n,length:s}=Tv(r.length,t.offset,t.length);yield Qy(r,0,n,n+s)}return e},Kge=async(r,e,t,n,s,i,o,a)=>{if(n.length)throw T(new Error(`No link named ${t} found in raw node ${r}`),"ERR_NOT_FOUND");const c=await ZM(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:jge(c.digest),depth:i,size:c.digest.length,node:c.digest}}},qge={[jt]:Bge,[nU]:Fge,[Z7]:Vge,[Dge.code]:Kge};function lU(r,e,t,n,s,i,o){const a=qge[r.code];if(!a)throw T(new Error(`No resolver for code ${r.code}`),"ERR_NO_RESOLVER");return a(r,e,t,n,lU,s,i,o)}const Hge=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),Gge=r=>{if(r instanceof Uint8Array)return{cid:D2.decode(r),toResolve:[]};const e=D2.asCID(r);if(e)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));const t=Hge(r);return{cid:D2.parse(t[0]),toResolve:t.slice(1)}}throw T(new Error(`Unknown path type ${r}`),"ERR_BAD_PATH")};async function*uU(r,e,t={}){let{cid:n,toResolve:s}=Gge(r),i=n.toString(),o=i;const a=s.length;for(;;){const c=await lU(n,i,o,s,a,e,t);if(!c.entry&&!c.next)throw T(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;s=c.next.toResolve,n=c.next.cid,i=c.next.name,o=c.next.path}}async function Sa(r,e,t={}){const n=await ks(uU(r,e,t));if(!n)throw T(new Error(`Could not resolve ${r}`),"ERR_NOT_FOUND");return n}async function*hU(r,e,t={}){const n=await Sa(r,e,t);if(!n)return;if(yield n,n.type==="directory")for await(const i of s(n,t))yield i;async function*s(i,o){for await(const a of i.content(o))yield a,!(a instanceof Uint8Array)&&a.type==="directory"&&(yield*s(a,o))}}function Wge({repo:r,preload:e}){async function*t(n,s={}){if(n=IE(n),s.preload!==!1){const o=n.split("/");e(we.parse(o[0]))}const i=await Sa(n,r.blocks,s);if(i.type==="directory")throw new Error("this dag node is a directory");if(!i.content)throw new Error("this dag node has no content");yield*i.content(s)}return Y(t)}M("ustar\0","binary");M("ustar ","binary");M(" \0","binary");function Qge(r){const e=async function*(){let t=yield,n=new Se;for await(const s of r){if(t==null){n.append(s),t=yield n,n=new Se;continue}for(n.append(s);n.length>=t;){const i=n.sublist(0,t);if(n.consume(t),t=yield i,t==null){n.length>0&&(t=yield n,n=new Se);break}}}if(t!=null)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e}var Yge={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:256,RTLD_LOCAL:0,RTLD_DEEPBIND:8,E2BIG:7,EACCES:13,EADDRINUSE:98,EADDRNOTAVAIL:99,EAFNOSUPPORT:97,EAGAIN:11,EALREADY:114,EBADF:9,EBADMSG:74,EBUSY:16,ECANCELED:125,ECHILD:10,ECONNABORTED:103,ECONNREFUSED:111,ECONNRESET:104,EDEADLK:35,EDESTADDRREQ:89,EDOM:33,EDQUOT:122,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:113,EIDRM:43,EILSEQ:84,EINPROGRESS:115,EINTR:4,EINVAL:22,EIO:5,EISCONN:106,EISDIR:21,ELOOP:40,EMFILE:24,EMLINK:31,EMSGSIZE:90,EMULTIHOP:72,ENAMETOOLONG:36,ENETDOWN:100,ENETRESET:102,ENETUNREACH:101,ENFILE:23,ENOBUFS:105,ENODATA:61,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:37,ENOLINK:67,ENOMEM:12,ENOMSG:42,ENOPROTOOPT:92,ENOSPC:28,ENOSR:63,ENOSTR:60,ENOSYS:38,ENOTCONN:107,ENOTDIR:20,ENOTEMPTY:39,ENOTSOCK:88,ENOTSUP:95,ENOTTY:25,ENXIO:6,EOPNOTSUPP:95,EOVERFLOW:75,EPERM:1,EPIPE:32,EPROTO:71,EPROTONOSUPPORT:93,EPROTOTYPE:91,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:116,ETIME:62,ETIMEDOUT:110,ETXTBSY:26,EWOULDBLOCK:11,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:7,SIGFPE:8,SIGKILL:9,SIGUSR1:10,SIGSEGV:11,SIGUSR2:12,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:17,SIGSTKFLT:16,SIGCONT:18,SIGSTOP:19,SIGTSTP:20,SIGTTIN:21,SIGTTOU:22,SIGURG:23,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:29,SIGPOLL:29,SIGPWR:30,SIGSYS:31,SIGUNUSED:31,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,UV_FS_O_FILEMAP:0,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DSYNC:4096,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:269488495,SSL_OP_ALL:2147485780,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6};const Xge=Et(Yge);async function n5(r){let e=new Uint8Array(0);for await(const t of r)e=z([e,t],e.length+t.length);return e}const Jge="0000000000000000000",Zge="7777777777777777777",ewe="0".charCodeAt(0),twe=M("ustar\0","binary"),rwe=M("00","binary"),nwe=parseInt("7777",8),swe=257,iwe=263,owe=function(r){switch(r){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72;default:return 0}},awe=function(r){let e=256;for(let t=0;t<148;t++)e+=r[t];for(let t=156;t<512;t++)e+=r[t];return e},Na=function(r,e){const t=r.toString(8);return t.length>e?M(Zge.slice(0,e)+" "):M(Jge.slice(0,e-t.length)+t+" ")},a6=function(r){const e=M(r).byteLength;let t=Math.floor(Math.log(e)/Math.log(10))+1;return e+t>=Math.pow(10,t)&&t++,`${e+t}${r}`};function cwe(r){let e="";r.name!=null&&(e+=a6(" path="+r.name+`
`)),r.linkname!=null&&(e+=a6(" linkpath="+r.linkname+`
`));const t=r.pax;if(t!=null)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e+=a6(" "+n+"="+t[n]+`
`));return M(e)}function s5(r){const e=new Uint8Array(512);let t=r.name,n="";if(r.typeflag===5&&t[t.length-1]!=="/"&&(t+="/"),M(t).byteLength!==t.length)return null;for(;M(t).byteLength>100;){const s=t.indexOf("/");if(s===-1)return null;n+=n!==""?"/"+t.slice(0,s):t.slice(0,s),t=t.slice(s+1)}return M(t).byteLength>100||M(n).byteLength>155||r.linkname!=null&&M(r.linkname).byteLength>100?null:(e.set(M(t),0),e.set(Na(r.mode&nwe,6),100),e.set(Na(r.uid,6),108),e.set(Na(r.gid,6),116),e.set(Na(r.size,11),124),e.set(Na(r.mtime.getTime()/1e3|0,11),136),e[156]=ewe+owe(r.type),r.linkname!=null&&e.set(M(r.linkname),157),e.set(twe,swe),e.set(rwe,iwe),r.uname!=null&&e.set(M(r.uname),265),r.gname!=null&&e.set(M(r.gname),297),e.set(Na(r.devmajor??0,6),329),e.set(Na(r.devminor??0,6),337),n!=null&&e.set(M(n),345),e.set(Na(awe(e),6),148),e)}const{S_IFMT:lwe,S_IFBLK:uwe,S_IFCHR:hwe,S_IFDIR:dwe,S_IFIFO:fwe,S_IFLNK:pwe}=Xge,ywe=parseInt("755",8),gwe=parseInt("644",8),dU=new Uint8Array(1024);function wwe(r=0){switch(r&lwe){case uwe:return"block-device";case hwe:return"character-device";case dwe:return"directory";case fwe:return"fifo";case pwe:return"symlink";default:return"file"}}function i5(r){return r&=511,r!==0?dU.subarray(0,512-r):new Uint8Array(0)}function c6(r){if(r.pax==null){const e=s5(r);if(e!=null)return e}return bwe(r)}function bwe(r){const e=cwe(r),t={name:"PaxHeader",mode:r.mode,uid:r.uid,gid:r.gid,size:e.length,mtime:r.mtime,type:"pax-header",linkname:r.linkname,uname:r.uname,gname:r.gname,devmajor:r.devmajor,devminor:r.devminor};return new Se(s5(t)??new Uint8Array(0),e,i5(e.length),s5({...t,size:r.size,type:r.type})??new Uint8Array(0)).subarray()}function wT(){return async function*(r){for await(let{header:e,body:t}of r){const n={...e,size:e.type==="symlink"?0:e.size??0,type:e.type??wwe(e.mode),mode:e.mode??(e.type==="directory"?ywe:gwe),uid:e.uid??0,gid:e.gid??0,mtime:e.mtime??new Date};if(typeof t=="string"&&(t=M(t)),t instanceof Uint8Array||gl(t)){n.size=t.length,yield c6(n),yield gl(t)?t.subarray():t,yield i5(n.size);continue}if(n.type==="symlink"&&n.linkname==null){if(t==null)throw new Error("type was symlink but no linkname or body specified");n.linkname=R(await n5(t)),yield c6(n);continue}if(yield c6(n),n.type!=="file"&&n.type!=="contiguous-file")continue;let s=0;for await(const i of t??[])s+=i.length,yield gl(i)?i.subarray():i;if(s!==n.size)throw new Error(`size mismatch, wrote ${s} of ${n.size} bytes`);yield i5(n.size)}yield dU}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const mwe=4,bT=0,mT=1,Ewe=2;function ud(r){let e=r.length;for(;--e>=0;)r[e]=0}const vwe=0,fU=1,_we=2,Swe=3,Awe=258,Iv=29,zp=256,B1=zp+1+Iv,lh=30,Rv=19,pU=2*B1+1,bl=15,l6=16,$we=7,Cv=256,yU=16,gU=17,wU=18,o5=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),P2=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Twe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Iwe=512,Zo=new Array((B1+2)*2);ud(Zo);const l1=new Array(lh*2);ud(l1);const z1=new Array(Iwe);ud(z1);const F1=new Array(Awe-Swe+1);ud(F1);const xv=new Array(Iv);ud(xv);const Yy=new Array(lh);ud(Yy);function u6(r,e,t,n,s){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=s,this.has_stree=r&&r.length}let mU,EU,vU;function h6(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}const _U=r=>r<256?z1[r]:z1[256+(r>>>7)],V1=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},gs=(r,e,t)=>{r.bi_valid>l6-t?(r.bi_buf|=e<<r.bi_valid&65535,V1(r,r.bi_buf),r.bi_buf=e>>l6-r.bi_valid,r.bi_valid+=t-l6):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},Eo=(r,e,t)=>{gs(r,t[e*2],t[e*2+1])},SU=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},Rwe=r=>{r.bi_valid===16?(V1(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},Cwe=(r,e)=>{const t=e.dyn_tree,n=e.max_code,s=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let u,l,h,f,y,d,p=0;for(f=0;f<=bl;f++)r.bl_count[f]=0;for(t[r.heap[r.heap_max]*2+1]=0,u=r.heap_max+1;u<pU;u++)l=r.heap[u],f=t[t[l*2+1]*2+1]+1,f>c&&(f=c,p++),t[l*2+1]=f,!(l>n)&&(r.bl_count[f]++,y=0,l>=a&&(y=o[l-a]),d=t[l*2],r.opt_len+=d*(f+y),i&&(r.static_len+=d*(s[l*2+1]+y)));if(p!==0){do{for(f=c-1;r.bl_count[f]===0;)f--;r.bl_count[f]--,r.bl_count[f+1]+=2,r.bl_count[c]--,p-=2}while(p>0);for(f=c;f!==0;f--)for(l=r.bl_count[f];l!==0;)h=r.heap[--u],!(h>n)&&(t[h*2+1]!==f&&(r.opt_len+=(f-t[h*2+1])*t[h*2],t[h*2+1]=f),l--)}},AU=(r,e,t)=>{const n=new Array(bl+1);let s=0,i,o;for(i=1;i<=bl;i++)s=s+t[i-1]<<1,n[i]=s;for(o=0;o<=e;o++){let a=r[o*2+1];a!==0&&(r[o*2]=SU(n[a]++,a))}},xwe=()=>{let r,e,t,n,s;const i=new Array(bl+1);for(t=0,n=0;n<Iv-1;n++)for(xv[n]=t,r=0;r<1<<o5[n];r++)F1[t++]=n;for(F1[t-1]=n,s=0,n=0;n<16;n++)for(Yy[n]=s,r=0;r<1<<P2[n];r++)z1[s++]=n;for(s>>=7;n<lh;n++)for(Yy[n]=s<<7,r=0;r<1<<P2[n]-7;r++)z1[256+s++]=n;for(e=0;e<=bl;e++)i[e]=0;for(r=0;r<=143;)Zo[r*2+1]=8,r++,i[8]++;for(;r<=255;)Zo[r*2+1]=9,r++,i[9]++;for(;r<=279;)Zo[r*2+1]=7,r++,i[7]++;for(;r<=287;)Zo[r*2+1]=8,r++,i[8]++;for(AU(Zo,B1+1,i),r=0;r<lh;r++)l1[r*2+1]=5,l1[r*2]=SU(r,5);mU=new u6(Zo,o5,zp+1,B1,bl),EU=new u6(l1,P2,0,lh,bl),vU=new u6(new Array(0),Twe,0,Rv,$we)},$U=r=>{let e;for(e=0;e<B1;e++)r.dyn_ltree[e*2]=0;for(e=0;e<lh;e++)r.dyn_dtree[e*2]=0;for(e=0;e<Rv;e++)r.bl_tree[e*2]=0;r.dyn_ltree[Cv*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},TU=r=>{r.bi_valid>8?V1(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},ET=(r,e,t,n)=>{const s=e*2,i=t*2;return r[s]<r[i]||r[s]===r[i]&&n[e]<=n[t]},d6=(r,e,t)=>{const n=r.heap[t];let s=t<<1;for(;s<=r.heap_len&&(s<r.heap_len&&ET(e,r.heap[s+1],r.heap[s],r.depth)&&s++,!ET(e,n,r.heap[s],r.depth));)r.heap[t]=r.heap[s],t=s,s<<=1;r.heap[t]=n},vT=(r,e,t)=>{let n,s,i=0,o,a;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+i++]&255,n+=(r.pending_buf[r.sym_buf+i++]&255)<<8,s=r.pending_buf[r.sym_buf+i++],n===0?Eo(r,s,e):(o=F1[s],Eo(r,o+zp+1,e),a=o5[o],a!==0&&(s-=xv[o],gs(r,s,a)),n--,o=_U(n),Eo(r,o,t),a=P2[o],a!==0&&(n-=Yy[o],gs(r,n,a)));while(i<r.sym_next);Eo(r,Cv,e)},a5=(r,e)=>{const t=e.dyn_tree,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,i=e.stat_desc.elems;let o,a,c=-1,u;for(r.heap_len=0,r.heap_max=pU,o=0;o<i;o++)t[o*2]!==0?(r.heap[++r.heap_len]=c=o,r.depth[o]=0):t[o*2+1]=0;for(;r.heap_len<2;)u=r.heap[++r.heap_len]=c<2?++c:0,t[u*2]=1,r.depth[u]=0,r.opt_len--,s&&(r.static_len-=n[u*2+1]);for(e.max_code=c,o=r.heap_len>>1;o>=1;o--)d6(r,t,o);u=i;do o=r.heap[1],r.heap[1]=r.heap[r.heap_len--],d6(r,t,1),a=r.heap[1],r.heap[--r.heap_max]=o,r.heap[--r.heap_max]=a,t[u*2]=t[o*2]+t[a*2],r.depth[u]=(r.depth[o]>=r.depth[a]?r.depth[o]:r.depth[a])+1,t[o*2+1]=t[a*2+1]=u,r.heap[1]=u++,d6(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],Cwe(r,e),AU(t,c,r.bl_count)},_T=(r,e,t)=>{let n,s=-1,i,o=e[0*2+1],a=0,c=7,u=4;for(o===0&&(c=138,u=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)i=o,o=e[(n+1)*2+1],!(++a<c&&i===o)&&(a<u?r.bl_tree[i*2]+=a:i!==0?(i!==s&&r.bl_tree[i*2]++,r.bl_tree[yU*2]++):a<=10?r.bl_tree[gU*2]++:r.bl_tree[wU*2]++,a=0,s=i,o===0?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4))},ST=(r,e,t)=>{let n,s=-1,i,o=e[0*2+1],a=0,c=7,u=4;for(o===0&&(c=138,u=3),n=0;n<=t;n++)if(i=o,o=e[(n+1)*2+1],!(++a<c&&i===o)){if(a<u)do Eo(r,i,r.bl_tree);while(--a!==0);else i!==0?(i!==s&&(Eo(r,i,r.bl_tree),a--),Eo(r,yU,r.bl_tree),gs(r,a-3,2)):a<=10?(Eo(r,gU,r.bl_tree),gs(r,a-3,3)):(Eo(r,wU,r.bl_tree),gs(r,a-11,7));a=0,s=i,o===0?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4)}},Dwe=r=>{let e;for(_T(r,r.dyn_ltree,r.l_desc.max_code),_T(r,r.dyn_dtree,r.d_desc.max_code),a5(r,r.bl_desc),e=Rv-1;e>=3&&r.bl_tree[bU[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},Pwe=(r,e,t,n)=>{let s;for(gs(r,e-257,5),gs(r,t-1,5),gs(r,n-4,4),s=0;s<n;s++)gs(r,r.bl_tree[bU[s]*2+1],3);ST(r,r.dyn_ltree,e-1),ST(r,r.dyn_dtree,t-1)},Owe=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return bT;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return mT;for(t=32;t<zp;t++)if(r.dyn_ltree[t*2]!==0)return mT;return bT};let AT=!1;const kwe=r=>{AT||(xwe(),AT=!0),r.l_desc=new h6(r.dyn_ltree,mU),r.d_desc=new h6(r.dyn_dtree,EU),r.bl_desc=new h6(r.bl_tree,vU),r.bi_buf=0,r.bi_valid=0,$U(r)},IU=(r,e,t,n)=>{gs(r,(vwe<<1)+(n?1:0),3),TU(r),V1(r,t),V1(r,~t),t&&r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},Nwe=r=>{gs(r,fU<<1,3),Eo(r,Cv,Zo),Rwe(r)},Lwe=(r,e,t,n)=>{let s,i,o=0;r.level>0?(r.strm.data_type===Ewe&&(r.strm.data_type=Owe(r)),a5(r,r.l_desc),a5(r,r.d_desc),o=Dwe(r),s=r.opt_len+3+7>>>3,i=r.static_len+3+7>>>3,i<=s&&(s=i)):s=i=t+5,t+4<=s&&e!==-1?IU(r,e,t,n):r.strategy===mwe||i===s?(gs(r,(fU<<1)+(n?1:0),3),vT(r,Zo,l1)):(gs(r,(_we<<1)+(n?1:0),3),Pwe(r,r.l_desc.max_code+1,r.d_desc.max_code+1,o+1),vT(r,r.dyn_ltree,r.dyn_dtree)),$U(r),n&&TU(r)},Mwe=(r,e,t)=>(r.pending_buf[r.sym_buf+r.sym_next++]=e,r.pending_buf[r.sym_buf+r.sym_next++]=e>>8,r.pending_buf[r.sym_buf+r.sym_next++]=t,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(F1[t]+zp+1)*2]++,r.dyn_dtree[_U(e)*2]++),r.sym_next===r.sym_end);var Uwe=kwe,Bwe=IU,zwe=Lwe,Fwe=Mwe,Vwe=Nwe,jwe={_tr_init:Uwe,_tr_stored_block:Bwe,_tr_flush_block:zwe,_tr_tally:Fwe,_tr_align:Vwe};const Kwe=(r,e,t,n)=>{let s=r&65535|0,i=r>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do s=s+e[n++]|0,i=i+s|0;while(--o);s%=65521,i%=65521}return s|i<<16|0};var j1=Kwe;const qwe=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},Hwe=new Uint32Array(qwe()),Gwe=(r,e,t,n)=>{const s=Hwe,i=n+t;r^=-1;for(let o=n;o<i;o++)r=r>>>8^s[(r^e[o])&255];return r^-1};var Rr=Gwe,ql={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},yu={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Wwe,_tr_stored_block:c5,_tr_flush_block:Qwe,_tr_tally:$c,_tr_align:Ywe}=jwe,{Z_NO_FLUSH:Tc,Z_PARTIAL_FLUSH:Xwe,Z_FULL_FLUSH:Jwe,Z_FINISH:ci,Z_BLOCK:$T,Z_OK:Or,Z_STREAM_END:TT,Z_STREAM_ERROR:_o,Z_DATA_ERROR:Zwe,Z_BUF_ERROR:f6,Z_DEFAULT_COMPRESSION:ebe,Z_FILTERED:tbe,Z_HUFFMAN_ONLY:D0,Z_RLE:rbe,Z_FIXED:nbe,Z_DEFAULT_STRATEGY:sbe,Z_UNKNOWN:ibe,Z_DEFLATED:Sb}=yu,obe=9,abe=15,cbe=8,lbe=29,ube=256,l5=ube+1+lbe,hbe=30,dbe=19,fbe=2*l5+1,pbe=15,Le=3,yc=258,So=yc+Le+1,ybe=32,Dh=42,Dv=57,u5=69,h5=73,d5=91,f5=103,ml=113,Kf=666,cs=1,hd=2,Hl=3,dd=4,gbe=3,El=(r,e)=>(r.msg=ql[e],e),IT=r=>r*2-(r>4?9:0),ac=r=>{let e=r.length;for(;--e>=0;)r[e]=0},wbe=r=>{let e,t,n,s=r.w_size;e=r.hash_size,n=e;do t=r.head[--n],r.head[n]=t>=s?t-s:0;while(--e);e=s,n=e;do t=r.prev[--n],r.prev[n]=t>=s?t-s:0;while(--e)};let bbe=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,Ic=bbe;const $s=r=>{const e=r.state;let t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Rs=(r,e)=>{Qwe(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,$s(r.strm)},tt=(r,e)=>{r.pending_buf[r.pending++]=e},Kd=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},p5=(r,e,t,n)=>{let s=r.avail_in;return s>n&&(s=n),s===0?0:(r.avail_in-=s,e.set(r.input.subarray(r.next_in,r.next_in+s),t),r.state.wrap===1?r.adler=j1(r.adler,e,s,t):r.state.wrap===2&&(r.adler=Rr(r.adler,e,s,t)),r.next_in+=s,r.total_in+=s,s)},RU=(r,e)=>{let t=r.max_chain_length,n=r.strstart,s,i,o=r.prev_length,a=r.nice_match;const c=r.strstart>r.w_size-So?r.strstart-(r.w_size-So):0,u=r.window,l=r.w_mask,h=r.prev,f=r.strstart+yc;let y=u[n+o-1],d=u[n+o];r.prev_length>=r.good_match&&(t>>=2),a>r.lookahead&&(a=r.lookahead);do if(s=e,!(u[s+o]!==d||u[s+o-1]!==y||u[s]!==u[n]||u[++s]!==u[n+1])){n+=2,s++;do;while(u[++n]===u[++s]&&u[++n]===u[++s]&&u[++n]===u[++s]&&u[++n]===u[++s]&&u[++n]===u[++s]&&u[++n]===u[++s]&&u[++n]===u[++s]&&u[++n]===u[++s]&&n<f);if(i=yc-(f-n),n=f-yc,i>o){if(r.match_start=e,o=i,i>=a)break;y=u[n+o-1],d=u[n+o]}}while((e=h[e&l])>c&&--t!==0);return o<=r.lookahead?o:r.lookahead},Ph=r=>{const e=r.w_size;let t,n,s;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-So)&&(r.window.set(r.window.subarray(e,e+e-n),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,r.insert>r.strstart&&(r.insert=r.strstart),wbe(r),n+=e),r.strm.avail_in===0)break;if(t=p5(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=t,r.lookahead+r.insert>=Le)for(s=r.strstart-r.insert,r.ins_h=r.window[s],r.ins_h=Ic(r,r.ins_h,r.window[s+1]);r.insert&&(r.ins_h=Ic(r,r.ins_h,r.window[s+Le-1]),r.prev[s&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=s,s++,r.insert--,!(r.lookahead+r.insert<Le)););}while(r.lookahead<So&&r.strm.avail_in!==0)},CU=(r,e)=>{let t=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,s,i,o=0,a=r.strm.avail_in;do{if(n=65535,i=r.bi_valid+42>>3,r.strm.avail_out<i||(i=r.strm.avail_out-i,s=r.strstart-r.block_start,n>s+r.strm.avail_in&&(n=s+r.strm.avail_in),n>i&&(n=i),n<t&&(n===0&&e!==ci||e===Tc||n!==s+r.strm.avail_in)))break;o=e===ci&&n===s+r.strm.avail_in?1:0,c5(r,0,0,o),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,$s(r.strm),s&&(s>n&&(s=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+s),r.strm.next_out),r.strm.next_out+=s,r.strm.avail_out-=s,r.strm.total_out+=s,r.block_start+=s,n-=s),n&&(p5(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(o===0);return a-=r.strm.avail_in,a&&(a>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=a&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-a,r.strm.next_in),r.strstart),r.strstart+=a,r.insert+=a>r.w_size-r.insert?r.w_size-r.insert:a),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),o?dd:e!==Tc&&e!==ci&&r.strm.avail_in===0&&r.strstart===r.block_start?hd:(i=r.window_size-r.strstart,r.strm.avail_in>i&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,i+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),i>r.strm.avail_in&&(i=r.strm.avail_in),i&&(p5(r.strm,r.window,r.strstart,i),r.strstart+=i,r.insert+=i>r.w_size-r.insert?r.w_size-r.insert:i),r.high_water<r.strstart&&(r.high_water=r.strstart),i=r.bi_valid+42>>3,i=r.pending_buf_size-i>65535?65535:r.pending_buf_size-i,t=i>r.w_size?r.w_size:i,s=r.strstart-r.block_start,(s>=t||(s||e===ci)&&e!==Tc&&r.strm.avail_in===0&&s<=i)&&(n=s>i?i:s,o=e===ci&&r.strm.avail_in===0&&n===s?1:0,c5(r,r.block_start,n,o),r.block_start+=n,$s(r.strm)),o?Hl:cs)},p6=(r,e)=>{let t,n;for(;;){if(r.lookahead<So){if(Ph(r),r.lookahead<So&&e===Tc)return cs;if(r.lookahead===0)break}if(t=0,r.lookahead>=Le&&(r.ins_h=Ic(r,r.ins_h,r.window[r.strstart+Le-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-So&&(r.match_length=RU(r,t)),r.match_length>=Le)if(n=$c(r,r.strstart-r.match_start,r.match_length-Le),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=Le){r.match_length--;do r.strstart++,r.ins_h=Ic(r,r.ins_h,r.window[r.strstart+Le-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=Ic(r,r.ins_h,r.window[r.strstart+1]);else n=$c(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Rs(r,!1),r.strm.avail_out===0))return cs}return r.insert=r.strstart<Le-1?r.strstart:Le-1,e===ci?(Rs(r,!0),r.strm.avail_out===0?Hl:dd):r.sym_next&&(Rs(r,!1),r.strm.avail_out===0)?cs:hd},$u=(r,e)=>{let t,n,s;for(;;){if(r.lookahead<So){if(Ph(r),r.lookahead<So&&e===Tc)return cs;if(r.lookahead===0)break}if(t=0,r.lookahead>=Le&&(r.ins_h=Ic(r,r.ins_h,r.window[r.strstart+Le-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=Le-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-So&&(r.match_length=RU(r,t),r.match_length<=5&&(r.strategy===tbe||r.match_length===Le&&r.strstart-r.match_start>4096)&&(r.match_length=Le-1)),r.prev_length>=Le&&r.match_length<=r.prev_length){s=r.strstart+r.lookahead-Le,n=$c(r,r.strstart-1-r.prev_match,r.prev_length-Le),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=s&&(r.ins_h=Ic(r,r.ins_h,r.window[r.strstart+Le-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=Le-1,r.strstart++,n&&(Rs(r,!1),r.strm.avail_out===0))return cs}else if(r.match_available){if(n=$c(r,0,r.window[r.strstart-1]),n&&Rs(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return cs}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=$c(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<Le-1?r.strstart:Le-1,e===ci?(Rs(r,!0),r.strm.avail_out===0?Hl:dd):r.sym_next&&(Rs(r,!1),r.strm.avail_out===0)?cs:hd},mbe=(r,e)=>{let t,n,s,i;const o=r.window;for(;;){if(r.lookahead<=yc){if(Ph(r),r.lookahead<=yc&&e===Tc)return cs;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=Le&&r.strstart>0&&(s=r.strstart-1,n=o[s],n===o[++s]&&n===o[++s]&&n===o[++s])){i=r.strstart+yc;do;while(n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&n===o[++s]&&s<i);r.match_length=yc-(i-s),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=Le?(t=$c(r,1,r.match_length-Le),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=$c(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Rs(r,!1),r.strm.avail_out===0))return cs}return r.insert=0,e===ci?(Rs(r,!0),r.strm.avail_out===0?Hl:dd):r.sym_next&&(Rs(r,!1),r.strm.avail_out===0)?cs:hd},Ebe=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(Ph(r),r.lookahead===0)){if(e===Tc)return cs;break}if(r.match_length=0,t=$c(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Rs(r,!1),r.strm.avail_out===0))return cs}return r.insert=0,e===ci?(Rs(r,!0),r.strm.avail_out===0?Hl:dd):r.sym_next&&(Rs(r,!1),r.strm.avail_out===0)?cs:hd};function io(r,e,t,n,s){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=s}const qf=[new io(0,0,0,0,CU),new io(4,4,8,4,p6),new io(4,5,16,8,p6),new io(4,6,32,32,p6),new io(4,4,16,16,$u),new io(8,16,32,32,$u),new io(8,16,128,128,$u),new io(8,32,128,256,$u),new io(32,128,258,1024,$u),new io(32,258,258,4096,$u)],vbe=r=>{r.window_size=2*r.w_size,ac(r.head),r.max_lazy_match=qf[r.level].max_lazy,r.good_match=qf[r.level].good_length,r.nice_match=qf[r.level].nice_length,r.max_chain_length=qf[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=Le-1,r.match_available=0,r.ins_h=0};function _be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Sb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(fbe*2),this.dyn_dtree=new Uint16Array((2*hbe+1)*2),this.bl_tree=new Uint16Array((2*dbe+1)*2),ac(this.dyn_ltree),ac(this.dyn_dtree),ac(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(pbe+1),this.heap=new Uint16Array(2*l5+1),ac(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*l5+1),ac(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Fp=r=>{if(!r)return 1;const e=r.state;return!e||e.strm!==r||e.status!==Dh&&e.status!==Dv&&e.status!==u5&&e.status!==h5&&e.status!==d5&&e.status!==f5&&e.status!==ml&&e.status!==Kf?1:0},xU=r=>{if(Fp(r))return El(r,_o);r.total_in=r.total_out=0,r.data_type=ibe;const e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Dv:e.wrap?Dh:ml,r.adler=e.wrap===2?0:1,e.last_flush=-2,Wwe(e),Or},DU=r=>{const e=xU(r);return e===Or&&vbe(r.state),e},Sbe=(r,e)=>Fp(r)||r.state.wrap!==2?_o:(r.state.gzhead=e,Or),PU=(r,e,t,n,s,i)=>{if(!r)return _o;let o=1;if(e===ebe&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>obe||t!==Sb||n<8||n>15||e<0||e>9||i<0||i>nbe||n===8&&o!==1)return El(r,_o);n===8&&(n=9);const a=new _be;return r.state=a,a.strm=r,a.status=Dh,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Le-1)/Le),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=i,a.method=t,DU(r)},Abe=(r,e)=>PU(r,e,Sb,abe,cbe,sbe),$be=(r,e)=>{if(Fp(r)||e>$T||e<0)return r?El(r,_o):_o;const t=r.state;if(!r.output||r.avail_in!==0&&!r.input||t.status===Kf&&e!==ci)return El(r,r.avail_out===0?f6:_o);const n=t.last_flush;if(t.last_flush=e,t.pending!==0){if($s(r),r.avail_out===0)return t.last_flush=-1,Or}else if(r.avail_in===0&&IT(e)<=IT(n)&&e!==ci)return El(r,f6);if(t.status===Kf&&r.avail_in!==0)return El(r,f6);if(t.status===Dh&&t.wrap===0&&(t.status=ml),t.status===Dh){let s=Sb+(t.w_bits-8<<4)<<8,i=-1;if(t.strategy>=D0||t.level<2?i=0:t.level<6?i=1:t.level===6?i=2:i=3,s|=i<<6,t.strstart!==0&&(s|=ybe),s+=31-s%31,Kd(t,s),t.strstart!==0&&(Kd(t,r.adler>>>16),Kd(t,r.adler&65535)),r.adler=1,t.status=ml,$s(r),t.pending!==0)return t.last_flush=-1,Or}if(t.status===Dv){if(r.adler=0,tt(t,31),tt(t,139),tt(t,8),t.gzhead)tt(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),tt(t,t.gzhead.time&255),tt(t,t.gzhead.time>>8&255),tt(t,t.gzhead.time>>16&255),tt(t,t.gzhead.time>>24&255),tt(t,t.level===9?2:t.strategy>=D0||t.level<2?4:0),tt(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(tt(t,t.gzhead.extra.length&255),tt(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=Rr(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=u5;else if(tt(t,0),tt(t,0),tt(t,0),tt(t,0),tt(t,0),tt(t,t.level===9?2:t.strategy>=D0||t.level<2?4:0),tt(t,gbe),t.status=ml,$s(r),t.pending!==0)return t.last_flush=-1,Or}if(t.status===u5){if(t.gzhead.extra){let s=t.pending,i=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+i>t.pending_buf_size;){let a=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+a),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>s&&(r.adler=Rr(r.adler,t.pending_buf,t.pending-s,s)),t.gzindex+=a,$s(r),t.pending!==0)return t.last_flush=-1,Or;s=0,i-=a}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+i),t.pending),t.pending+=i,t.gzhead.hcrc&&t.pending>s&&(r.adler=Rr(r.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=h5}if(t.status===h5){if(t.gzhead.name){let s=t.pending,i;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(r.adler=Rr(r.adler,t.pending_buf,t.pending-s,s)),$s(r),t.pending!==0)return t.last_flush=-1,Or;s=0}t.gzindex<t.gzhead.name.length?i=t.gzhead.name.charCodeAt(t.gzindex++)&255:i=0,tt(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>s&&(r.adler=Rr(r.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=d5}if(t.status===d5){if(t.gzhead.comment){let s=t.pending,i;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(r.adler=Rr(r.adler,t.pending_buf,t.pending-s,s)),$s(r),t.pending!==0)return t.last_flush=-1,Or;s=0}t.gzindex<t.gzhead.comment.length?i=t.gzhead.comment.charCodeAt(t.gzindex++)&255:i=0,tt(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>s&&(r.adler=Rr(r.adler,t.pending_buf,t.pending-s,s))}t.status=f5}if(t.status===f5){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&($s(r),t.pending!==0))return t.last_flush=-1,Or;tt(t,r.adler&255),tt(t,r.adler>>8&255),r.adler=0}if(t.status=ml,$s(r),t.pending!==0)return t.last_flush=-1,Or}if(r.avail_in!==0||t.lookahead!==0||e!==Tc&&t.status!==Kf){let s=t.level===0?CU(t,e):t.strategy===D0?Ebe(t,e):t.strategy===rbe?mbe(t,e):qf[t.level].func(t,e);if((s===Hl||s===dd)&&(t.status=Kf),s===cs||s===Hl)return r.avail_out===0&&(t.last_flush=-1),Or;if(s===hd&&(e===Xwe?Ywe(t):e!==$T&&(c5(t,0,0,!1),e===Jwe&&(ac(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),$s(r),r.avail_out===0))return t.last_flush=-1,Or}return e!==ci?Or:t.wrap<=0?TT:(t.wrap===2?(tt(t,r.adler&255),tt(t,r.adler>>8&255),tt(t,r.adler>>16&255),tt(t,r.adler>>24&255),tt(t,r.total_in&255),tt(t,r.total_in>>8&255),tt(t,r.total_in>>16&255),tt(t,r.total_in>>24&255)):(Kd(t,r.adler>>>16),Kd(t,r.adler&65535)),$s(r),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Or:TT)},Tbe=r=>{if(Fp(r))return _o;const e=r.state.status;return r.state=null,e===ml?El(r,Zwe):Or},Ibe=(r,e)=>{let t=e.length;if(Fp(r))return _o;const n=r.state,s=n.wrap;if(s===2||s===1&&n.status!==Dh||n.lookahead)return _o;if(s===1&&(r.adler=j1(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){s===0&&(ac(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(e.subarray(t-n.w_size,t),0),e=c,t=n.w_size}const i=r.avail_in,o=r.next_in,a=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,Ph(n);n.lookahead>=Le;){let c=n.strstart,u=n.lookahead-(Le-1);do n.ins_h=Ic(n,n.ins_h,n.window[c+Le-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--u);n.strstart=c,n.lookahead=Le-1,Ph(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Le-1,n.match_available=0,r.next_in=o,r.input=a,r.avail_in=i,n.wrap=s,Or};var Rbe=Abe,Cbe=PU,xbe=DU,Dbe=xU,Pbe=Sbe,Obe=$be,kbe=Tbe,Nbe=Ibe,Lbe="pako deflate (from Nodeca project)",u1={deflateInit:Rbe,deflateInit2:Cbe,deflateReset:xbe,deflateResetKeep:Dbe,deflateSetHeader:Pbe,deflate:Obe,deflateEnd:kbe,deflateSetDictionary:Nbe,deflateInfo:Lbe};const Mbe=(r,e)=>Object.prototype.hasOwnProperty.call(r,e);var Ube=function(r){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)Mbe(t,n)&&(r[n]=t[n])}}return r},Bbe=r=>{let e=0;for(let n=0,s=r.length;n<s;n++)e+=r[n].length;const t=new Uint8Array(e);for(let n=0,s=0,i=r.length;n<i;n++){let o=r[n];t.set(o,s),s+=o.length}return t},Ab={assign:Ube,flattenChunks:Bbe};let OU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{OU=!1}const K1=new Uint8Array(256);for(let r=0;r<256;r++)K1[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;K1[254]=K1[254]=1;var zbe=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,s,i,o=r.length,a=0;for(s=0;s<o;s++)t=r.charCodeAt(s),(t&64512)===55296&&s+1<o&&(n=r.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),i=0,s=0;i<a;s++)t=r.charCodeAt(s),(t&64512)===55296&&s+1<o&&(n=r.charCodeAt(s+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),s++)),t<128?e[i++]=t:t<2048?(e[i++]=192|t>>>6,e[i++]=128|t&63):t<65536?(e[i++]=224|t>>>12,e[i++]=128|t>>>6&63,e[i++]=128|t&63):(e[i++]=240|t>>>18,e[i++]=128|t>>>12&63,e[i++]=128|t>>>6&63,e[i++]=128|t&63);return e};const Fbe=(r,e)=>{if(e<65534&&r.subarray&&OU)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t};var Vbe=(r,e)=>{const t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,s;const i=new Array(t*2);for(s=0,n=0;n<t;){let o=r[n++];if(o<128){i[s++]=o;continue}let a=K1[o];if(a>4){i[s++]=65533,n+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&n<t;)o=o<<6|r[n++]&63,a--;if(a>1){i[s++]=65533;continue}o<65536?i[s++]=o:(o-=65536,i[s++]=55296|o>>10&1023,i[s++]=56320|o&1023)}return Fbe(i,s)},jbe=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+K1[r[t]]>e?t:e},q1={string2buf:zbe,buf2string:Vbe,utf8border:jbe};function Kbe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var kU=Kbe;const NU=Object.prototype.toString,{Z_NO_FLUSH:qbe,Z_SYNC_FLUSH:Hbe,Z_FULL_FLUSH:Gbe,Z_FINISH:Wbe,Z_OK:Xy,Z_STREAM_END:Qbe,Z_DEFAULT_COMPRESSION:Ybe,Z_DEFAULT_STRATEGY:Xbe,Z_DEFLATED:Jbe}=yu;function Vp(r){this.options=Ab.assign({level:Ybe,method:Jbe,chunkSize:16384,windowBits:15,memLevel:8,strategy:Xbe},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kU,this.strm.avail_out=0;let t=u1.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Xy)throw new Error(ql[t]);if(e.header&&u1.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=q1.string2buf(e.dictionary):NU.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=u1.deflateSetDictionary(this.strm,n),t!==Xy)throw new Error(ql[t]);this._dict_set=!0}}Vp.prototype.push=function(r,e){const t=this.strm,n=this.options.chunkSize;let s,i;if(this.ended)return!1;for(e===~~e?i=e:i=e===!0?Wbe:qbe,typeof r=="string"?t.input=q1.string2buf(r):NU.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(i===Hbe||i===Gbe)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(s=u1.deflate(t,i),s===Qbe)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),s=u1.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Xy;if(t.avail_out===0){this.onData(t.output);continue}if(i>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Vp.prototype.onData=function(r){this.chunks.push(r)};Vp.prototype.onEnd=function(r){r===Xy&&(this.result=Ab.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function Pv(r,e){const t=new Vp(e);if(t.push(r,!0),t.err)throw t.msg||ql[t.err];return t.result}function Zbe(r,e){return e=e||{},e.raw=!0,Pv(r,e)}function e3e(r,e){return e=e||{},e.gzip=!0,Pv(r,e)}var t3e=Vp,r3e=Pv,n3e=Zbe,s3e=e3e,i3e=yu,o3e={Deflate:t3e,deflate:r3e,deflateRaw:n3e,gzip:s3e,constants:i3e};const P0=16209,a3e=16191;var c3e=function(e,t){let n,s,i,o,a,c,u,l,h,f,y,d,p,b,w,S,E,m,v,A,g,_,$,x;const k=e.state;n=e.next_in,$=e.input,s=n+(e.avail_in-5),i=e.next_out,x=e.output,o=i-(t-e.avail_out),a=i+(e.avail_out-257),c=k.dmax,u=k.wsize,l=k.whave,h=k.wnext,f=k.window,y=k.hold,d=k.bits,p=k.lencode,b=k.distcode,w=(1<<k.lenbits)-1,S=(1<<k.distbits)-1;e:do{d<15&&(y+=$[n++]<<d,d+=8,y+=$[n++]<<d,d+=8),E=p[y&w];t:for(;;){if(m=E>>>24,y>>>=m,d-=m,m=E>>>16&255,m===0)x[i++]=E&65535;else if(m&16){v=E&65535,m&=15,m&&(d<m&&(y+=$[n++]<<d,d+=8),v+=y&(1<<m)-1,y>>>=m,d-=m),d<15&&(y+=$[n++]<<d,d+=8,y+=$[n++]<<d,d+=8),E=b[y&S];r:for(;;){if(m=E>>>24,y>>>=m,d-=m,m=E>>>16&255,m&16){if(A=E&65535,m&=15,d<m&&(y+=$[n++]<<d,d+=8,d<m&&(y+=$[n++]<<d,d+=8)),A+=y&(1<<m)-1,A>c){e.msg="invalid distance too far back",k.mode=P0;break e}if(y>>>=m,d-=m,m=i-o,A>m){if(m=A-m,m>l&&k.sane){e.msg="invalid distance too far back",k.mode=P0;break e}if(g=0,_=f,h===0){if(g+=u-m,m<v){v-=m;do x[i++]=f[g++];while(--m);g=i-A,_=x}}else if(h<m){if(g+=u+h-m,m-=h,m<v){v-=m;do x[i++]=f[g++];while(--m);if(g=0,h<v){m=h,v-=m;do x[i++]=f[g++];while(--m);g=i-A,_=x}}}else if(g+=h-m,m<v){v-=m;do x[i++]=f[g++];while(--m);g=i-A,_=x}for(;v>2;)x[i++]=_[g++],x[i++]=_[g++],x[i++]=_[g++],v-=3;v&&(x[i++]=_[g++],v>1&&(x[i++]=_[g++]))}else{g=i-A;do x[i++]=x[g++],x[i++]=x[g++],x[i++]=x[g++],v-=3;while(v>2);v&&(x[i++]=x[g++],v>1&&(x[i++]=x[g++]))}}else if(m&64){e.msg="invalid distance code",k.mode=P0;break e}else{E=b[(E&65535)+(y&(1<<m)-1)];continue r}break}}else if(m&64)if(m&32){k.mode=a3e;break e}else{e.msg="invalid literal/length code",k.mode=P0;break e}else{E=p[(E&65535)+(y&(1<<m)-1)];continue t}break}}while(n<s&&i<a);v=d>>3,n-=v,d-=v<<3,y&=(1<<d)-1,e.next_in=n,e.next_out=i,e.avail_in=n<s?5+(s-n):5-(n-s),e.avail_out=i<a?257+(a-i):257-(i-a),k.hold=y,k.bits=d};const Tu=15,RT=852,CT=592,xT=0,y6=1,DT=2,l3e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),u3e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h3e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d3e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),f3e=(r,e,t,n,s,i,o,a)=>{const c=a.bits;let u=0,l=0,h=0,f=0,y=0,d=0,p=0,b=0,w=0,S=0,E,m,v,A,g,_=null,$;const x=new Uint16Array(Tu+1),k=new Uint16Array(Tu+1);let j=null,G,Q,V;for(u=0;u<=Tu;u++)x[u]=0;for(l=0;l<n;l++)x[e[t+l]]++;for(y=c,f=Tu;f>=1&&x[f]===0;f--);if(y>f&&(y=f),f===0)return s[i++]=1<<24|64<<16|0,s[i++]=1<<24|64<<16|0,a.bits=1,0;for(h=1;h<f&&x[h]===0;h++);for(y<h&&(y=h),b=1,u=1;u<=Tu;u++)if(b<<=1,b-=x[u],b<0)return-1;if(b>0&&(r===xT||f!==1))return-1;for(k[1]=0,u=1;u<Tu;u++)k[u+1]=k[u]+x[u];for(l=0;l<n;l++)e[t+l]!==0&&(o[k[e[t+l]]++]=l);if(r===xT?(_=j=o,$=20):r===y6?(_=l3e,j=u3e,$=257):(_=h3e,j=d3e,$=0),S=0,l=0,u=h,g=i,d=y,p=0,v=-1,w=1<<y,A=w-1,r===y6&&w>RT||r===DT&&w>CT)return 1;for(;;){G=u-p,o[l]+1<$?(Q=0,V=o[l]):o[l]>=$?(Q=j[o[l]-$],V=_[o[l]-$]):(Q=32+64,V=0),E=1<<u-p,m=1<<d,h=m;do m-=E,s[g+(S>>p)+m]=G<<24|Q<<16|V|0;while(m!==0);for(E=1<<u-1;S&E;)E>>=1;if(E!==0?(S&=E-1,S+=E):S=0,l++,--x[u]===0){if(u===f)break;u=e[t+o[l]]}if(u>y&&(S&A)!==v){for(p===0&&(p=y),g+=h,d=u-p,b=1<<d;d+p<f&&(b-=x[d+p],!(b<=0));)d++,b<<=1;if(w+=1<<d,r===y6&&w>RT||r===DT&&w>CT)return 1;v=S&A,s[v]=y<<24|d<<16|g-i|0}}return S!==0&&(s[g+S]=u-p<<24|64<<16|0),a.bits=y,0};var h1=f3e;const p3e=0,LU=1,MU=2,{Z_FINISH:PT,Z_BLOCK:y3e,Z_TREES:O0,Z_OK:Gl,Z_STREAM_END:g3e,Z_NEED_DICT:w3e,Z_STREAM_ERROR:yi,Z_DATA_ERROR:UU,Z_MEM_ERROR:BU,Z_BUF_ERROR:b3e,Z_DEFLATED:OT}=yu,$b=16180,kT=16181,NT=16182,LT=16183,MT=16184,UT=16185,BT=16186,zT=16187,FT=16188,VT=16189,Jy=16190,Vo=16191,g6=16192,jT=16193,w6=16194,KT=16195,qT=16196,HT=16197,GT=16198,k0=16199,N0=16200,WT=16201,QT=16202,YT=16203,XT=16204,JT=16205,b6=16206,ZT=16207,eI=16208,Mt=16209,zU=16210,FU=16211,m3e=852,E3e=592,v3e=15,_3e=v3e,tI=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function S3e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const gu=r=>{if(!r)return 1;const e=r.state;return!e||e.strm!==r||e.mode<$b||e.mode>FU?1:0},VU=r=>{if(gu(r))return yi;const e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=$b,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(m3e),e.distcode=e.distdyn=new Int32Array(E3e),e.sane=1,e.back=-1,Gl},jU=r=>{if(gu(r))return yi;const e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,VU(r)},KU=(r,e)=>{let t;if(gu(r))return yi;const n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?yi:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,jU(r))},qU=(r,e)=>{if(!r)return yi;const t=new S3e;r.state=t,t.strm=r,t.window=null,t.mode=$b;const n=KU(r,e);return n!==Gl&&(r.state=null),n},A3e=r=>qU(r,_3e);let rI=!0,m6,E6;const $3e=r=>{if(rI){m6=new Int32Array(512),E6=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(h1(LU,r.lens,0,288,m6,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;h1(MU,r.lens,0,32,E6,0,r.work,{bits:5}),rI=!1}r.lencode=m6,r.lenbits=9,r.distcode=E6,r.distbits=5},HU=(r,e,t,n)=>{let s;const i=r.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(e.subarray(t-i.wsize,t),0),i.wnext=0,i.whave=i.wsize):(s=i.wsize-i.wnext,s>n&&(s=n),i.window.set(e.subarray(t-n,t-n+s),i.wnext),n-=s,n?(i.window.set(e.subarray(t-n,t),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0},T3e=(r,e)=>{let t,n,s,i,o,a,c,u,l,h,f,y,d,p,b=0,w,S,E,m,v,A,g,_;const $=new Uint8Array(4);let x,k;const j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(gu(r)||!r.output||!r.input&&r.avail_in!==0)return yi;t=r.state,t.mode===Vo&&(t.mode=g6),o=r.next_out,s=r.output,c=r.avail_out,i=r.next_in,n=r.input,a=r.avail_in,u=t.hold,l=t.bits,h=a,f=c,_=Gl;e:for(;;)switch(t.mode){case $b:if(t.wrap===0){t.mode=g6;break}for(;l<16;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(t.wrap&2&&u===35615){t.wbits===0&&(t.wbits=15),t.check=0,$[0]=u&255,$[1]=u>>>8&255,t.check=Rr(t.check,$,2,0),u=0,l=0,t.mode=kT;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){r.msg="incorrect header check",t.mode=Mt;break}if((u&15)!==OT){r.msg="unknown compression method",t.mode=Mt;break}if(u>>>=4,l-=4,g=(u&15)+8,t.wbits===0&&(t.wbits=g),g>15||g>t.wbits){r.msg="invalid window size",t.mode=Mt;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=u&512?VT:Vo,u=0,l=0;break;case kT:for(;l<16;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(t.flags=u,(t.flags&255)!==OT){r.msg="unknown compression method",t.mode=Mt;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=Mt;break}t.head&&(t.head.text=u>>8&1),t.flags&512&&t.wrap&4&&($[0]=u&255,$[1]=u>>>8&255,t.check=Rr(t.check,$,2,0)),u=0,l=0,t.mode=NT;case NT:for(;l<32;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}t.head&&(t.head.time=u),t.flags&512&&t.wrap&4&&($[0]=u&255,$[1]=u>>>8&255,$[2]=u>>>16&255,$[3]=u>>>24&255,t.check=Rr(t.check,$,4,0)),u=0,l=0,t.mode=LT;case LT:for(;l<16;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&t.wrap&4&&($[0]=u&255,$[1]=u>>>8&255,t.check=Rr(t.check,$,2,0)),u=0,l=0,t.mode=MT;case MT:if(t.flags&1024){for(;l<16;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&t.wrap&4&&($[0]=u&255,$[1]=u>>>8&255,t.check=Rr(t.check,$,2,0)),u=0,l=0}else t.head&&(t.head.extra=null);t.mode=UT;case UT:if(t.flags&1024&&(y=t.length,y>a&&(y=a),y&&(t.head&&(g=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(i,i+y),g)),t.flags&512&&t.wrap&4&&(t.check=Rr(t.check,n,y,i)),a-=y,i+=y,t.length-=y),t.length))break e;t.length=0,t.mode=BT;case BT:if(t.flags&2048){if(a===0)break e;y=0;do g=n[i+y++],t.head&&g&&t.length<65536&&(t.head.name+=String.fromCharCode(g));while(g&&y<a);if(t.flags&512&&t.wrap&4&&(t.check=Rr(t.check,n,y,i)),a-=y,i+=y,g)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=zT;case zT:if(t.flags&4096){if(a===0)break e;y=0;do g=n[i+y++],t.head&&g&&t.length<65536&&(t.head.comment+=String.fromCharCode(g));while(g&&y<a);if(t.flags&512&&t.wrap&4&&(t.check=Rr(t.check,n,y,i)),a-=y,i+=y,g)break e}else t.head&&(t.head.comment=null);t.mode=FT;case FT:if(t.flags&512){for(;l<16;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(t.wrap&4&&u!==(t.check&65535)){r.msg="header crc mismatch",t.mode=Mt;break}u=0,l=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Vo;break;case VT:for(;l<32;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}r.adler=t.check=tI(u),u=0,l=0,t.mode=Jy;case Jy:if(t.havedict===0)return r.next_out=o,r.avail_out=c,r.next_in=i,r.avail_in=a,t.hold=u,t.bits=l,w3e;r.adler=t.check=1,t.mode=Vo;case Vo:if(e===y3e||e===O0)break e;case g6:if(t.last){u>>>=l&7,l-=l&7,t.mode=b6;break}for(;l<3;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}switch(t.last=u&1,u>>>=1,l-=1,u&3){case 0:t.mode=jT;break;case 1:if($3e(t),t.mode=k0,e===O0){u>>>=2,l-=2;break e}break;case 2:t.mode=qT;break;case 3:r.msg="invalid block type",t.mode=Mt}u>>>=2,l-=2;break;case jT:for(u>>>=l&7,l-=l&7;l<32;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if((u&65535)!==(u>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Mt;break}if(t.length=u&65535,u=0,l=0,t.mode=w6,e===O0)break e;case w6:t.mode=KT;case KT:if(y=t.length,y){if(y>a&&(y=a),y>c&&(y=c),y===0)break e;s.set(n.subarray(i,i+y),o),a-=y,i+=y,c-=y,o+=y,t.length-=y;break}t.mode=Vo;break;case qT:for(;l<14;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(t.nlen=(u&31)+257,u>>>=5,l-=5,t.ndist=(u&31)+1,u>>>=5,l-=5,t.ncode=(u&15)+4,u>>>=4,l-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Mt;break}t.have=0,t.mode=HT;case HT:for(;t.have<t.ncode;){for(;l<3;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}t.lens[j[t.have++]]=u&7,u>>>=3,l-=3}for(;t.have<19;)t.lens[j[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,x={bits:t.lenbits},_=h1(p3e,t.lens,0,19,t.lencode,0,t.work,x),t.lenbits=x.bits,_){r.msg="invalid code lengths set",t.mode=Mt;break}t.have=0,t.mode=GT;case GT:for(;t.have<t.nlen+t.ndist;){for(;b=t.lencode[u&(1<<t.lenbits)-1],w=b>>>24,S=b>>>16&255,E=b&65535,!(w<=l);){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(E<16)u>>>=w,l-=w,t.lens[t.have++]=E;else{if(E===16){for(k=w+2;l<k;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(u>>>=w,l-=w,t.have===0){r.msg="invalid bit length repeat",t.mode=Mt;break}g=t.lens[t.have-1],y=3+(u&3),u>>>=2,l-=2}else if(E===17){for(k=w+3;l<k;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}u>>>=w,l-=w,g=0,y=3+(u&7),u>>>=3,l-=3}else{for(k=w+7;l<k;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}u>>>=w,l-=w,g=0,y=11+(u&127),u>>>=7,l-=7}if(t.have+y>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Mt;break}for(;y--;)t.lens[t.have++]=g}}if(t.mode===Mt)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Mt;break}if(t.lenbits=9,x={bits:t.lenbits},_=h1(LU,t.lens,0,t.nlen,t.lencode,0,t.work,x),t.lenbits=x.bits,_){r.msg="invalid literal/lengths set",t.mode=Mt;break}if(t.distbits=6,t.distcode=t.distdyn,x={bits:t.distbits},_=h1(MU,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,x),t.distbits=x.bits,_){r.msg="invalid distances set",t.mode=Mt;break}if(t.mode=k0,e===O0)break e;case k0:t.mode=N0;case N0:if(a>=6&&c>=258){r.next_out=o,r.avail_out=c,r.next_in=i,r.avail_in=a,t.hold=u,t.bits=l,c3e(r,f),o=r.next_out,s=r.output,c=r.avail_out,i=r.next_in,n=r.input,a=r.avail_in,u=t.hold,l=t.bits,t.mode===Vo&&(t.back=-1);break}for(t.back=0;b=t.lencode[u&(1<<t.lenbits)-1],w=b>>>24,S=b>>>16&255,E=b&65535,!(w<=l);){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(S&&!(S&240)){for(m=w,v=S,A=E;b=t.lencode[A+((u&(1<<m+v)-1)>>m)],w=b>>>24,S=b>>>16&255,E=b&65535,!(m+w<=l);){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}u>>>=m,l-=m,t.back+=m}if(u>>>=w,l-=w,t.back+=w,t.length=E,S===0){t.mode=JT;break}if(S&32){t.back=-1,t.mode=Vo;break}if(S&64){r.msg="invalid literal/length code",t.mode=Mt;break}t.extra=S&15,t.mode=WT;case WT:if(t.extra){for(k=t.extra;l<k;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,l-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=QT;case QT:for(;b=t.distcode[u&(1<<t.distbits)-1],w=b>>>24,S=b>>>16&255,E=b&65535,!(w<=l);){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(!(S&240)){for(m=w,v=S,A=E;b=t.distcode[A+((u&(1<<m+v)-1)>>m)],w=b>>>24,S=b>>>16&255,E=b&65535,!(m+w<=l);){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}u>>>=m,l-=m,t.back+=m}if(u>>>=w,l-=w,t.back+=w,S&64){r.msg="invalid distance code",t.mode=Mt;break}t.offset=E,t.extra=S&15,t.mode=YT;case YT:if(t.extra){for(k=t.extra;l<k;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,l-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Mt;break}t.mode=XT;case XT:if(c===0)break e;if(y=f-c,t.offset>y){if(y=t.offset-y,y>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Mt;break}y>t.wnext?(y-=t.wnext,d=t.wsize-y):d=t.wnext-y,y>t.length&&(y=t.length),p=t.window}else p=s,d=o-t.offset,y=t.length;y>c&&(y=c),c-=y,t.length-=y;do s[o++]=p[d++];while(--y);t.length===0&&(t.mode=N0);break;case JT:if(c===0)break e;s[o++]=t.length,c--,t.mode=N0;break;case b6:if(t.wrap){for(;l<32;){if(a===0)break e;a--,u|=n[i++]<<l,l+=8}if(f-=c,r.total_out+=f,t.total+=f,t.wrap&4&&f&&(r.adler=t.check=t.flags?Rr(t.check,s,f,o-f):j1(t.check,s,f,o-f)),f=c,t.wrap&4&&(t.flags?u:tI(u))!==t.check){r.msg="incorrect data check",t.mode=Mt;break}u=0,l=0}t.mode=ZT;case ZT:if(t.wrap&&t.flags){for(;l<32;){if(a===0)break e;a--,u+=n[i++]<<l,l+=8}if(t.wrap&4&&u!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=Mt;break}u=0,l=0}t.mode=eI;case eI:_=g3e;break e;case Mt:_=UU;break e;case zU:return BU;case FU:default:return yi}return r.next_out=o,r.avail_out=c,r.next_in=i,r.avail_in=a,t.hold=u,t.bits=l,(t.wsize||f!==r.avail_out&&t.mode<Mt&&(t.mode<b6||e!==PT))&&HU(r,r.output,r.next_out,f-r.avail_out),h-=r.avail_in,f-=r.avail_out,r.total_in+=h,r.total_out+=f,t.total+=f,t.wrap&4&&f&&(r.adler=t.check=t.flags?Rr(t.check,s,f,r.next_out-f):j1(t.check,s,f,r.next_out-f)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Vo?128:0)+(t.mode===k0||t.mode===w6?256:0),(h===0&&f===0||e===PT)&&_===Gl&&(_=b3e),_},I3e=r=>{if(gu(r))return yi;let e=r.state;return e.window&&(e.window=null),r.state=null,Gl},R3e=(r,e)=>{if(gu(r))return yi;const t=r.state;return t.wrap&2?(t.head=e,e.done=!1,Gl):yi},C3e=(r,e)=>{const t=e.length;let n,s,i;return gu(r)||(n=r.state,n.wrap!==0&&n.mode!==Jy)?yi:n.mode===Jy&&(s=1,s=j1(s,e,t,0),s!==n.check)?UU:(i=HU(r,e,t,t),i?(n.mode=zU,BU):(n.havedict=1,Gl))};var x3e=jU,D3e=KU,P3e=VU,O3e=A3e,k3e=qU,N3e=T3e,L3e=I3e,M3e=R3e,U3e=C3e,B3e="pako inflate (from Nodeca project)",ea={inflateReset:x3e,inflateReset2:D3e,inflateResetKeep:P3e,inflateInit:O3e,inflateInit2:k3e,inflate:N3e,inflateEnd:L3e,inflateGetHeader:M3e,inflateSetDictionary:U3e,inflateInfo:B3e};function z3e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var F3e=z3e;const GU=Object.prototype.toString,{Z_NO_FLUSH:V3e,Z_FINISH:j3e,Z_OK:H1,Z_STREAM_END:v6,Z_NEED_DICT:_6,Z_STREAM_ERROR:K3e,Z_DATA_ERROR:nI,Z_MEM_ERROR:q3e}=yu;function jp(r){this.options=Ab.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kU,this.strm.avail_out=0;let t=ea.inflateInit2(this.strm,e.windowBits);if(t!==H1)throw new Error(ql[t]);if(this.header=new F3e,ea.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=q1.string2buf(e.dictionary):GU.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ea.inflateSetDictionary(this.strm,e.dictionary),t!==H1)))throw new Error(ql[t])}jp.prototype.push=function(r,e){const t=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let i,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?j3e:V3e,GU.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),i=ea.inflate(t,o),i===_6&&s&&(i=ea.inflateSetDictionary(t,s),i===H1?i=ea.inflate(t,o):i===nI&&(i=_6));t.avail_in>0&&i===v6&&t.state.wrap>0&&r[t.next_in]!==0;)ea.inflateReset(t),i=ea.inflate(t,o);switch(i){case K3e:case nI:case _6:case q3e:return this.onEnd(i),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||i===v6))if(this.options.to==="string"){let c=q1.utf8border(t.output,t.next_out),u=t.next_out-c,l=q1.buf2string(t.output,c);t.next_out=u,t.avail_out=n-u,u&&t.output.set(t.output.subarray(c,c+u),0),this.onData(l)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(i===H1&&a===0)){if(i===v6)return i=ea.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};jp.prototype.onData=function(r){this.chunks.push(r)};jp.prototype.onEnd=function(r){r===H1&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ab.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function Ov(r,e){const t=new jp(e);if(t.push(r),t.err)throw t.msg||ql[t.err];return t.result}function H3e(r,e){return e=e||{},e.raw=!0,Ov(r,e)}var G3e=jp,W3e=Ov,Q3e=H3e,Y3e=Ov,X3e=yu,J3e={Inflate:G3e,inflate:W3e,inflateRaw:Q3e,ungzip:Y3e,constants:X3e};const{Deflate:Z3e,deflate:e6e,deflateRaw:t6e,gzip:r6e}=o3e,{Inflate:n6e,inflate:s6e,inflateRaw:i6e,ungzip:o6e}=J3e;var a6e=Z3e,c6e=e6e,l6e=t6e,u6e=r6e,h6e=n6e,d6e=s6e,f6e=i6e,p6e=o6e,y6e=yu,sI={Deflate:a6e,deflate:c6e,deflateRaw:l6e,gzip:u6e,Inflate:h6e,inflate:d6e,inflateRaw:f6e,ungzip:p6e,constants:y6e};const iI=6;function g6e({repo:r,preload:e}){async function*t(n,s={}){if(s.compressionLevel!=null&&(s.compressionLevel<-1||s.compressionLevel>9))throw T(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(s.preload!==!1){let a;try{a=IE(n).split("/")}catch(c){throw T(c,"ERR_INVALID_PATH")}e(we.parse(a[0]))}const i=we.asCID(n)||n,o=await Sa(i,r.blocks,s);if(o.type==="file"||o.type==="raw"){const a=[];!s.compress||s.archive===!0?a.push([{header:{name:o.path,mode:o.type==="file"&&o.unixfs.mode,mtime:o.type==="file"&&o.unixfs.mtime?new Date(o.unixfs.mtime.secs*1e3):void 0,size:o.size,type:"file"},body:o.content()}],wT()):a.push(o.content),s.compress&&a.push(async function*(c){const u=await n5(c);yield sI.gzip(u,{level:s.compressionLevel||iI})}),yield*Ve(...a);return}if(o.type==="directory"){const a=[hU(i,r.blocks,s),async function*(c){for await(const u of c){const l={header:{name:u.path,size:u.size}};if(u.type==="file")l.header.type="file",l.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,l.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0,l.body=u.content();else if(u.type==="raw")l.header.type="file",l.body=u.content();else if(u.type==="directory")l.header.type="directory",l.header.mode=u.unixfs.mode!=null?u.unixfs.mode:void 0,l.header.mtime=u.unixfs.mtime?new Date(u.unixfs.mtime.secs*1e3):void 0;else throw T(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");yield l}},wT()];if(s.compress){if(!s.archive)throw T(new Error("file is not regular"),"ERR_INVALID_PATH");s.compress&&a.push(async function*(c){const u=await n5(c);yield sI.gzip(u,{level:s.compressionLevel||iI})})}yield*Ve(...a);return}throw T(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS")}return Y(t)}function w6e({repo:r,preload:e}){async function*t(n,s={}){const i=IE(n),o=i.split("/");s.preload!==!1&&e(we.parse(o[0]));const a=we.asCID(i)||i,c=await Sa(a,r.blocks,s);if(c.type==="file"){yield RA(c);return}if(c.type==="directory"){for await(const u of c.content())yield RA(u);return}throw T(new Error(`Unknown UnixFS type ${c.type}`),"ERR_UNKNOWN_UNIXFS_TYPE")}return Y(t)}class b6e{constructor({preload:e,repo:t,hashers:n,options:s}){const i=Hye({preload:e,repo:t,options:s,hashers:n});this.addAll=i,this.add=g0e({addAll:i}),this.cat=Wge({repo:t,preload:e}),this.get=g6e({repo:t,preload:e}),this.ls=w6e({repo:t,preload:e})}}const Zy="0.18.1",m6e="",E6e="^0.158.1";function v6e({repo:r}){async function e(t={}){const n=await r.version.get();return{version:Zy,commit:m6e,repo:`${n}`,"ipfs-core":Zy,"interface-ipfs-core":E6e}}return Y(e)}const _6e=U("ipfs:components:id");function S6e({peerId:r,network:e}){async function t(n={}){const s=e.try();if(!s){if(n.peerId)throw new mp;if(r.publicKey==null)throw T(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:r,publicKey:R(r.publicKey,"base64pad"),addresses:[],agentVersion:`js-ipfs/${Zy}`,protocolVersion:"9000",protocols:[]}}const{libp2p:i}=s,o=n.peerId?n.peerId:r,a=await A6e(o,i,n),c=R(a.metadata.get("AgentVersion")||new Uint8Array),u=R(a.metadata.get("ProtocolVersion")||new Uint8Array),l=a.id.toString(),h=a.publicKey?R(a.publicKey,"base64pad"):"";return{id:o,publicKey:h,addresses:(a.addresses||[]).map(f=>{const y=f.toString();return y.endsWith(`/p2p/${l}`)?y:`${y}/p2p/${l}`}).sort().map(f=>ld(f)),agentVersion:c,protocolVersion:u,protocols:(a.protocols||[]).sort()}}return Y(t)}async function A6e(r,e,t){let n=await e.peerStore.get(r);n||(n=await $6e(r,e,t));let s=r.publicKey?r.publicKey:await e.peerStore.keyBook.get(r);if(s==null)try{s=await e.getPublicKey(r,t)}catch(i){_6e.error("Could not load public key for",r.toString(),i)}return{...n,publicKey:s,metadata:n.metadata||new Map,addresses:n.addresses.map(i=>i.multiaddr)}}async function $6e(r,e,t){if(e.dht==null)throw T(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(const s of e.dht.findPeer(r,t))if(s.name==="FINAL_PEER")break;const n=await e.peerStore.get(r);if(!n)throw T(new Error("Could not find peer"),"ERR_NOT_FOUND");return n}var rr=T6e;function T6e(r,e,t){var n,s;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");if(s=n.pop(),!s)return!1;oI(s);for(var i;i=n.shift();)if(oI(i),typeof r[i]>"u"&&(r[i]={}),r=r[i],!r||typeof r!="object")return!1;return r[s]=t,!0}function oI(r){if(r=="__proto__"||r=="constructor"||r=="prototype")throw new Error("setting of prototype values not supported")}const eg={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:r=>(rr(r,"Discovery.MDNS.Enabled",!1),rr(r,"Discovery.webRTCStar.Enabled",!1),r.Swarm={...r.Swarm||{},DisableNatPortMap:!0},r)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:r=>(rr(r,"Discovery.MDNS.Enabled",!0),rr(r,"Discovery.webRTCStar.Enabled",!0),rr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:r=>{const e=ch();return rr(r,"Addresses.API",e.Addresses.API?"/ip4/127.0.0.1/tcp/0":""),rr(r,"Addresses.Gateway",e.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":""),rr(r,"Addresses.Swarm",e.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),rr(r,"Addresses.Delegates",[]),rr(r,"Bootstrap",[]),rr(r,"Discovery.MDNS.Enabled",!1),rr(r,"Discovery.webRTCStar.Enabled",!1),rr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!0}),r}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:r=>{const e=ch();return rr(r,"Addresses.API",e.Addresses.API),rr(r,"Addresses.Gateway",e.Addresses.Gateway),rr(r,"Addresses.Swarm",e.Addresses.Swarm),rr(r,"Addresses.Delegates",e.Addresses.Delegates),rr(r,"Bootstrap",e.Bootstrap),rr(r,"Discovery.MDNS.Enabled",e.Discovery.MDNS.Enabled),rr(r,"Discovery.webRTCStar.Enabled",e.Discovery.webRTCStar.Enabled),rr(r,"Swarm",{...r.Swarm||{},DisableNatPortMap:!1}),r}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:r=>{const e=r.Swarm||{},t=e.ConnMgr||{};return t.LowWater=20,t.HighWater=40,e.ConnMgr=t,r.Swarm=e,r}},"default-power":{description:'Inverse of "lowpower" profile.',transform:r=>{const e=ch();return r.Swarm=e.Swarm,r}}},I6e=U("ipfs:core:config");function R6e({repo:r}){return{getAll:Y(e),get:Y(t),set:Y(n),replace:Y(s),profiles:{apply:Y(i),list:Y(C6e)}};async function e(o={}){return r.config.getAll(o)}async function t(o,a){return o?r.config.get(o,a):Promise.reject(new Error("key argument is required"))}async function n(o,a,c){return r.config.set(o,a,c)}async function s(o,a){return r.config.replace(o,a)}async function i(o,a={dryRun:!1}){const{dryRun:c}=a,u=eg[o];if(!u)throw new Error(`No profile with name '${o}' exists`);try{const l=await r.config.getAll(a);let h=JSON.parse(JSON.stringify(l));return h=u.transform(h),c||await r.config.replace(h,a),delete l.Identity.PrivKey,delete h.Identity.PrivKey,{original:l,updated:h}}catch(l){throw I6e(l),new Error(`Could not apply profile '${o}' to config: ${l.message}`)}}}async function C6e(r){return Object.keys(eg).map(e=>({name:e,description:eg[e].description}))}function L0({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*x6e(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t],i=we.asCID(n);i?yield[s.join("/"),i]:typeof n=="object"&&(yield*y5(n,s))}else{const t=we.asCID(e);t?yield[r.join("/"),t]:yield*y5(e,r)}}function*y5(r,e){if(r==null||r instanceof Uint8Array)return;const t=we.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,s]of Object.entries(r)){const i=[...e,n];yield*x6e(i,s)}}function*D6e(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t];yield s.join("/"),typeof n=="object"&&!we.asCID(n)&&(yield*g5(n,s))}else yield*g5(e,r)}function*g5(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const s=[...e,t];yield s.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!we.asCID(n)&&(yield*D6e(s,n))}}function P6e(r,e){let t=r;for(const[n,s]of e.entries()){if(t=t[s],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const i=we.asCID(t);if(i)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}let O6e=class{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:L0(),bytes:L0(),value:L0(),asBlock:L0()})}links(){return y5(this.value,[])}tree(){return g5(this.value,[])}get(e="/"){return P6e(this.value,e.split("/").filter(Boolean))}};function k6e({bytes:r,cid:e,value:t,codec:n}){const s=t!==void 0?t:n&&n.decode(r);if(s===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new O6e({cid:e,bytes:r,value:s})}var N6e=WU,aI=128,L6e=127,M6e=~L6e,U6e=Math.pow(2,31);function WU(r,e,t){e=e||[],t=t||0;for(var n=t;r>=U6e;)e[t++]=r&255|aI,r/=128;for(;r&M6e;)e[t++]=r&255|aI,r>>>=7;return e[t]=r|0,WU.bytes=t-n+1,e}var B6e=w5,z6e=128,cI=127;function w5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw w5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&cI)<<s:(o&cI)*Math.pow(2,s),s+=7}while(o>=z6e);return w5.bytes=i-n,t}var F6e=Math.pow(2,7),V6e=Math.pow(2,14),j6e=Math.pow(2,21),K6e=Math.pow(2,28),q6e=Math.pow(2,35),H6e=Math.pow(2,42),G6e=Math.pow(2,49),W6e=Math.pow(2,56),Q6e=Math.pow(2,63),Y6e=function(r){return r<F6e?1:r<V6e?2:r<j6e?3:r<K6e?4:r<q6e?5:r<H6e?6:r<G6e?7:r<W6e?8:r<Q6e?9:10},X6e={encode:N6e,decode:B6e,encodingLength:Y6e},tg=X6e;const b5=(r,e=0)=>[tg.decode(r,e),tg.decode.bytes],rg=(r,e,t=0)=>(tg.encode(r,e,t),e),ng=r=>tg.encodingLength(r),J6e=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},kv=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Z6e=(r,e)=>{const t=e.byteLength,n=ng(r),s=n+ng(t),i=new Uint8Array(s+t);return rg(r,i,0),rg(t,i,n),i.set(e,s),new Nv(r,t,e,i)},m5=r=>{const e=kv(r),[t,n]=b5(e),[s,i]=b5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Nv(t,s,o,e)},eme=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&J6e(r.bytes,t.bytes)}};let Nv=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function tme(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var rme=tme,nme=rme;let sme=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ime=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return QU(this,e)}},ome=class{constructor(e){this.decoders=e}or(e){return QU(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const QU=(r,e)=>new ome({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let ame=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new sme(e,t,n),this.decoder=new ime(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const YU=({name:r,prefix:e,encode:t,decode:n})=>new ame(r,e,t,n),XU=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=nme(t,e);return YU({prefix:r,name:e,encode:n,decode:i=>kv(s(i))})},cme=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},lme=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Aa=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>YU({prefix:e,name:r,encode(s){return lme(s,n,t)},decode(s){return cme(s,n,t,r)}}),Ja=XU({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});XU({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const O2=Aa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Aa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Aa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Aa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Aa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Aa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Aa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Aa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Aa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const lI=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return hme(t,E5(r),e||Ja.encoder);default:return dme(t,E5(r),e||O2.encoder)}},uI=new WeakMap,E5=r=>{const e=uI.get(r);if(e==null){const t=new Map;return uI.set(r,t),t}return e};let G1=class Nn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==qd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==fme)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Nn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Z6e(e,t);return Nn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Nn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&eme(e.multihash,n.multihash)}toString(e){return lI(this,e)}toJSON(){return{"/":lI(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Nn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Nn(n,s,i,o||hI(n,s,i.bytes))}else if(t[pme]===!0){const{version:n,multihash:s,code:i}=t,o=m5(s);return Nn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==qd)throw new Error(`Version 0 CID must use dag-pb (code: ${qd}) block encoding`);return new Nn(e,t,n,n.bytes)}case 1:{const s=hI(e,t,n.bytes);return new Nn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Nn.create(0,qd,e)}static createV1(e,t){return Nn.create(1,e,t)}static decode(e){const[t,n]=Nn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Nn.inspectBytes(e),n=t.size-t.multihashSize,s=kv(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new Nv(t.multihashCode,t.digestSize,i,s);return[t.version===0?Nn.createV0(o):Nn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=b5(e.subarray(t));return t+=f,h};let s=n(),i=qd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=ume(e,t),i=Nn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return E5(i).set(n,e),i}};const ume=(r,e)=>{switch(r[0]){case"Q":{const t=e||Ja;return[Ja.prefix,t.decode(`${Ja.prefix}${r}`)]}case Ja.prefix:{const t=e||Ja;return[Ja.prefix,t.decode(r)]}case O2.prefix:{const t=e||O2;return[O2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},hme=(r,e,t)=>{const{prefix:n}=t;if(n!==Ja.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},dme=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},qd=112,fme=18,hI=(r,e,t)=>{const n=ng(r),s=n+ng(e),i=new Uint8Array(s+t.byteLength);return rg(r,i,0),rg(e,i,n),i.set(t,s),i},pme=Symbol.for("@ipld/js-cid/CID");function JU(r){const e=eE({version:1,roots:r}),t=P.encode(e.length),n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}function yme(r){return{async setRoots(e){const t=JU(e);await r.write(t)},async writeBlock(e){const{cid:t,bytes:n}=e;await r.write(new Uint8Array(P.encode(t.bytes.length+n.length))),await r.write(t.bytes),n.length&&await r.write(n)},async close(){await r.end()}}}function M0(){}function gme(){const r=[];let e=null,t=M0,n=!1,s=null,i=M0;const o=()=>(e||(e=new Promise(u=>{t=()=>{e=null,t=M0,u()}})),e),a={write(u){r.push(u);const l=o();return i(),l},async end(){n=!0;const u=o();i(),await u}},c={async next(){const u=r.shift();return u?(r.length===0&&t(),{done:!1,value:u}):n?(t(),{done:!0,value:void 0}):(s||(s=new Promise(l=>{i=()=>(s=null,i=M0,l(c.next()))})),s)}};return{writer:a,iterator:c}}const gc={Null:r=>r===null,Int:r=>Number.isInteger(r),Float:r=>typeof r=="number"&&Number.isFinite(r),String:r=>typeof r=="string",Bool:r=>typeof r=="boolean",Bytes:r=>r instanceof Uint8Array,Link:r=>!gc.Null(r)&&typeof r=="object"&&r.asCID===r,List:r=>Array.isArray(r),Map:r=>!gc.Null(r)&&typeof r=="object"&&r.asCID!==r&&!gc.List(r)&&!gc.Bytes(r)},Vu={Int:gc.Int,"CarHeader > version":r=>Vu.Int(r),"CarHeader > roots (anon) > valueType (anon)":gc.Link,"CarHeader > roots (anon)":r=>gc.List(r)&&Array.prototype.every.call(r,Vu["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":r=>Vu["CarHeader > roots (anon)"](r),CarHeader:r=>{const e=r&&Object.keys(r);return gc.Map(r)&&["version"].every(t=>e.includes(t))&&Object.entries(r).every(([t,n])=>Vu["CarHeader > "+t]&&Vu["CarHeader > "+t](n))}},wme=Vu.CarHeader,S6={SHA2_256:18,LENGTH:32,DAG_PB:112},bme=16+8+8+8;function sg(r,e){if(!r.length)throw new Error("Unexpected end of data");const t=P.decode(r);return e.seek(P.decode.bytes),t}function mme(r){const e=new DataView(r.buffer,r.byteOffset,r.byteLength);let t=0;return{version:2,characteristics:[e.getBigUint64(t,!0),e.getBigUint64(t+=8,!0)],dataOffset:Number(e.getBigUint64(t+=8,!0)),dataSize:Number(e.getBigUint64(t+=8,!0)),indexOffset:Number(e.getBigUint64(t+=8,!0))}}function Eme(r){P.decode(r);const e=P.decode.bytes,t=P.decode(r.subarray(P.decode.bytes)),n=P.decode.bytes;return e+n+t}async function Lv(r,e){const t=sg(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR header (zero length)");const n=await r.exactly(t,!0),s=Hw(n);if(!wme(s))throw new Error("Invalid CAR header format");if(s.version!==1&&s.version!==2||e!==void 0&&s.version!==e)throw new Error(`Invalid CAR version: ${s.version}${e!==void 0?` (expected ${e})`:""}`);const i=Array.isArray(s.roots);if(s.version===1&&!i||s.version===2&&i)throw new Error("Invalid CAR header format");if(s.version===1)return s;const o=mme(await r.exactly(bme,!0));r.seek(o.dataOffset-r.pos);const a=await Lv(r,1);return Object.assign(a,o)}async function vme(r){const e=await r.exactly(2,!1);if(e[0]===S6.SHA2_256&&e[1]===S6.LENGTH){const o=await r.exactly(34,!0),a=m5(o);return G1.create(0,S6.DAG_PB,a)}const t=sg(await r.upTo(8),r);if(t!==1)throw new Error(`Unexpected CID version (${t})`);const n=sg(await r.upTo(8),r),s=await r.exactly(Eme(await r.upTo(8)),!0),i=m5(s);return G1.create(t,n,i)}async function ZU(r){const e=r.pos;let t=sg(await r.upTo(8),r);if(t===0)throw new Error("Invalid CAR section (zero length)");t+=r.pos-e;const n=await vme(r),s=t-Number(r.pos-e);return{cid:n,length:t,blockLength:s}}async function _me(r){const{cid:e,blockLength:t}=await ZU(r);return{bytes:await r.exactly(t,!0),cid:e}}async function Sme(r){const e=r.pos,{cid:t,length:n,blockLength:s}=await ZU(r),i={cid:t,length:n,blockLength:s,offset:e,blockOffset:r.pos};return r.seek(i.blockLength),i}function Ame(r){const e=(async()=>{const t=await Lv(r);if(t.version===2){const n=r.pos-t.dataOffset;r=Ime(r,t.dataSize-n)}return t})();return{header:()=>e,async*blocks(){for(await e;(await r.upTo(8)).length>0;)yield await _me(r)},async*blocksIndex(){for(await e;(await r.upTo(8)).length>0;)yield await Sme(r)}}}function eB(r){let e=0;return{async upTo(t){return r.subarray(e,e+Math.min(t,r.length-e))},async exactly(t,n=!1){if(t>r.length-e)throw new Error("Unexpected end of data");const s=r.subarray(e,e+t);return n&&(e+=t),s},seek(t){e+=t},get pos(){return e}}}function $me(r){let e=0,t=0,n=0,s=new Uint8Array(0);const i=async o=>{t=s.length-n;const a=[s.subarray(n)];for(;t<o;){const u=await r();if(u==null)break;t<0?u.length>t&&a.push(u.subarray(-t)):a.push(u),t+=u.length}s=new Uint8Array(a.reduce((u,l)=>u+l.length,0));let c=0;for(const u of a)s.set(u,c),c+=u.length;n=0};return{async upTo(o){return s.length-n<o&&await i(o),s.subarray(n,n+Math.min(s.length-n,o))},async exactly(o,a=!1){if(s.length-n<o&&await i(o),s.length-n<o)throw new Error("Unexpected end of data");const c=s.subarray(n,n+o);return a&&(e+=o,n+=o),c},seek(o){e+=o,n+=o},get pos(){return e}}}function Tme(r){const e=r[Symbol.asyncIterator]();async function t(){const n=await e.next();return n.done?null:n.value}return $me(t)}function Ime(r,e){let t=0;return{async upTo(n){let s=await r.upTo(n);return s.length+t>e&&(s=s.subarray(0,e-t)),s},async exactly(n,s=!1){const i=await r.exactly(n,s);if(i.length+t>e)throw new Error("Unexpected end of data");return s&&(t+=n),i},seek(n){t+=n,r.seek(n)},get pos(){return r.pos}}}class ig{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array)||!e.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const t=G1.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:t,bytes:e.bytes})),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(e){e=Rme(e);const{encoder:t,iterator:n}=fI(),s=new ig(e,t),i=new dI(n);return{writer:s,out:i}}static createAppender(){const{encoder:e,iterator:t}=fI();e.setRoots=()=>Promise.resolve();const n=new ig([],e),s=new dI(t);return{writer:n,out:s}}static async updateRootsInBytes(e,t){const n=eB(e);await Lv(n);const s=JU(t);if(Number(n.pos)!==s.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${s.length} bytes)`);return e.set(s,0),e}}class dI{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function fI(){const r=gme(),{writer:e,iterator:t}=r;return{encoder:yme(e),iterator:t}}function Rme(r){if(r===void 0)return[];if(!Array.isArray(r)){const t=G1.asCID(r);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}const e=[];for(const t of r){const n=G1.asCID(t);if(!n)throw new TypeError("roots must be a single CID or an array of CIDs");e.push(n)}return e}const tB=async({cid:r,load:e,seen:t})=>{t=t||new Set;const n=r.toString(is);if(t.has(n))return;const s=await e(r);if(t.add(n),s!==null)for(const[,i]of s.links())await tB({cid:i,load:e,seen:t})},rB=U("ipfs:components:dag:import"),Cme=[mE,cN];function xme({repo:r,preload:e,codecs:t}){async function*n(s,i={}){i.preload!==!1&&e(s);const o=we.asCID(s);if(!o)throw new Error(`Unexpected error converting CID type: ${s}`);rB(`Exporting ${o} as car`);const{writer:a,out:c}=await ig.create([o]);let u=null;(async()=>{try{const l=Dme(r,a,{signal:i.signal,timeout:i.timeout},t);await tB({cid:o,load:l})}catch(l){u=l}finally{a.close()}})();for await(const l of c){if(u)break;yield l}if(u)throw u}return Y(n)}function Dme(r,e,t,n){return async s=>{const i=await n.getCodec(s.code);if(!i)throw new Error(`Can't decode links in block with codec 0x${s.code.toString(16)} to form complete DAG`);const o=await r.blocks.get(s,t);return rB(`Adding block ${s} to car`),await e.put({cid:s,bytes:o}),Cme.includes(s.code)?null:k6e({bytes:o,cid:s,codec:i})}}async function to(r){for await(const e of r)return e}function Pme({codecs:r,repo:e,preload:t}){return Y(async function(i,o={}){if(o.preload!==!1&&t(i),o.path){const h=o.localResolve?await to(I1(i,o.path,r,e,o)):await ks(I1(i,o.path,r,e,o));if(!h)throw T(new Error("Not found"),"ERR_NOT_FOUND");return h}const a=await r.getCodec(i.code),c=await e.blocks.get(i,o);return{value:a.decode(c),remainderPath:""}})}class Ome{constructor(e,t,n){this._version=e,this._roots=t,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class og extends Ome{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){const{version:t,roots:n,iterator:s}=await kme(e);return new og(t,n,s)}static async fromIterable(e){const{version:t,roots:n,iterator:s}=await Nme(e);return new og(t,n,s)}}async function kme(r){if(!(r instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return nB(eB(r))}async function Nme(r){if(!r||typeof r[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return nB(Tme(r))}async function nB(r){const e=Ame(r),{version:t,roots:n}=await e.header();return{version:t,roots:n,iterator:e.blocks()}}const sB=U("ipfs:components:dag:import");function Lme({repo:r}){async function*e(t,n={}){const s=await r.gcLock.readLock();try{const i={signal:n.signal,timeout:n.timeout},o=Mp(t),{value:a,done:c}=await o.peek();if(c)return;a&&o.push(a);let u;a instanceof Uint8Array?u=[o]:u=o;for await(const l of u){const h=await Mme(r,i,l);if(n.pinRoots!==!1)for(const f of h){let y="";try{await r.blocks.has(f)?(sB(`Pinning root ${f}`),await r.pins.pinRecursively(f)):y="blockstore: block not found"}catch(d){y=d.message}yield{root:{cid:f,pinErrorMsg:y}}}}}finally{s()}}return Y(e)}async function Mme(r,e,t){const n=await og.fromIterable(t),s=await n.getRoots();return await jr(r.blocks.putMany(ls(n,({cid:i,bytes:o})=>(sB(`Import block ${i}`),{key:i,value:o})),{signal:e.signal})),s}function Ume({repo:r,codecs:e,hashers:t,preload:n}){async function s(i,o={}){const a=o.pin?await r.gcLock.readLock():null;try{const c=await e.getCodec(o.storeCodec||"dag-cbor");if(!c)throw new Error(`Unknown storeCodec ${o.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(o.inputCodec){if(!(i instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");const d=await e.getCodec(o.inputCodec);if(!d)throw new Error(`Unknown inputCodec ${o.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);i=d.decode(i)}const u=o.version!=null?o.version:1,l=await t.getHasher(o.hashAlg||"sha2-256");if(!l)throw new Error(`Unknown hash algorithm ${o.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);const h=c.encode(i),f=await l.digest(h),y=we.create(u,c.code,f);return await r.blocks.put(y,h,{signal:o.signal}),o.pin&&await r.pins.pinRecursively(y),o.preload!==!1&&n(y),y}finally{a&&a()}}return Y(s)}function Bme({repo:r,codecs:e,preload:t}){async function n(s,i={}){const{cid:o}=Sp(s);return i.preload!==!1&&t(o),rb(r,e,s,i)}return Y(n)}class zme{constructor({repo:e,codecs:t,hashers:n,preload:s}){this.export=xme({repo:e,preload:s,codecs:t}),this.get=Pme({codecs:t,repo:e,preload:s}),this.import=Lme({repo:e}),this.resolve=Bme({repo:e,codecs:t,preload:s}),this.put=Ume({repo:e,codecs:t,hashers:n,preload:s})}}function Fme(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var Vme=Fme,jme=Vme;const Kme=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Mv=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},qme=r=>new TextEncoder().encode(r),Hme=r=>new TextDecoder().decode(r);let Gme=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Wme=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return iB(this,e)}},Qme=class{constructor(e){this.decoders=e}or(e){return iB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const iB=(r,e)=>new Qme({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Yme=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Gme(e,t,n),this.decoder=new Wme(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Tb=({name:r,prefix:e,encode:t,decode:n})=>new Yme(r,e,t,n),Kp=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=jme(t,e);return Tb({prefix:r,name:e,encode:n,decode:i=>Mv(s(i))})},Xme=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Jme=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Yr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Tb({prefix:e,name:r,encode(s){return Jme(s,n,t)},decode(s){return Xme(s,n,t,r)}}),zi=Kp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Zme=Kp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),e4e=Object.freeze(Object.defineProperty({__proto__:null,base58btc:zi,base58flickr:Zme},Symbol.toStringTag,{value:"Module"}));var t4e=oB,pI=128,r4e=127,n4e=~r4e,s4e=Math.pow(2,31);function oB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=s4e;)e[t++]=r&255|pI,r/=128;for(;r&n4e;)e[t++]=r&255|pI,r>>>=7;return e[t]=r|0,oB.bytes=t-n+1,e}var i4e=v5,o4e=128,yI=127;function v5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw v5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&yI)<<s:(o&yI)*Math.pow(2,s),s+=7}while(o>=o4e);return v5.bytes=i-n,t}var a4e=Math.pow(2,7),c4e=Math.pow(2,14),l4e=Math.pow(2,21),u4e=Math.pow(2,28),h4e=Math.pow(2,35),d4e=Math.pow(2,42),f4e=Math.pow(2,49),p4e=Math.pow(2,56),y4e=Math.pow(2,63),g4e=function(r){return r<a4e?1:r<c4e?2:r<l4e?3:r<u4e?4:r<h4e?5:r<d4e?6:r<f4e?7:r<p4e?8:r<y4e?9:10},w4e={encode:t4e,decode:i4e,encodingLength:g4e},ag=w4e;const _5=(r,e=0)=>[ag.decode(r,e),ag.decode.bytes],cg=(r,e,t=0)=>(ag.encode(r,e,t),e),lg=r=>ag.encodingLength(r),b4e=(r,e)=>{const t=e.byteLength,n=lg(r),s=n+lg(t),i=new Uint8Array(s+t);return cg(r,i,0),cg(t,i,n),i.set(e,s),new Uv(r,t,e,i)},aB=r=>{const e=Mv(r),[t,n]=_5(e),[s,i]=_5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Uv(t,s,o,e)},m4e=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Kme(r.bytes,t.bytes)}};let Uv=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const Cl=Yr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),E4e=Yr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),v4e=Yr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),_4e=Yr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),S4e=Yr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),A4e=Yr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),$4e=Yr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),T4e=Yr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),I4e=Yr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),R4e=Object.freeze(Object.defineProperty({__proto__:null,base32:Cl,base32hex:S4e,base32hexpad:$4e,base32hexpadupper:T4e,base32hexupper:A4e,base32pad:v4e,base32padupper:_4e,base32upper:E4e,base32z:I4e},Symbol.toStringTag,{value:"Module"})),gI=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return x4e(t,S5(r),e||zi.encoder);default:return D4e(t,S5(r),e||Cl.encoder)}},wI=new WeakMap,S5=r=>{const e=wI.get(r);if(e==null){const t=new Map;return wI.set(r,t),t}return e};let cB=class Ln{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Hd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==P4e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ln.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=b4e(e,t);return Ln.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ln.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&m4e(e.multihash,n.multihash)}toString(e){return gI(this,e)}toJSON(){return{"/":gI(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Ln)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Ln(n,s,i,o||bI(n,s,i.bytes))}else if(t[O4e]===!0){const{version:n,multihash:s,code:i}=t,o=aB(s);return Ln.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Hd)throw new Error(`Version 0 CID must use dag-pb (code: ${Hd}) block encoding`);return new Ln(e,t,n,n.bytes)}case 1:{const s=bI(e,t,n.bytes);return new Ln(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Ln.create(0,Hd,e)}static createV1(e,t){return Ln.create(1,e,t)}static decode(e){const[t,n]=Ln.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ln.inspectBytes(e),n=t.size-t.multihashSize,s=Mv(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new Uv(t.multihashCode,t.digestSize,i,s);return[t.version===0?Ln.createV0(o):Ln.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=_5(e.subarray(t));return t+=f,h};let s=n(),i=Hd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=C4e(e,t),i=Ln.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return S5(i).set(n,e),i}};const C4e=(r,e)=>{switch(r[0]){case"Q":{const t=e||zi;return[zi.prefix,t.decode(`${zi.prefix}${r}`)]}case zi.prefix:{const t=e||zi;return[zi.prefix,t.decode(r)]}case Cl.prefix:{const t=e||Cl;return[Cl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},x4e=(r,e,t)=>{const{prefix:n}=t;if(n!==zi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},D4e=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Hd=112,P4e=18,bI=(r,e,t)=>{const n=lg(r),s=n+lg(e),i=new Uint8Array(s+t.byteLength);return cg(r,i,0),cg(e,i,n),i.set(t,s),i},O4e=Symbol.for("@ipld/js-cid/CID"),k4e=Math.pow(2,7),N4e=Math.pow(2,14),L4e=Math.pow(2,21),Bv=Math.pow(2,28),zv=Math.pow(2,35),Fv=Math.pow(2,42),Vv=Math.pow(2,49),ct=128,Jn=127;function Hc(r){if(r<k4e)return 1;if(r<N4e)return 2;if(r<L4e)return 3;if(r<Bv)return 4;if(r<zv)return 5;if(r<Fv)return 6;if(r<Vv)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function M4e(r,e,t=0){switch(Hc(r)){case 8:e[t++]=r&255|ct,r/=128;case 7:e[t++]=r&255|ct,r/=128;case 6:e[t++]=r&255|ct,r/=128;case 5:e[t++]=r&255|ct,r/=128;case 4:e[t++]=r&255|ct,r>>>=7;case 3:e[t++]=r&255|ct,r>>>=7;case 2:e[t++]=r&255|ct,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function U4e(r,e,t=0){switch(Hc(r)){case 8:e.set(t++,r&255|ct),r/=128;case 7:e.set(t++,r&255|ct),r/=128;case 6:e.set(t++,r&255|ct),r/=128;case 5:e.set(t++,r&255|ct),r/=128;case 4:e.set(t++,r&255|ct),r>>>=7;case 3:e.set(t++,r&255|ct),r>>>=7;case 2:e.set(t++,r&255|ct),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function B4e(r,e){let t=r[e],n=0;if(n+=t&Jn,t<ct||(t=r[e+1],n+=(t&Jn)<<7,t<ct)||(t=r[e+2],n+=(t&Jn)<<14,t<ct)||(t=r[e+3],n+=(t&Jn)<<21,t<ct)||(t=r[e+4],n+=(t&Jn)*Bv,t<ct)||(t=r[e+5],n+=(t&Jn)*zv,t<ct)||(t=r[e+6],n+=(t&Jn)*Fv,t<ct)||(t=r[e+7],n+=(t&Jn)*Vv,t<ct))return n;throw new RangeError("Could not decode varint")}function z4e(r,e){let t=r.get(e),n=0;if(n+=t&Jn,t<ct||(t=r.get(e+1),n+=(t&Jn)<<7,t<ct)||(t=r.get(e+2),n+=(t&Jn)<<14,t<ct)||(t=r.get(e+3),n+=(t&Jn)<<21,t<ct)||(t=r.get(e+4),n+=(t&Jn)*Bv,t<ct)||(t=r.get(e+5),n+=(t&Jn)*zv,t<ct)||(t=r.get(e+6),n+=(t&Jn)*Fv,t<ct)||(t=r.get(e+7),n+=(t&Jn)*Vv,t<ct))return n;throw new RangeError("Could not decode varint")}function Ib(r,e,t=0){return e==null&&(e=$o(Hc(r))),e instanceof Uint8Array?M4e(r,e,t):U4e(r,e,t)}function qp(r,e=0){return r instanceof Uint8Array?B4e(r,e):z4e(r,e)}const F4e=Tb({prefix:"\0",name:"identity",encode:r=>Hme(r),decode:r=>qme(r)}),V4e=Object.freeze(Object.defineProperty({__proto__:null,identity:F4e},Symbol.toStringTag,{value:"Module"})),j4e=Yr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),K4e=Object.freeze(Object.defineProperty({__proto__:null,base2:j4e},Symbol.toStringTag,{value:"Module"})),q4e=Yr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),H4e=Object.freeze(Object.defineProperty({__proto__:null,base8:q4e},Symbol.toStringTag,{value:"Module"})),G4e=Kp({prefix:"9",name:"base10",alphabet:"0123456789"}),W4e=Object.freeze(Object.defineProperty({__proto__:null,base10:G4e},Symbol.toStringTag,{value:"Module"})),Q4e=Yr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Y4e=Yr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),X4e=Object.freeze(Object.defineProperty({__proto__:null,base16:Q4e,base16upper:Y4e},Symbol.toStringTag,{value:"Module"})),J4e=Kp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Z4e=Kp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),e5e=Object.freeze(Object.defineProperty({__proto__:null,base36:J4e,base36upper:Z4e},Symbol.toStringTag,{value:"Module"})),t5e=Yr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),r5e=Yr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),n5e=Yr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s5e=Yr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),i5e=Object.freeze(Object.defineProperty({__proto__:null,base64:t5e,base64pad:r5e,base64url:n5e,base64urlpad:s5e},Symbol.toStringTag,{value:"Module"})),lB=Array.from(""),o5e=lB.reduce((r,e,t)=>(r[t]=e,r),[]),a5e=lB.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function c5e(r){return r.reduce((e,t)=>(e+=o5e[t],e),"")}function l5e(r){const e=[];for(const t of r){const n=a5e[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const u5e=Tb({prefix:"",name:"base256emoji",encode:c5e,decode:l5e}),h5e=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:u5e},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const d5e={...V4e,...K4e,...H4e,...W4e,...X4e,...R4e,...e5e,...e4e,...i5e,...h5e},mI=mi,f5e=Ei,uB=function(r){let e=0;if(r=r.toString().trim(),mI(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(f5e(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=mI(t[n]);let o;i&&(o=uB(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},p5e=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},js=-1,W1={},A5={},y5e=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,js,"ip6zone"],[43,8,"ipcidr"],[53,js,"dns",!0],[54,js,"dns4",!0],[55,js,"dns6",!0],[56,js,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,js,"unix",!1,!0],[421,js,"ipfs"],[421,js,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,js,"garlic64"],[448,0,"tls"],[449,js,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,js,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,js,"memory"]];y5e.forEach(r=>{const e=g5e(...r);A5[e.code]=e,W1[e.name]=e});function g5e(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function ot(r){if(typeof r=="number"){if(A5[r]!=null)return A5[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(W1[r]!=null)return W1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}ot("ip4");ot("ip6");ot("ipcidr");function jv(r,e){switch(ot(r).code){case 4:case 41:return b5e(e);case 42:return SI(e);case 6:case 273:case 33:case 132:return hB(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return SI(e);case 421:return _5e(e);case 444:return AI(e);case 445:return AI(e);case 466:return v5e(e);default:return R(e,"base16")}}function EI(r,e){switch(ot(r).code){case 4:return vI(e);case 41:return vI(e);case 42:return _I(e);case 6:case 273:case 33:case 132:return Kv(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return _I(e);case 421:return m5e(e);case 444:return S5e(e);case 445:return A5e(e);case 466:return E5e(e);default:return M(e,"base16")}}const A6=Object.values(d5e).map(r=>r.decoder),w5e=function(){let r=A6[0].or(A6[1]);return A6.slice(2).forEach(e=>r=r.or(e)),r}();function vI(r){if(!Nt(r))throw new Error("invalid ip address");return uB(r)}function b5e(r){const e=p5e(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function Kv(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function hB(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function _I(r){const e=M(r),t=Uint8Array.from(Ib(e.length));return z([t,e],t.length+e.length)}function SI(r){const e=qp(r);if(r=r.slice(Hc(e)),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function m5e(r){let e;r[0]==="Q"||r[0]==="1"?e=aB(zi.decode(`z${r}`)).bytes:e=cB.parse(r).multihash.bytes;const t=Uint8Array.from(Ib(e.length));return z([t,e],t.length+e.length)}function E5e(r){const e=w5e.decode(r),t=Uint8Array.from(Ib(e.length));return z([t,e],t.length+e.length)}function v5e(r){const e=qp(r),t=r.slice(Hc(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function _5e(r){const e=qp(r),t=r.slice(Hc(e));if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function S5e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Cl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Kv(n);return z([t,s],t.length+s.length)}function A5e(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Cl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Kv(n);return z([t,s],t.length+s.length)}function AI(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=hB(t);return`${n}:${s}`}function $5e(r){r=$5(r);const e=[],t=[];let n=null;const s=r.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){const o=s[i],a=ot(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw pB("invalid address: "+r);if(a.path===!0){n=$5(s.slice(i).join("/")),e.push([a.code,EI(a.code,n)]),t.push([a.code,n]);break}const c=EI(a.code,s[i]);e.push([a.code,c]),t.push([a.code,jv(a.code,c)])}return{string:dB(t),bytes:fB(e),tuples:e,stringTuples:t,path:n}}function $I(r){const e=[],t=[];let n=null,s=0;for(;s<r.length;){const i=qp(r,s),o=Hc(i),a=ot(i),c=T5e(a,r.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}const u=r.slice(s+o,s+o+c);if(s+=c+o,s>r.length)throw pB("Invalid address Uint8Array: "+R(r,"base16"));e.push([i,u]);const l=jv(i,u);if(t.push([i,l]),a.path===!0){n=l;break}}return{bytes:Uint8Array.from(r),string:dB(t),tuples:e,stringTuples:t,path:n}}function dB(r){const e=[];return r.map(t=>{const n=ot(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),$5(e.join("/"))}function fB(r){return z(r.map(e=>{const t=ot(e[0]);let n=Uint8Array.from(Ib(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n}))}function T5e(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=qp(e instanceof Uint8Array?e:Uint8Array.from(e));return t+Hc(t)}}function $5(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function pB(r){return new Error("Error parsing address: "+r)}const I5e=Symbol.for("nodejs.util.inspect.custom"),R5e=[ot("dns").code,ot("dns4").code,ot("dns6").code,ot("dnsaddr").code],C5e=new Map,yB=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Hit(r){return gB(r)?r.protos().some(e=>e.resolvable):!1}function gB(r){return!!r?.[yB]}var yh,uc,ip,op,ant,sa;let x5e=(sa=class{constructor(e){N(this,"bytes");ar(this,yh,void 0);ar(this,uc,void 0);ar(this,ip,void 0);ar(this,op,void 0);N(this,ant,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=$I(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=$5e(e)}else if(gB(e))t=$I(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,Dt(this,yh,t.string),Dt(this,uc,t.tuples),Dt(this,ip,t.stringTuples),Dt(this,op,t.path)}toString(){return ve(this,yh)}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=ot("tcp"),a=ot("udp"),c=ot("ip4"),u=ot("ip6"),l=ot("dns6"),h=ot("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),R5e.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=ot(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=ot(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return ve(this,uc).map(([e])=>Object.assign({},ot(e)))}protoCodes(){return ve(this,uc).map(([e])=>e)}protoNames(){return ve(this,uc).map(([e])=>ot(e).name)}tuples(){return ve(this,uc)}stringTuples(){return ve(this,ip)}encapsulate(e){return e=new sa(e),new sa(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new sa(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new sa(fB(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,s])=>{n===W1.p2p.code&&e.push([n,s]),n===W1["p2p-circuit"].code&&(e=[])});const t=e.pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(zi.decode(`z${n}`),"base58btc"):R(cB.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ve(this,op)}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=C5e.get(t.name);if(n==null)throw new Bw(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new sa(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(ant=yB,I5e)](){return`Multiaddr(${ve(this,yh)})`}},yh=new WeakMap,uc=new WeakMap,ip=new WeakMap,op=new WeakMap,sa);function Hp(r){return new x5e(r)}function TI(r){let e;try{e=ot("sni").code}catch{return null}for(const[t,n]of r)if(t===e&&n!==void 0)return n;return null}function II(r){return r.some(([e,t])=>e===ot("tls").code)}function _s(r,e,t){const n=wB[ot(r).name];if(n===void 0)throw new Error(`Can't interpret protocol ${ot(r).name}`);const s=n(e,t);return r===ot("ip6").code?`[${s}]`:s}const wB={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`tcp://${_s(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`udp://${_s(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${_s(t[0],t[1]??"",e)}/ipfs/${r}`},p2p:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${_s(t[0],t[1]??"",e)}/p2p/${r}`},http:(r,e)=>{const t=II(e),n=TI(e);if(t&&n!==null)return`https://${n}`;const s=t?"https://":"http://",i=e.pop();if(i===void 0)throw new Error("Unexpected end of multiaddr");let o=_s(i[0],i[1]??"",e);return o=o.replace("tcp://",""),`${s}${o}`},tls:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return _s(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return _s(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=_s(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=II(e),n=TI(e);if(t&&n!==null)return`wss://${n}`;const s=t?"wss://":"ws://",i=e.pop();if(i===void 0)throw new Error("Unexpected end of multiaddr");let o=_s(i[0],i[1]??"",e);return o=o.replace("tcp://",""),`${s}${o}`},wss:(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=_s(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`},"p2p-websocket-star":(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${_s(t[0],t[1]??"",e)}/p2p-websocket-star`},"p2p-webrtc-star":(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${_s(t[0],t[1]??"",e)}/p2p-webrtc-star`},"p2p-webrtc-direct":(r,e)=>{const t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${_s(t[0],t[1]??"",e)}/p2p-webrtc-direct`}};function qv(r,e){const n=Hp(r).stringTuples(),s=n.pop();if(s===void 0)throw new Error("Unexpected end of multiaddr");const i=ot(s[0]),o=wB[i.name];if(o==null)throw new Error(`No interpreter found for ${i.name}`);let a=o(s[1]??"",n);return e?.assumeHttp!==!1&&s[0]===ot("tcp").code&&(a=a.replace("tcp://","http://"),(s[1]==="443"||s[1]==="80")&&(s[1]==="443"&&(a=a.replace("http://","https://")),a=a.substring(0,a.lastIndexOf(":")))),a}function D5e(r){if(!Array.isArray(r))throw new TypeError(`Expected an array, got ${typeof r}`);r=[...r];for(let e=r.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}const P5e=U("ipfs:preload"),O5e=Cr.default?Cr.default:Cr,k5e=new O5e({concurrency:4});function N5e(r,e={}){return P5e(r),k5e.add(async()=>{const n=(await aa.post(r,{signal:e.signal})).body.getReader();try{for(;;){const{done:s}=await n.read();if(s)return}}finally{n.releaseLock()}})}const Gd=U("ipfs:preload");function L5e(r={}){if(r.enabled=!!r.enabled,r.addresses=r.addresses||[],r.cache=r.cache||1e3,!r.enabled||!r.addresses.length)return Gd("preload disabled"),Object.assign(()=>{},{start:()=>{},stop:()=>{}});let e=!0,t=[];const n=r.addresses.map(o=>qv(o)),s=nb(r.cache),i=async o=>{try{if(e)throw new Error(`preload ${o} but preloader is not started`);const a=o.toString();if(s.has(a))return;s.set(a,!0);const c=D5e(n);let u=!1;const l=Date.now();for(const h of c){if(e)throw new Error(`preload aborted for ${a}`);let f;try{f=new AbortController,t=t.concat(f),await N5e(`${h}/api/v0/refs?r=true&arg=${encodeURIComponent(a)}`,{signal:f.signal}),u=!0}catch(y){y.type!=="aborted"&&Gd.error(y)}finally{t=t.filter(y=>y!==f)}if(u)break}Gd(`${u?"":"un"}successfully preloaded ${a} in ${Date.now()-l}ms`)}catch(a){Gd.error(a)}};return i.start=()=>{e=!1},i.stop=()=>{e=!0,Gd(`aborting ${t.length} pending preload request(s)`),t.forEach(o=>o.abort()),t=[]},i}const U0=U("ipfs:mfs-preload");function M5e({preload:r,files:e,options:t={}}){if(t.interval=t.interval||30*1e3,!t.enabled){U0("MFS preload disabled");const o=async()=>{};return{start:o,stop:o}}let n="",s;const i=async()=>{try{const o=await e.stat("/"),a=o.cid.toString();n!==a&&(U0(`preloading updated MFS root ${n} -> ${o.cid}`),await r(o.cid),n=a)}catch(o){U0.error("failed to preload MFS root",o)}finally{s=setTimeout(i,t.interval)}};return{async start(){const o=await e.stat("/");n=o.cid.toString(),U0(`monitoring MFS root ${o.cid}`),s=setTimeout(i,t.interval)},stop(){clearTimeout(s)}}}let U5e=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},B5e=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const RI=r=>globalThis.DOMException===void 0?new B5e(r):new DOMException(r),CI=r=>{const e=r.reason===void 0?RI("This operation was aborted."):r.reason;return e instanceof Error?e:RI(e)};function z5e(r,e){const{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e;let o;const c=new Promise((u,l)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:f}=e;f.aborted&&l(CI(f)),f.addEventListener("abort",()=>{l(CI(f))})}if(t===Number.POSITIVE_INFINITY){r.then(u,l);return}const h=new U5e;o=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(f){l(f)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?u():s instanceof Error?l(s):(h.message=s??`Promise timed out after ${t} milliseconds`,l(h))},t),(async()=>{try{u(await r)}catch(f){l(f)}})()}).finally(()=>{c.clear()});return c.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},c}const xI="lock:worker:request-read",DI="lock:worker:release-read",PI="lock:master:grant-read",OI="lock:worker:request-write",kI="lock:worker:release-write",NI="lock:master:grant-write",Rc={},Wl=r=>{r.addEventListener("message",e=>{Wl.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Wl.dispatchEvent("message",r,e)})};Wl.addEventListener=(r,e)=>{Rc[r]==null&&(Rc[r]=[]),Rc[r].push(e)};Wl.removeEventListener=(r,e)=>{Rc[r]!=null&&(Rc[r]=Rc[r].filter(t=>t===e))};Wl.dispatchEvent=function(r,e,t){Rc[r]!=null&&Rc[r].forEach(n=>n(e,t))};const LI=(r,e,t,n,s)=>(i,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>(i.postMessage({type:s,name:a.name,identifier:a.identifier}),await new Promise(c=>{const u=l=>{if(l==null||l.data==null)return;const h={type:l.data.type,name:l.data.name,identifier:l.data.identifier};h.type===n&&h.identifier===a.identifier&&(i.removeEventListener("message",u),c())};i.addEventListener("message",u)}))}}))},MI=(r,e,t,n)=>async()=>{const s=IN();return globalThis.postMessage({type:e,identifier:s,name:r}),await new Promise(i=>{const o=a=>{if(a==null||a.data==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===s&&(globalThis.removeEventListener("message",o),i(()=>{globalThis.postMessage({type:n,identifier:s,name:r})}))};globalThis.addEventListener("message",o)})},F5e={singleProcess:!1},V5e=r=>{if(r=Object.assign({},F5e,r),!!globalThis.document||r.singleProcess){const t=new EventTarget;return Wl.addEventListener("message",LI(t,"requestReadLock",xI,DI,PI)),Wl.addEventListener("message",LI(t,"requestWriteLock",OI,kI,NI)),t}return{isWorker:!0,readLock:t=>MI(t,xI,PI,DI),writeLock:t=>MI(t,OI,NI,kI)}},el={};let cc;async function $6(r,e){let t;const n=new Promise(s=>{t=s});return r.add(async()=>await z5e((async()=>await new Promise(s=>{t(()=>{s()})}))(),{milliseconds:e.timeout})),await n}const j5e=(r,e)=>{if(cc.isWorker===!0)return{readLock:cc.readLock(r,e),writeLock:cc.writeLock(r,e)};const t=new Cr({concurrency:1});let n;return{async readLock(){if(n!=null)return await $6(n,e);n=new Cr({concurrency:e.concurrency,autoStart:!1});const s=n,i=$6(n,e);return t.add(async()=>(s.start(),await s.onIdle().then(()=>{n===s&&(n=null)}))),await i},async writeLock(){return n=null,await $6(t,e)}}},K5e={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Hv(r){const e=Object.assign({},K5e,r);return cc==null&&(cc=V5e(e),cc.isWorker!==!0&&(cc.addEventListener("requestReadLock",t=>{el[t.data.name]!=null&&el[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),cc.addEventListener("requestWriteLock",async t=>{el[t.data.name]!=null&&el[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),el[e.name]==null&&(el[e.name]=j5e(e.name,e)),el[e.name]}let B0;function Gv(r=!1){if(B0)return B0;const e=Hv({singleProcess:r});return B0={readLock:t=>async(...n)=>{const s=await e.readLock();try{return await t.apply(null,n)}finally{s()}},writeLock:t=>async(...n)=>{const s=await e.writeLock();try{return await t.apply(null,n)}finally{s()}}},B0}const UI=U("ipfs:mfs:utils:with-mfs-root");async function Wv(r,e){if(e&&e.signal&&e.signal.aborted)throw T(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.open();let t;try{const n=await r.repo.datastore.get(d4);t=we.decode(n)}catch(n){if(n.code!=="ERR_NOT_FOUND")throw n;UI("Creating new MFS root");const s=Ct({Data:new Ot({type:"directory"}).marshal(),Links:[]}),i=await Eh.digest(s);if(t=we.createV0(i),await r.repo.blocks.put(t,s),e&&e.signal&&e.signal.aborted)throw T(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await r.repo.datastore.put(d4,t.bytes)}return UI(`Loaded MFS root /ipfs/${t}`),t}function Qv(r=""){return(r.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}const T6="ipfs",ws=async(r,e,t)=>{const n=await Wv(r,t);let s={entryType:"file"},i="";if(we.asCID(e)?i=`/ipfs/${e}`:i=e.toString(),i=i.trim(),i=i.replace(/(\/\/+)/g,"/"),i.endsWith("/")&&i.length>1&&(i=i.substring(0,i.length-1)),!i)throw T(new Error("paths must not be empty"),"ERR_NO_PATH");if(i.substring(0,1)!=="/")throw T(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");i.substring(i.length-1)==="/"&&(i=i.substring(0,i.length-1));const o=Qv(i);if(o[0]===T6){let c;o.length===2?c=`/${o.join("/")}`:c=`/${o.slice(0,o.length-1).join("/")}`,s={type:"ipfs",depth:o.length-2,entryType:"file",mfsPath:`/${o.join("/")}`,mfsDirectory:c,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}else{const c=`/${T6}/${n}${o.length?"/"+o.join("/"):""}`,u=`/${T6}/${n}/${o.slice(0,o.length-1).join("/")}`;s={type:"mfs",depth:o.length,entryType:"file",mfsDirectory:u,mfsPath:c,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}const a=s.type==="mfs"?s.mfsPath:s.path;try{const c=await Sa(a,r.repo.blocks,t);s.cid=c.cid,s.mfsPath=`/ipfs/${c.path}`,s.entryType=c.type,s.content=c.content,(s.entryType==="file"||s.entryType==="directory")&&(c.type==="file"||c.type==="directory")&&(s.unixfs=c.unixfs)}catch(c){if(c.code!=="ERR_NOT_FOUND")throw c}return s.exists=!!s.cid,s},q5e=kt.bind({ignoreUndefined:!0}),H5e=U("ipfs:mfs:stat"),G5e={withLocal:!1};function Rb(r){async function e(t,n={}){n=q5e(G5e,n),H5e(`Fetching stats for ${t}`);const{type:s,cid:i,mfsPath:o}=await ws(r,t,n),a=s==="ipfs"&&i?i:o;let c;try{c=await Sa(a,r.repo.blocks)}catch(u){throw u.code==="ERR_NOT_FOUND"?T(new Error(`${t} does not exist`),"ERR_NOT_FOUND"):u}if(!BI[c.type])throw new Error(`Cannot stat codec ${c.cid.code}`);return BI[c.type](c)}return Y(e)}const BI={raw:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:r=>{const e={cid:r.cid,type:"file",size:r.unixfs.fileSize(),cumulativeSize:Ct(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},directory:r=>{const e={cid:r.cid,type:"directory",size:0,cumulativeSize:Ct(r.node).length+(r.node.Links||[]).reduce((t,n)=>t+(n.Tsize||0),0),blocks:r.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:r.unixfs.mode};return r.unixfs.mtime&&(e.mtime=r.unixfs.mtime),e},object:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:r=>({cid:r.cid,size:r.node.length,cumulativeSize:r.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})},W5e=U("ipfs:mfs:utils:to-trail");async function Gp(r,e){W5e(`Creating trail for path ${e}`);const t=[];for await(const n of uU(e,r.repo.blocks))t.push({name:n.name,cid:n.cid,size:n.size,type:n.type});return t}const bB=async(r,e,t)=>{t.codec||(t.codec=kc),t.hasher||(t.hasher=Eh),t.cidVersion===void 0&&(t.cidVersion=1),t.codec===kc&&t.hasher!==Eh&&(t.cidVersion=1);const n=await t.hasher.digest(r),s=we.create(t.cidVersion,t.codec.code,n);return t.onlyHash||await e.put(s,r,{signal:t.signal}),s},mB=Eb.code,EB=8;async function vB(r){return(await Eb.encode(r)).subarray(0,8).reverse()}class Q5e{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}}class _B extends Q5e{constructor(e,t){super(e,t),this._bucket=vb({hashFn:vB,bits:EB})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){yield*SB(this._bucket,e,this,this.options)}}async function*SB(r,e,t,n){const s=r._children,i=[];let o=0;for(let y=0;y<s.length;y++){const d=s.get(y);if(!d)continue;const p=y.toString(16).toUpperCase().padStart(2,"0");if(d instanceof rs){let b;for await(const w of await SB(d,e,null,n))b=w;if(!b)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:p,Tsize:b.size,Hash:b.cid}),o+=b.size}else if(typeof d.value.flush=="function"){const b=d.value;let w;for await(const E of b.flush(e))w=E,yield w;const S=p+d.key;i.push({Name:S,Tsize:w.size,Hash:w.cid}),o+=w.size}else{const b=d.value;if(!b.cid)continue;const w=p+d.key,S=b.size;i.push({Name:w,Tsize:S,Hash:b.cid}),o+=S}}const a=Uint8Array.from(s.bitField().reverse()),u={Data:new Ot({type:"hamt-sharded-directory",data:a,fanout:r.tableSize(),hashType:mB,mtime:t&&t.mtime,mode:t&&t.mode}).marshal(),Links:i},l=Ct(To(u)),h=await bB(l,e,n),f=l.length+o;yield{cid:h,node:u,size:f}}const Hf=U("ipfs:mfs:core:utils:hamt-utils"),Cb=async(r,e,t,n)=>{if(!n.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");const s=Uint8Array.from(t._children.bitField().reverse()),i=Ot.unmarshal(n.parent.Data),o=new Ot({type:"hamt-sharded-directory",data:s,fanout:t.tableSize(),hashType:mB,mode:i.mode,mtime:i.mtime}),a=await r.hashers.getHasher(n.hashAlg),c={Data:o.marshal(),Links:e.sort((f,y)=>(f.Name||"").localeCompare(y.Name||""))},u=Ct(c),l=await a.digest(u),h=we.create(n.cidVersion,jt,l);return n.flush&&await r.repo.blocks.put(h,u),{node:c,cid:h,size:e.reduce((f,y)=>f+(y.Tsize||0),u.length)}},AB=async(r,e,t,n,s)=>{const i=new rs({hash:t._options.hash,bits:t._options.bits},n,s);return n._putObjectAt(s,i),await xb(r,e,i,t),i},$B=async r=>{const e=vb({hashFn:vB,bits:EB});return await Promise.all(r.map(async t=>{const n=t.Name||"";if(n.length===2){const s=parseInt(n,16),i=new rs({hash:e._options.hash,bits:e._options.bits},e,s);return e._putObjectAt(s,i),Promise.resolve()}return e.put(n.substring(2),{size:t.Tsize,cid:t.Hash})})),e},xb=async(r,e,t,n)=>{await Promise.all(e.map(async s=>{const i=s.Name||"";if(i.length===2){Hf("Populating sub bucket",i);const o=parseInt(i,16),a=await r.repo.blocks.get(s.Hash),c=hr(a),u=new rs({hash:n._options.hash,bits:n._options.bits},t,o);return t._putObjectAt(o,u),await xb(r,c.Links,u,n),Promise.resolve()}return n.put(i.substring(2),{size:s.Tsize,cid:s.Hash})}))},uh=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Y5e=async(r,e,t)=>{const n=await $B(t.Links),s=await n._findNewBucketAndPos(e),i=[{bucket:s.bucket,prefix:uh(s.pos)}];let o=s.bucket;for(;o!==n;)i.push({bucket:o,prefix:uh(o._posAtParent)}),o=o._parent;i.reverse(),i[0].node=t;for(let a=0;a<i.length;a++){const c=i[a];if(!c.node)throw new Error("Could not generate HAMT path");const u=c.node.Links.filter(y=>(y.Name||"").substring(0,2)===c.prefix).pop();if(!u){Hf(`Link ${c.prefix}${e} will be added`);continue}if(u.Name===`${c.prefix}${e}`){Hf(`Link ${c.prefix}${e} will be replaced`);continue}Hf(`Found subshard ${c.prefix}`);const l=await r.repo.blocks.get(u.Hash),h=hr(l);if(!i[a+1]){Hf(`Loaded new subshard ${c.prefix}`),await AB(r,h.Links,n,c.bucket,parseInt(c.prefix,16));const y=await n._findNewBucketAndPos(e);i.push({bucket:y.bucket,prefix:uh(y.pos),node:h});continue}const f=i[a+1];await xb(r,h.Links,f.bucket,n),f.node=h}return await n.put(e,!0),i.reverse(),{rootBucket:n,path:i}},X5e=async(r,e,t={})=>{const n=new _B({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:t.mtime,mode:t.mode},t);for(let i=0;i<e.length;i++)await n._bucket.put(e[i].name,{size:e[i].size,cid:e[i].cid});const s=await ks(n.flush(r.repo.blocks));if(!s)throw new Error("Flushing shard yielded no result");return s},vo=U("ipfs:mfs:core:utils:add-link");async function fd(r,e){let t=e.parent;if(e.parentCid){const s=we.asCID(e.parentCid);if(s===null)throw T(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(s.code!==jt)throw T(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");vo(`Loading parent node ${s}`);const i=await r.repo.blocks.get(s);t=hr(i)}if(!t)throw T(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!e.cid)throw T(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!e.name)throw T(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!e.size&&e.size!==0)throw T(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!t.Data)throw T(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");const n=Ot.unmarshal(t.Data);return n.type==="hamt-sharded-directory"?(vo("Adding link to sharded directory"),e8e(r,{...e,parent:t})):t.Links.length>=e.shardSplitThreshold?(vo("Converting directory to sharded directory"),J5e(r,{...e,parent:t,mtime:n.mtime,mode:n.mode})):(vo(`Adding ${e.name} (${e.cid}) to regular directory`),Z5e(r,{...e,parent:t}))}const J5e=async(r,e)=>{const t=await X5e(r,e.parent.Links.map(n=>({name:n.Name||"",size:n.Tsize||0,cid:n.Hash})).concat({name:e.name,size:e.size,cid:e.cid}),e);return vo(`Converted directory to sharded directory ${t.cid}`),t},Z5e=async(r,e)=>{const t=e.parent.Links.filter(u=>u.Name!==e.name);if(t.push({Name:e.name,Tsize:e.size,Hash:e.cid}),!e.parent.Data)throw T(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");const n=Ot.unmarshal(e.parent.Data);let s;if(n.mtime){const u=Date.now(),l=Math.floor(u/1e3);n.mtime={secs:l,nsecs:(u-l*1e3)*1e3},s=n.marshal()}else s=e.parent.Data;e.parent=To({Data:s,Links:t});const i=await r.hashers.getHasher(e.hashAlg),o=Ct(e.parent),a=await i.digest(o),c=we.create(e.cidVersion,jt,a);return e.flush&&await r.repo.blocks.put(c,o),{node:e.parent,cid:c,size:o.length}},e8e=async(r,e)=>{const{shard:t,path:n}=await t8e(r,e),s=await ks(t.flush(r.repo.blocks));if(!s)throw new Error("No result from flushing shard");const i=await r.repo.blocks.get(s.cid),o=hr(i),a=e.parent.Links.filter(u=>(u.Name||"").substring(0,2)!==n[0].prefix),c=o.Links.find(u=>(u.Name||"").substring(0,2)===n[0].prefix);if(!c)throw new Error(`No link found with prefix ${n[0].prefix}`);return a.push(c),Cb(r,a,n[0].bucket,e)},t8e=async(r,e)=>{const t={name:e.name,cid:e.cid,size:e.size};if(!e.parent.Data)throw T(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");const n=await $B(e.parent.Links),s=Ot.unmarshal(e.parent.Data),i=new _B({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:s.mode},e);i._bucket=n,s.mtime&&(i.mtime={secs:Math.round(Date.now()/1e3)});const o=await n._findNewBucketAndPos(t.name),a=r8e(o);a[0].node=e.parent;let c=0;for(;c<a.length;){const u=a[c];c++;const l=u.node;if(!l)throw new Error("Segment had no node");const h=l.Links.find(p=>(p.Name||"").substring(0,2)===u.prefix);if(!h){vo(`Link ${u.prefix}${t.name} will be added`),c=a.length;break}if(h.Name===`${u.prefix}${t.name}`){vo(`Link ${u.prefix}${t.name} will be replaced`),c=a.length;break}if((h.Name||"").length>2){vo(`Link ${h.Name} ${h.Hash} will be replaced with a subshard`),c=a.length;break}vo(`Found subshard ${u.prefix}`);const f=await r.repo.blocks.get(h.Hash),y=hr(f);if(!a[c]){vo(`Loaded new subshard ${u.prefix}`),await AB(r,y.Links,n,u.bucket,parseInt(u.prefix,16));const p=await n._findNewBucketAndPos(t.name);a.push({bucket:p.bucket,prefix:uh(p.pos),node:y});break}const d=a[c];await xb(r,y.Links,d.bucket,n),d.node=y}return await i._bucket.put(t.name,{size:t.size,cid:t.cid}),{shard:i,path:a}},r8e=r=>{const e=[{bucket:r.bucket,prefix:uh(r.pos)}];let t=r.bucket._parent,n=r.bucket._posAtParent;for(;t;)e.push({bucket:t,prefix:uh(n)}),n=t._posAtParent,t=t._parent;return e.reverse(),e},zI=U("ipfs:mfs:utils:update-tree"),n8e={shardSplitThreshold:1e3};async function wu(r,e,t){t=Object.assign({},n8e,t),zI("Trail",e),e=e.slice().reverse();let n=0,s;for await(const o of r.repo.blocks.getMany(e.map(a=>a.cid))){const a=hr(o),c=e[n].cid,u=e[n].name;if(n++,!s){s={cid:c,name:u,size:o.length};continue}const l=await fd(r,{parent:a,name:s.name,cid:s.cid,size:s.size,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold,hashAlg:t.hashAlg,cidVersion:t.cidVersion});s={cid:l.cid,name:u,size:l.size}}const{cid:i}=s;return zI(`Final CID ${i}`),i}const s8e=U("ipfs:mfs:utils:update-mfs-root");async function bu(r,e,t){if(t&&t.signal&&t.signal.aborted)throw T(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return s8e(`New MFS root will be ${e}`),await r.repo.datastore.put(d4,e.bytes),e}async function i8e(r,e,t){const n=new Ot({type:e,mode:t.mode,mtime:t.mtime}),s=await r.hashers.getHasher(t.hashAlg),i={Data:n.marshal(),Links:[]},o=Ct(i),a=await s.digest(o),c=we.create(t.cidVersion,jt,a);return t.flush&&await r.repo.blocks.put(c,o),{cid:c,node:i}}const o8e=kt.bind({ignoreUndefined:!0}),TB=U("ipfs:mfs:mkdir"),a8e={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function ug(r){async function e(t,n={}){const s=o8e(a8e,n);if(!t)throw new Error("no path given to Mkdir");if(t=t.trim(),t==="/"){if(s.parents)return;throw T(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if(t.substring(0,1)!=="/")throw T(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");TB(`Creating ${t}`);const i=Qv(t);if(i[0]==="ipfs")throw T(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");const o=await Wv(r,s);let a;const c=[],u=await i8e(r,"directory",s);for(let h=0;h<=i.length;h++){const f=i.slice(0,h),y=`/ipfs/${o}/${f.join("/")}`;try{if(a=await Sa(y,r.repo.blocks),a.type!=="file"&&a.type!=="directory")throw T(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(h===i.length){if(s.parents)return;throw T(new Error("file already exists"),"ERR_ALREADY_EXISTS")}c.push({name:a.name,cid:a.cid})}catch(d){if(d.code==="ERR_NOT_FOUND"){if(h<i.length&&!s.parents)throw T(new Error(`Intermediate directory path ${y} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await c8e(r,f[f.length-1],u,c[c.length-1],c,s)}else throw d}}const l=await wu(r,c,s);await bu(r,l,s)}return Y(e)}const c8e=async(r,e,t,n,s,i)=>{TB(`Adding empty dir called ${e} to ${n.cid}`);const o=await fd(r,{parent:n.node,parentCid:n.cid,size:0,cid:t.cid,name:e,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});s[s.length-1].cid=o.cid,s.push({name:e,cid:t.cid})},l8e=kt.bind({ignoreUndefined:!0}),z0=U("ipfs:mfs:cp"),u8e={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function Yv(r){async function e(t,n,s={}){const i=l8e(u8e,s);Array.isArray(t)||(t=[t]);const o=await Promise.all(t.map(f=>ws(r,f,i)));let a=await ws(r,n,i);if(!o.length||!a)throw T(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");const c=o.find(f=>!f.exists);if(c)throw T(new Error(`${c.path} does not exist`),"ERR_INVALID_PARAMS");const u=FI(a);if(a.exists){if(z0("Destination exists"),o.length===1&&!u)throw T(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(z0("Destination does not exist"),o.length>1){if(!i.parents)throw T(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await ug(r)(a.path,i),a=await ws(r,a.path,i)}else if(a.parts.length>1){const f=`/${a.parts.slice(0,-1).join("/")}`;try{await Rb(r)(f,i)}catch(y){if(y.code!=="ERR_NOT_FOUND")throw y;if(!i.parents)throw T(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await ug(r)(f,i),a=await ws(r,a.path,i)}}const l=FI(a)?a.mfsPath:a.mfsDirectory,h=await Gp(r,l);if(o.length===1){const f=o.pop();if(!f)throw T(new Error("could not find source"),"ERR_INVALID_PARAMS");const y=u?f.name:a.name;return z0(`Only one source, copying to destination ${u?"directory":"file"} ${y}`),h8e(r,f,y,h,i)}return z0("Multiple sources, wrapping in a directory"),d8e(r,o,a,h,i)}return Y(e)}const FI=r=>r.unixfs&&r.unixfs.type&&r.unixfs.type.includes("directory"),h8e=async(r,e,t,n,s)=>{let i=n.pop();if(!i)throw T(new Error("destination had no parent"),"ERR_INVALID_PARAMS");i=await IB(r,e,t,i,s),n.push(i);const o=await wu(r,n,s);await bu(r,o,s)},d8e=async(r,e,t,n,s)=>{for(let o=0;o<e.length;o++){const a=e[o];t=await IB(r,a,a.name,t,s)}n[n.length-1]=t;const i=await wu(r,n,s);await bu(r,i,s)},IB=async(r,e,t,n,s)=>{const i=await r.repo.blocks.get(e.cid),{node:o,cid:a,size:c}=await fd(r,{parentCid:n.cid,size:i.length,cid:e.cid,name:t,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold});return n.node=o,n.cid=a,n.size=c,n},wc=U("ipfs:mfs:core:utils:remove-link");async function f8e(r,e){let t=e.parent;if(e.parentCid){const s=we.asCID(e.parentCid);if(s===null)throw T(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");wc(`Loading parent node ${s}`);const i=await r.repo.blocks.get(s);t=hr(i)}if(!t)throw T(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!e.name)throw T(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!t.Data)throw T(new Error("Parent node had no data"),"ERR_INVALID_NODE");return Ot.unmarshal(t.Data).type==="hamt-sharded-directory"?(wc(`Removing ${e.name} from sharded directory`),y8e(r,{...e,parent:t})):(wc(`Removing link ${e.name} regular directory`),p8e(r,{...e,parent:t}))}const p8e=async(r,e)=>{e.parent.Links=e.parent.Links.filter(o=>o.Name!==e.name);const t=await Ct(e.parent),s=await(await r.hashers.getHasher(e.hashAlg)).digest(t),i=we.create(e.cidVersion,jt,s);return await r.repo.blocks.put(i,t),wc(`Updated regular directory ${i}`),{node:e.parent,cid:i}},y8e=async(r,e)=>{const{rootBucket:t,path:n}=await Y5e(r,e.name,e.parent);await t.del(e.name);const{node:s}=await RB(r,n,e.name,e);return Cb(r,s.Links,t,e)},RB=async(r,e,t,n)=>{const s=e.pop();if(!s)throw T(new Error("Could not find parent"),"EINVALIDPARENT");const{bucket:i,prefix:o,node:a}=s;if(!a)throw T(new Error("Could not find parent"),"EINVALIDPARENT");const c=a.Links.find(y=>(y.Name||"").substring(0,2)===o);if(!c)throw T(new Error(`No link found with prefix ${o} for file ${t}`),"ERR_NOT_FOUND");if(c.Name===`${o}${t}`){wc(`Removing existing link ${c.Name}`);const y=a.Links.filter(d=>d.Name!==c.Name);return await i.del(t),Cb(r,y,i,n)}wc(`Descending into sub-shard ${c.Name} for ${o}${t}`);const u=await RB(r,e,t,n);let l=u.cid,h=u.size,f=o;if(u.node.Links.length===1){wc(`Removing subshard for ${o}`);const y=u.node.Links[0];f=`${o}${(y.Name||"").substring(2)}`,l=y.Hash,h=y.Tsize||0}return wc(`Updating shard ${o} with name ${f}`),g8e(r,i,a,o,f,h,l,n)},g8e=(r,e,t,n,s,i,o,a)=>{const c=t.Links.filter(u=>u.Name!==n);return c.push({Name:s,Tsize:i,Hash:o}),Cb(r,c,e,a)},w8e=kt.bind({ignoreUndefined:!0}),b8e={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function Xv(r){async function e(t,n={}){const s=w8e(b8e,n);Array.isArray(t)||(t=[t]);const i=await Promise.all(t.map(o=>ws(r,o,s)));if(!i.length)throw T(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");i.forEach(o=>{if(o.path==="/")throw T(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")});for(const o of i)await m8e(r,o.path,s)}return Y(e)}const m8e=async(r,e,t)=>{const n=await ws(r,e,t),s=await Gp(r,n.mfsPath),i=s[s.length-1];s.pop();const o=s[s.length-1];if(!o)throw T(new Error(`${e} does not exist`),"ERR_NOT_FOUND");if(i.type==="directory"&&!t.recursive)throw T(new Error(`${e} is a directory, use -r to remove directories`),"ERR_WAS_DIR");const{cid:a}=await f8e(r,{parentCid:o.cid,name:i.name,hashAlg:t.hashAlg,cidVersion:t.cidVersion,flush:t.flush,shardSplitThreshold:t.shardSplitThreshold});o.cid=a;const c=await wu(r,s,t);await bu(r,c,t)},E8e=kt.bind({ignoreUndefined:!0}),v8e=U("ipfs:mfs:touch"),VI={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function _8e(r,e,t){let n=0;return(r.includes("x")||r.includes("X")&&(t||e&1||e&8||e&64))&&(n+=1),r.includes("w")&&(n+=2),r.includes("r")&&(n+=4),n}function S8e(r,e){let t=0;return r.includes("u")&&(t+=e<<6),r.includes("g")&&(t+=e<<3),r.includes("o")&&(t+=e),t}function A8e(r,e,t){return e.includes("t")&&(t+=parseInt("1000",8)),e.includes("s")&&(r.includes("u")&&(t+=parseInt("4000",8)),r.includes("g")&&(t+=parseInt("2000",8))),t}function $8e(r,e,t){e||(e=0);const n=r.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!n)throw new Error(`Invalid file mode: ${r}`);let[,s,i,o]=n;(s==="a"||!s)&&(s="ugo");let a=_8e(o,e,t);return a=S8e(s,a),a=A8e(s,o,a),i==="="?(s.includes("u")&&(e=e&parseInt("7077",8),e=e|a),s.includes("g")&&(e=e&parseInt("7707",8),e=e|a),s.includes("o")&&(e=e&parseInt("7770",8),e=e|a),e):i==="+"?a|e:i==="-"?a^e:e}function jI(r,e){if(r instanceof String||typeof r=="string"){const t=`${r}`;t.match(/^\d+$/g)?r=parseInt(t,8):r=0+t.split(",").reduce((n,s)=>$8e(s,n,e.isDirectory()),e.mode||0)}return r}function T8e(r){async function e(t,n,s={}){const i=E8e(VI,s);v8e(`Fetching stats for ${t}`);const{cid:o,mfsDirectory:a,name:c}=await ws(r,t,i);if(o.code!==jt)throw T(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(i.recursive){const _=await Ve(async function*(){for await(const $ of hU(o,r.repo.blocks)){if($.type!=="file"&&$.type!=="directory")throw T(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");$.unixfs.mode=jI(n,$.unixfs);const x=To({Data:$.unixfs.marshal(),Links:$.node.Links});yield{path:$.path,content:x}}},$=>Av($,r.repo.blocks,{...i,pin:!1,dagBuilder:async function*(x,k,j){for await(const G of x)yield async function(){const Q=G.content,V=Ct(Q),ne=await bB(V,k,j);if(!Q.Data)throw T(new Error(`${ne} had no data`),"ERR_INVALID_NODE");const W=Ot.unmarshal(Q.Data);return{cid:ne,size:V.length,path:G.path,unixfs:W}}}}),$=>ks($));if(!_)throw T(new Error(`Could not chmod ${t}`),"ERR_COULD_NOT_CHMOD");await Xv(r)(t,i),await Yv(r)(`/ipfs/${_.cid}`,t,i);return}const u=await r.repo.blocks.get(o),l=hr(u);if(!l.Data)throw T(new Error(`${o} had no data`),"ERR_INVALID_NODE");const h=Ot.unmarshal(l.Data);h.mode=jI(n,h);const f=Ct({Data:h.marshal(),Links:l.Links}),y=i.hashAlg||VI.hashAlg,p=await(await r.hashers.getHasher(y)).digest(f),b=we.create(i.cidVersion,jt,p);i.flush&&await r.repo.blocks.put(b,f);const w=await Gp(r,a),S=w[w.length-1],E=we.decode(S.cid.bytes),m=await r.repo.blocks.get(E),v=hr(m),A=await fd(r,{parent:v,name:c,cid:b,size:f.length,flush:i.flush,hashAlg:y,cidVersion:o.version,shardSplitThreshold:1/0});S.cid=A.cid;const g=await wu(r,w,i);await bu(r,g,i)}return Y(e)}const I8e=kt.bind({ignoreUndefined:!0}),R8e={};function C8e(r){async function e(t,n={}){n=I8e(R8e,n);const{cid:s}=await Rb(r)(t,n);return s}return Y(e)}const x8e=kt.bind({ignoreUndefined:!0}),D8e={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3};function P8e(r){async function e(t,n,s={}){const i=x8e(D8e,s);await Yv(r)(t,n,i),await Xv(r)(t,{...i,recursive:!0})}return Y(e)}const O8e=kt.bind({ignoreUndefined:!0}),k8e=U("ipfs:mfs:touch"),KI={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"};function N8e(r){async function e(t,n={}){const s=O8e(KI,n);s.mtime=s.mtime||new Date,k8e(`Touching ${t} mtime: ${s.mtime}`);const{cid:i,mfsDirectory:o,name:a,exists:c}=await ws(r,t,s),u=n.hashAlg||KI.hashAlg,l=await r.hashers.getHasher(u);let h,f,y=s.cidVersion;if(c){if(i.code!==jt)throw T(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");y=i.version;const v=await r.repo.blocks.get(i),A=hr(v);if(!A.Data)throw T(new Error(`${t} had no data`),"ERR_INVALID_NODE");const g=Ot.unmarshal(A.Data);g.mtime=s.mtime,h=Ct({Data:g.marshal(),Links:A.Links});const _=await l.digest(h);f=we.create(s.cidVersion,jt,_),s.flush&&await r.repo.blocks.put(f,h)}else{const v=new Ot({type:"file",mtime:s.mtime});h=Ct({Data:v.marshal(),Links:[]});const A=await l.digest(h);f=we.create(s.cidVersion,jt,A),s.flush&&await r.repo.blocks.put(f,h)}const d=await Gp(r,o),p=d[d.length-1],b=p.cid,w=await r.repo.blocks.get(b),S=hr(w),E=await fd(r,{parent:S,name:a,cid:f,size:h.length,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold,hashAlg:s.hashAlg,cidVersion:y});p.cid=E.cid;const m=await wu(r,d,s);await bu(r,m,s)}return Y(e)}const L8e=kt.bind({ignoreUndefined:!0}),M8e={offset:0,length:1/0};function U8e(r){function e(t,n={}){return n=L8e(M8e,n),{[Symbol.asyncIterator]:async function*(){const i=await ws(r,t,n),o=await Sa(i.mfsPath,r.repo.blocks);if(o.type!=="file"&&o.type!=="raw")throw T(new Error(`${t} was not a file or raw bytes`),"ERR_NOT_FILE");if(!o.content)throw T(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(const a of o.content({offset:n.offset,length:n.length}))yield a}}}return Y(e)}const Wd=U("ipfs:mfs:utils:to-async-iterator");function B8e(r){if(!r)throw T(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if((typeof r=="string"||r instanceof String)&&(Wd("Content was a string"),r=M(r.toString())),r.length)return Wd("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield r}};if(r[Symbol.asyncIterator])return Wd("Content was an async iterator"),r;if(r[Symbol.iterator])return Wd("Content was an iterator"),r;if(iS.Blob&&r instanceof iS.Blob)return Wd("Content was an HTML5 Blob"),Kl(r.stream());throw T(new Error(`Don't know how to convert ${r} into an async iterator`),"ERR_INVALID_PARAMS")}const z8e=kt.bind({ignoreUndefined:!0}),fo=U("ipfs:mfs:write"),F8e={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(r,e)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3};function V8e(r){async function e(t,n,s={}){const i=z8e(F8e,s);let o,a,c;if(fo("Reading source, destination and parent"),await Gv().readLock(async()=>{o=await B8e(n),a=await ws(r,t,i),c=await ws(r,a.mfsDirectory,i)})(),fo("Read source, destination and parent"),!i.parents&&!c.exists)throw T(new Error("directory does not exist"),"ERR_NO_EXIST");if(o==null)throw T(new Error("could not create source"),"ERR_NO_SOURCE");if(a==null)throw T(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!i.create&&!a.exists)throw T(new Error("file does not exist"),"ERR_NO_EXIST");if(a.entryType!=="file")throw T(new Error("not a file"),"ERR_NOT_A_FILE");return j8e(r,t,o,a,i)}return Y(e)}const j8e=async(r,e,t,n,s)=>{const i=await K8e(r,t,n,s);await Gv().writeLock(async()=>{const o=Qv(e),a=o.pop();if(a==null)throw T(new Error("source does not exist"),"ERR_NO_EXIST");let c=!1;try{await Rb(r)(`/${o.join("/")}`,s),c=!0}catch(b){if(b.code!=="ERR_NOT_FOUND")throw b}c||await ug(r)(`/${o.join("/")}`,s);const u=await ws(r,e,s),l=await Gp(r,u.mfsDirectory),h=l[l.length-1];if(!h)throw T(new Error("directory does not exist"),"ERR_NO_EXIST");if(!h.type||!h.type.includes("directory"))throw T(new Error(`cannot write to ${h.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");const f=await r.repo.blocks.get(h.cid),y=hr(f),d=await fd(r,{parent:y,name:a,cid:i.cid,size:i.size,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold,hashAlg:s.hashAlg,cidVersion:s.cidVersion});h.cid=d.cid;const p=await wu(r,l,s);await bu(r,p,s)})()},K8e=async(r,e,t,n)=>{t.exists?fo(`Overwriting file ${t.cid} offset ${n.offset} length ${n.length}`):fo(`Writing file offset ${n.offset} length ${n.length}`);const s=[];if(n.offset>0)if(t.unixfs){if(fo(`Writing first ${n.offset} bytes of original file`),s.push(()=>t.content({offset:0,length:n.offset})),t.unixfs.fileSize()<n.offset){const l=n.offset-t.unixfs.fileSize();fo(`Writing zeros for extra ${l} bytes`),s.push(qI(l))}}else fo(`Writing zeros for first ${n.offset} bytes`),s.push(qI(n.offset));s.push(CB(e,n.length));const i=H8e(q8e(s),l=>{if(t.unixfs&&!n.truncate){const h=t.unixfs.fileSize();if(h>l)return fo(`Writing last ${h-l} of ${h} bytes from original file starting at offset ${l}`),t.content({offset:l});fo("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}});let o;n.mode!==void 0&&n.mode!==null?o=sh(n.mode):t&&t.unixfs&&(o=t.unixfs.mode);let a;n.mtime!=null?a=_1(n.mtime):t&&t.unixfs&&(a=t.unixfs.mtime);const c=await r.hashers.getHasher(n.hashAlg),u=await ks(Av([{content:i,mode:o,mtime:a}],r.repo.blocks,{progress:n.progress,hasher:c,cidVersion:n.cidVersion,strategy:n.strategy,rawLeaves:n.rawLeaves,reduceSingleLeafToSelf:n.reduceSingleLeafToSelf,leafType:n.leafType}));if(!u)throw T(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return fo(`Wrote ${u.cid}`),{cid:u.cid,size:u.size}},CB=(r,e)=>async function*(){let n=0;for await(const s of r){if(n+=s.length,n>e){yield s.subarray(0,e-n);return}yield s}},qI=(r,e=Lie)=>{const t=new Uint8Array(e);async function*n(){for(;;)yield t}return CB(n(),r)},q8e=async function*(r){for(let e=0;e<r.length;e++)yield*r[e]()},H8e=async function*(r,e){let t=0;for await(const n of r)t+=n.length,yield n;for await(const n of e(t))t+=n.length,yield n},HI=r=>{const e={cid:r.cid,name:r.name,type:r.type==="directory"?"directory":"file",size:r.size};return(r.type==="file"||r.type==="directory")&&(e.mode=r.unixfs.mode,e.mtime=r.unixfs.mtime),e};function G8e(r){async function*e(t,n={}){const s=await ws(r,t,n),i=await Sa(s.mfsPath,r.repo.blocks);if(i.type==="directory"){yield*ls(i.content(n),HI);return}yield HI(i)}return Y(e)}const W8e={stat:Rb},Q8e={chmod:T8e,cp:Yv,flush:C8e,mkdir:ug,mv:P8e,rm:Xv,touch:N8e},GI={write:V8e,read:U8e,ls:G8e},WI=({options:r,mfs:e,operations:t,lock:n})=>{Object.keys(t).forEach(s=>{e[s]=n(t[s](r))})},Y8e={repoOwner:!0,repo:null};function X8e(r){const{repoOwner:e}=Object.assign({},Y8e||{},r),t=Gv(e),n=o=>t.readLock(o),s=o=>t.writeLock(o),i={};return WI({options:r,mfs:i,operations:W8e,lock:n}),WI({options:r,mfs:i,operations:Q8e,lock:s}),Object.keys(GI).forEach(o=>{i[o]=GI[o](r)}),i}function J8e({repo:r,preload:e,hashers:t,options:n}){const s=X8e({repo:r,repoOwner:n.repoOwner!==!1,hashers:t}),i=o=>(...c)=>{const u=c.filter(l=>Lse(l)||SE(l));if(u.length){const l=c[c.length-1];l&&l.preload!==!1&&u.forEach(h=>e(h))}return o(...c)};return{...s,chmod:s.chmod,cp:i(s.cp),mkdir:s.mkdir,stat:i(s.stat),rm:s.rm,read:i(s.read),touch:s.touch,write:s.write,mv:i(s.mv),flush:s.flush,ls:i(async function*(...o){for await(const a of s.ls(...o))yield{...a,size:a.size||0}})}}function Z8e({keychain:r}){return Y((t,n)=>r.exportKey(t,n))}const QI="Ed25519",YI=2048;function e7e({keychain:r}){return Y((t,n={type:QI,size:YI})=>r.createKey(t,n.type||QI,n.size||YI))}function t7e({keychain:r}){return Y((t,n,s)=>r.importKey(t,n,s))}function r7e({keychain:r}){return Y(t=>r.findKeyByName(t))}function n7e({keychain:r}){return Y(()=>r.listKeys())}function s7e({keychain:r}){return Y(async(t,n)=>{const s=await r.renameKey(t,n);return{was:t,now:s.name,id:s.id,overwrite:!1}})}function i7e({keychain:r}){return Y(t=>r.removeKey(t))}class o7e{constructor({keychain:e}){this.gen=e7e({keychain:e}),this.list=n7e({keychain:e}),this.rm=i7e({keychain:e}),this.rename=s7e({keychain:e}),this.export=Z8e({keychain:e}),this.import=t7e({keychain:e}),this.info=r7e({keychain:e})}}function mu({repo:r,preload:e}){async function t(n,s={}){s.preload!==!1&&e(n);const i=await r.blocks.get(n,s);return hr(i)}return Y(t)}function a7e({repo:r,preload:e}){const t=mu({repo:r,preload:e});async function n(s,i={}){return(await t(s,i)).Data||new Uint8Array(0)}return Y(n)}function T5(r,e=[]){for(const t in r){const n=r[t];if(t==="/"&&Object.keys(r).length===1)try{e.push({Name:"",Tsize:0,Hash:we.parse(n)});continue}catch{}const s=we.asCID(n);if(s){e.push({Name:"",Tsize:0,Hash:s});continue}Array.isArray(n)&&T5(n,e),n&&typeof n=="object"&&T5(n,e)}return e}function c7e({repo:r,codecs:e}){async function t(n,s={}){const i=await e.getCodec(n.code),o=await r.blocks.get(n,s),a=i.decode(o);switch(n.code){case mE:return[];case jt:return a.Links;case Z7:case Vk:return T5(a);default:throw new Error(`Cannot resolve links from codec ${n.code}`)}}return Y(t)}function l7e({repo:r,preload:e}){async function t(n={}){let s;if(n.template)if(n.template==="unixfs-dir")s=new Ot({type:"directory"}).marshal();else throw new Error("unknown template");const i=Ct({Data:s,Links:[]}),o=await Eh.digest(i),a=we.createV0(o);return await r.blocks.put(a,i,{signal:n.signal}),n.preload!==!1&&e(a),a}return Y(t)}function Wp({repo:r,preload:e}){async function t(n,s={}){const i=await r.gcLock.readLock();try{const o=Ct(n),a=await Eh.digest(o),c=we.createV1(jt,a);return await r.blocks.put(c,o,{signal:s.signal}),s.preload!==!1&&e(c),s.pin&&await r.pins.pinRecursively(c,{signal:s.signal}),c}finally{i()}}return Y(t)}function u7e({repo:r,preload:e}){const t=mu({repo:r,preload:e});async function n(s,i={}){const o=await t(s,i),c=Ct(o).length,u=o.Links.reduce((l,h)=>l+(h.Tsize||0),0);return{Hash:s,NumLinks:o.Links.length,BlockSize:c,LinksSize:c-(o.Data||[]).length,DataSize:(o.Data||[]).length,CumulativeSize:c+u}}return Y(n)}function h7e({repo:r,preload:e}){const t=mu({repo:r,preload:e}),n=Wp({repo:r,preload:e});async function s(i,o,a={}){const c=await t(i,a);return n({...c,Links:c.Links.concat([o])},a)}return Y(s)}function d7e({repo:r,preload:e}){const t=mu({repo:r,preload:e}),n=Wp({repo:r,preload:e});async function s(i,o,a={}){const c=await t(i,a),u=z([c.Data||[],o]);return n({...c,Data:u},a)}return Y(s)}function f7e({repo:r,preload:e}){const t=mu({repo:r,preload:e}),n=Wp({repo:r,preload:e});async function s(i,o,a={}){const c=await t(i,a),u=(typeof o=="string"?o:o.Name)||"";return c.Links=c.Links.filter(l=>l.Name!==u),n(c,a)}return Y(s)}function p7e({repo:r,preload:e}){const t=mu({repo:r,preload:e}),n=Wp({repo:r,preload:e});async function s(i,o,a={}){const c=await t(i,a);return n({...c,Data:o},a)}return Y(s)}class y7e{constructor({repo:e,preload:t}){this.addLink=h7e({repo:e,preload:t}),this.appendData=d7e({repo:e,preload:t}),this.rmLink=f7e({repo:e,preload:t}),this.setData=p7e({repo:e,preload:t})}}class g7e{constructor({repo:e,codecs:t,preload:n}){this.data=a7e({repo:e,preload:n}),this.get=mu({repo:e,preload:n}),this.links=c7e({repo:e,codecs:t}),this.new=l7e({repo:e,preload:n}),this.put=Wp({repo:e,preload:n}),this.stat=u7e({repo:e,preload:n}),this.patch=new y7e({repo:e,preload:n})}}const w7e=U("ipfs:repo:gc");function b7e({repo:r,hashers:e}){async function*t(n={}){const s=Date.now();let i;try{i=await Wv({repo:r,hashers:e},n),await r.pins.pinRecursively(i),yield*r.gc()}finally{i&&await r.pins.unpin(i)}w7e(`Complete (${Date.now()-s}ms)`)}return Y(t)}function xB({repo:r}){async function e(t={}){const n=await r.stat();return{numObjects:BigInt(n.numObjects.toString()),repoSize:BigInt(n.repoSize.toString()),repoPath:n.repoPath,version:`${n.version}`,storageMax:BigInt(n.storageMax.toString())}}return Y(e)}const k2=12;function m7e({repo:r}){async function e(t={}){try{await r._checkInitialized(t)}catch(n){if([/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some(i=>i.test(n.message)))return k2;throw n}return r.version.get()}return Y(e)}class E7e{constructor({repo:e,hashers:t}){this.gc=b7e({repo:e,hashers:t}),this.stat=xB({repo:e}),this.version=m7e({repo:e}),this.setApiAddr=n=>e.apiAddr.set(n)}}function XI(r,e){return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0}}function v7e({network:r}){return Y(async function*(t={}){const{libp2p:n}=await r.use(t);if(!t.poll){yield XI();return}const s=t.interval||1e3;let i=-1;try{if(i=typeof s=="string"?Te(s)||-1:s,!i||i<0)throw new Error("invalid duration")}catch(a){throw T(a,"ERR_INVALID_POLL_INTERVAL")}let o;try{for(;;)yield XI(n,t),await new Promise(a=>{o=setTimeout(a,i)})}finally{clearTimeout(o)}})}class _7e{constructor({repo:e,network:t}){this.repo=xB({repo:e}),this.bw=v7e({network:t}),this.bitswap=ZL({network:t})}}var Jv=S7e;function S7e(r,e,t){if(!r)return t;var n,s;if(Array.isArray(e)&&(n=e.slice(0)),typeof e=="string"&&(n=e.split(".")),typeof e=="symbol"&&(n=[e]),!Array.isArray(n))throw new Error("props arg must be an array, a string or a symbol");for(;n.length;)if(s=n.shift(),!r||(r=r[s],r===void 0))return t;return r}var A7e=DB,JI=128,$7e=127,T7e=~$7e,I7e=Math.pow(2,31);function DB(r,e,t){e=e||[],t=t||0;for(var n=t;r>=I7e;)e[t++]=r&255|JI,r/=128;for(;r&T7e;)e[t++]=r&255|JI,r>>>=7;return e[t]=r|0,DB.bytes=t-n+1,e}var R7e=I5,C7e=128,ZI=127;function I5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw I5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&ZI)<<s:(o&ZI)*Math.pow(2,s),s+=7}while(o>=C7e);return I5.bytes=i-n,t}var x7e=Math.pow(2,7),D7e=Math.pow(2,14),P7e=Math.pow(2,21),O7e=Math.pow(2,28),k7e=Math.pow(2,35),N7e=Math.pow(2,42),L7e=Math.pow(2,49),M7e=Math.pow(2,56),U7e=Math.pow(2,63),B7e=function(r){return r<x7e?1:r<D7e?2:r<P7e?3:r<O7e?4:r<k7e?5:r<N7e?6:r<L7e?7:r<M7e?8:r<U7e?9:10},z7e={encode:A7e,decode:R7e,encodingLength:B7e},hg=z7e;const R5=(r,e=0)=>[hg.decode(r,e),hg.decode.bytes],dg=(r,e,t=0)=>(hg.encode(r,e,t),e),fg=r=>hg.encodingLength(r),F7e=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Zv=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},V7e=r=>new TextEncoder().encode(r),j7e=r=>new TextDecoder().decode(r),C5=(r,e)=>{const t=e.byteLength,n=fg(r),s=n+fg(t),i=new Uint8Array(s+t);return dg(r,i,0),dg(t,i,n),i.set(e,s),new e9(r,t,e,i)},Db=r=>{const e=Zv(r),[t,n]=R5(e),[s,i]=R5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new e9(t,s,o,e)},K7e=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&F7e(r.bytes,t.bytes)}};let e9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function q7e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var H7e=q7e,G7e=H7e;let W7e=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Q7e=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return PB(this,e)}},Y7e=class{constructor(e){this.decoders=e}or(e){return PB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const PB=(r,e)=>new Y7e({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let X7e=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new W7e(e,t,n),this.decoder=new Q7e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Pb=({name:r,prefix:e,encode:t,decode:n})=>new X7e(r,e,t,n),Qp=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=G7e(t,e);return Pb({prefix:r,name:e,encode:n,decode:i=>Zv(s(i))})},J7e=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Z7e=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Xr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Pb({prefix:e,name:r,encode(s){return Z7e(s,n,t)},decode(s){return J7e(s,n,t,r)}}),Fi=Qp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),eEe=Qp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),tEe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Fi,base58flickr:eEe},Symbol.toStringTag,{value:"Module"})),xs=Xr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rEe=Xr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nEe=Xr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sEe=Xr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),iEe=Xr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oEe=Xr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aEe=Xr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cEe=Xr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lEe=Xr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),uEe=Object.freeze(Object.defineProperty({__proto__:null,base32:xs,base32hex:iEe,base32hexpad:aEe,base32hexpadupper:cEe,base32hexupper:oEe,base32pad:nEe,base32padupper:sEe,base32upper:rEe,base32z:lEe},Symbol.toStringTag,{value:"Module"})),eR=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return dEe(t,x5(r),e||Fi.encoder);default:return fEe(t,x5(r),e||xs.encoder)}},tR=new WeakMap,x5=r=>{const e=tR.get(r);if(e==null){const t=new Map;return tR.set(r,t),t}return e};let Do=class Mn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Qd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==pEe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Mn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=C5(e,t);return Mn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Mn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&K7e(e.multihash,n.multihash)}toString(e){return eR(this,e)}toJSON(){return{"/":eR(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Mn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Mn(n,s,i,o||rR(n,s,i.bytes))}else if(t[yEe]===!0){const{version:n,multihash:s,code:i}=t,o=Db(s);return Mn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Qd)throw new Error(`Version 0 CID must use dag-pb (code: ${Qd}) block encoding`);return new Mn(e,t,n,n.bytes)}case 1:{const s=rR(e,t,n.bytes);return new Mn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Mn.create(0,Qd,e)}static createV1(e,t){return Mn.create(1,e,t)}static decode(e){const[t,n]=Mn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Mn.inspectBytes(e),n=t.size-t.multihashSize,s=Zv(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new e9(t.multihashCode,t.digestSize,i,s);return[t.version===0?Mn.createV0(o):Mn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=R5(e.subarray(t));return t+=f,h};let s=n(),i=Qd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=hEe(e,t),i=Mn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return x5(i).set(n,e),i}};const hEe=(r,e)=>{switch(r[0]){case"Q":{const t=e||Fi;return[Fi.prefix,t.decode(`${Fi.prefix}${r}`)]}case Fi.prefix:{const t=e||Fi;return[Fi.prefix,t.decode(r)]}case xs.prefix:{const t=e||xs;return[xs.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},dEe=(r,e,t)=>{const{prefix:n}=t;if(n!==Fi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},fEe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Qd=112,pEe=18,rR=(r,e,t)=>{const n=fg(r),s=n+fg(e),i=new Uint8Array(s+t.byteLength);return dg(r,i,0),dg(e,i,n),i.set(t,s),i},yEe=Symbol.for("@ipld/js-cid/CID");async function Oh(r){let e=0;for await(const t of r)e++;return e}const gEe=85,wEe=_e("ipfs:repo:migrator:migration-8");function OB(r){return r.child?OB(r.child):r}function bEe(r){try{const e=xs.decode(`b${r.toString().toLowerCase().slice(1)}`),t=Do.decode(e).multihash.bytes,n=xs.encode(t).slice(1).toUpperCase();return new be(`/${n}`,!1)}catch{return r}}function mEe(r){try{const e=xs.decode(`b${r.toString().toLowerCase().slice(1)}`),t=Db(e),n=xs.encode(Do.createV1(gEe,t).bytes).slice(1);return new be(`/${n.toUpperCase()}`,!1)}catch{return r}}async function nR(r,e,t){const n=r.blocks;await n.open();const s=OB(n),i=await Oh(s.queryKeys({filters:[o=>t(o).toString()!==o.toString()]}));try{let o=0;for await(const a of s.query({})){const c=t(a.key);c.toString()!==a.key.toString()&&(o+=1,wEe(`Migrating Block from ${a.key} to ${c}`,await s.has(a.key)),await s.delete(a.key),await s.put(c,a.value),e(o/i*100,`Migrated Block from ${a.key} to ${c}`))}}finally{await n.close()}}const EEe={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(r,e=()=>{})=>nR(r,e,bEe),revert:(r,e=()=>{})=>nR(r,e,mEe)},sR=le.Reader,vEe=le.Writer;le.util;const F0=le.roots.default||(le.roots.default={}),_Ee=F0.ipfs=(()=>{const r={};return r.pin=function(){const e={};return e.Set=function(){function t(n){if(n)for(var s=Object.keys(n),i=0;i<s.length;++i)n[s[i]]!=null&&(this[s[i]]=n[s[i]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(s,i){return i||(i=vEe.create()),s.version!=null&&Object.hasOwnProperty.call(s,"version")&&i.uint32(8).uint32(s.version),s.fanout!=null&&Object.hasOwnProperty.call(s,"fanout")&&i.uint32(16).uint32(s.fanout),s.seed!=null&&Object.hasOwnProperty.call(s,"seed")&&i.uint32(29).fixed32(s.seed),i},t.decode=function(s,i){s instanceof sR||(s=sR.create(s));for(var o=i===void 0?s.len:s.pos+i,a=new F0.ipfs.pin.Set;s.pos<o;){var c=s.uint32();switch(c>>>3){case 1:a.version=s.uint32();break;case 2:a.fanout=s.uint32();break;case 3:a.seed=s.fixed32();break;default:s.skipType(c&7);break}}return a},t.fromObject=function(s){if(s instanceof F0.ipfs.pin.Set)return s;var i=new F0.ipfs.pin.Set;return s.version!=null&&(i.version=s.version>>>0),s.fanout!=null&&(i.fanout=s.fanout>>>0),s.seed!=null&&(i.seed=s.seed>>>0),i},t.toObject=function(s,i){i||(i={});var o={};return i.defaults&&(o.version=0,o.fanout=0,o.seed=0),s.version!=null&&s.hasOwnProperty("version")&&(o.version=s.version),s.fanout!=null&&s.hasOwnProperty("fanout")&&(o.fanout=s.fanout),s.seed!=null&&s.hasOwnProperty("seed")&&(o.seed=s.seed),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},t}(),e}(),r})();var D5={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),t.BASE=2166136261;function t(n,s=t.BASE){const i=n.length;for(let o=0;o<i;o++)s^=n.charCodeAt(o),s+=(s<<1)+(s<<4)+(s<<7)+(s<<8)+(s<<24);return s>>>0}e.default=t,r.exports=t})(D5,D5.exports);var SEe=D5.exports;const AEe=Et(SEe),N2=new be("/local/pins"),I6=256,$Ee=8192,kB=Do.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),Xu={direct:"direct",recursive:"recursive"};function iR(r){return new be(`/${xs.encode(r.multihash.bytes).toUpperCase().substring(1)}`)}const TEe=({name:r,code:e,encode:t})=>new IEe(r,e,t);let IEe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?C5(this.code,t):t.then(n=>C5(this.code,n))}else throw Error("Unknown type, must be binary type")}};const REe=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),t9=TEe({name:"sha2-256",code:18,encode:REe("SHA-256")}),P5=_Ee.pin.Set;function CEe(r){const e=r.Data;if(!e)throw new Error("No data present");const t=P.decode(e),n=P.decode.bytes??0;if(n<=0)throw new Error("Invalid Set header length");if(n+t>e.length)throw new Error("Impossibly large set header length");const s=e.slice(n,t+n),i=P5.toObject(P5.decode(s),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(i.version!==1)throw new Error(`Unsupported Set version: ${i.version}`);if(i.fanout>r.Links.length)throw new Error("Impossibly large fanout");return{header:i,data:e.slice(t+n)}}function xEe(r,e){const t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,r,!0);const s=M(e.toString()),i=z([t,s],t.byteLength+s.byteLength);return AEe(R(i))}async function*NB(r,e){const t=CEe(e);let n=0;for(const s of e.Links){if(n<t.header.fanout){const i=s.Hash;if(!kB.equals(i)){const o=await r.get(i),a=hr(o);yield*NB(r,a)}}else yield s.Hash;n++}}async function*V0(r,e,t){const n=e.Links.find(o=>o.Name===t);if(!n)throw new Error("No link found with name "+t);const s=await r.get(n.Hash),i=hr(s);yield*NB(r,i)}function DEe(r,e){return t(e,0);async function t(n,s){const i=P5.encode({version:1,fanout:I6,seed:s}).finish(),o=P.encode(i.length),a=z([o,i]),c=[];for(let l=0;l<I6;l++)c.push({Name:"",Tsize:1,Hash:kB});if(n.length<=$Ee){const l=n.map(y=>({link:{Name:"",Tsize:1,Hash:y.key},data:y.data||new Uint8Array})).sort((y,d)=>Om(y.link.Hash.bytes,d.link.Hash.bytes)),h=c.concat(l.map(y=>y.link));return{Data:z([a,...l.map(y=>y.data)]),Links:h}}else{const l=n.reduce((f,y)=>{const d=xEe(s,y.key)%I6;return f[d]=d in f?f[d].concat([y]):[y],f},[]);let h=0;for(const f of l){const y=await t(f,s+1);await u(y,h),h++}return{Data:a,Links:c}}async function u(l,h){const f=Ct(l),y=await t9.digest(f),d=Do.createV0(y);await r.put(d,f);const p=l.Links.reduce((b,w)=>b+(w.Tsize||0),0)+f.length;c[h]={Name:"",Tsize:p,Hash:d}}}}async function oR(r,e,t){const n=await DEe(r,t.map(c=>({key:c}))),s=Ct(n),i=await t9.digest(s),o=Do.createV0(i);await r.put(o,s);const a=n.Links.reduce((c,u)=>c+u.Tsize,0)+s.length;return{Name:e,Tsize:a,Hash:o}}async function PEe(r,e,t,n){if(!await e.has(N2))return;const s=await e.get(N2),i=Do.decode(s),o=await r.get(i),a=hr(o);let c=0;const u=await Oh(V0(r,a,Xu.recursive))+await Oh(V0(r,a,Xu.direct));for await(const l of V0(r,a,Xu.recursive)){c++;const h={depth:1/0};l.version!==0&&(h.version=l.version),l.code!==jt&&(h.codec=l.code),await t.put(iR(l),P1(h)),n(c/u*100,`Migrated recursive pin ${l}`)}for await(const l of V0(r,a,Xu.direct)){c++;const h={depth:0};l.version!==0&&(h.version=l.version),l.code!==jt&&(h.codec=l.code),await t.put(iR(l),P1(h)),n(c/u*100,`Migrated direct pin ${l}`)}await r.delete(i),await e.delete(N2)}async function OEe(r,e,t,n){const s=[],i=[];let o=0;const a=await Oh(t.queryKeys({}));for await(const{key:f,value:y}of t.query({})){o++;const d=Qa(y),p=Do.create(d.version||0,d.codec||jt,Db(xs.decode("b"+f.toString().toLowerCase().split("/").pop())));d.depth===0?(n(o/a*100,`Reverted direct pin ${p}`),i.push(p)):(n(o/a*100,`Reverted recursive pin ${p}`),s.push(p))}n(100,"Updating pin root");const c={Links:[await oR(r,Xu.direct,i),await oR(r,Xu.recursive,s)]},u=Ct(c),l=await t9.digest(u),h=Do.createV0(l);await r.put(h,u),await e.put(N2,h.bytes)}async function aR(r,e,t){const n=r.blocks,s=r.datastore,i=r.pins;await n.open(),await s.open(),await i.open();try{await t(n,s,i,e)}finally{await i.close(),await s.close(),await n.close()}}const kEe={version:9,description:"Migrates pins to datastore",migrate:(r,e=()=>{})=>aR(r,e,PEe),revert:(r,e=()=>{})=>aR(r,e,OEe)},NEe=new be("/config"),r9=new be("/version");function Ob(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}async function LEe(r,e,t){const n=await e(r);if(n)return n;const s=Ob(t);return s?new Promise((i,o)=>{const a=s.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{i(!!a.result)}}):!1}async function MEe(r,e,t,n){if(await t(r))return e(r);const s=Ob(n);if(!s)throw Ro();return new Promise((i,o)=>{const a=s.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return i(a.result);o(Ro())}})}function j0(r){const e=r.get.bind(r),t=r.has.bind(r);return r.get=n=>MEe(n,e,t,r),r.has=n=>LEe(n,t,r),r}function LB(r){return{...r,root:j0(r.root),datastore:j0(r.datastore),pins:j0(r.pins),keys:j0(r.keys)}}async function UEe(r,e,t=()=>{}){const n=Ob(e);if(!n){t(`${r} did not need an upgrade`);return}t(`Upgrading ${r}`),await UB(n,(i,o)=>[{type:"del",key:i},{type:"put",key:M(i),value:o}])}async function BEe(r,e,t=()=>{}){const n=Ob(e);if(!n){t(`${r} did not need a downgrade`);return}t(`Downgrading ${r}`),await UB(n,(i,o)=>[{type:"del",key:i},{type:"put",key:R(i),value:o}])}function MB(r){return r.child?MB(r.child):r}async function cR(r,e,t){const n=Object.entries(r).map(([o,a])=>({key:o,backend:MB(a)})).filter(({key:o,backend:a})=>a.constructor.name==="LevelDatastore").map(({key:o,backend:a})=>({name:o,store:a}));e(0,`Migrating ${n.length} dbs`);let s=0;const i=o=>{e(Math.round(s/n.length*100),o)};for(const{name:o,store:a}of n){await a.open();try{await t(o,a,i)}finally{s++,await a.close()}}e(100,`Migrated ${n.length} dbs`)}const zEe={version:10,description:"Migrates datastore-level keys to binary",migrate:(r,e=()=>{})=>cR(r,e,UEe),revert:(r,e=()=>{})=>cR(r,e,BEe)};function UB(r,e){function t(n,s){const i=r.store("readwrite"),o=i.transaction;let a=0,c;o.onabort=()=>s(c||o.error||new Error("aborted by user")),o.oncomplete=()=>s();function u(){const l=n[a++],h=l.key;let f;try{f=l.type==="del"?i.delete(h):i.put(l.value,h)}catch(y){c=y,o.abort();return}a<n.length&&(f.onsuccess=u)}u()}return new Promise((n,s)=>{const i=r.iterator(),o=c=>c;i._deserializeKey=i._deserializeValue=o,a();function a(){const c=(u,l,h)=>{if(u||l===void 0){const f=y=>{if(y){s(y);return}n()};i.end(f);return}t(e(l,h),a)};i.next(c)}})}const bc=new be("/local/filesroot");async function FEe(r,e=()=>{}){if(e(100,"Migrating MFS root to repo datastore"),await r.root.open(),await r.datastore.open(),await r.root.has(bc)){const t=await r.root.get(bc);await r.datastore.put(bc,t),await r.root.delete(bc)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo datastore")}async function VEe(r,e=()=>{}){if(e(100,"Migrating MFS root to repo root datastore"),await r.root.open(),await r.datastore.open(),await r.datastore.has(bc)){const t=await r.datastore.get(bc);await r.root.put(bc,t),await r.datastore.delete(bc)}await r.datastore.close(),await r.root.close(),e(100,"Stored MFS root in repo root datastore")}const jEe={version:11,description:"Store mfs root in the datastore",migrate:FEe,revert:VEe},lR=le.Reader,KEe=le.Writer,qEe=le.util,K0=le.roots.default||(le.roots.default={}),BB=K0.Protocols=(()=>{function r(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.protocols=qEe.emptyArray,r.encode=function(t,n){if(n||(n=KEe.create()),t.protocols!=null&&t.protocols.length)for(var s=0;s<t.protocols.length;++s)n.uint32(10).string(t.protocols[s]);return n},r.decode=function(t,n){t instanceof lR||(t=lR.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new K0.Protocols;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.protocols&&i.protocols.length||(i.protocols=[]),i.protocols.push(t.string());break;default:t.skipType(o&7);break}}return i},r.fromObject=function(t){if(t instanceof K0.Protocols)return t;var n=new K0.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");n.protocols=[];for(var s=0;s<t.protocols.length;++s)n.protocols[s]=String(t.protocols[s])}return n},r.toObject=function(t,n){n||(n={});var s={};if((n.arrays||n.defaults)&&(s.protocols=[]),t.protocols&&t.protocols.length){s.protocols=[];for(var i=0;i<t.protocols.length;++i)s.protocols[i]=t.protocols[i]}return s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r})(),Iu=le.Reader,R6=le.Writer,Ut=le.util,Ir=le.roots.default||(le.roots.default={}),zB=Ir.Addresses=(()=>{function r(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.addrs=Ut.emptyArray,r.prototype.certifiedRecord=null,r.encode=function(t,n){if(n||(n=R6.create()),t.addrs!=null&&t.addrs.length)for(var s=0;s<t.addrs.length;++s)Ir.Addresses.Address.encode(t.addrs[s],n.uint32(10).fork()).ldelim();return t.certifiedRecord!=null&&Object.hasOwnProperty.call(t,"certifiedRecord")&&Ir.Addresses.CertifiedRecord.encode(t.certifiedRecord,n.uint32(18).fork()).ldelim(),n},r.decode=function(t,n){t instanceof Iu||(t=Iu.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new Ir.Addresses;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.addrs&&i.addrs.length||(i.addrs=[]),i.addrs.push(Ir.Addresses.Address.decode(t,t.uint32()));break;case 2:i.certifiedRecord=Ir.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(o&7);break}}return i},r.fromObject=function(t){if(t instanceof Ir.Addresses)return t;var n=new Ir.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");n.addrs=[];for(var s=0;s<t.addrs.length;++s){if(typeof t.addrs[s]!="object")throw TypeError(".Addresses.addrs: object expected");n.addrs[s]=Ir.Addresses.Address.fromObject(t.addrs[s])}}if(t.certifiedRecord!=null){if(typeof t.certifiedRecord!="object")throw TypeError(".Addresses.certifiedRecord: object expected");n.certifiedRecord=Ir.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return n},r.toObject=function(t,n){n||(n={});var s={};if((n.arrays||n.defaults)&&(s.addrs=[]),n.defaults&&(s.certifiedRecord=null),t.addrs&&t.addrs.length){s.addrs=[];for(var i=0;i<t.addrs.length;++i)s.addrs[i]=Ir.Addresses.Address.toObject(t.addrs[i],n)}return t.certifiedRecord!=null&&t.hasOwnProperty("certifiedRecord")&&(s.certifiedRecord=Ir.Addresses.CertifiedRecord.toObject(t.certifiedRecord,n)),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r.Address=function(){function e(n){if(n)for(var s=Object.keys(n),i=0;i<s.length;++i)n[s[i]]!=null&&(this[s[i]]=n[s[i]])}e.prototype.multiaddr=Ut.newBuffer([]),e.prototype.isCertified=null;let t;return Object.defineProperty(e.prototype,"_isCertified",{get:Ut.oneOfGetter(t=["isCertified"]),set:Ut.oneOfSetter(t)}),e.encode=function(s,i){return i||(i=R6.create()),s.multiaddr!=null&&Object.hasOwnProperty.call(s,"multiaddr")&&i.uint32(10).bytes(s.multiaddr),s.isCertified!=null&&Object.hasOwnProperty.call(s,"isCertified")&&i.uint32(16).bool(s.isCertified),i},e.decode=function(s,i){s instanceof Iu||(s=Iu.create(s));for(var o=i===void 0?s.len:s.pos+i,a=new Ir.Addresses.Address;s.pos<o;){var c=s.uint32();switch(c>>>3){case 1:a.multiaddr=s.bytes();break;case 2:a.isCertified=s.bool();break;default:s.skipType(c&7);break}}return a},e.fromObject=function(s){if(s instanceof Ir.Addresses.Address)return s;var i=new Ir.Addresses.Address;return s.multiaddr!=null&&(typeof s.multiaddr=="string"?Ut.base64.decode(s.multiaddr,i.multiaddr=Ut.newBuffer(Ut.base64.length(s.multiaddr)),0):s.multiaddr.length&&(i.multiaddr=s.multiaddr)),s.isCertified!=null&&(i.isCertified=!!s.isCertified),i},e.toObject=function(s,i){i||(i={});var o={};return i.defaults&&(i.bytes===String?o.multiaddr="":(o.multiaddr=[],i.bytes!==Array&&(o.multiaddr=Ut.newBuffer(o.multiaddr)))),s.multiaddr!=null&&s.hasOwnProperty("multiaddr")&&(o.multiaddr=i.bytes===String?Ut.base64.encode(s.multiaddr,0,s.multiaddr.length):i.bytes===Array?Array.prototype.slice.call(s.multiaddr):s.multiaddr),s.isCertified!=null&&s.hasOwnProperty("isCertified")&&(o.isCertified=s.isCertified,i.oneofs&&(o._isCertified="isCertified")),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},e}(),r.CertifiedRecord=function(){function e(t){if(t)for(var n=Object.keys(t),s=0;s<n.length;++s)t[n[s]]!=null&&(this[n[s]]=t[n[s]])}return e.prototype.seq=Ut.Long?Ut.Long.fromBits(0,0,!0):0,e.prototype.raw=Ut.newBuffer([]),e.encode=function(n,s){return s||(s=R6.create()),n.seq!=null&&Object.hasOwnProperty.call(n,"seq")&&s.uint32(8).uint64(n.seq),n.raw!=null&&Object.hasOwnProperty.call(n,"raw")&&s.uint32(18).bytes(n.raw),s},e.decode=function(n,s){n instanceof Iu||(n=Iu.create(n));for(var i=s===void 0?n.len:n.pos+s,o=new Ir.Addresses.CertifiedRecord;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:o.seq=n.uint64();break;case 2:o.raw=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof Ir.Addresses.CertifiedRecord)return n;var s=new Ir.Addresses.CertifiedRecord;return n.seq!=null&&(Ut.Long?(s.seq=Ut.Long.fromValue(n.seq)).unsigned=!0:typeof n.seq=="string"?s.seq=parseInt(n.seq,10):typeof n.seq=="number"?s.seq=n.seq:typeof n.seq=="object"&&(s.seq=new Ut.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0))),n.raw!=null&&(typeof n.raw=="string"?Ut.base64.decode(n.raw,s.raw=Ut.newBuffer(Ut.base64.length(n.raw)),0):n.raw.length&&(s.raw=n.raw)),s},e.toObject=function(n,s){s||(s={});var i={};if(s.defaults){if(Ut.Long){var o=new Ut.Long(0,0,!0);i.seq=s.longs===String?o.toString():s.longs===Number?o.toNumber():o}else i.seq=s.longs===String?"0":0;s.bytes===String?i.raw="":(i.raw=[],s.bytes!==Array&&(i.raw=Ut.newBuffer(i.raw)))}return n.seq!=null&&n.hasOwnProperty("seq")&&(typeof n.seq=="number"?i.seq=s.longs===String?String(n.seq):n.seq:i.seq=s.longs===String?Ut.Long.prototype.toString.call(n.seq):s.longs===Number?new Ut.LongBits(n.seq.low>>>0,n.seq.high>>>0).toNumber(!0):n.seq),n.raw!=null&&n.hasOwnProperty("raw")&&(i.raw=s.bytes===String?Ut.base64.encode(n.raw,0,n.raw.length):s.bytes===Array?Array.prototype.slice.call(n.raw):n.raw),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},e}(),r})(),kh=le.Reader,n9=le.Writer,ft=le.util,gr=le.roots.default||(le.roots.default={}),FB=gr.Peer=(()=>{function r(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var n=Object.keys(t),s=0;s<n.length;++s)t[n[s]]!=null&&(this[n[s]]=t[n[s]])}r.prototype.addresses=ft.emptyArray,r.prototype.protocols=ft.emptyArray,r.prototype.metadata=ft.emptyArray,r.prototype.pubKey=null,r.prototype.peerRecordEnvelope=null;let e;return Object.defineProperty(r.prototype,"_pubKey",{get:ft.oneOfGetter(e=["pubKey"]),set:ft.oneOfSetter(e)}),Object.defineProperty(r.prototype,"_peerRecordEnvelope",{get:ft.oneOfGetter(e=["peerRecordEnvelope"]),set:ft.oneOfSetter(e)}),r.encode=function(n,s){if(s||(s=n9.create()),n.addresses!=null&&n.addresses.length)for(var i=0;i<n.addresses.length;++i)gr.Address.encode(n.addresses[i],s.uint32(10).fork()).ldelim();if(n.protocols!=null&&n.protocols.length)for(var i=0;i<n.protocols.length;++i)s.uint32(18).string(n.protocols[i]);if(n.metadata!=null&&n.metadata.length)for(var i=0;i<n.metadata.length;++i)gr.Metadata.encode(n.metadata[i],s.uint32(26).fork()).ldelim();return n.pubKey!=null&&Object.hasOwnProperty.call(n,"pubKey")&&s.uint32(34).bytes(n.pubKey),n.peerRecordEnvelope!=null&&Object.hasOwnProperty.call(n,"peerRecordEnvelope")&&s.uint32(42).bytes(n.peerRecordEnvelope),s},r.decode=function(n,s){n instanceof kh||(n=kh.create(n));for(var i=s===void 0?n.len:n.pos+s,o=new gr.Peer;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:o.addresses&&o.addresses.length||(o.addresses=[]),o.addresses.push(gr.Address.decode(n,n.uint32()));break;case 2:o.protocols&&o.protocols.length||(o.protocols=[]),o.protocols.push(n.string());break;case 3:o.metadata&&o.metadata.length||(o.metadata=[]),o.metadata.push(gr.Metadata.decode(n,n.uint32()));break;case 4:o.pubKey=n.bytes();break;case 5:o.peerRecordEnvelope=n.bytes();break;default:n.skipType(a&7);break}}return o},r.fromObject=function(n){if(n instanceof gr.Peer)return n;var s=new gr.Peer;if(n.addresses){if(!Array.isArray(n.addresses))throw TypeError(".Peer.addresses: array expected");s.addresses=[];for(var i=0;i<n.addresses.length;++i){if(typeof n.addresses[i]!="object")throw TypeError(".Peer.addresses: object expected");s.addresses[i]=gr.Address.fromObject(n.addresses[i])}}if(n.protocols){if(!Array.isArray(n.protocols))throw TypeError(".Peer.protocols: array expected");s.protocols=[];for(var i=0;i<n.protocols.length;++i)s.protocols[i]=String(n.protocols[i])}if(n.metadata){if(!Array.isArray(n.metadata))throw TypeError(".Peer.metadata: array expected");s.metadata=[];for(var i=0;i<n.metadata.length;++i){if(typeof n.metadata[i]!="object")throw TypeError(".Peer.metadata: object expected");s.metadata[i]=gr.Metadata.fromObject(n.metadata[i])}}return n.pubKey!=null&&(typeof n.pubKey=="string"?ft.base64.decode(n.pubKey,s.pubKey=ft.newBuffer(ft.base64.length(n.pubKey)),0):n.pubKey.length&&(s.pubKey=n.pubKey)),n.peerRecordEnvelope!=null&&(typeof n.peerRecordEnvelope=="string"?ft.base64.decode(n.peerRecordEnvelope,s.peerRecordEnvelope=ft.newBuffer(ft.base64.length(n.peerRecordEnvelope)),0):n.peerRecordEnvelope.length&&(s.peerRecordEnvelope=n.peerRecordEnvelope)),s},r.toObject=function(n,s){s||(s={});var i={};if((s.arrays||s.defaults)&&(i.addresses=[],i.protocols=[],i.metadata=[]),n.addresses&&n.addresses.length){i.addresses=[];for(var o=0;o<n.addresses.length;++o)i.addresses[o]=gr.Address.toObject(n.addresses[o],s)}if(n.protocols&&n.protocols.length){i.protocols=[];for(var o=0;o<n.protocols.length;++o)i.protocols[o]=n.protocols[o]}if(n.metadata&&n.metadata.length){i.metadata=[];for(var o=0;o<n.metadata.length;++o)i.metadata[o]=gr.Metadata.toObject(n.metadata[o],s)}return n.pubKey!=null&&n.hasOwnProperty("pubKey")&&(i.pubKey=s.bytes===String?ft.base64.encode(n.pubKey,0,n.pubKey.length):s.bytes===Array?Array.prototype.slice.call(n.pubKey):n.pubKey,s.oneofs&&(i._pubKey="pubKey")),n.peerRecordEnvelope!=null&&n.hasOwnProperty("peerRecordEnvelope")&&(i.peerRecordEnvelope=s.bytes===String?ft.base64.encode(n.peerRecordEnvelope,0,n.peerRecordEnvelope.length):s.bytes===Array?Array.prototype.slice.call(n.peerRecordEnvelope):n.peerRecordEnvelope,s.oneofs&&(i._peerRecordEnvelope="peerRecordEnvelope")),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r})();gr.Address=(()=>{function r(t){if(t)for(var n=Object.keys(t),s=0;s<n.length;++s)t[n[s]]!=null&&(this[n[s]]=t[n[s]])}r.prototype.multiaddr=ft.newBuffer([]),r.prototype.isCertified=null;let e;return Object.defineProperty(r.prototype,"_isCertified",{get:ft.oneOfGetter(e=["isCertified"]),set:ft.oneOfSetter(e)}),r.encode=function(n,s){return s||(s=n9.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&s.uint32(10).bytes(n.multiaddr),n.isCertified!=null&&Object.hasOwnProperty.call(n,"isCertified")&&s.uint32(16).bool(n.isCertified),s},r.decode=function(n,s){n instanceof kh||(n=kh.create(n));for(var i=s===void 0?n.len:n.pos+s,o=new gr.Address;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:o.multiaddr=n.bytes();break;case 2:o.isCertified=n.bool();break;default:n.skipType(a&7);break}}return o},r.fromObject=function(n){if(n instanceof gr.Address)return n;var s=new gr.Address;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?ft.base64.decode(n.multiaddr,s.multiaddr=ft.newBuffer(ft.base64.length(n.multiaddr)),0):n.multiaddr.length&&(s.multiaddr=n.multiaddr)),n.isCertified!=null&&(s.isCertified=!!n.isCertified),s},r.toObject=function(n,s){s||(s={});var i={};return s.defaults&&(s.bytes===String?i.multiaddr="":(i.multiaddr=[],s.bytes!==Array&&(i.multiaddr=ft.newBuffer(i.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(i.multiaddr=s.bytes===String?ft.base64.encode(n.multiaddr,0,n.multiaddr.length):s.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),n.isCertified!=null&&n.hasOwnProperty("isCertified")&&(i.isCertified=n.isCertified,s.oneofs&&(i._isCertified="isCertified")),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r})();gr.Metadata=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.key="",r.prototype.value=ft.newBuffer([]),r.encode=function(t,n){return n||(n=n9.create()),t.key!=null&&Object.hasOwnProperty.call(t,"key")&&n.uint32(10).string(t.key),t.value!=null&&Object.hasOwnProperty.call(t,"value")&&n.uint32(18).bytes(t.value),n},r.decode=function(t,n){t instanceof kh||(t=kh.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new gr.Metadata;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.key=t.string();break;case 2:i.value=t.bytes();break;default:t.skipType(o&7);break}}return i},r.fromObject=function(t){if(t instanceof gr.Metadata)return t;var n=new gr.Metadata;return t.key!=null&&(n.key=String(t.key)),t.value!=null&&(typeof t.value=="string"?ft.base64.decode(t.value,n.value=ft.newBuffer(ft.base64.length(t.value)),0):t.value.length&&(n.value=t.value)),n},r.toObject=function(t,n){n||(n={});var s={};return n.defaults&&(s.key="",n.bytes===String?s.value="":(s.value=[],n.bytes!==Array&&(s.value=ft.newBuffer(s.value)))),t.key!=null&&t.hasOwnProperty("key")&&(s.key=t.key),t.value!=null&&t.hasOwnProperty("value")&&(s.value=n.bytes===String?ft.base64.encode(t.value,0,t.value.length):n.bytes===Array?Array.prototype.slice.call(t.value):t.value),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r})();const uR=le.Reader,HEe=le.Writer,Bt=le.util,q0=le.roots.default||(le.roots.default={}),GEe=q0.Envelope=(()=>{function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.publicKey=Bt.newBuffer([]),r.prototype.payloadType=Bt.newBuffer([]),r.prototype.payload=Bt.newBuffer([]),r.prototype.signature=Bt.newBuffer([]),r.encode=function(t,n){return n||(n=HEe.create()),t.publicKey!=null&&Object.hasOwnProperty.call(t,"publicKey")&&n.uint32(10).bytes(t.publicKey),t.payloadType!=null&&Object.hasOwnProperty.call(t,"payloadType")&&n.uint32(18).bytes(t.payloadType),t.payload!=null&&Object.hasOwnProperty.call(t,"payload")&&n.uint32(26).bytes(t.payload),t.signature!=null&&Object.hasOwnProperty.call(t,"signature")&&n.uint32(42).bytes(t.signature),n},r.decode=function(t,n){t instanceof uR||(t=uR.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new q0.Envelope;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=t.bytes();break;case 5:i.signature=t.bytes();break;default:t.skipType(o&7);break}}return i},r.fromObject=function(t){if(t instanceof q0.Envelope)return t;var n=new q0.Envelope;return t.publicKey!=null&&(typeof t.publicKey=="string"?Bt.base64.decode(t.publicKey,n.publicKey=Bt.newBuffer(Bt.base64.length(t.publicKey)),0):t.publicKey.length&&(n.publicKey=t.publicKey)),t.payloadType!=null&&(typeof t.payloadType=="string"?Bt.base64.decode(t.payloadType,n.payloadType=Bt.newBuffer(Bt.base64.length(t.payloadType)),0):t.payloadType.length&&(n.payloadType=t.payloadType)),t.payload!=null&&(typeof t.payload=="string"?Bt.base64.decode(t.payload,n.payload=Bt.newBuffer(Bt.base64.length(t.payload)),0):t.payload.length&&(n.payload=t.payload)),t.signature!=null&&(typeof t.signature=="string"?Bt.base64.decode(t.signature,n.signature=Bt.newBuffer(Bt.base64.length(t.signature)),0):t.signature.length&&(n.signature=t.signature)),n},r.toObject=function(t,n){n||(n={});var s={};return n.defaults&&(n.bytes===String?s.publicKey="":(s.publicKey=[],n.bytes!==Array&&(s.publicKey=Bt.newBuffer(s.publicKey))),n.bytes===String?s.payloadType="":(s.payloadType=[],n.bytes!==Array&&(s.payloadType=Bt.newBuffer(s.payloadType))),n.bytes===String?s.payload="":(s.payload=[],n.bytes!==Array&&(s.payload=Bt.newBuffer(s.payload))),n.bytes===String?s.signature="":(s.signature=[],n.bytes!==Array&&(s.signature=Bt.newBuffer(s.signature)))),t.publicKey!=null&&t.hasOwnProperty("publicKey")&&(s.publicKey=n.bytes===String?Bt.base64.encode(t.publicKey,0,t.publicKey.length):n.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),t.payloadType!=null&&t.hasOwnProperty("payloadType")&&(s.payloadType=n.bytes===String?Bt.base64.encode(t.payloadType,0,t.payloadType.length):n.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),t.payload!=null&&t.hasOwnProperty("payload")&&(s.payload=n.bytes===String?Bt.base64.encode(t.payload,0,t.payload.length):n.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),t.signature!=null&&t.hasOwnProperty("signature")&&(s.signature=n.bytes===String?Bt.base64.encode(t.signature,0,t.signature.length):n.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r})(),H0=le.Reader,hR=le.Writer,tr=le.util,$i=le.roots.default||(le.roots.default={}),WEe=$i.PeerRecord=(()=>{function r(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.peerId=tr.newBuffer([]),r.prototype.seq=tr.Long?tr.Long.fromBits(0,0,!0):0,r.prototype.addresses=tr.emptyArray,r.encode=function(t,n){if(n||(n=hR.create()),t.peerId!=null&&Object.hasOwnProperty.call(t,"peerId")&&n.uint32(10).bytes(t.peerId),t.seq!=null&&Object.hasOwnProperty.call(t,"seq")&&n.uint32(16).uint64(t.seq),t.addresses!=null&&t.addresses.length)for(var s=0;s<t.addresses.length;++s)$i.PeerRecord.AddressInfo.encode(t.addresses[s],n.uint32(26).fork()).ldelim();return n},r.decode=function(t,n){t instanceof H0||(t=H0.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new $i.PeerRecord;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:i.peerId=t.bytes();break;case 2:i.seq=t.uint64();break;case 3:i.addresses&&i.addresses.length||(i.addresses=[]),i.addresses.push($i.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return i},r.fromObject=function(t){if(t instanceof $i.PeerRecord)return t;var n=new $i.PeerRecord;if(t.peerId!=null&&(typeof t.peerId=="string"?tr.base64.decode(t.peerId,n.peerId=tr.newBuffer(tr.base64.length(t.peerId)),0):t.peerId.length&&(n.peerId=t.peerId)),t.seq!=null&&(tr.Long?(n.seq=tr.Long.fromValue(t.seq)).unsigned=!0:typeof t.seq=="string"?n.seq=parseInt(t.seq,10):typeof t.seq=="number"?n.seq=t.seq:typeof t.seq=="object"&&(n.seq=new tr.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");n.addresses=[];for(var s=0;s<t.addresses.length;++s){if(typeof t.addresses[s]!="object")throw TypeError(".PeerRecord.addresses: object expected");n.addresses[s]=$i.PeerRecord.AddressInfo.fromObject(t.addresses[s])}}return n},r.toObject=function(t,n){n||(n={});var s={};if((n.arrays||n.defaults)&&(s.addresses=[]),n.defaults)if(n.bytes===String?s.peerId="":(s.peerId=[],n.bytes!==Array&&(s.peerId=tr.newBuffer(s.peerId))),tr.Long){var i=new tr.Long(0,0,!0);s.seq=n.longs===String?i.toString():n.longs===Number?i.toNumber():i}else s.seq=n.longs===String?"0":0;if(t.peerId!=null&&t.hasOwnProperty("peerId")&&(s.peerId=n.bytes===String?tr.base64.encode(t.peerId,0,t.peerId.length):n.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),t.seq!=null&&t.hasOwnProperty("seq")&&(typeof t.seq=="number"?s.seq=n.longs===String?String(t.seq):t.seq:s.seq=n.longs===String?tr.Long.prototype.toString.call(t.seq):n.longs===Number?new tr.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){s.addresses=[];for(var o=0;o<t.addresses.length;++o)s.addresses[o]=$i.PeerRecord.AddressInfo.toObject(t.addresses[o],n)}return s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r.AddressInfo=function(){function e(t){if(t)for(var n=Object.keys(t),s=0;s<n.length;++s)t[n[s]]!=null&&(this[n[s]]=t[n[s]])}return e.prototype.multiaddr=tr.newBuffer([]),e.encode=function(n,s){return s||(s=hR.create()),n.multiaddr!=null&&Object.hasOwnProperty.call(n,"multiaddr")&&s.uint32(10).bytes(n.multiaddr),s},e.decode=function(n,s){n instanceof H0||(n=H0.create(n));for(var i=s===void 0?n.len:n.pos+s,o=new $i.PeerRecord.AddressInfo;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:o.multiaddr=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof $i.PeerRecord.AddressInfo)return n;var s=new $i.PeerRecord.AddressInfo;return n.multiaddr!=null&&(typeof n.multiaddr=="string"?tr.base64.decode(n.multiaddr,s.multiaddr=tr.newBuffer(tr.base64.length(n.multiaddr)),0):n.multiaddr.length&&(s.multiaddr=n.multiaddr)),s},e.toObject=function(n,s){s||(s={});var i={};return s.defaults&&(s.bytes===String?i.multiaddr="":(i.multiaddr=[],s.bytes!==Array&&(i.multiaddr=tr.newBuffer(i.multiaddr)))),n.multiaddr!=null&&n.hasOwnProperty("multiaddr")&&(i.multiaddr=s.bytes===String?tr.base64.encode(n.multiaddr,0,n.multiaddr.length):s.bytes===Array?Array.prototype.slice.call(n.multiaddr):n.multiaddr),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},e}(),r})(),dR=mi,QEe=Ei,VB=function(r){let e=0;if(r=r.toString().trim(),dR(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(QEe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=dR(t[n]);let o;i&&(o=VB(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},YEe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Ks=-1,pg={},O5={},XEe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Ks,"ip6zone"],[43,8,"ipcidr"],[53,Ks,"dns",!0],[54,Ks,"dns4",!0],[55,Ks,"dns6",!0],[56,Ks,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Ks,"unix",!1,!0],[421,Ks,"ipfs"],[421,Ks,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Ks,"garlic64"],[448,0,"tls"],[449,Ks,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Ks,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Ks,"memory"]];XEe.forEach(r=>{const e=JEe(...r);O5[e.code]=e,pg[e.name]=e});function JEe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function br(r){if(typeof r=="number"){if(O5[r]!=null)return O5[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(pg[r]!=null)return pg[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const ZEe=Pb({prefix:"\0",name:"identity",encode:r=>j7e(r),decode:r=>V7e(r)}),eve=Object.freeze(Object.defineProperty({__proto__:null,identity:ZEe},Symbol.toStringTag,{value:"Module"})),tve=Xr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),rve=Object.freeze(Object.defineProperty({__proto__:null,base2:tve},Symbol.toStringTag,{value:"Module"})),nve=Xr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),sve=Object.freeze(Object.defineProperty({__proto__:null,base8:nve},Symbol.toStringTag,{value:"Module"})),ive=Qp({prefix:"9",name:"base10",alphabet:"0123456789"}),ove=Object.freeze(Object.defineProperty({__proto__:null,base10:ive},Symbol.toStringTag,{value:"Module"})),ave=Xr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),cve=Xr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),lve=Object.freeze(Object.defineProperty({__proto__:null,base16:ave,base16upper:cve},Symbol.toStringTag,{value:"Module"})),uve=Qp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hve=Qp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),dve=Object.freeze(Object.defineProperty({__proto__:null,base36:uve,base36upper:hve},Symbol.toStringTag,{value:"Module"})),fve=Xr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),pve=Xr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),yve=Xr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gve=Xr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),wve=Object.freeze(Object.defineProperty({__proto__:null,base64:fve,base64pad:pve,base64url:yve,base64urlpad:gve},Symbol.toStringTag,{value:"Module"})),jB=Array.from(""),bve=jB.reduce((r,e,t)=>(r[t]=e,r),[]),mve=jB.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Eve(r){return r.reduce((e,t)=>(e+=bve[t],e),"")}function vve(r){const e=[];for(const t of r){const n=mve[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const _ve=Pb({prefix:"",name:"base256emoji",encode:Eve,decode:vve}),Sve=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:_ve},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Ave={...eve,...rve,...sve,...ove,...lve,...uEe,...dve,...tEe,...wve,...Sve};function $ve(r,e){switch(br(r).code){case 4:case 41:return Rve(e);case 42:return yR(e);case 6:case 273:case 33:case 132:return KB(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return yR(e);case 421:return Pve(e);case 444:return gR(e);case 445:return gR(e);case 466:return Dve(e);default:return R(e,"base16")}}function Tve(r,e){switch(br(r).code){case 4:return fR(e);case 41:return fR(e);case 42:return pR(e);case 6:case 273:case 33:case 132:return s9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return pR(e);case 421:return Cve(e);case 444:return Ove(e);case 445:return kve(e);case 466:return xve(e);default:return M(e,"base16")}}const C6=Object.values(Ave).map(r=>r.decoder),Ive=function(){let r=C6[0].or(C6[1]);return C6.slice(2).forEach(e=>r=r.or(e)),r}();function fR(r){if(!Nt(r))throw new Error("invalid ip address");return VB(r)}function Rve(r){const e=YEe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function s9(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function KB(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function pR(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function yR(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function Cve(r){let e;r[0]==="Q"||r[0]==="1"?e=Db(Fi.decode(`z${r}`)).bytes:e=Do.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function xve(r){const e=Ive.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function Dve(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function Pve(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function Ove(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=xs.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=s9(n);return z([t,s],t.length+s.length)}function kve(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=xs.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=s9(n);return z([t,s],t.length+s.length)}function gR(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=KB(t);return`${n}:${s}`}function Nve(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=br(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw WB("invalid address: "+r);if(i.path===!0){e.push([s,o9(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function Lve(r){const e=[];return r.map(t=>{const n=kb(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),o9(e.join("/"))}function Mve(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=kb(e);return e.length>1?[t.code,Tve(t.code,e[1])]:[t.code]})}function qB(r){return r.map(e=>{const t=kb(e);return e[1]!=null?[t.code,$ve(t.code,e[1])]:[t.code]})}function HB(r){return k5(z(r.map(e=>{const t=kb(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function GB(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function i9(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=br(n),o=GB(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw WB("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function wR(r){const e=i9(r),t=qB(e);return Lve(t)}function Uve(r){r=o9(r);const e=Nve(r),t=Mve(e);return HB(t)}function Bve(r){return Uve(r)}function k5(r){const e=zve(r);if(e!=null)throw e;return Uint8Array.from(r)}function zve(r){try{i9(r)}catch(e){return e}}function o9(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function WB(r){return new Error("Error parsing address: "+r)}function kb(r){return br(r[0])}var Ru=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},x6=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Yd,Xd,Jd,bR;const Fve=Symbol.for("nodejs.util.inspect.custom"),Vve=[br("dns").code,br("dns4").code,br("dns6").code,br("dnsaddr").code],jve=new Map,QB=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Kve(r){return!!r?.[QB]}let qve=class ju{constructor(e){if(Yd.set(this,void 0),Xd.set(this,void 0),Jd.set(this,void 0),this[bR]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=k5(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Bve(e)}else if(Kve(e))this.bytes=k5(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Ru(this,Yd,"f")==null&&x6(this,Yd,wR(this.bytes),"f"),Ru(this,Yd,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=br("tcp"),a=br("udp"),c=br("ip4"),u=br("ip6"),l=br("dns6"),h=br("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),Vve.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=br(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=br(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},br(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=br(s),a=GB(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Ru(this,Xd,"f")==null&&x6(this,Xd,i9(this.bytes),"f"),Ru(this,Xd,"f")}stringTuples(){return Ru(this,Jd,"f")==null&&x6(this,Jd,qB(this.tuples()),"f"),Ru(this,Jd,"f")}encapsulate(e){return e=new ju(e),new ju(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ju(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new ju(HB(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===pg.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Fi.decode(`z${n}`),"base58btc"):R(Do.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>br(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=jve.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new ju(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Yd=new WeakMap,Xd=new WeakMap,Jd=new WeakMap,bR=QB,Fve)](){return`Multiaddr(${wR(this.bytes)})`}};function mR(r){return new qve(r)}le.util.Long=void 0;le.configure();async function Hve(r,e=()=>{}){e(0,"Storing each peerstore key under a single datastore key"),await r.datastore.open();const t={},n=[];for await(const{key:s,value:i}of r.datastore.query({prefix:"/peers"})){n.push(s);const o=s.toString(),[,a,c,u,l]=o.split("/");if(a==="peers"&&["protos","addrs","metadata","keys"].includes(c)&&u)if(t[u]=t[u]||{addresses:[],protocols:[],metadata:[]},c==="protos"){const h=BB.decode(i);t[u].protocols=h.protocols.sort()}else if(c==="addrs"){const h=zB.decode(i);t[u].addresses=h.addrs.sort((f,y)=>mR(f.multiaddr).toString().localeCompare(mR(y.multiaddr).toString())),h.certifiedRecord&&h.certifiedRecord.raw&&(t[u].peerRecordEnvelope=h.certifiedRecord.raw)}else c==="metadata"?t[u].metadata.push({key:l,value:i}):c==="keys"&&(t[u].pubKey=i)}e(33,"Read peer data from store");for(const s of n)await r.datastore.delete(s);e(66,"Removed existing peer data from store");for(const s of Object.keys(t)){const i=t[s];i.metadata=i.metadata.sort((a,c)=>a.key.localeCompare(c.key));const o=FB.encode(i).finish();await r.datastore.put(new be(`/peers/${s}`),o)}await r.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function Gve(r,e=()=>{}){e(0,"Storing each peerstore key under a multiple datastore keys"),await r.datastore.open();const t={},n=[];for await(const{key:s,value:i}of r.datastore.query({prefix:"/peers"})){n.push(s);const o=s.toString(),[,,a]=o.split("/");t[a]=FB.decode(i)}e(33,"Read peer data from store");for(const s of n)await r.datastore.delete(s);e(66,"Removed existing peer data from store");for(const[s,i]of Object.entries(t)){if(i.protocols&&i.protocols.length>0&&await r.datastore.put(new be(`/peers/protos/${s}`),BB.encode({protocols:i.protocols}).finish()),i.addresses&&i.addresses.length>0){const o=i.peerRecordEnvelope;let a;if(o){const c=GEe.decode(o),u=WEe.decode(c.payload);a={raw:o,seq:u.seq}}await r.datastore.put(new be(`/peers/addrs/${s}`),zB.encode({addrs:i.addresses,certifiedRecord:a}).finish())}if(i.metadata&&i.metadata.length>0)for(const{key:o,value:a}of i.metadata)await r.datastore.put(new be(`/peers/metadata/${s}/${o}`),a);i.pubKey&&await r.datastore.put(new be(`/peers/keys/${s}`),i.pubKey)}await r.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}const Wve={version:12,description:"Store each peerstore peer under a single datastore key",migrate:Hve,revert:Gve},tl={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0},a9=[Object.assign({version:1},tl),Object.assign({version:2},tl),Object.assign({version:3},tl),Object.assign({version:4},tl),Object.assign({version:5},tl),Object.assign({version:6},tl),Object.assign({version:7},tl),EEe,kEe,zEe,jEe,Wve];class Nb extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=Nb.code,this.message=e}}Nb.code="ERR_NON_REVERSIBLE_MIGRATION";class Yp extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=Yp.code,this.message=e}}Yp.code="ERR_NOT_INITIALIZED_REPO";class Lb extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=Lb.code,this.message=e}}Lb.code="ERR_REQUIRED_PARAMETER";class Mb extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=Mb.code,this.message=e}}Mb.code="ERR_INVALID_VALUE";class pd extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=pd.code,this.message=e}}pd.code="ERR_MISSING_REPO_OPTIONS";const Qve=Object.freeze(Object.defineProperty({__proto__:null,InvalidValueError:Mb,MissingRepoOptionsError:pd,NonReversibleMigrationError:Nb,NotInitializedRepoError:Yp,RequiredParameterError:Lb},Symbol.toStringTag,{value:"Module"})),D6=_e("ipfs:repo:migrator:repo:init");async function Yve(r){if(!r)throw new pd("Please pass repo options when trying to open a repo");const e=r.root;try{await e.open();const t=await e.has(r9),n=await e.has(NEe);return!t||!n?(D6(`Version entry present: ${t}`),D6(`Config entry present: ${n}`),!1):!0}catch(t){return D6("While checking if repo is initialized error was thrown: "+t.message),!1}finally{if(e!==void 0)try{await e.close()}catch{}}}async function YB(r){if(!await Yve(r))throw new Yp("Repo is not initialized!");const e=r.root;await e.open();try{return parseInt(R(await e.get(r9)))}finally{await e.close()}}async function yg(r,e){if(!e)throw new pd("Please pass repo options when trying to open a repo");const t=e.root;await t.open(),await t.put(r9,M(String(r))),await t.close()}const Vi=_e("ipfs:repo:migrator");function Xve(r){return r=r||a9,!Array.isArray(r)||r.length===0?0:r[r.length-1].version}async function Jve(r,e,t,n,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??a9;if(!r)throw new li.RequiredParameterError("Path argument is required!");if(!t)throw new li.RequiredParameterError("repoOptions argument is required!");if(!n)throw new li.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(n)||n<=0)throw new li.InvalidValueError("Version has to be positive integer!");e=LB(e);const u=await YB(e);if(u===n){Vi("Nothing to migrate.");return}if(u>n)throw new li.InvalidValueError(`Current repo's version (${u}) is higher then toVersion (${n}), you probably wanted to revert it?`);XB(c,u,n);let l;!a&&!i&&(l=await t.repoLock.lock(r));try{for(const h of c){if(n!==void 0&&h.version>n)break;if(!(h.version<=u)){Vi(`Migrating version ${h.version}`);try{if(!a){let f=()=>{};o&&(f=(y,d)=>o(h.version,y.toFixed(2),d)),await h.migrate(e,f)}}catch(f){const y=h.version-1;throw Vi(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${y}`),await yg(y,e),new Error(`During migration to version ${h.version} exception was raised: ${f.stack||f.message||f}`)}Vi(`Migrating to version ${h.version} finished`)}}a||await yg(n||Xve(c),e),Vi("Repo successfully migrated",n!==void 0?`to version ${n}!`:"to latest version!")}finally{!a&&!i&&l&&await l.close()}}async function Zve(r,e,t,n,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??a9;if(!r)throw new li.RequiredParameterError("Path argument is required!");if(!t)throw new li.RequiredParameterError("repoOptions argument is required!");if(!n)throw new li.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(n)||n<=0)throw new li.InvalidValueError("Version has to be positive integer!");e=LB(e);const u=await YB(e);if(u===n){Vi("Nothing to revert.");return}if(u<n)throw new li.InvalidValueError(`Current repo's version (${u}) is lower then toVersion (${n}), you probably wanted to migrate it?`);XB(c,n,u,!0);let l;!a&&!i&&(l=await t.repoLock.lock(r)),Vi(`Reverting from version ${u} to ${n}`);try{const h=c.slice().reverse();for(const f of h){if(f.version<=n)break;if(!(f.version>u)){Vi(`Reverting migration version ${f.version}`);try{if(!a){let y=()=>{};o&&(y=(d,p)=>o(f.version,d.toFixed(2),p)),await f.revert(e,y)}}catch(y){const d=f.version;throw Vi(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${d}`),await yg(d,e),y.message=`During reversion to version ${f.version} exception was raised: ${y.message}`,y}Vi(`Reverting to version ${f.version} finished`)}}a||await yg(n,e),Vi(`All migrations successfully reverted to version ${n}!`)}finally{!a&&!i&&l&&await l.close()}}function XB(r,e,t,n=!1){let s=0;for(const i of r){if(i.version>t)break;if(i.version>e){if(n&&!i.revert)throw new li.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${i.version} is not reversible. Cancelling reversion.`);s++}}if(s!==t-e)throw new li.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${t}`)}const li=Qve;var Ub={exports:{}};/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */Ub.exports=n9e;Ub.exports.format=JB;Ub.exports.parse=ZB;var e9e=/\B(?=(\d{3})+(?!\d))/g,t9e=/(?:\.0*|(\.[^0]+)0+)$/,Va={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},r9e=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function n9e(r,e){return typeof r=="string"?ZB(r):typeof r=="number"?JB(r,e):null}function JB(r,e){if(!Number.isFinite(r))return null;var t=Math.abs(r),n=e&&e.thousandsSeparator||"",s=e&&e.unitSeparator||"",i=e&&e.decimalPlaces!==void 0?e.decimalPlaces:2,o=!!(e&&e.fixedDecimals),a=e&&e.unit||"";(!a||!Va[a.toLowerCase()])&&(t>=Va.pb?a="PB":t>=Va.tb?a="TB":t>=Va.gb?a="GB":t>=Va.mb?a="MB":t>=Va.kb?a="KB":a="B");var c=r/Va[a.toLowerCase()],u=c.toFixed(i);return o||(u=u.replace(t9e,"$1")),n&&(u=u.split(".").map(function(l,h){return h===0?l.replace(e9e,n):l}).join(".")),u+s+a}function ZB(r){if(typeof r=="number"&&!isNaN(r))return r;if(typeof r!="string")return null;var e=r9e.exec(r),t,n="b";return e?(t=parseFloat(e[1]),n=e[4].toLowerCase()):(t=parseInt(r,10),n="b"),isNaN(t)?null:Math.floor(Va[n]*t)}var s9e=Ub.exports;const i9e=Et(s9e);class Bb extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=Bb.code}}Bb.code="ERR_LOCK_EXISTS";class zc extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=zc.code}}zc.code="ERR_NOT_FOUND";class zb extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=zb.code}}zb.code="ERR_INVALID_REPO_VERSION";const Gf="ERR_REPO_NOT_INITIALIZED",o9e="ERR_REPO_ALREADY_OPEN",a9e="ERR_REPO_ALREADY_CLOSED";async function ez(r,e,t){const n=await e(r);if(n)return n;const s=rz(t);return s?new Promise((i,o)=>{const a=s.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{i(!!a.result)}}):!1}async function tz(r,e,t,n){if(await t(r))return e(r);const s=rz(n);if(!s)throw new zc;return new Promise((i,o)=>{const a=s.store("readonly").get(r.toString());a.transaction.onabort=()=>{o(a.transaction.error)},a.transaction.oncomplete=()=>{if(a.result)return i(a.result);o(new zc)}})}function rz(r){let e=r;for(;e.db||e.child;)if(e=e.db||e.child,e.type==="level-js"||e.constructor.name==="Level")return e}const c9e=_e("ipfs:repo:version"),P6=new be("version");function l9e(r){return{async exists(){return ez(P6,r.has.bind(r),r)},async get(){const e=await tz(P6,r.get.bind(r),r.has.bind(r),r);return parseInt(R(e),10)},set(e){return r.put(P6,M(String(e)))},async check(e){const t=await this.get();return c9e("comparing version: %s and %s",t,e),t===e||(t===6&&e===7||e===6&&t===7)}}}const u9e=Cr.default?Cr.default:Cr,O6=new be("config");function h9e(r){const e=new u9e({concurrency:1}),t={async getAll(i={}){const o=await tz(O6,r.get.bind(r),r.has.bind(r),r);return JSON.parse(R(o))},async get(i,o={}){if(i==null)throw new zc(`Key ${i} does not exist in config`);const a=await this.getAll(o),c=Jv(a,i);if(c===void 0)throw new zc(`Key ${i} does not exist in config`);return c},set(i,o,a={}){if(typeof i!="string"&&!(i instanceof String))throw T(new Error("Invalid key type: "+typeof i),"ERR_INVALID_KEY");if(o===void 0||o instanceof Uint8Array)throw T(new Error("Invalid value type: "+typeof o),"ERR_INVALID_VALUE");return e.add(()=>n({key:i,value:o},a.signal))},replace(i,o={}){if(!i||i instanceof Uint8Array)throw T(new Error("Invalid value type: "+typeof i),"ERR_INVALID_VALUE");return e.add(()=>n({key:void 0,value:i},o.signal))},async exists(){return ez(O6,r.has.bind(r),r)}};return t;async function n(i,o){if(o&&o.aborted)return;const a=i.key,c=i.value;if(a){const u=await t.getAll();return typeof u=="object"&&u!==null&&rr(u,a,c),s(u)}return s(c)}function s(i){const o=M(JSON.stringify(i,null,2));return r.put(O6,o)}}function k6(r){if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}function d9e(r,e={}){if(!k6(r)&&!Array.isArray(r))throw new TypeError("Expected a plain object or array");const{deep:t,compare:n}=e,s=[],i=[],o=c=>{const u=s.indexOf(c);if(u!==-1)return i[u];const l=[];return s.push(c),i.push(l),l.push(...c.map(h=>Array.isArray(h)?o(h):k6(h)?a(h):h)),l},a=c=>{const u=s.indexOf(c);if(u!==-1)return i[u];const l={},h=Object.keys(c).sort(n);s.push(c),i.push(l);for(const f of h){const y=c[f];let d;t&&Array.isArray(y)?d=o(y):d=t&&k6(y)?a(y):y,Object.defineProperty(l,f,{...Object.getOwnPropertyDescriptor(c,f),value:d})}return l};return Array.isArray(r)?t?o(r):r.slice():a(r)}const N6=new be("datastore_spec");function f9e(r){return{exists(){return r.has(N6)},async get(){const e=await r.get(N6);return JSON.parse(R(e))},async set(e){return r.put(N6,M(JSON.stringify(d9e(e,{deep:!0}))))}}}const L6=new be("api");function p9e(r){return{async get(){const e=await r.get(L6);return e&&e.toString()},set(e){return r.put(L6,M(e.toString()))},delete(){return r.delete(L6)}}}var y9e=nz,ER=128,g9e=127,w9e=~g9e,b9e=Math.pow(2,31);function nz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=b9e;)e[t++]=r&255|ER,r/=128;for(;r&w9e;)e[t++]=r&255|ER,r>>>=7;return e[t]=r|0,nz.bytes=t-n+1,e}var m9e=N5,E9e=128,vR=127;function N5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw N5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&vR)<<s:(o&vR)*Math.pow(2,s),s+=7}while(o>=E9e);return N5.bytes=i-n,t}var v9e=Math.pow(2,7),_9e=Math.pow(2,14),S9e=Math.pow(2,21),A9e=Math.pow(2,28),$9e=Math.pow(2,35),T9e=Math.pow(2,42),I9e=Math.pow(2,49),R9e=Math.pow(2,56),C9e=Math.pow(2,63),x9e=function(r){return r<v9e?1:r<_9e?2:r<S9e?3:r<A9e?4:r<$9e?5:r<T9e?6:r<I9e?7:r<R9e?8:r<C9e?9:10},D9e={encode:y9e,decode:m9e,encodingLength:x9e},gg=D9e;const L5=(r,e=0)=>[gg.decode(r,e),gg.decode.bytes],wg=(r,e,t=0)=>(gg.encode(r,e,t),e),bg=r=>gg.encodingLength(r),P9e=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Fb=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},sz=(r,e)=>{const t=e.byteLength,n=bg(r),s=n+bg(t),i=new Uint8Array(s+t);return wg(r,i,0),wg(t,i,n),i.set(e,s),new c9(r,t,e,i)},iz=r=>{const e=Fb(r),[t,n]=L5(e),[s,i]=L5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new c9(t,s,o,e)},O9e=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&P9e(r.bytes,t.bytes)}};let c9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function k9e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var N9e=k9e,L9e=N9e;let M9e=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},U9e=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oz(this,e)}},B9e=class{constructor(e){this.decoders=e}or(e){return oz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const oz=(r,e)=>new B9e({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let z9e=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new M9e(e,t,n),this.decoder=new U9e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const az=({name:r,prefix:e,encode:t,decode:n})=>new z9e(r,e,t,n),cz=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=L9e(t,e);return az({prefix:r,name:e,encode:n,decode:i=>Fb(s(i))})},F9e=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},V9e=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},$a=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>az({prefix:e,name:r,encode(s){return V9e(s,n,t)},decode(s){return F9e(s,n,t,r)}}),Za=cz({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});cz({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Cc=$a({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});$a({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});$a({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});$a({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});$a({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});$a({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});$a({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});$a({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});$a({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const _R=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return K9e(t,M5(r),e||Za.encoder);default:return q9e(t,M5(r),e||Cc.encoder)}},SR=new WeakMap,M5=r=>{const e=SR.get(r);if(e==null){const t=new Map;return SR.set(r,t),t}return e};let ro=class Un{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Zd)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==H9e)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Un.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=sz(e,t);return Un.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Un.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&O9e(e.multihash,n.multihash)}toString(e){return _R(this,e)}toJSON(){return{"/":_R(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Un)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Un(n,s,i,o||AR(n,s,i.bytes))}else if(t[G9e]===!0){const{version:n,multihash:s,code:i}=t,o=iz(s);return Un.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Zd)throw new Error(`Version 0 CID must use dag-pb (code: ${Zd}) block encoding`);return new Un(e,t,n,n.bytes)}case 1:{const s=AR(e,t,n.bytes);return new Un(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Un.create(0,Zd,e)}static createV1(e,t){return Un.create(1,e,t)}static decode(e){const[t,n]=Un.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Un.inspectBytes(e),n=t.size-t.multihashSize,s=Fb(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new c9(t.multihashCode,t.digestSize,i,s);return[t.version===0?Un.createV0(o):Un.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=L5(e.subarray(t));return t+=f,h};let s=n(),i=Zd;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=j9e(e,t),i=Un.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return M5(i).set(n,e),i}};const j9e=(r,e)=>{switch(r[0]){case"Q":{const t=e||Za;return[Za.prefix,t.decode(`${Za.prefix}${r}`)]}case Za.prefix:{const t=e||Za;return[Za.prefix,t.decode(r)]}case Cc.prefix:{const t=e||Cc;return[Cc.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},K9e=(r,e,t)=>{const{prefix:n}=t;if(n!==Za.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},q9e=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Zd=112,H9e=18,AR=(r,e,t)=>{const n=bg(r),s=n+bg(e),i=new Uint8Array(s+t.byteLength);return wg(r,i,0),wg(e,i,n),i.set(t,s),i},G9e=Symbol.for("@ipld/js-cid/CID"),lz=0,W9e="identity",uz=Fb,Q9e=r=>sz(lz,uz(r)),Y9e={code:lz,name:W9e,encode:uz,digest:Q9e};function X9e(r){return{open(){return r.open()},close(){return r.close()},query(e,t){return r.query(e,t)},queryKeys(e,t){return r.queryKeys(e,t)},async get(e,t){const n=La(e);return n.isIdentity?Promise.resolve(n.digest):r.get(e,t)},async*getMany(e,t){for await(const n of e)yield this.get(n,t)},async put(e,t,n){const{isIdentity:s}=La(e);s||await r.put(e,t,n)},async*putMany(e,t){const n=$r({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{await jr(r.putMany(async function*(){for await(const{key:i,value:o}of e)La(i).isIdentity||(yield{key:i,value:o}),n.push({key:i,value:o})}())),n.end()}catch(i){n.end(i)}}),yield*n},has(e,t){const{isIdentity:n}=La(e);return n?Promise.resolve(!0):r.has(e,t)},delete(e,t){const{isIdentity:n}=La(e);return n?Promise.resolve():r.delete(e,t)},deleteMany(e,t){return r.deleteMany(Yt(e,n=>!La(n).isIdentity),t)},batch(){const e=r.batch();return{put(t,n){const{isIdentity:s}=La(t);s||e.put(t,n)},delete(t){const{isIdentity:n}=La(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function La(r){const e=ro.asCID(r);if(e==null)throw T(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==Y9e.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}const hz=_e("ipfs:repo:lock:memory"),dz="repo.lock",Wf={};async function J9e(r){const e=r+"/"+dz;if(hz("locking %s",e),Wf[e]===!0)throw new Bb(`Lock already being held for file: ${e}`);return Wf[e]=!0,{async close(){Wf[e]&&delete Wf[e]}}}async function Z9e(r){const e=r+"/"+dz;return hz(`checking lock: ${e}`),!!Wf[e]}const fz={lock:J9e,locked:Z9e},e_e={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:fz},pz={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};function G0({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*t_e(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t],i=ro.asCID(n);i?yield[s.join("/"),i]:typeof n=="object"&&(yield*U5(n,s))}else{const t=ro.asCID(e);t?yield[r.join("/"),t]:yield*U5(e,r)}}function*U5(r,e){if(r==null||r instanceof Uint8Array)return;const t=ro.asCID(r);t&&(yield[e.join("/"),t]);for(const[n,s]of Object.entries(r)){const i=[...e,n];yield*t_e(i,s)}}function*r_e(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t];yield s.join("/"),typeof n=="object"&&!ro.asCID(n)&&(yield*B5(n,s))}else yield*B5(e,r)}function*B5(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const s=[...e,t];yield s.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ro.asCID(n)&&(yield*r_e(s,n))}}function n_e(r,e){let t=r;for(const[n,s]of e.entries()){if(t=t[s],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const i=ro.asCID(t);if(i)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}class s_e{constructor({cid:e,bytes:t,value:n}){if(!e||!t||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:G0(),bytes:G0(),value:G0(),asBlock:G0()})}links(){return U5(this.value,[])}tree(){return B5(this.value,[])}get(e="/"){return n_e(this.value,e.split("/").filter(Boolean))}}function yz({bytes:r,cid:e,value:t,codec:n}){const s=t!==void 0?t:n&&n.decode(r);if(s===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new s_e({cid:e,bytes:r,value:s})}function W0(r){const e=ro.asCID(r);if(e==null)throw T(new Error("Not a valid cid"),"ERR_INVALID_CID");const t=Cc.encode(e.multihash.bytes);return new be("/"+t.slice(1).toUpperCase(),!1)}function $R(r){return iz(Cc.decode(`b${r.toString().toLowerCase().substring(1)}`))}const i_e=_e("ipfs:repo:utils:walk-dag");async function*mg(r,e,t,n){try{const s=await e.get(r,n),i=await t(r.code),o=yz({bytes:s,cid:r,codec:i});for(const[,a]of o.links())yield a,yield*mg(a,e,t,n)}catch(s){throw i_e("Could not walk DAG for CID",r.toString(),s),s}}class o_e extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const s=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:s}):this._set(e,{value:t,expiry:s})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[s,i]=n;this._deleteIfExpired(s,i)===!1&&(yield[s,i.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[s,i]=n;this.cache.has(s)||this._deleteIfExpired(s,i)===!1&&(yield[s,i.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,s]of this.entriesAscending())e.call(t,s,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const a_e=2048;function c_e(r){const e=`Invalid type '${r}', must be one of {direct, indirect, recursive, all}`;return T(new Error(e),"ERR_INVALID_PIN_TYPE")}class l_e{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=_e("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);const n={depth:0};return e.version!==0&&(n.version=e.version),e.code!==jt&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(W0(e),P1(n))}unpin(e,t){return this.pinstore.delete(W0(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);const n={depth:1/0};e.version!==0&&(n.version=e.version),e.code!==jt&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(W0(e),P1(n))}async*directKeys(e){for await(const t of this.pinstore.query({filters:[n=>Qa(n.value).depth===0]})){const n=Qa(t.value),s=n.version||0,i=n.codec!=null?n.codec:jt,o=$R(t.key);yield{cid:ro.create(s,i,o),metadata:n.metadata}}}async*recursiveKeys(e){for await(const t of this.pinstore.query({filters:[n=>Qa(n.value).depth===1/0]})){const n=Qa(t.value),s=n.version||0,i=n.codec!=null?n.codec:jt,o=$R(t.key);yield{cid:ro.create(s,i,o),metadata:n.metadata}}}async*indirectKeys(e){for await(const{cid:t}of this.recursiveKeys())for await(const n of mg(t,this.blockstore,this.loadCodec,e)){const s=[nt.recursive];(await this.isPinnedWithType(n,s)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);const s=t.includes(nt.all),i=t.includes(nt.direct),o=t.includes(nt.recursive),a=t.includes(nt.indirect);if(o||i||s){const l=await to(this.pinstore.query({prefix:W0(e).toString(),filters:[h=>{if(s)return!0;const f=Qa(h.value);return t.includes(f.depth===0?nt.direct:nt.recursive)}],limit:1}));if(l){const h=Qa(l.value);return{cid:e,pinned:!0,reason:h.depth===0?nt.direct:nt.recursive,metadata:h.metadata}}}const c=this;async function*u(l,h){for await(const{cid:f}of h)for await(const y of mg(f,c.blockstore,c.loadCodec))if(y.equals(l)){yield f;return}}if(s||a){const l=await to(u(e,this.recursiveKeys()));if(l)return{cid:e,pinned:!0,reason:nt.indirect,parent:l}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){const n=new o_e({maxSize:t.cidCacheMaxSize??a_e}),s=async(i,o)=>{if(n.has(i.toString()))return;n.set(i.toString(),!0);const a=await this.blockstore.get(i,o),c=await this.loadCodec(i.code),u=yz({bytes:a,cid:i,codec:c});await Promise.all([...u.links()].map(([,l])=>s(l,o)))};await s(e,t)}static checkPinType(e){if(typeof e!="string"||!Object.keys(nt).includes(e))throw c_e(e);return!0}}function u_e(r,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,s){await e.put(t,n,s)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(t,n){return await TR(t,r),e.delete(t,n)},deleteMany(t,n){return e.deleteMany(ls(t,async s=>(await TR(s,r),s)),n)},batch(){return e.batch()}}}async function TR(r,e){const{pinned:t,reason:n}=await e.isPinnedWithType(r,nt.all);if(t)throw T(new Error(`pinned: ${n}`),"ERR_BLOCK_PINNED")}const Q1=_e("ipfs:repo:gc"),h_e=Ro().code,d_e=256,f_e=new be("/local/filesroot");function p_e({gcLock:r,pins:e,blockstore:t,root:n,loadCodec:s}){async function*i(){const o=Date.now();Q1("Creating set of marked blocks");const a=await r.writeLock();try{const c=await y_e({pins:e,blockstore:t,root:n,loadCodec:s}),u=t.queryKeys({});yield*g_e({blockstore:t},c,u),Q1(`Complete (${Date.now()-o}ms)`)}finally{a()}}return i}async function y_e({pins:r,blockstore:e,loadCodec:t,root:n}){const s=async function*(){let a;try{a=await n.get(f_e)}catch(u){if(u.code===h_e){Q1("No blocks in MFS");return}throw u}const c=ro.decode(a);yield c,yield*mg(c,e,t)}(),i=ys(ls(r.recursiveKeys(),({cid:a})=>a),r.indirectKeys(),ls(r.directKeys(),({cid:a})=>a),s),o=new Set;for await(const a of ys(i,s))o.add(Cc.encode(a.multihash.bytes));return o}async function*g_e({blockstore:r},e,t){let n=0,s=0;yield*Ve(bv(ls(t,async o=>async function(){n++;try{const c=Cc.encode(o.multihash.bytes);if(e.has(c))return null;try{await r.delete(o),s++}catch(u){return{err:new Error(`Could not delete block with CID ${o}: ${u.message}`)}}return{cid:o}}catch(c){const u=`Could delete block with CID ${o}`;return Q1(u,c),{err:new Error(u+`: ${c.message}`)}}}),d_e),o=>Yt(o,Boolean)),Q1(`Marked set has ${e.size} unique blocks. Blockstore has ${n} blocks. Deleted ${s} blocks.`)}const hs=_e("ipfs:repo"),w_e=Number.MAX_SAFE_INTEGER,b_e="repoAutoMigrate";class m_e{constructor(e,t,n,s){if(typeof e!="string")throw new Error("missing repo path");if(typeof t!="function")throw new Error("missing codec loader");this.options=kt(e_e,s),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;const i=n.blocks,o=n.pins;this.pins=new l_e({pinstore:o,blockstore:i,loadCodec:t});const a=u_e(this.pins,i);this.blocks=X9e(a),this.version=l9e(this.root),this.config=h9e(this.root),this.spec=f9e(this.root),this.apiAddr=p9e(this.root),this.gcLock=Hv({name:e,singleProcess:this.options.repoOwner!==!1}),this.gc=p_e({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){hs("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(v_e(e)),await this.spec.set(__e(e)),await this.version.set(k2)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch{return!1}}async open(){if(!this.closed)throw T(new Error("repo is already open"),o9e);hs("opening at: %s",this.path);try{if(await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),hs("acquired repo.lock"),!await this.version.check(k2))if(await this._isAutoMigrationEnabled())await this._migrate(k2,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys});else throw new zb("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");hs("creating datastore"),await this.datastore.open(),hs("creating blocks"),await this.blocks.open(),hs("creating keystore"),await this.keys.open(),hs("creating pins"),await this.pins.pinstore.open(),this.closed=!1,hs("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){hs("error removing lock",t)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if(e.message!=="Already open")throw e}}async _openLock(){const e=await this.options.repoLock.lock(this.path);if(typeof e.close!="function")throw T(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){hs("init check");let e;try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(t){throw t.code==="ERR_NOT_FOUND"?T(new Error("repo is not initialized yet"),Gf,{path:this.path}):t}if(!e)throw T(new Error("repo is not initialized yet"),Gf,{path:this.path})}async close(){if(this.closed)throw T(new Error("repo is already closed"),a9e);hs("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==Gf&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map(e=>e&&e.close())),hs("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){const[e,t,n,s,i]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),IR(this.datastore),IR(this.keys)]),o=t.size+s+i;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:o}}throw T(new Error("repo is not initialized yet"),Gf,{path:this.path})}async _isAutoMigrationEnabled(){if(this.options.autoMigrate!==void 0)return this.options.autoMigrate;let e;try{e=await this.config.get(b_e)}catch(t){if(t.code===zc.code)e=!0;else throw t}return e}async _migrate(e,t){return await this.version.get()>e?(hs(`reverting to version ${e}`),Zve(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(hs(`migrating to version ${e}`),Jve(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{const e=await this.config.get("Datastore.StorageMax");return BigInt(i9e(e))}catch{return BigInt(w_e)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(const{key:n,value:s}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(s.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}}async function IR(r){let e=BigInt(0);for await(const t of r.query({}))e+=BigInt(t.value.byteLength),e+=BigInt(t.key.uint8Array().byteLength);return e}function E_e(r,e,t,n){return new m_e(r,e,t,n)}function v_e(r){return r.Datastore=Object.assign({},pz,Jv(r,"datastore")),r}function __e(r){const e={...pz.Spec,...Jv(r,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map(t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc}))}}async function*Eg(r,e){yield*(await Kc(r)).sort(e)}class ef extends pb{constructor(e,t={}){super(),this.db=typeof e=="string"?new $q(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw YN(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(n){throw b4(n)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(n){throw n.notFound?Ro(n):b4(n)}return t}async has(e){try{await this.db.get(e.toString())}catch(t){if(t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(e.toString())}catch(t){throw XN(t)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce((i,o)=>Yt(i,o),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((i,o)=>Eg(i,o),t));const{offset:n,limit:s}=e;if(n){let i=0;t=Yt(t,()=>i++>=n)}return s&&(t=Vl(t,s)),t}queryKeys(e){let t=ls(this._query({values:!1,prefix:e.prefix}),({key:i})=>i);Array.isArray(e.filters)&&(t=e.filters.reduce((i,o)=>Yt(i,o),t)),Array.isArray(e.orders)&&(t=e.orders.reduce((i,o)=>Eg(i,o),t));const{offset:n,limit:s}=e;if(n){let i=0;t=Yt(t,()=>i++>=n)}return s&&(t=Vl(t,s)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(e.prefix!=null){const s=e.prefix.toString();t.gte=s,t.lt=s+""}const n=this.db.iterator(t);if(n[Symbol.asyncIterator])return S_e(n);if(n.next!=null&&n.end!=null)return A_e(n);throw new Error("Level returned incompatible iterator")}}async function*S_e(r){for await(const[e,t]of r)yield{key:new be(e,!1),value:t};await r.close()}function A_e(r){return{[Symbol.asyncIterator](){return{next:()=>new Promise((e,t)=>{r.next((n,s,i)=>{if(n)return t(n);if(s==null)return r.end(o=>{if(o)return t(o);e({done:!0,value:void 0})});e({done:!1,value:{key:new be(s,!1),value:i}})})}),return:()=>new Promise((e,t)=>{r.end(n=>{if(n)return t(n);e({done:!0,value:void 0})})})}}}}var $_e=gz,RR=128,T_e=127,I_e=~T_e,R_e=Math.pow(2,31);function gz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=R_e;)e[t++]=r&255|RR,r/=128;for(;r&I_e;)e[t++]=r&255|RR,r>>>=7;return e[t]=r|0,gz.bytes=t-n+1,e}var C_e=z5,x_e=128,CR=127;function z5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw z5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&CR)<<s:(o&CR)*Math.pow(2,s),s+=7}while(o>=x_e);return z5.bytes=i-n,t}var D_e=Math.pow(2,7),P_e=Math.pow(2,14),O_e=Math.pow(2,21),k_e=Math.pow(2,28),N_e=Math.pow(2,35),L_e=Math.pow(2,42),M_e=Math.pow(2,49),U_e=Math.pow(2,56),B_e=Math.pow(2,63),z_e=function(r){return r<D_e?1:r<P_e?2:r<O_e?3:r<k_e?4:r<N_e?5:r<L_e?6:r<M_e?7:r<U_e?8:r<B_e?9:10},F_e={encode:$_e,decode:C_e,encodingLength:z_e},vg=F_e;const F5=(r,e=0)=>[vg.decode(r,e),vg.decode.bytes],_g=(r,e,t=0)=>(vg.encode(r,e,t),e),Sg=r=>vg.encodingLength(r),V_e=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},l9=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},j_e=(r,e)=>{const t=e.byteLength,n=Sg(r),s=n+Sg(t),i=new Uint8Array(s+t);return _g(r,i,0),_g(t,i,n),i.set(e,s),new u9(r,t,e,i)},wz=r=>{const e=l9(r),[t,n]=F5(e),[s,i]=F5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new u9(t,s,o,e)},K_e=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&V_e(r.bytes,t.bytes)}};let u9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function q_e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var H_e=q_e,G_e=H_e;let W_e=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Q_e=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bz(this,e)}},Y_e=class{constructor(e){this.decoders=e}or(e){return bz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const bz=(r,e)=>new Y_e({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let X_e=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new W_e(e,t,n),this.decoder=new Q_e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const mz=({name:r,prefix:e,encode:t,decode:n})=>new X_e(r,e,t,n),Ez=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=G_e(t,e);return mz({prefix:r,name:e,encode:n,decode:i=>l9(s(i))})},J_e=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Z_e=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ta=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>mz({prefix:e,name:r,encode(s){return Z_e(s,n,t)},decode(s){return J_e(s,n,t,r)}}),bo=Ez({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ez({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const da=Ta({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ta({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});const eSe=Ta({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ta({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ta({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ta({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ta({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ta({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ta({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const xR=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return rSe(t,V5(r),e||bo.encoder);default:return nSe(t,V5(r),e||da.encoder)}},DR=new WeakMap,V5=r=>{const e=DR.get(r);if(e==null){const t=new Map;return DR.set(r,t),t}return e};let vz=class Bn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==tf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==sSe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Bn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=j_e(e,t);return Bn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Bn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&K_e(e.multihash,n.multihash)}toString(e){return xR(this,e)}toJSON(){return{"/":xR(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Bn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Bn(n,s,i,o||PR(n,s,i.bytes))}else if(t[iSe]===!0){const{version:n,multihash:s,code:i}=t,o=wz(s);return Bn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==tf)throw new Error(`Version 0 CID must use dag-pb (code: ${tf}) block encoding`);return new Bn(e,t,n,n.bytes)}case 1:{const s=PR(e,t,n.bytes);return new Bn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Bn.create(0,tf,e)}static createV1(e,t){return Bn.create(1,e,t)}static decode(e){const[t,n]=Bn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Bn.inspectBytes(e),n=t.size-t.multihashSize,s=l9(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new u9(t.multihashCode,t.digestSize,i,s);return[t.version===0?Bn.createV0(o):Bn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=F5(e.subarray(t));return t+=f,h};let s=n(),i=tf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=tSe(e,t),i=Bn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return V5(i).set(n,e),i}};const tSe=(r,e)=>{switch(r[0]){case"Q":{const t=e||bo;return[bo.prefix,t.decode(`${bo.prefix}${r}`)]}case bo.prefix:{const t=e||bo;return[bo.prefix,t.decode(r)]}case da.prefix:{const t=e||da;return[da.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},rSe=(r,e,t)=>{const{prefix:n}=t;if(n!==bo.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},nSe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},tf=112,sSe=18,PR=(r,e,t)=>{const n=Sg(r),s=n+Sg(e),i=new Uint8Array(s+t.byteLength);return _g(r,i,0),_g(e,i,n),i.set(t,s),i},iSe=Symbol.for("@ipld/js-cid/CID"),oSe=85,OR=(r,e)=>async function*(){yield*(await Kc(r)).sort(e)}();class h9{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:s}of e)await this.put(n,s,t),yield{key:n,value:s}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,s){e.push({key:n,value:s})},delete(n){t.push(n)},commit:async n=>{await jr(this.putMany(e,n)),e=[],await jr(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=Yt(n,s=>s.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Yt(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>OR(s,i),n)),e.offset!=null){let s=0;n=Yt(n,()=>s++>=(e.offset||0))}return e.limit!=null&&(n=Vl(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=Yt(n,s=>s.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Yt(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>OR(s,i),n)),e.offset!=null){let s=0;n=Yt(n,()=>s++>=e.offset)}return e.limit!=null&&(n=Vl(n,e.limit)),n}}function Cu(r){const e=vz.asCID(r);if(!e)throw T(new Error("Not a valid cid"),"ERR_INVALID_CID");return new be("/"+da.encode(e.multihash.bytes).slice(1).toUpperCase(),!1)}function xc(r){return vz.createV1(oSe,wz(da.decode("b"+r.toString().slice(1).toLowerCase())))}function d9(r){const e=r.substring(0,1);if(e==="/")return d9(r.substring(1));let t;e.toLowerCase()==="b"?t=i=>da.decode(i.toLowerCase()).subarray(2):e.toLowerCase()==="c"?t=i=>eSe.decode(i.toLowerCase()).subarray(2):e==="z"?t=i=>bo.decode(i).subarray(2):e==="Q"?t=i=>bo.decode("z"+i):t=i=>da.decode("b"+i.toLowerCase()).subarray(2);let n;for(let i=1;i<r.length;i++)try{n=t(r.substring(0,i))}catch(o){if(o.message!=="Unexpected end of data")throw o}let s="/C";return n&&(s=`/${da.encode(n).slice(1,-1).toUpperCase()||"C"}`),s}function aSe(r){return{...r,prefix:r.prefix?d9(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e({key:xc(t.key),value:t.value})):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e({key:xc(t.key),value:t.value},{key:xc(n.key),value:n.value})):void 0}}function cSe(r){return{...r,prefix:r.prefix?d9(r.prefix):void 0,filters:r.filters?r.filters.map(e=>t=>e(xc(t))):void 0,orders:r.orders?r.orders.map(e=>(t,n)=>e(xc(t),xc(n))):void 0}}class lSe extends h9{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:n,value:s}of this.child.query(aSe(e),t))yield{key:xc(n),value:s}}async*queryKeys(e,t){for await(const n of this.child.queryKeys(cSe(e),t))yield xc(n)}async get(e,t){return this.child.get(Cu(e),t)}async*getMany(e,t){for await(const n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(Cu(e),t,n)}async*putMany(e,t){const n=$r({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)(async()=>{try{const i=this.child;await jr(this.child.putMany(async function*(){for await(const o of e){const a=Cu(o.key);await i.has(a,t)||(yield{key:a,value:o.value}),n.push(o)}}())),n.end()}catch(i){n.end(i)}}),yield*n}has(e,t){return this.child.has(Cu(e),t)}delete(e,t){return this.child.delete(Cu(e),t)}deleteMany(e,t){const n=$r({objectMode:!0});return jr(this.child.deleteMany(async function*(){for await(const s of e)yield Cu(s),n.push(s);n.end()}(),t)).catch(s=>{n.end(s)}),n}}function uSe(r,e,t){const n=t.path||"ipfs";return E_e(n,s=>e.getCodec(s),{root:new ef(n,{prefix:"",version:2}),blocks:new lSe(new ef(`${n}/blocks`,{prefix:"",version:2})),datastore:new ef(`${n}/datastore`,{prefix:"",version:2}),keys:new ef(`${n}/keys`,{prefix:"",version:2}),pins:new ef(`${n}/pins`,{prefix:"",version:2})},{autoMigrate:t.autoMigrate,onMigrationProgress:t.onMigrationProgress||r,repoLock:fz})}function kR(r){return r instanceof Uint8Array?{get(e){return r[e]},set(e,t){r[e]=t}}:{get(e){return r.get(e)},set(e,t){r.set(e,t)}}}const NR=4294967296;class yo{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(e===!0)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){const e=-(this.lo&1),t=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new yo(n,t)}zzEncode(){const e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new yo(t,n)}toBytes(e,t=0){const n=kR(e);for(;this.hi>0;)n.set(t++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(t++,this.lo&127|128),this.lo=this.lo>>>7;n.set(t++,this.lo)}static fromBigInt(e){if(e===0n)return new yo;const t=e<0;t&&(e=-e);let n=Number(e>>32n)|0,s=Number(e-(BigInt(n)<<32n))|0;return t&&(n=~n>>>0,s=~s>>>0,++s>NR&&(s=0,++n>NR&&(n=0))),new yo(n,s)}static fromNumber(e){if(e===0)return new yo;const t=e<0;t&&(e=-e);let n=e>>>0,s=(e-n)/4294967296>>>0;return t&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new yo(s,n)}static fromBytes(e,t=0){const n=kR(e),s=new yo;let i=0;if(e.length-t>4){for(;i<4;++i)if(s.lo=(s.lo|(n.get(t)&127)<<i*7)>>>0,n.get(t++)<128)return s;if(s.lo=(s.lo|(n.get(t)&127)<<28)>>>0,s.hi=(s.hi|(n.get(t)&127)>>4)>>>0,n.get(t++)<128)return s;i=0}else for(;i<4;++i){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(s.lo=(s.lo|(n.get(t)&127)<<i*7)>>>0,n.get(t++)<128)return s}if(e.length-t>4){for(;i<5;++i)if(s.hi=(s.hi|(n.get(t)&127)<<i*7+3)>>>0,n.get(t++)<128)return s}else if(t<e.byteLength)for(;i<5;++i){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(s.hi=(s.hi|(n.get(t)&127)<<i*7+3)>>>0,n.get(t++)<128)return s}throw RangeError("invalid varint encoding")}}const hSe=Math.pow(2,7),dSe=Math.pow(2,14),fSe=Math.pow(2,21),pSe=Math.pow(2,28),ySe=Math.pow(2,35),gSe=Math.pow(2,42),wSe=Math.pow(2,49),bSe=Math.pow(2,56),mSe=Math.pow(2,63),Jt={encodingLength(r){return r<hSe?1:r<dSe?2:r<fSe?3:r<pSe?4:r<ySe?5:r<gSe?6:r<wSe?7:r<bSe?8:r<mSe?9:10},encode(r,e,t=0){if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=$o(Jt.encodingLength(r))),yo.fromNumber(r).toBytes(e,t),e},decode(r,e=0){return yo.fromBytes(r,e).toNumber(!0)}},ESe={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var Ag;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.publicKey=t.bytes();break;case 2:s.payloadType=t.bytes();break;case 3:s.payload=t.bytes();break;case 5:s.signature=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(Ag||(Ag={}));const nc=class nc{constructor(e){N(this,"peerId");N(this,"payloadType");N(this,"payload");N(this,"signature");N(this,"marshaled");const{peerId:t,payloadType:n,payload:s,signature:i}=e;this.peerId=t,this.payloadType=n,this.payload=s,this.signature=i}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=Ag.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Ie(this.marshal(),e.marshal())}async validate(e){const t=LR(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return Fl(this.peerId.publicKey).verify(t.subarray(),this.signature)}};N(nc,"createFromProtobuf",async e=>{const t=Ag.decode(e),n=await vi(t.publicKey);return new nc({peerId:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),N(nc,"seal",async(e,t)=>{if(t.privateKey==null)throw new Error("Missing private key");const n=e.domain,s=e.codec,i=e.marshal(),o=LR(n,s,i),c=await(await ba(t.privateKey)).sign(o.subarray());return new nc({peerId:t,payloadType:s,payload:i,signature:c})}),N(nc,"openAndCertify",async(e,t)=>{const n=await nc.createFromProtobuf(e);if(!await n.validate(t))throw new L("envelope signature is not valid for the given domain",ESe.ERR_SIGNATURE_NOT_VALID);return n});let fa=nc;const LR=(r,e,t)=>{const n=M(r),s=Jt.encode(n.byteLength),i=Jt.encode(e.length),o=Jt.encode(t.length);return new Se(s,n,i,e,o,t)};function vSe(r,e){const t=(n,s)=>n.toString().localeCompare(s.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,s)=>e[s].equals(n)))}const _Se="libp2p-peer-record",SSe=Uint8Array.from([3,1]);var $g;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=zr((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{const o={multiaddr:new Uint8Array(0)},a=i==null?s.len:s.pos+i;for(;s.pos<a;){const c=s.uint32();switch(c>>>3){case 1:o.multiaddr=s.bytes();break;default:s.skipType(c&7);break}}return o})),n),t.encode=s=>Fr(s,t.codec()),t.decode=s=>Vr(s,t.codec())})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const i of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(i,n);s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={peerId:new Uint8Array(0),seq:0n,addresses:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.peerId=t.bytes();break;case 2:s.seq=t.uint64();break;case 3:s.addresses.push(r.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})($g||($g={}));const Xo=class Xo{constructor(e){N(this,"peerId");N(this,"multiaddrs");N(this,"seqNumber");N(this,"domain",Xo.DOMAIN);N(this,"codec",Xo.CODEC);N(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:s}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=s??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=$g.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Xo)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!vSe(this.multiaddrs,e.multiaddrs))}};N(Xo,"createFromProtobuf",e=>{const t=$g.decode(e),n=No(t.peerId),s=(t.addresses??[]).map(o=>Hp(o.multiaddr)),i=t.seq;return new Xo({peerId:n,multiaddrs:s,seqNumber:i})}),N(Xo,"DOMAIN",_Se),N(Xo,"CODEC",SSe);let Dc=Xo;const j5=Symbol.for("@libp2p/topology");function ASe(r){return r!=null&&!!r[j5]}const MR=()=>{};var cnt;class $Se{constructor(e){N(this,"min");N(this,"max");N(this,"peers");N(this,"onConnect");N(this,"onDisconnect");N(this,"registrar");N(this,cnt,!0);this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??MR,this.onDisconnect=e.onDisconnect??MR}get[Symbol.toStringTag](){return j5.toString()}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}}cnt=j5;function f9(r){return new $Se(r)}var go,AO;let Zt=(AO=class extends EventTarget{constructor(){super(...arguments);ar(this,go,new Map)}listenerCount(t){const n=ve(this,go).get(t);return n==null?0:n.length}addEventListener(t,n,s){super.addEventListener(t,n,s);let i=ve(this,go).get(t);i==null&&(i=[],ve(this,go).set(t,i)),i.push({callback:n,once:(s!==!0&&s!==!1&&s?.once)??!1})}removeEventListener(t,n,s){super.removeEventListener(t.toString(),n??null,s);let i=ve(this,go).get(t);i!=null&&(i=i.filter(({callback:o})=>o!==n),ve(this,go).set(t,i))}dispatchEvent(t){const n=super.dispatchEvent(t);let s=ve(this,go).get(t.type);return s==null||(s=s.filter(({once:i})=>!i),ve(this,go).set(t.type,s)),n}safeDispatchEvent(t,n){return this.dispatchEvent(new oe(t,n))}},go=new WeakMap,AO);class TSe extends Event{constructor(t,n){super(t,n);N(this,"detail");this.detail=n?.detail}}const oe=globalThis.CustomEvent??TSe;class ISe{constructor(e,t,n){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=n;for(let s=0;s<t;s++)this.history[s]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:s}=e;return this.msgs.has(s)?!1:(this.msgs.set(s,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(!n)return null;const s=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,s),{msg:n.message,count:s}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(s=>{const i=this.msgs.get(s.msgIdStr);if(i&&i.validated&&e.has(s.topic)){let o=t.get(s.topic);o||(o=[],t.set(s.topic,o)),o.push(s.msgId)}});return t}validate(e){const t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:s}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:s}}shift(){this.history[this.history.length-1].forEach(t=>{const n=this.msgs.get(t.msgIdStr);n&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}var _z={exports:{}},M6={},U6={},B6,UR;function RSe(){if(UR)return B6;UR=1,B6=e;var r=Eu();function e(i,o){this.lo=i>>>0,this.hi=o>>>0}var t=e.zero=new e(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var n=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(o){if(o===0)return t;var a=o<0;a&&(o=-o);var c=o>>>0,u=(o-c)/4294967296>>>0;return a&&(u=~u>>>0,c=~c>>>0,++c>4294967295&&(c=0,++u>4294967295&&(u=0))),new e(c,u)},e.from=function(o){if(typeof o=="number")return e.fromNumber(o);if(r.isString(o))if(r.Long)o=r.Long.fromString(o);else return e.fromNumber(parseInt(o,10));return o.low||o.high?new e(o.low>>>0,o.high>>>0):t},e.prototype.toNumber=function(o){if(!o&&this.hi>>>31){var a=~this.lo+1>>>0,c=~this.hi>>>0;return a||(c=c+1>>>0),-(a+c*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(o){return r.Long?new r.Long(this.lo|0,this.hi|0,!!o):{low:this.lo|0,high:this.hi|0,unsigned:!!o}};var s=String.prototype.charCodeAt;return e.fromHash=function(o){return o===n?t:new e((s.call(o,0)|s.call(o,1)<<8|s.call(o,2)<<16|s.call(o,3)<<24)>>>0,(s.call(o,4)|s.call(o,5)<<8|s.call(o,6)<<16|s.call(o,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var o=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^o)>>>0,this.lo=(this.lo<<1^o)>>>0,this},e.prototype.zzDecode=function(){var o=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^o)>>>0,this.hi=(this.hi>>>1^o)>>>0,this},e.prototype.length=function(){var o=this.lo,a=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return c===0?a===0?o<16384?o<128?1:2:o<2097152?3:4:a<16384?a<128?5:6:a<2097152?7:8:c<128?9:10},B6}var BR;function Eu(){return BR||(BR=1,function(r){var e=r;e.asPromise=Tq,e.base64=Iq,e.EventEmitter=Rq,e.float=Cq,e.inquire=xq,e.utf8=Dq,e.pool=Pq,e.LongBits=RSe(),e.isNode=!!(typeof Is<"u"&&Is&&Is.process&&Is.process.versions&&Is.process.versions.node),e.global=e.isNode&&Is||typeof window<"u"&&window||typeof self<"u"&&self||Is,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i},e.isString=function(i){return typeof i=="string"||i instanceof String},e.isObject=function(i){return i&&typeof i=="object"},e.isset=e.isSet=function(i,o){var a=i[o];return a!=null&&i.hasOwnProperty(o)?typeof a!="object"||(Array.isArray(a)?a.length:Object.keys(a).length)>0:!1},e.Buffer=function(){try{var s=e.inquire("buffer").Buffer;return s.prototype.utf8Write?s:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(i){return typeof i=="number"?e.Buffer?e._Buffer_allocUnsafe(i):new e.Array(i):e.Buffer?e._Buffer_from(i):typeof Uint8Array>"u"?i:new Uint8Array(i)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(i){return i?e.LongBits.from(i).toHash():e.LongBits.zeroHash},e.longFromHash=function(i,o){var a=e.LongBits.fromHash(i);return e.Long?e.Long.fromBits(a.lo,a.hi,o):a.toNumber(!!o)};function t(s,i,o){for(var a=Object.keys(i),c=0;c<a.length;++c)(s[a[c]]===void 0||!o)&&(s[a[c]]=i[a[c]]);return s}e.merge=t,e.lcFirst=function(i){return i.charAt(0).toLowerCase()+i.substring(1)};function n(s){function i(o,a){if(!(this instanceof i))return new i(o,a);Object.defineProperty(this,"message",{get:function(){return o}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:new Error().stack||""}),a&&t(this,a)}return(i.prototype=Object.create(Error.prototype)).constructor=i,Object.defineProperty(i.prototype,"name",{get:function(){return s}}),i.prototype.toString=function(){return this.name+": "+this.message},i}e.newError=n,e.ProtocolError=n("ProtocolError"),e.oneOfGetter=function(i){for(var o={},a=0;a<i.length;++a)o[i[a]]=1;return function(){for(var c=Object.keys(this),u=c.length-1;u>-1;--u)if(o[c[u]]===1&&this[c[u]]!==void 0&&this[c[u]]!==null)return c[u]}},e.oneOfSetter=function(i){return function(o){for(var a=0;a<i.length;++a)i[a]!==o&&delete this[i[a]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var s=e.Buffer;if(!s){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=s.from!==Uint8Array.from&&s.from||function(o,a){return new s(o,a)},e._Buffer_allocUnsafe=s.allocUnsafe||function(o){return new s(o)}}}(U6)),U6}var z6,zR;function Sz(){if(zR)return z6;zR=1,z6=c;var r=Eu(),e,t=r.LongBits,n=r.base64,s=r.utf8;function i(b,w,S){this.fn=b,this.len=w,this.next=void 0,this.val=S}function o(){}function a(b){this.head=b.head,this.tail=b.tail,this.len=b.len,this.next=b.states}function c(){this.len=0,this.head=new i(o,0,0),this.tail=this.head,this.states=null}var u=function(){return r.Buffer?function(){return(c.create=function(){return new e})()}:function(){return new c}};c.create=u(),c.alloc=function(w){return new r.Array(w)},r.Array!==Array&&(c.alloc=r.pool(c.alloc,r.Array.prototype.subarray)),c.prototype._push=function(w,S,E){return this.tail=this.tail.next=new i(w,S,E),this.len+=S,this};function l(b,w,S){w[S]=b&255}function h(b,w,S){for(;b>127;)w[S++]=b&127|128,b>>>=7;w[S]=b}function f(b,w){this.len=b,this.next=void 0,this.val=w}f.prototype=Object.create(i.prototype),f.prototype.fn=h,c.prototype.uint32=function(w){return this.len+=(this.tail=this.tail.next=new f((w=w>>>0)<128?1:w<16384?2:w<2097152?3:w<268435456?4:5,w)).len,this},c.prototype.int32=function(w){return w<0?this._push(y,10,t.fromNumber(w)):this.uint32(w)},c.prototype.sint32=function(w){return this.uint32((w<<1^w>>31)>>>0)};function y(b,w,S){for(;b.hi;)w[S++]=b.lo&127|128,b.lo=(b.lo>>>7|b.hi<<25)>>>0,b.hi>>>=7;for(;b.lo>127;)w[S++]=b.lo&127|128,b.lo=b.lo>>>7;w[S++]=b.lo}c.prototype.uint64=function(w){var S=t.from(w);return this._push(y,S.length(),S)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(w){var S=t.from(w).zzEncode();return this._push(y,S.length(),S)},c.prototype.bool=function(w){return this._push(l,1,w?1:0)};function d(b,w,S){w[S]=b&255,w[S+1]=b>>>8&255,w[S+2]=b>>>16&255,w[S+3]=b>>>24}c.prototype.fixed32=function(w){return this._push(d,4,w>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(w){var S=t.from(w);return this._push(d,4,S.lo)._push(d,4,S.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(w){return this._push(r.float.writeFloatLE,4,w)},c.prototype.double=function(w){return this._push(r.float.writeDoubleLE,8,w)};var p=r.Array.prototype.set?function(w,S,E){S.set(w,E)}:function(w,S,E){for(var m=0;m<w.length;++m)S[E+m]=w[m]};return c.prototype.bytes=function(w){var S=w.length>>>0;if(!S)return this._push(l,1,0);if(r.isString(w)){var E=c.alloc(S=n.length(w));n.decode(w,E,0),w=E}return this.uint32(S)._push(p,S,w)},c.prototype.string=function(w){var S=s.length(w);return S?this.uint32(S)._push(s.write,S,w):this._push(l,1,0)},c.prototype.fork=function(){return this.states=new a(this),this.head=this.tail=new i(o,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new i(o,0,0),this.len=0),this},c.prototype.ldelim=function(){var w=this.head,S=this.tail,E=this.len;return this.reset().uint32(E),E&&(this.tail.next=w.next,this.tail=S,this.len+=E),this},c.prototype.finish=function(){for(var w=this.head.next,S=this.constructor.alloc(this.len),E=0;w;)w.fn(w.val,S,E),E+=w.len,w=w.next;return S},c._configure=function(b){e=b,c.create=u(),e._configure()},z6}var F6,FR;function CSe(){if(FR)return F6;FR=1,F6=t;var r=Sz();(t.prototype=Object.create(r.prototype)).constructor=t;var e=Eu();function t(){r.call(this)}t._configure=function(){t.alloc=e._Buffer_allocUnsafe,t.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&e.Buffer.prototype.set.name==="set"?function(i,o,a){o.set(i,a)}:function(i,o,a){if(i.copy)i.copy(o,a,0,i.length);else for(var c=0;c<i.length;)o[a++]=i[c++]}},t.prototype.bytes=function(i){e.isString(i)&&(i=e._Buffer_from(i,"base64"));var o=i.length>>>0;return this.uint32(o),o&&this._push(t.writeBytesBuffer,o,i),this};function n(s,i,o){s.length<40?e.utf8.write(s,i,o):i.utf8Write?i.utf8Write(s,o):i.write(s,o)}return t.prototype.string=function(i){var o=e.Buffer.byteLength(i);return this.uint32(o),o&&this._push(n,o,i),this},t._configure(),F6}var V6,VR;function Az(){if(VR)return V6;VR=1,V6=i;var r=Eu(),e,t=r.LongBits,n=r.utf8;function s(h,f){return RangeError("index out of range: "+h.pos+" + "+(f||1)+" > "+h.len)}function i(h){this.buf=h,this.pos=0,this.len=h.length}var o=typeof Uint8Array<"u"?function(f){if(f instanceof Uint8Array||Array.isArray(f))return new i(f);throw Error("illegal buffer")}:function(f){if(Array.isArray(f))return new i(f);throw Error("illegal buffer")},a=function(){return r.Buffer?function(y){return(i.create=function(p){return r.Buffer.isBuffer(p)?new e(p):o(p)})(y)}:o};i.create=a(),i.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,i.prototype.uint32=function(){var f=4294967295;return function(){if(f=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(f=(f|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(f=(f|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(f=(f|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(f=(f|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return f;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return f}}(),i.prototype.int32=function(){return this.uint32()|0},i.prototype.sint32=function(){var f=this.uint32();return f>>>1^-(f&1)|0};function c(){var h=new t(0,0),f=0;if(this.len-this.pos>4){for(;f<4;++f)if(h.lo=(h.lo|(this.buf[this.pos]&127)<<f*7)>>>0,this.buf[this.pos++]<128)return h;if(h.lo=(h.lo|(this.buf[this.pos]&127)<<28)>>>0,h.hi=(h.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return h;f=0}else{for(;f<3;++f){if(this.pos>=this.len)throw s(this);if(h.lo=(h.lo|(this.buf[this.pos]&127)<<f*7)>>>0,this.buf[this.pos++]<128)return h}return h.lo=(h.lo|(this.buf[this.pos++]&127)<<f*7)>>>0,h}if(this.len-this.pos>4){for(;f<5;++f)if(h.hi=(h.hi|(this.buf[this.pos]&127)<<f*7+3)>>>0,this.buf[this.pos++]<128)return h}else for(;f<5;++f){if(this.pos>=this.len)throw s(this);if(h.hi=(h.hi|(this.buf[this.pos]&127)<<f*7+3)>>>0,this.buf[this.pos++]<128)return h}throw Error("invalid varint encoding")}i.prototype.bool=function(){return this.uint32()!==0};function u(h,f){return(h[f-4]|h[f-3]<<8|h[f-2]<<16|h[f-1]<<24)>>>0}i.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return u(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return u(this.buf,this.pos+=4)|0};function l(){if(this.pos+8>this.len)throw s(this,8);return new t(u(this.buf,this.pos+=4),u(this.buf,this.pos+=4))}return i.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var f=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,f},i.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var f=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,f},i.prototype.bytes=function(){var f=this.uint32(),y=this.pos,d=this.pos+f;if(d>this.len)throw s(this,f);return this.pos+=f,Array.isArray(this.buf)?this.buf.slice(y,d):y===d?new this.buf.constructor(0):this._slice.call(this.buf,y,d)},i.prototype.string=function(){var f=this.bytes();return n.read(f,0,f.length)},i.prototype.skip=function(f){if(typeof f=="number"){if(this.pos+f>this.len)throw s(this,f);this.pos+=f}else do if(this.pos>=this.len)throw s(this);while(this.buf[this.pos++]&128);return this},i.prototype.skipType=function(h){switch(h){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(h=this.uint32()&7)!==4;)this.skipType(h);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+h+" at offset "+this.pos)}return this},i._configure=function(h){e=h,i.create=a(),e._configure();var f=r.Long?"toLong":"toNumber";r.merge(i.prototype,{int64:function(){return c.call(this)[f](!1)},uint64:function(){return c.call(this)[f](!0)},sint64:function(){return c.call(this).zzDecode()[f](!1)},fixed64:function(){return l.call(this)[f](!0)},sfixed64:function(){return l.call(this)[f](!1)}})},V6}var j6,jR;function xSe(){if(jR)return j6;jR=1,j6=t;var r=Az();(t.prototype=Object.create(r.prototype)).constructor=t;var e=Eu();function t(n){r.call(this,n)}return t._configure=function(){e.Buffer&&(t.prototype._slice=e.Buffer.prototype.slice)},t.prototype.string=function(){var s=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+s,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+s,this.len))},t._configure(),j6}var K6={},q6,KR;function DSe(){if(KR)return q6;KR=1,q6=e;var r=Eu();(e.prototype=Object.create(r.EventEmitter.prototype)).constructor=e;function e(t,n,s){if(typeof t!="function")throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!n,this.responseDelimited=!!s}return e.prototype.rpcCall=function t(n,s,i,o,a){if(!o)throw TypeError("request must be specified");var c=this;if(!a)return r.asPromise(t,c,n,s,i,o);if(!c.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return c.rpcImpl(n,s[c.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(l,h){if(l)return c.emit("error",l,n),a(l);if(h===null){c.end(!0);return}if(!(h instanceof i))try{h=i[c.responseDelimited?"decodeDelimited":"decode"](h)}catch(f){return c.emit("error",f,n),a(f)}return c.emit("data",h,n),a(null,h)})}catch(u){c.emit("error",u,n),setTimeout(function(){a(u)},0);return}},e.prototype.end=function(n){return this.rpcImpl&&(n||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},q6}var qR;function PSe(){return qR||(qR=1,function(r){var e=r;e.Service=DSe()}(K6)),K6}var H6,HR;function OSe(){return HR||(HR=1,H6={}),H6}var GR;function kSe(){return GR||(GR=1,function(r){var e=r;e.build="minimal",e.Writer=Sz(),e.BufferWriter=CSe(),e.Reader=Az(),e.BufferReader=xSe(),e.util=Eu(),e.rpc=PSe(),e.roots=OSe(),e.configure=t;function t(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}t()}(M6)),M6}var G6,WR;function $z(){return WR||(WR=1,G6=kSe()),G6}(function(r){(function(e,t){typeof P7=="function"&&r&&r.exports&&(r.exports=t($z()))})(Is,function(e){var t=e.Reader,n=e.Writer,s=e.util,i=e.roots.default||(e.roots.default={});return i.RPC=function(){function o(c){if(this.subscriptions=[],this.messages=[],c)for(var u=Object.keys(c),l=0;l<u.length;++l)c[u[l]]!=null&&(this[u[l]]=c[u[l]])}o.prototype.subscriptions=s.emptyArray,o.prototype.messages=s.emptyArray,o.prototype.control=null;var a;return Object.defineProperty(o.prototype,"_control",{get:s.oneOfGetter(a=["control"]),set:s.oneOfSetter(a)}),o.encode=function(u,l){if(l||(l=n.create()),u.subscriptions!=null&&u.subscriptions.length)for(var h=0;h<u.subscriptions.length;++h)i.RPC.SubOpts.encode(u.subscriptions[h],l.uint32(10).fork()).ldelim();if(u.messages!=null&&u.messages.length)for(var h=0;h<u.messages.length;++h)i.RPC.Message.encode(u.messages[h],l.uint32(18).fork()).ldelim();return u.control!=null&&Object.hasOwnProperty.call(u,"control")&&i.RPC.ControlMessage.encode(u.control,l.uint32(26).fork()).ldelim(),l},o.decode=function(u,l){u instanceof t||(u=t.create(u));for(var h=l===void 0?u.len:u.pos+l,f=new i.RPC;u.pos<h;){var y=u.uint32();switch(y>>>3){case 1:f.subscriptions&&f.subscriptions.length||(f.subscriptions=[]),f.subscriptions.push(i.RPC.SubOpts.decode(u,u.uint32()));break;case 2:f.messages&&f.messages.length||(f.messages=[]),f.messages.push(i.RPC.Message.decode(u,u.uint32()));break;case 3:f.control=i.RPC.ControlMessage.decode(u,u.uint32());break;default:u.skipType(y&7);break}}return f},o.fromObject=function(u){if(u instanceof i.RPC)return u;var l=new i.RPC;if(u.subscriptions){if(!Array.isArray(u.subscriptions))throw TypeError(".RPC.subscriptions: array expected");l.subscriptions=[];for(var h=0;h<u.subscriptions.length;++h){if(typeof u.subscriptions[h]!="object")throw TypeError(".RPC.subscriptions: object expected");l.subscriptions[h]=i.RPC.SubOpts.fromObject(u.subscriptions[h])}}if(u.messages){if(!Array.isArray(u.messages))throw TypeError(".RPC.messages: array expected");l.messages=[];for(var h=0;h<u.messages.length;++h){if(typeof u.messages[h]!="object")throw TypeError(".RPC.messages: object expected");l.messages[h]=i.RPC.Message.fromObject(u.messages[h])}}if(u.control!=null){if(typeof u.control!="object")throw TypeError(".RPC.control: object expected");l.control=i.RPC.ControlMessage.fromObject(u.control)}return l},o.toObject=function(u,l){l||(l={});var h={};if((l.arrays||l.defaults)&&(h.subscriptions=[],h.messages=[]),u.subscriptions&&u.subscriptions.length){h.subscriptions=[];for(var f=0;f<u.subscriptions.length;++f)h.subscriptions[f]=i.RPC.SubOpts.toObject(u.subscriptions[f],l)}if(u.messages&&u.messages.length){h.messages=[];for(var f=0;f<u.messages.length;++f)h.messages[f]=i.RPC.Message.toObject(u.messages[f],l)}return u.control!=null&&u.hasOwnProperty("control")&&(h.control=i.RPC.ControlMessage.toObject(u.control,l),l.oneofs&&(h._control="control")),h},o.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},o.SubOpts=function(){function c(l){if(l)for(var h=Object.keys(l),f=0;f<h.length;++f)l[h[f]]!=null&&(this[h[f]]=l[h[f]])}c.prototype.subscribe=null,c.prototype.topic=null;var u;return Object.defineProperty(c.prototype,"_subscribe",{get:s.oneOfGetter(u=["subscribe"]),set:s.oneOfSetter(u)}),Object.defineProperty(c.prototype,"_topic",{get:s.oneOfGetter(u=["topic"]),set:s.oneOfSetter(u)}),c.encode=function(h,f){return f||(f=n.create()),h.subscribe!=null&&Object.hasOwnProperty.call(h,"subscribe")&&f.uint32(8).bool(h.subscribe),h.topic!=null&&Object.hasOwnProperty.call(h,"topic")&&f.uint32(18).string(h.topic),f},c.decode=function(h,f){h instanceof t||(h=t.create(h));for(var y=f===void 0?h.len:h.pos+f,d=new i.RPC.SubOpts;h.pos<y;){var p=h.uint32();switch(p>>>3){case 1:d.subscribe=h.bool();break;case 2:d.topic=h.string();break;default:h.skipType(p&7);break}}return d},c.fromObject=function(h){if(h instanceof i.RPC.SubOpts)return h;var f=new i.RPC.SubOpts;return h.subscribe!=null&&(f.subscribe=!!h.subscribe),h.topic!=null&&(f.topic=String(h.topic)),f},c.toObject=function(h,f){f||(f={});var y={};return h.subscribe!=null&&h.hasOwnProperty("subscribe")&&(y.subscribe=h.subscribe,f.oneofs&&(y._subscribe="subscribe")),h.topic!=null&&h.hasOwnProperty("topic")&&(y.topic=h.topic,f.oneofs&&(y._topic="topic")),y},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o.Message=function(){function c(l){if(l)for(var h=Object.keys(l),f=0;f<h.length;++f)l[h[f]]!=null&&(this[h[f]]=l[h[f]])}c.prototype.from=null,c.prototype.data=null,c.prototype.seqno=null,c.prototype.topic="",c.prototype.signature=null,c.prototype.key=null;var u;return Object.defineProperty(c.prototype,"_from",{get:s.oneOfGetter(u=["from"]),set:s.oneOfSetter(u)}),Object.defineProperty(c.prototype,"_data",{get:s.oneOfGetter(u=["data"]),set:s.oneOfSetter(u)}),Object.defineProperty(c.prototype,"_seqno",{get:s.oneOfGetter(u=["seqno"]),set:s.oneOfSetter(u)}),Object.defineProperty(c.prototype,"_signature",{get:s.oneOfGetter(u=["signature"]),set:s.oneOfSetter(u)}),Object.defineProperty(c.prototype,"_key",{get:s.oneOfGetter(u=["key"]),set:s.oneOfSetter(u)}),c.encode=function(h,f){return f||(f=n.create()),h.from!=null&&Object.hasOwnProperty.call(h,"from")&&f.uint32(10).bytes(h.from),h.data!=null&&Object.hasOwnProperty.call(h,"data")&&f.uint32(18).bytes(h.data),h.seqno!=null&&Object.hasOwnProperty.call(h,"seqno")&&f.uint32(26).bytes(h.seqno),f.uint32(34).string(h.topic),h.signature!=null&&Object.hasOwnProperty.call(h,"signature")&&f.uint32(42).bytes(h.signature),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&f.uint32(50).bytes(h.key),f},c.decode=function(h,f){h instanceof t||(h=t.create(h));for(var y=f===void 0?h.len:h.pos+f,d=new i.RPC.Message;h.pos<y;){var p=h.uint32();switch(p>>>3){case 1:d.from=h.bytes();break;case 2:d.data=h.bytes();break;case 3:d.seqno=h.bytes();break;case 4:d.topic=h.string();break;case 5:d.signature=h.bytes();break;case 6:d.key=h.bytes();break;default:h.skipType(p&7);break}}if(!d.hasOwnProperty("topic"))throw s.ProtocolError("missing required 'topic'",{instance:d});return d},c.fromObject=function(h){if(h instanceof i.RPC.Message)return h;var f=new i.RPC.Message;return h.from!=null&&(typeof h.from=="string"?s.base64.decode(h.from,f.from=s.newBuffer(s.base64.length(h.from)),0):h.from.length&&(f.from=h.from)),h.data!=null&&(typeof h.data=="string"?s.base64.decode(h.data,f.data=s.newBuffer(s.base64.length(h.data)),0):h.data.length&&(f.data=h.data)),h.seqno!=null&&(typeof h.seqno=="string"?s.base64.decode(h.seqno,f.seqno=s.newBuffer(s.base64.length(h.seqno)),0):h.seqno.length&&(f.seqno=h.seqno)),h.topic!=null&&(f.topic=String(h.topic)),h.signature!=null&&(typeof h.signature=="string"?s.base64.decode(h.signature,f.signature=s.newBuffer(s.base64.length(h.signature)),0):h.signature.length&&(f.signature=h.signature)),h.key!=null&&(typeof h.key=="string"?s.base64.decode(h.key,f.key=s.newBuffer(s.base64.length(h.key)),0):h.key.length&&(f.key=h.key)),f},c.toObject=function(h,f){f||(f={});var y={};return f.defaults&&(y.topic=""),h.from!=null&&h.hasOwnProperty("from")&&(y.from=f.bytes===String?s.base64.encode(h.from,0,h.from.length):f.bytes===Array?Array.prototype.slice.call(h.from):h.from,f.oneofs&&(y._from="from")),h.data!=null&&h.hasOwnProperty("data")&&(y.data=f.bytes===String?s.base64.encode(h.data,0,h.data.length):f.bytes===Array?Array.prototype.slice.call(h.data):h.data,f.oneofs&&(y._data="data")),h.seqno!=null&&h.hasOwnProperty("seqno")&&(y.seqno=f.bytes===String?s.base64.encode(h.seqno,0,h.seqno.length):f.bytes===Array?Array.prototype.slice.call(h.seqno):h.seqno,f.oneofs&&(y._seqno="seqno")),h.topic!=null&&h.hasOwnProperty("topic")&&(y.topic=h.topic),h.signature!=null&&h.hasOwnProperty("signature")&&(y.signature=f.bytes===String?s.base64.encode(h.signature,0,h.signature.length):f.bytes===Array?Array.prototype.slice.call(h.signature):h.signature,f.oneofs&&(y._signature="signature")),h.key!=null&&h.hasOwnProperty("key")&&(y.key=f.bytes===String?s.base64.encode(h.key,0,h.key.length):f.bytes===Array?Array.prototype.slice.call(h.key):h.key,f.oneofs&&(y._key="key")),y},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o.ControlMessage=function(){function c(u){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],u)for(var l=Object.keys(u),h=0;h<l.length;++h)u[l[h]]!=null&&(this[l[h]]=u[l[h]])}return c.prototype.ihave=s.emptyArray,c.prototype.iwant=s.emptyArray,c.prototype.graft=s.emptyArray,c.prototype.prune=s.emptyArray,c.encode=function(l,h){if(h||(h=n.create()),l.ihave!=null&&l.ihave.length)for(var f=0;f<l.ihave.length;++f)i.RPC.ControlIHave.encode(l.ihave[f],h.uint32(10).fork()).ldelim();if(l.iwant!=null&&l.iwant.length)for(var f=0;f<l.iwant.length;++f)i.RPC.ControlIWant.encode(l.iwant[f],h.uint32(18).fork()).ldelim();if(l.graft!=null&&l.graft.length)for(var f=0;f<l.graft.length;++f)i.RPC.ControlGraft.encode(l.graft[f],h.uint32(26).fork()).ldelim();if(l.prune!=null&&l.prune.length)for(var f=0;f<l.prune.length;++f)i.RPC.ControlPrune.encode(l.prune[f],h.uint32(34).fork()).ldelim();return h},c.decode=function(l,h){l instanceof t||(l=t.create(l));for(var f=h===void 0?l.len:l.pos+h,y=new i.RPC.ControlMessage;l.pos<f;){var d=l.uint32();switch(d>>>3){case 1:y.ihave&&y.ihave.length||(y.ihave=[]),y.ihave.push(i.RPC.ControlIHave.decode(l,l.uint32()));break;case 2:y.iwant&&y.iwant.length||(y.iwant=[]),y.iwant.push(i.RPC.ControlIWant.decode(l,l.uint32()));break;case 3:y.graft&&y.graft.length||(y.graft=[]),y.graft.push(i.RPC.ControlGraft.decode(l,l.uint32()));break;case 4:y.prune&&y.prune.length||(y.prune=[]),y.prune.push(i.RPC.ControlPrune.decode(l,l.uint32()));break;default:l.skipType(d&7);break}}return y},c.fromObject=function(l){if(l instanceof i.RPC.ControlMessage)return l;var h=new i.RPC.ControlMessage;if(l.ihave){if(!Array.isArray(l.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");h.ihave=[];for(var f=0;f<l.ihave.length;++f){if(typeof l.ihave[f]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");h.ihave[f]=i.RPC.ControlIHave.fromObject(l.ihave[f])}}if(l.iwant){if(!Array.isArray(l.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");h.iwant=[];for(var f=0;f<l.iwant.length;++f){if(typeof l.iwant[f]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");h.iwant[f]=i.RPC.ControlIWant.fromObject(l.iwant[f])}}if(l.graft){if(!Array.isArray(l.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");h.graft=[];for(var f=0;f<l.graft.length;++f){if(typeof l.graft[f]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");h.graft[f]=i.RPC.ControlGraft.fromObject(l.graft[f])}}if(l.prune){if(!Array.isArray(l.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");h.prune=[];for(var f=0;f<l.prune.length;++f){if(typeof l.prune[f]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");h.prune[f]=i.RPC.ControlPrune.fromObject(l.prune[f])}}return h},c.toObject=function(l,h){h||(h={});var f={};if((h.arrays||h.defaults)&&(f.ihave=[],f.iwant=[],f.graft=[],f.prune=[]),l.ihave&&l.ihave.length){f.ihave=[];for(var y=0;y<l.ihave.length;++y)f.ihave[y]=i.RPC.ControlIHave.toObject(l.ihave[y],h)}if(l.iwant&&l.iwant.length){f.iwant=[];for(var y=0;y<l.iwant.length;++y)f.iwant[y]=i.RPC.ControlIWant.toObject(l.iwant[y],h)}if(l.graft&&l.graft.length){f.graft=[];for(var y=0;y<l.graft.length;++y)f.graft[y]=i.RPC.ControlGraft.toObject(l.graft[y],h)}if(l.prune&&l.prune.length){f.prune=[];for(var y=0;y<l.prune.length;++y)f.prune[y]=i.RPC.ControlPrune.toObject(l.prune[y],h)}return f},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o.ControlIHave=function(){function c(l){if(this.messageIDs=[],l)for(var h=Object.keys(l),f=0;f<h.length;++f)l[h[f]]!=null&&(this[h[f]]=l[h[f]])}c.prototype.topicID=null,c.prototype.messageIDs=s.emptyArray;var u;return Object.defineProperty(c.prototype,"_topicID",{get:s.oneOfGetter(u=["topicID"]),set:s.oneOfSetter(u)}),c.encode=function(h,f){if(f||(f=n.create()),h.topicID!=null&&Object.hasOwnProperty.call(h,"topicID")&&f.uint32(10).string(h.topicID),h.messageIDs!=null&&h.messageIDs.length)for(var y=0;y<h.messageIDs.length;++y)f.uint32(18).bytes(h.messageIDs[y]);return f},c.decode=function(h,f){h instanceof t||(h=t.create(h));for(var y=f===void 0?h.len:h.pos+f,d=new i.RPC.ControlIHave;h.pos<y;){var p=h.uint32();switch(p>>>3){case 1:d.topicID=h.string();break;case 2:d.messageIDs&&d.messageIDs.length||(d.messageIDs=[]),d.messageIDs.push(h.bytes());break;default:h.skipType(p&7);break}}return d},c.fromObject=function(h){if(h instanceof i.RPC.ControlIHave)return h;var f=new i.RPC.ControlIHave;if(h.topicID!=null&&(f.topicID=String(h.topicID)),h.messageIDs){if(!Array.isArray(h.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");f.messageIDs=[];for(var y=0;y<h.messageIDs.length;++y)typeof h.messageIDs[y]=="string"?s.base64.decode(h.messageIDs[y],f.messageIDs[y]=s.newBuffer(s.base64.length(h.messageIDs[y])),0):h.messageIDs[y].length&&(f.messageIDs[y]=h.messageIDs[y])}return f},c.toObject=function(h,f){f||(f={});var y={};if((f.arrays||f.defaults)&&(y.messageIDs=[]),h.topicID!=null&&h.hasOwnProperty("topicID")&&(y.topicID=h.topicID,f.oneofs&&(y._topicID="topicID")),h.messageIDs&&h.messageIDs.length){y.messageIDs=[];for(var d=0;d<h.messageIDs.length;++d)y.messageIDs[d]=f.bytes===String?s.base64.encode(h.messageIDs[d],0,h.messageIDs[d].length):f.bytes===Array?Array.prototype.slice.call(h.messageIDs[d]):h.messageIDs[d]}return y},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o.ControlIWant=function(){function c(u){if(this.messageIDs=[],u)for(var l=Object.keys(u),h=0;h<l.length;++h)u[l[h]]!=null&&(this[l[h]]=u[l[h]])}return c.prototype.messageIDs=s.emptyArray,c.encode=function(l,h){if(h||(h=n.create()),l.messageIDs!=null&&l.messageIDs.length)for(var f=0;f<l.messageIDs.length;++f)h.uint32(10).bytes(l.messageIDs[f]);return h},c.decode=function(l,h){l instanceof t||(l=t.create(l));for(var f=h===void 0?l.len:l.pos+h,y=new i.RPC.ControlIWant;l.pos<f;){var d=l.uint32();switch(d>>>3){case 1:y.messageIDs&&y.messageIDs.length||(y.messageIDs=[]),y.messageIDs.push(l.bytes());break;default:l.skipType(d&7);break}}return y},c.fromObject=function(l){if(l instanceof i.RPC.ControlIWant)return l;var h=new i.RPC.ControlIWant;if(l.messageIDs){if(!Array.isArray(l.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");h.messageIDs=[];for(var f=0;f<l.messageIDs.length;++f)typeof l.messageIDs[f]=="string"?s.base64.decode(l.messageIDs[f],h.messageIDs[f]=s.newBuffer(s.base64.length(l.messageIDs[f])),0):l.messageIDs[f].length&&(h.messageIDs[f]=l.messageIDs[f])}return h},c.toObject=function(l,h){h||(h={});var f={};if((h.arrays||h.defaults)&&(f.messageIDs=[]),l.messageIDs&&l.messageIDs.length){f.messageIDs=[];for(var y=0;y<l.messageIDs.length;++y)f.messageIDs[y]=h.bytes===String?s.base64.encode(l.messageIDs[y],0,l.messageIDs[y].length):h.bytes===Array?Array.prototype.slice.call(l.messageIDs[y]):l.messageIDs[y]}return f},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o.ControlGraft=function(){function c(l){if(l)for(var h=Object.keys(l),f=0;f<h.length;++f)l[h[f]]!=null&&(this[h[f]]=l[h[f]])}c.prototype.topicID=null;var u;return Object.defineProperty(c.prototype,"_topicID",{get:s.oneOfGetter(u=["topicID"]),set:s.oneOfSetter(u)}),c.encode=function(h,f){return f||(f=n.create()),h.topicID!=null&&Object.hasOwnProperty.call(h,"topicID")&&f.uint32(10).string(h.topicID),f},c.decode=function(h,f){h instanceof t||(h=t.create(h));for(var y=f===void 0?h.len:h.pos+f,d=new i.RPC.ControlGraft;h.pos<y;){var p=h.uint32();switch(p>>>3){case 1:d.topicID=h.string();break;default:h.skipType(p&7);break}}return d},c.fromObject=function(h){if(h instanceof i.RPC.ControlGraft)return h;var f=new i.RPC.ControlGraft;return h.topicID!=null&&(f.topicID=String(h.topicID)),f},c.toObject=function(h,f){f||(f={});var y={};return h.topicID!=null&&h.hasOwnProperty("topicID")&&(y.topicID=h.topicID,f.oneofs&&(y._topicID="topicID")),y},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o.ControlPrune=function(){function c(l){if(this.peers=[],l)for(var h=Object.keys(l),f=0;f<h.length;++f)l[h[f]]!=null&&(this[h[f]]=l[h[f]])}c.prototype.topicID=null,c.prototype.peers=s.emptyArray,c.prototype.backoff=null;var u;return Object.defineProperty(c.prototype,"_topicID",{get:s.oneOfGetter(u=["topicID"]),set:s.oneOfSetter(u)}),Object.defineProperty(c.prototype,"_backoff",{get:s.oneOfGetter(u=["backoff"]),set:s.oneOfSetter(u)}),c.encode=function(h,f){if(f||(f=n.create()),h.topicID!=null&&Object.hasOwnProperty.call(h,"topicID")&&f.uint32(10).string(h.topicID),h.peers!=null&&h.peers.length)for(var y=0;y<h.peers.length;++y)i.RPC.PeerInfo.encode(h.peers[y],f.uint32(18).fork()).ldelim();return h.backoff!=null&&Object.hasOwnProperty.call(h,"backoff")&&f.uint32(24).uint64(h.backoff),f},c.decode=function(h,f){h instanceof t||(h=t.create(h));for(var y=f===void 0?h.len:h.pos+f,d=new i.RPC.ControlPrune;h.pos<y;){var p=h.uint32();switch(p>>>3){case 1:d.topicID=h.string();break;case 2:d.peers&&d.peers.length||(d.peers=[]),d.peers.push(i.RPC.PeerInfo.decode(h,h.uint32()));break;case 3:d.backoff=h.uint64();break;default:h.skipType(p&7);break}}return d},c.fromObject=function(h){if(h instanceof i.RPC.ControlPrune)return h;var f=new i.RPC.ControlPrune;if(h.topicID!=null&&(f.topicID=String(h.topicID)),h.peers){if(!Array.isArray(h.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");f.peers=[];for(var y=0;y<h.peers.length;++y){if(typeof h.peers[y]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");f.peers[y]=i.RPC.PeerInfo.fromObject(h.peers[y])}}return h.backoff!=null&&(s.Long?(f.backoff=s.Long.fromValue(h.backoff)).unsigned=!0:typeof h.backoff=="string"?f.backoff=parseInt(h.backoff,10):typeof h.backoff=="number"?f.backoff=h.backoff:typeof h.backoff=="object"&&(f.backoff=new s.LongBits(h.backoff.low>>>0,h.backoff.high>>>0).toNumber(!0))),f},c.toObject=function(h,f){f||(f={});var y={};if((f.arrays||f.defaults)&&(y.peers=[]),h.topicID!=null&&h.hasOwnProperty("topicID")&&(y.topicID=h.topicID,f.oneofs&&(y._topicID="topicID")),h.peers&&h.peers.length){y.peers=[];for(var d=0;d<h.peers.length;++d)y.peers[d]=i.RPC.PeerInfo.toObject(h.peers[d],f)}return h.backoff!=null&&h.hasOwnProperty("backoff")&&(typeof h.backoff=="number"?y.backoff=f.longs===String?String(h.backoff):h.backoff:y.backoff=f.longs===String?s.Long.prototype.toString.call(h.backoff):f.longs===Number?new s.LongBits(h.backoff.low>>>0,h.backoff.high>>>0).toNumber(!0):h.backoff,f.oneofs&&(y._backoff="backoff")),y},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o.PeerInfo=function(){function c(l){if(l)for(var h=Object.keys(l),f=0;f<h.length;++f)l[h[f]]!=null&&(this[h[f]]=l[h[f]])}c.prototype.peerID=null,c.prototype.signedPeerRecord=null;var u;return Object.defineProperty(c.prototype,"_peerID",{get:s.oneOfGetter(u=["peerID"]),set:s.oneOfSetter(u)}),Object.defineProperty(c.prototype,"_signedPeerRecord",{get:s.oneOfGetter(u=["signedPeerRecord"]),set:s.oneOfSetter(u)}),c.encode=function(h,f){return f||(f=n.create()),h.peerID!=null&&Object.hasOwnProperty.call(h,"peerID")&&f.uint32(10).bytes(h.peerID),h.signedPeerRecord!=null&&Object.hasOwnProperty.call(h,"signedPeerRecord")&&f.uint32(18).bytes(h.signedPeerRecord),f},c.decode=function(h,f){h instanceof t||(h=t.create(h));for(var y=f===void 0?h.len:h.pos+f,d=new i.RPC.PeerInfo;h.pos<y;){var p=h.uint32();switch(p>>>3){case 1:d.peerID=h.bytes();break;case 2:d.signedPeerRecord=h.bytes();break;default:h.skipType(p&7);break}}return d},c.fromObject=function(h){if(h instanceof i.RPC.PeerInfo)return h;var f=new i.RPC.PeerInfo;return h.peerID!=null&&(typeof h.peerID=="string"?s.base64.decode(h.peerID,f.peerID=s.newBuffer(s.base64.length(h.peerID)),0):h.peerID.length&&(f.peerID=h.peerID)),h.signedPeerRecord!=null&&(typeof h.signedPeerRecord=="string"?s.base64.decode(h.signedPeerRecord,f.signedPeerRecord=s.newBuffer(s.base64.length(h.signedPeerRecord)),0):h.signedPeerRecord.length&&(f.signedPeerRecord=h.signedPeerRecord)),f},c.toObject=function(h,f){f||(f={});var y={};return h.peerID!=null&&h.hasOwnProperty("peerID")&&(y.peerID=f.bytes===String?s.base64.encode(h.peerID,0,h.peerID.length):f.bytes===Array?Array.prototype.slice.call(h.peerID):h.peerID,f.oneofs&&(y._peerID="peerID")),h.signedPeerRecord!=null&&h.hasOwnProperty("signedPeerRecord")&&(y.signedPeerRecord=f.bytes===String?s.base64.encode(h.signedPeerRecord,0,h.signedPeerRecord.length):f.bytes===Array?Array.prototype.slice.call(h.signedPeerRecord):h.signedPeerRecord,f.oneofs&&(y._signedPeerRecord="signedPeerRecord")),y},c.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},c}(),o}(),i})})(_z);var NSe=_z.exports;const LSe=Et(NSe),{RPC:p9}=LSe,Xp=1e3,y9=60*Xp,QR="/floodsub/1.0.0",YR="/meshsub/1.0.0",Tz="/meshsub/1.1.0",MSe=6,USe=4,BSe=12,zSe=4,FSe=2,VSe=5,jSe=3,KSe=6,qSe=.25,HSe=3,XR=100,GSe=Xp,WSe=y9,QSe=16,YSe=y9,XSe=15,JSe=300,ZSe=Xp,eAe=60,tAe=2,rAe=10*Xp,xu=5e3,nAe=10,sAe=3*Xp,iAe=2*y9,oAe=120*1e3,aAe="ERR_TOPIC_VALIDATOR_REJECT",cAe="ERR_TOPIC_VALIDATOR_IGNORE",lAe=0,uAe=128,hAe=1e3,dAe=1e3;function jo(r){if(r.length<=1)return r;const e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){const n=e(),s=r[t];r[t]=r[n],r[n]=s}return r}function fAe(r){return R(r,"base64")}const Tg="StrictSign",g9="StrictNoSign";var ra;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(ra||(ra={}));var JR;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(JR||(JR={}));var Nh;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(Nh||(Nh={}));var eo;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(eo||(eo={}));var fs;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(fs||(fs={}));var Pi;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(Pi||(Pi={}));function ZR(r){switch(r){case ra.Ignore:return eo.Ignore;case ra.Reject:return eo.Reject}}async function pAe(r,e){switch(r){case Tg:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");const t=await ba(e.privateKey);return{type:Nh.Signing,author:e,key:e.publicKey,privateKey:t}}case g9:return{type:Nh.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}const St="ERR_INVALID_PEER_SCORE_PARAMS",yAe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},gAe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function wAe(r={}){return{...yAe,...r,topics:r.topics?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=bAe(n),e),{}):{}}}function bAe(r={}){return{...gAe,...r}}function mAe(r){for(const[e,t]of Object.entries(r.topics))try{EAe(t)}catch(n){throw new L(`invalid score parameters for topic ${e}: ${n.message}`,St)}if(r.topicScoreCap<0)throw new L("invalid topic score cap; must be positive (or 0 for no cap)",St);if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new L("missing application specific score function",St);if(r.IPColocationFactorWeight>0)throw new L("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",St);if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new L("invalid IPColocationFactorThreshold; must be at least 1",St);if(r.behaviourPenaltyWeight>0)throw new L("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",St);if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new L("invalid BehaviourPenaltyDecay; must be between 0 and 1",St);if(r.decayInterval<1e3)throw new L("invalid DecayInterval; must be at least 1s",St);if(r.decayToZero<=0||r.decayToZero>=1)throw new L("invalid DecayToZero; must be between 0 and 1",St)}function EAe(r){if(r.topicWeight<0)throw new L("invalid topic weight; must be >= 0",St);if(r.timeInMeshQuantum===0)throw new L("invalid TimeInMeshQuantum; must be non zero",St);if(r.timeInMeshWeight<0)throw new L("invalid TimeInMeshWeight; must be positive (or 0 to disable)",St);if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new L("invalid TimeInMeshQuantum; must be positive",St);if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new L("invalid TimeInMeshCap; must be positive",St);if(r.firstMessageDeliveriesWeight<0)throw new L("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",St);if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new L("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",St);if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new L("invalid FirstMessageDeliveriesCap; must be positive",St);if(r.meshMessageDeliveriesWeight>0)throw new L("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",St);if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new L("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",St);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new L("invalid MeshMessageDeliveriesCap; must be positive",St);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new L("invalid MeshMessageDeliveriesThreshold; must be positive",St);if(r.meshMessageDeliveriesWindow<0)throw new L("invalid MeshMessageDeliveriesWindow; must be non-negative",St);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new L("invalid MeshMessageDeliveriesActivation; must be at least 1s",St);if(r.meshFailurePenaltyWeight>0)throw new L("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",St);if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new L("invalid MeshFailurePenaltyDecay; must be between 0 and 1",St);if(r.invalidMessageDeliveriesWeight>0)throw new L("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",St);if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new L("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",St)}const vAe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function _Ae(r={}){return{...vAe,...r}}function SAe(r,e,t,n){let s=0;Object.entries(e.topics).forEach(([o,a])=>{const c=t.topics[o];if(c===void 0)return;let u=0;if(a.inMesh){let y=a.meshTime/c.timeInMeshQuantum;y>c.timeInMeshCap&&(y=c.timeInMeshCap),u+=y*c.timeInMeshWeight}let l=a.firstMessageDeliveries;if(l>c.firstMessageDeliveriesCap&&(l=c.firstMessageDeliveriesCap),u+=l*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){const y=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,d=y*y;u+=d*c.meshMessageDeliveriesWeight}const h=a.meshFailurePenalty;u+=h*c.meshFailurePenaltyWeight;const f=a.invalidMessageDeliveries*a.invalidMessageDeliveries;u+=f*c.invalidMessageDeliveriesWeight,s+=u*c.topicWeight}),t.topicScoreCap>0&&s>t.topicScoreCap&&(s=t.topicScoreCap);const i=t.appSpecificScore(r);if(s+=i*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;const a=n.get(o),c=a?a.size:0;if(c>t.IPColocationFactorThreshold){const u=c-t.IPColocationFactorThreshold,l=u*u;s+=l*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){const o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;s+=a*t.behaviourPenaltyWeight}return s}function or(r,t){var t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(r)&&this._fromArray(r)}or.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};or.prototype.get=function(e){return this.peekAt(e)};or.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};or.prototype.peekFront=function(){return this.peek()};or.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(or.prototype,"length",{get:function(){return this.size()}});or.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};or.prototype.unshift=function(e){if(e===void 0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};or.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};or.prototype.push=function(e){if(e===void 0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};or.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};or.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),s=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var i=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+s&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+s&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+s&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+s&this._capacityMask}return i}}};or.prototype.remove=function(e,t){var n=e,s,i=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return s=new Array(1),s[0]=this.removeOne(n),s;if(n===0&&n+t>=o)return s=this.toArray(),this.clear(),s;n+t>o&&(t=o-n);var c;for(s=new Array(t),c=0;c<t;c++)s[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;i>0;)this._list[n=n-1+a&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+a&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),s}}};or.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var s=this.size();if(n<0&&(n+=s),!(n>s))if(arguments.length>2){var i,o,a,c=arguments.length,u=this._list.length,l=2;if(!s||n<s/2){for(o=new Array(n),i=0;i<n;i++)o[i]=this._list[this._head+i&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+u&this._capacityMask);c>l;)this.unshift(arguments[--c]);for(i=n;i>0;i--)this.unshift(o[i-1])}else{o=new Array(s-(n+t));var h=o.length;for(i=0;i<h;i++)o[i]=this._list[this._head+n+t+i&this._capacityMask];for(t===0?(a=[],n!=s&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-h+u&this._capacityMask);l<c;)this.push(arguments[l++]);for(i=0;i<h;i++)this.push(o[i])}return a}else return this.remove(n,t)}};or.prototype.clear=function(){this._head=0,this._tail=0};or.prototype.isEmpty=function(){return this._head===this._tail};or.prototype.toArray=function(){return this._copyArray(!1)};or.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])};or.prototype._copyArray=function(e){var t=[],n=this._list,s=n.length,i;if(e||this._head>this._tail){for(i=this._head;i<s;i++)t.push(n[i]);for(i=0;i<this._tail;i++)t.push(n[i])}else for(i=this._head;i<this._tail;i++)t.push(n[i]);return t};or.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};or.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var AAe=or;const $Ae=Et(AAe);var ps;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(ps||(ps={}));class TAe{constructor(){this.records=new Map,this.queue=new $Ae}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:ps.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+oAe};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function K5(r,e,t=()=>!0){const n=new Set;if(e<=0)return n;for(const s of r){if(n.size>=e)break;t(s)&&(n.add(s),r.delete(s))}return n}function IAe(r,e){return K5(r,e,()=>!0)}class RAe extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return t===void 0&&(t=this.getDefault(),this.set(e,t)),t}}const Du=U("libp2p:gossipsub:score");class CAe{constructor(e,t,n){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new RAe(()=>new Set),this.scoreCache=new Map,this.deliveryRecords=new TAe,mAe(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??SAe}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){Du("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),Du("started")}stop(){if(!this._backgroundInterval){Du("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),Du("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,s)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(s,n.knownIPs),this.peerStats.delete(s),this.scoreCache.delete(s));return}Object.entries(n.topics).forEach(([i,o])=>{const a=this.params.topics[i];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const n=Date.now(),s=this.scoreCache.get(e);if(s&&s.cacheUntil>n)return s.score;this.metrics?.scoreFnRuns.inc();const i=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return s?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-s.score)),s.score=i,s.cacheUntil=o):this.scoreCache.set(e,{score:i,cacheUntil:o}),i}addPenalty(e,t,n){const s=this.peerStats.get(e);s&&(s.behaviourPenalty+=t,this.metrics?.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);n&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);n&&n.knownIPs.delete(t);const s=this.peerIPs.get(t);s&&(s.delete(e),s.size===0&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,s])=>{s.firstMessageDeliveries=0;const i=this.params.topics[n].meshMessageDeliveriesThreshold;if(s.inMesh&&s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){const o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.inMesh=!1,s.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n){const s=this.getPtopicStats(n,t);s&&(s.inMesh=!0,s.graftTime=Date.now(),s.meshTime=0,s.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n){const s=this.getPtopicStats(n,t);if(s){const i=this.params.topics[t].meshMessageDeliveriesThreshold;if(s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){const o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.meshMessageDeliveriesActive=!1,s.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const s=this.deliveryRecords.ensureRecord(t),i=Date.now();if(s.status!==ps.unknown){Du("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-s.firstSeen,ps[s.status]);return}s.status=ps.valid,s.validated=i,s.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,s){switch(s){case eo.Error:this.markInvalidMessageDelivery(e,n);return;case eo.Blacklisted:return}const i=this.deliveryRecords.ensureRecord(t);if(i.status!==ps.unknown){Du("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeen,ps[i.status]);return}if(s===eo.Ignore){i.status=ps.ignored,i.peers.clear();return}i.status=ps.invalid,this.markInvalidMessageDelivery(e,n),i.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),i.peers.clear()}duplicateMessage(e,t,n){const s=this.deliveryRecords.ensureRecord(t);if(!s.peers.has(e))switch(s.status){case ps.unknown:s.peers.add(e);break;case ps.valid:s.peers.add(e),this.markDuplicateMessageDelivery(e,n,s.validated);break;case ps.invalid:this.markInvalidMessageDelivery(e,n);break;case ps.ignored:break}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n){const s=this.getPtopicStats(n,t);s&&(s.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n){const s=this.getPtopicStats(n,t);if(s){let i=this.params.topics[t].firstMessageDeliveriesCap;s.firstMessageDeliveries=Math.min(i,s.firstMessageDeliveries+1),s.inMesh&&(i=this.params.topics[t].meshMessageDeliveriesCap,s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){const s=this.peerStats.get(e);if(s){const i=n!==void 0?Date.now():0,o=this.getPtopicStats(s,t);if(o&&o.inMesh){const a=this.params.topics[t];if(n!==void 0){const u=i-n,l=u>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,u,l),l)return}const c=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(c,o.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const s=this.peerIPs.get(n);s&&(s.delete(e),s.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}class xAe{constructor(e,t,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=Math.floor(Math.random()*t.length),s=t[n],i=this.msgIdToStrFn(s);let o=this.promises.get(i);o||(o=new Map,this.promises.set(i,o));const a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,a)))}getBrokenPromises(){const e=Date.now(),t=new Map;let n=0;return this.promises.forEach((s,i)=>{s.forEach((o,a)=>{o<e&&(t.set(a,(t.get(a)??0)+1),s.delete(a),n++)}),s.size||this.promises.delete(i)}),this.metrics?.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);const n=this.promises.get(e);n&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case eo.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[n,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(n),t++;else break;this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}class W6{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var eC;(function(r){r.forward="forward",r.publish="publish"})(eC||(eC={}));var ec;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(ec||(ec={}));var Ju;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Unsub="unsubscribed",r.Excess="excess"})(Ju||(Ju={}));var d1;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(d1||(d1={}));var f1;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(f1||(f1={}));var Zu;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(Zu||(Zu={}));function DAe(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:r.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:r.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:r.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),msgReceivedStatus:r.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,1*t.maxMeshMessageDeliveriesWindowSec,2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,1*t.behaviourPenaltyThreshold,2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,1*t.gossipPromiseExpireSec,2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,s,i){const o=this.toTopic(n);this.meshPeerInclusionEvents.inc({topic:o,reason:s},i)},onRemoveFromMesh(n,s,i){const o=this.toTopic(n);this.meshPeerChurnEvents.inc({topic:o,reason:s},i)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,s){const i=this.toTopic(n);this.asyncValidationResult.inc({topic:i,acceptance:s})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,s,i){const o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},s),this.ihaveRcvNotSeenMsgids.inc({topic:o},i)},onIwantRcv(n,s){for(const[i,o]of n){const a=this.toTopic(i);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(s)},onForwardMsg(n,s){const i=this.toTopic(n);this.msgForwardCount.inc({topic:i},1),this.msgForwardPeers.inc({topic:i},s)},onPublishMsg(n,s,i,o){const a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},i*o),this.msgPublishPeers.inc({topic:a},i),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"direct"},s.direct),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"floodsub"},s.floodsub),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"mesh"},s.mesh),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"fanout"},s.fanout)},onMsgRecvPreValidation(n){const s=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:s},1)},onMsgRecvError(n){const s=this.toTopic(n);this.msgReceivedError.inc({topic:s},1)},onMsgRecvResult(n,s){const i=this.toTopic(n);this.msgReceivedStatus.inc({topic:i,status:s})},onMsgRecvInvalid(n,s){const i=this.toTopic(n),o=s.reason===eo.Error?s.error:s.reason;this.msgReceivedInvalid.inc({topic:i,error:o},1)},onDuplicateMsgDelivery(n,s,i){if(this.duplicateMsgDeliveryDelay.observe(s/1e3),i){const o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onPublishDuplicateMsg(n){const s=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:s},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,s){this.rpcRecvBytes.inc(s),this.rpcRecvCount.inc(1),n.subscriptions&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages&&this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),n.control.ihave&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,s){if(this.rpcSentBytes.inc(s),this.rpcSentCount.inc(1),n.subscriptions&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages&&this.rpcSentMessage.inc(n.messages.length),n.control){const i=n.control.ihave?.length??0,o=n.control.iwant?.length??0,a=n.control.graft?.length??0,c=n.control.prune?.length??0;i>0&&this.rpcSentIHave.inc(i),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),c>0&&this.rpcSentPrune.inc(c),(i>0||o>0||a>0||c>0)&&this.rpcSentControl.inc(1)}},registerScores(n,s){let i=0,o=0,a=0,c=0;for(const u of n)u>=s.graylistThreshold&&i++,u>=s.publishThreshold&&o++,u>=s.gossipThreshold&&a++,u>=0&&c++;this.peersByScoreThreshold.set({threshold:Zu.graylist},i),this.peersByScoreThreshold.set({threshold:Zu.publish},o),this.peersByScoreThreshold.set({threshold:Zu.gossip},a),this.peersByScoreThreshold.set({threshold:Zu.mesh},c),this.score.set(n)},registerScoreWeights(n){for(const[s,i]of n.byTopic)this.scoreWeights.set({topic:s,p:"p1"},i.p1w),this.scoreWeights.set({topic:s,p:"p2"},i.p2w),this.scoreWeights.set({topic:s,p:"p3"},i.p3w),this.scoreWeights.set({topic:s,p:"p3b"},i.p3bw),this.scoreWeights.set({topic:s,p:"p4"},i.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,s){const i=new Map;n.forEach((o,a)=>{const c=this.topicStrToLabel.get(a)??"unknown";let u=i.get(c);u||(u=new Set,i.set(c,u)),o.forEach(l=>u?.add(l))});for(const[o,a]of i){const c=[];a.forEach(u=>{c.push(s.get(u)??0)}),this.scorePerMesh.set({topic:o},c)}}}}const tC={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function rC(r,e,t,n,s){if(s!=="sha1"&&s!=="sha2-256"&&s!=="sha2-512"){const a=Object.keys(tC).join(" / ");throw new L(`Hash '${s}' is unknown or not supported. Must be ${a}`,"ERR_UNSUPPORTED_HASH_TYPE")}const i=tC[s],o=Oq(r,e,t,n,i);return kq.encode64(o,null)}const Iz=M("libp2p-pubsub:");async function PAe(r,e,t,n){switch(r.type){case Nh.Signing:{const s={from:r.author.toBytes(),data:n,seqno:Pp(8),topic:e,signature:void 0,key:void 0},i=z([Iz,p9.Message.encode(s).finish()]);s.signature=await r.privateKey.sign(i),s.key=r.key;const o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${R(s.seqno,"base16")}`),topic:e,signature:s.signature,key:s.key};return{raw:s,msg:o}}case Nh.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}}}}async function OAe(r,e){switch(r){case g9:return e.signature!=null?{valid:!1,error:fs.SignaturePresent}:e.seqno!=null?{valid:!1,error:fs.SeqnoPresent}:e.key!=null?{valid:!1,error:fs.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case Tg:{if(e.seqno==null)return{valid:!1,error:fs.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:fs.InvalidSeqno};if(e.signature==null)return{valid:!1,error:fs.InvalidSignature};if(e.from==null)return{valid:!1,error:fs.InvalidPeerId};let t;try{t=No(e.from)}catch{return{valid:!1,error:fs.InvalidPeerId}}let n;if(e.key){if(n=Fl(e.key),t.publicKey!==void 0&&!Ie(n.bytes,t.publicKey))return{valid:!1,error:fs.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:fs.InvalidPeerId};n=Fl(t.publicKey)}const s={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},i=z([Iz,p9.Message.encode(s).finish()]);return await n.verify(i,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${R(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??HE(n)}}:{valid:!1,error:fs.InvalidSignature}}}}var kAe=Rz,nC=128,NAe=127,LAe=~NAe,MAe=Math.pow(2,31);function Rz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=MAe;)e[t++]=r&255|nC,r/=128;for(;r&LAe;)e[t++]=r&255|nC,r>>>=7;return e[t]=r|0,Rz.bytes=t-n+1,e}var UAe=q5,BAe=128,sC=127;function q5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw q5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&sC)<<s:(o&sC)*Math.pow(2,s),s+=7}while(o>=BAe);return q5.bytes=i-n,t}var zAe=Math.pow(2,7),FAe=Math.pow(2,14),VAe=Math.pow(2,21),jAe=Math.pow(2,28),KAe=Math.pow(2,35),qAe=Math.pow(2,42),HAe=Math.pow(2,49),GAe=Math.pow(2,56),WAe=Math.pow(2,63),QAe=function(r){return r<zAe?1:r<FAe?2:r<VAe?3:r<jAe?4:r<KAe?5:r<qAe?6:r<HAe?7:r<GAe?8:r<WAe?9:10},YAe={encode:kAe,decode:UAe,encodingLength:QAe},Cz=YAe;const iC=(r,e,t=0)=>(Cz.encode(r,e,t),e),oC=r=>Cz.encodingLength(r),aC=(r,e)=>{const t=e.byteLength,n=oC(r),s=n+oC(t),i=new Uint8Array(s+t);return iC(r,i,0),iC(t,i,n),i.set(e,s),new XAe(r,t,e,i)};let XAe=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const JAe=({name:r,code:e,encode:t})=>new ZAe(r,e,t);let ZAe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?aC(this.code,t):t.then(n=>aC(this.code,n))}else throw Error("Unknown type, must be binary type")}};const e$e=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),t$e=JAe({name:"sha2-256",code:18,encode:e$e("SHA-256")}),r$e=(r,e)=>{const t=M(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n};function n$e(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return r$e(r.from.toBytes(),r.sequenceNumber)}async function s$e(r){return await t$e.encode(r.data)}function i$e(r,e,t,n,s){let i=0;const o=new Map;if(Object.entries(e.topics).forEach(([f,y])=>{const d=s.get(f)??"unknown",p=t.topics[f];if(p===void 0)return;let b=o.get(d);b||(b={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(d,b));let w=0,S=0,E=0,m=0,v=0;if(y.inMesh){const $=Math.max(y.meshTime/p.timeInMeshQuantum,p.timeInMeshCap);w+=$*p.timeInMeshWeight}let A=y.firstMessageDeliveries;if(A>p.firstMessageDeliveriesCap&&(A=p.firstMessageDeliveriesCap),S+=A*p.firstMessageDeliveriesWeight,y.meshMessageDeliveriesActive&&y.meshMessageDeliveries<p.meshMessageDeliveriesThreshold){const $=p.meshMessageDeliveriesThreshold-y.meshMessageDeliveries,x=$*$;E+=x*p.meshMessageDeliveriesWeight}const g=y.meshFailurePenalty;m+=g*p.meshFailurePenaltyWeight;const _=y.invalidMessageDeliveries*y.invalidMessageDeliveries;v+=_*p.invalidMessageDeliveriesWeight,i+=(w+S+E+m+v)*p.topicWeight,b.p1w+=w,b.p2w+=S,b.p3w+=E,b.p3bw+=m,b.p4w+=v}),t.topicScoreCap>0&&i>t.topicScoreCap){i=t.topicScoreCap;const f=t.topicScoreCap/i;for(const y of o.values())y.p1w*=f,y.p2w*=f,y.p3w*=f,y.p3bw*=f,y.p4w*=f}let a=0,c=0,u=0;const l=t.appSpecificScore(r);a+=l*t.appSpecificWeight,e.knownIPs.forEach(f=>{if(t.IPColocationFactorWhitelist.has(f))return;const y=n.get(f),d=y?y.size:0;if(d>t.IPColocationFactorThreshold){const p=d-t.IPColocationFactorThreshold,b=p*p;c+=b*t.IPColocationFactorWeight}});const h=e.behaviourPenalty*e.behaviourPenalty;return u+=h*t.behaviourPenaltyWeight,i+=a+c+u,{byTopic:o,p5w:a,p6w:c,p7w:u,score:i}}function o$e(r,e,t,n,s){const i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of r){const a=e.get(o);if(a){const c=i$e(o,a,t,n,s);for(const[u,l]of c.byTopic){let h=i.byTopic.get(u);h||(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(u,h)),h.p1w.push(l.p1w),h.p2w.push(l.p2w),h.p3w.push(l.p3w),h.p3bw.push(l.p3bw),h.p4w.push(l.p4w)}i.p5w.push(c.p5w),i.p6w.push(c.p6w),i.p7w.push(c.p7w),i.score.push(c.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}let cC=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function xz(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new cC(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new cC(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}function a$e(r){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}const Vb=r=>{const e=Jt.encodingLength(r),t=a$e(e);return Jt.encode(r,t),Vb.bytes=e,t};Vb.bytes=0;function Dz(r){r=r??{};const e=r.lengthEncoder??Vb;return async function*(n){for await(const s of n){const i=e(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}}}Dz.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??Vb;return new Se(t(r.byteLength),r)};const c$e=8,l$e=1024*1024*4;var cl;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(cl||(cl={}));const w9=r=>{const e=Jt.decode(r);return w9.bytes=Jt.encodingLength(e),e};w9.bytes=0;function H5(r){return async function*(t){const n=new Se;let s=cl.LENGTH,i=-1;const o=r?.lengthDecoder??w9,a=r?.maxLengthLength??c$e,c=r?.maxDataLength??l$e;for await(const u of t)for(n.append(u);n.byteLength>0;){if(s===cl.LENGTH)try{if(i=o(n),i<0)throw T(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>c)throw T(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const l=o.bytes;n.consume(l),r?.onLength!=null&&r.onLength(i),s=cl.DATA}catch(l){if(l instanceof RangeError){if(n.byteLength>a)throw T(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(s===cl.DATA){if(n.byteLength<i)break;const l=n.sublist(0,i);n.consume(i),r?.onData!=null&&r.onData(l),yield l,s=cl.LENGTH}}if(n.byteLength>0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}H5.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return H5({...e??{},onLength:i=>{t=i}})(n)};class u$e{constructor(e,t,n){this.rawStream=e,this.pushable=$r({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,Ve(xz(this.pushable,this.closeController.signal,{returnOnAbort:!0}),Dz(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class h$e{constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=xz(Ve(this.rawStream,H5(t)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var d$e=$z();const f$e=Et(d$e),p$e={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function y$e(r,e){e={...e};const t=f$e.Reader.create(r),n=r.length,s=n===void 0?t.len:t.pos+n,i={};for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.length<e.maxSubscriptions?i.subscriptions.push(g$e(t,t.uint32())):t.skipType(o&7);break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.length<e.maxMessages?i.messages.push(w$e(t,t.uint32())):t.skipType(o&7);break;case 3:i.control=b$e(t,t.uint32(),e);break;default:t.skipType(o&7);break}}return i}function g$e(r,e){const t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){const s=r.uint32();switch(s>>>3){case 1:n.subscribe=r.bool();break;case 2:n.topic=r.string();break;default:r.skipType(s&7);break}}return n}function w$e(r,e){const t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){const s=r.uint32();switch(s>>>3){case 1:n.from=r.bytes();break;case 2:n.data=r.bytes();break;case 3:n.seqno=r.bytes();break;case 4:n.topic=r.string();break;case 5:n.signature=r.bytes();break;case 6:n.key=r.bytes();break;default:r.skipType(s&7);break}}if(!n.topic)throw Error("missing required 'topic'");return n}function b$e(r,e,t){const n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){const i=r.uint32();switch(i>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.length<t.maxControlMessages?s.ihave.push(m$e(r,r.uint32(),t)):r.skipType(i&7);break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.length<t.maxControlMessages?s.iwant.push(E$e(r,r.uint32(),t)):r.skipType(i&7);break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.length<t.maxControlMessages?s.graft.push(v$e(r,r.uint32())):r.skipType(i&7);break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.length<t.maxControlMessages?s.prune.push(_$e(r,r.uint32(),t)):r.skipType(i&7);break;default:r.skipType(i&7);break}}return s}function m$e(r,e,t){const n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){const i=r.uint32();switch(i>>>3){case 1:s.topicID=r.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),t.maxIhaveMessageIDs-- >0?s.messageIDs.push(r.bytes()):r.skipType(i&7);break;default:r.skipType(i&7);break}}return s}function E$e(r,e,t){const n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){const i=r.uint32();switch(i>>>3){case 1:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),t.maxIwantMessageIDs-- >0?s.messageIDs.push(r.bytes()):r.skipType(i&7);break;default:r.skipType(i&7);break}}return s}function v$e(r,e){const t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){const s=r.uint32();switch(s>>>3){case 1:n.topicID=r.string();break;default:r.skipType(s&7);break}}return n}function _$e(r,e,t){const n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){const i=r.uint32();switch(i>>>3){case 1:s.topicID=r.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),t.maxPeerInfos-- >0?s.peers.push(S$e(r,r.uint32())):r.skipType(i&7);break;case 3:s.backoff=r.uint64();break;default:r.skipType(i&7);break}}return s}function S$e(r,e){const t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){const s=r.uint32();switch(s>>>3){case 1:n.peerID=r.bytes();break;case 2:n.signedPeerRecord=r.bytes();break;default:r.skipType(s&7);break}}return n}var Ig;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(Ig||(Ig={}));function A$e(r){for(const e of r.tuples())switch(e[0]){case Ig.ip4:case Ig.ip6:return jv(e[0],e[1])}return null}var Ss;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(Ss||(Ss={}));class Pz extends Zt{constructor(e,t={}){super(),this.multicodecs=[Tz,YR],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=$r({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:Ss.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{const s=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{if(s?.(),this.status.code===Ss.started){clearTimeout(this.status.heartbeatTimeout);let i=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;i<this.opts.heartbeatInterval*.25&&(i+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,i)}})};const n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:MSe,Dlo:USe,Dhi:BSe,Dscore:zSe,Dout:FSe,Dlazy:KSe,heartbeatInterval:GSe,fanoutTTL:WSe,mcacheLength:VSe,mcacheGossip:jSe,seenTTL:iAe,gossipsubIWantFollowupMs:sAe,prunePeers:QSe,pruneBackoff:YSe,graftFloodThreshold:rAe,opportunisticGraftPeers:tAe,opportunisticGraftTicks:eAe,directConnectTicks:JSe,...t,scoreParams:wAe(t.scoreParams),scoreThresholds:_Ae(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??p$e,this.globalSignaturePolicy=n.globalSignaturePolicy??Tg,n.fallbackToFloodsub&&this.multicodecs.push(QR),this.log=U(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map(s=>s.id.toString())),this.seenCache=new W6({validityMs:n.seenTTL}),this.publishedMessageIds=new W6({validityMs:n.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Tg:this.msgIdFn=n$e;break;case g9:this.msgIdFn=s$e;break}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new W6({validityMs:n.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??fAe,this.mcache=t.messageCache||new ISe(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const s=Math.max(...Object.values(n.scoreParams.topics).map(o=>o.meshMessageDeliveriesWindow),dAe),i=DAe(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});i.mcacheSize.addCollect(()=>this.onScrapeMetrics(i));for(const o of this.multicodecs)i.protocolsEnabled.set({protocol:o},1);this.metrics=i}else this.metrics=null;this.gossipTracer=new xAe(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new CAe(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=n.allowedTopics?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(e=>Ae(e))}isStarted(){return this.status.code===Ss.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await pAe(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=$r({objectMode:!0}),Ve(this.outboundInflightQueue,async i=>{for await(const{peerId:o,connection:a}of i)await this.createOutboundStream(o,a)}).catch(i=>this.log.error("outbound inflight queue error",i)),await Promise.all(this.opts.directPeers.map(async i=>{await this.components.peerStore.addressBook.add(i.id,i.addrs)}));const e=this.components.registrar;await Promise.all(this.multicodecs.map(i=>e.handle(i,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));const t=f9({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map(i=>e.register(i,t))),s=setTimeout(this.runHeartbeat,XR);this.status={code:Ss.started,registrarTopologyIds:n,heartbeatTimeout:s,hearbeatStartMs:Date.now()+XR},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async i=>await this.connect(i)))}).catch(i=>{this.log(i)})},ZSe),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Ss.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:Ss.stopped};const t=this.components.registrar;e.forEach(n=>t.unregister(n)),this.outboundInflightQueue.end();for(const n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(const n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const n=t.remotePeer;this.addPeer(n,t.stat.direction,t.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.stat.status}),!(!this.isStarted()||t.stat.status!=="OPEN")&&(this.addPeer(e,t.stat.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{const s=new u$e(await t.newStream(this.multicodecs),o=>this.log.error("outbound pipe error",o),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,s);const i=s.protocol;i===QR&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(s){this.log.error("createOutboundStream error",s)}}async createInboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(!this.peers.has(n))return;const s=this.streamsInbound.get(n);s!==void 0&&(this.log("replacing existing inbound steam %s",n),s.close()),this.log("create inbound stream %s",n);const i=new h$e(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,i),this.pipePeerReadStream(e,i.source).catch(o=>this.log(o))}addPeer(e,t,n){const s=e.toString();if(!this.peers.has(s)){this.log("new peer %p",e),this.peers.add(s),this.score.addPeer(s);const i=A$e(n);i!==null?this.score.addIP(s,i):this.log("Added peer has no IP in current address %s %s",s,n.toString()),this.outbound.has(s)||this.outbound.set(s,t==="outbound")}}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const n=this.streamsOutbound.get(t),s=this.streamsInbound.get(t);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),s?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const i of this.topics.values())i.delete(t);for(const[i,o]of this.mesh)o.delete(t)===!0&&this.metrics?.onRemoveFromMesh(i,Ju.Dc,1);for(const i of this.fanout.values())i.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===Ss.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map(n=>Ae(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await Ve(t,async n=>{for await(const s of n)try{const i=s.subarray(),o=y$e(i,this.decodeRpcLimits);if(this.metrics?.onRpcRecv(o,i.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,o)}catch(a){this.metrics?.onRpcRecvError(),this.log(a)}else this.handleReceivedRpc(e,o).catch(a=>{this.metrics?.onRpcRecvError(),this.log(a)})}catch(i){this.metrics?.onRpcDataError(),this.log(i)}})}catch(n){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(n,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}const n=t.subscriptions?t.subscriptions.length:0,s=t.messages?t.messages.length:0;let i=0,o=0,a=0,c=0;if(t.control&&(t.control.ihave&&(i=t.control.ihave.length),t.control.iwant&&(o=t.control.iwant.length),t.control.graft&&(a=t.control.graft.length),t.control.prune&&(c=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${n} messages ${s} ihave ${i} iwant ${o} graft ${a} prune ${c}`),t.subscriptions&&t.subscriptions.length>0){const u=[];t.subscriptions.forEach(l=>{const h=l.topic,f=l.subscribe===!0;if(h!=null){if(this.allowedTopics&&!this.allowedTopics.has(h))return;this.handleReceivedSubscription(e,h,f),u.push({topic:h,subscribe:f})}}),this.dispatchEvent(new oe("subscription-change",{detail:{peerId:e,subscriptions:u}}))}if(t.messages)for(const u of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(u.topic))continue;const l=this.handleReceivedMessage(e,u).catch(h=>{this.metrics?.onMsgRecvError(u.topic),this.log(h)});this.opts.awaitRpcMessageHandler&&await l}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,n){this.log("subscription update from %p topic %s",e,t);let s=this.topics.get(t);s==null&&(s=new Set,this.topics.set(t,s)),n?s.add(e.toString()):s.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const n=await this.validateReceivedMessage(e,t);switch(this.metrics?.onMsgRecvResult(t.topic,n.code),n.code){case Pi.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,t.topic),this.gossipTracer.deliverMessage(n.msgIdStr,!0),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case Pi.invalid:if(n.msgIdStr){const s=n.msgIdStr;this.score.rejectMessage(e.toString(),s,t.topic,n.reason),this.gossipTracer.rejectMessage(s,n.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);this.metrics?.onMsgRecvInvalid(t.topic,n);return;case Pi.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new oe("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new oe("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const n=this.fastMsgIdFn?.(t),s=n!==void 0?this.fastMsgIdCache?.get(n):void 0;if(s)return{code:Pi.duplicate,msgIdStr:s};const i=await OAe(this.globalSignaturePolicy,t);if(!i.valid)return{code:Pi.invalid,reason:eo.Error,error:i.error};const o=i.message;try{this.dataTransform&&(o.data=this.dataTransform.inboundTransform(t.topic,o.data))}catch(h){return this.log("Invalid message, transform failed",h),{code:Pi.invalid,reason:eo.Error,error:fs.TransformFailed}}const a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u={msgId:a,msgIdStr:c};if(n!==void 0&&this.fastMsgIdCache&&this.fastMsgIdCache.put(n,c)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(c))return{code:Pi.duplicate,msgIdStr:c};this.seenCache.put(c);const l=this.topicValidators.get(t.topic);if(l!=null){let h;try{h=await l(e,o)}catch(f){const y=f.code;y===cAe&&(h=ra.Ignore),y===aAe?h=ra.Reject:h=ra.Ignore}if(h!==ra.Accept)return{code:Pi.invalid,reason:ZR(h),msgIdStr:c}}return{code:Pi.valid,messageId:u,msg:o}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map(s=>({topic:s,subscribe:n}))})}async handleControlMessage(e,t){if(t===void 0)return;const n=t.ihave?this.handleIHave(e,t.ihave):[],s=t.iwant?this.handleIWant(e,t.iwant):[],i=t.graft?await this.handleGraft(e,t.graft):[];if(t.prune&&await this.handlePrune(e,t.prune),!n.length&&!s.length&&!i.length)return;const o=this.sendRpc(e,{messages:s,control:{iwant:n,prune:i}}),a=n[0]?.messageIDs;a&&(o?this.gossipTracer.addPromise(e,a):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<uAe&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;const s=this.score.score(e);return s>=lAe?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+hAe}):this.acceptFromWhitelist.delete(e),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:f1.LowScore}),[];const s=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,s),s>nAe)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:f1.MaxIhave}),[];const i=this.iasked.get(e)??0;if(i>=xu)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:f1.MaxIasked}),[];const o=new Map;if(t.forEach(({topicID:u,messageIDs:l})=>{if(!u||!l||!this.mesh.has(u))return;let h=0;l.forEach(f=>{const y=this.msgIdToStrFn(f);this.seenCache.has(y)||(o.set(y,f),h++)}),this.metrics?.onIhaveRcv(u,l.length,h)}),!o.size)return[];let a=o.size;a+i>xu&&(a=xu-i),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let c=Array.from(o.values());return jo(c),c=c.slice(0,a),this.iasked.set(e,i+a),[{messageIDs:c}]}handleIWant(e,t){if(!t.length)return[];const n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];const s=new Map,i=new Map;let o=0;return t.forEach(({messageIDs:a})=>{a&&a.forEach(c=>{const u=this.msgIdToStrFn(c),l=this.mcache.getWithIWantCount(u,e);if(l==null){o++;return}if(i.set(l.msg.topic,1+(i.get(l.msg.topic)??0)),l.count>HSe){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,c);return}s.set(u,l.msg)})}),this.metrics?.onIwantRcv(i,o),s.size?(this.log("IWANT: Sending %d messages to %s",s.size,e),Array.from(s.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const n=[],s=this.score.score(e),i=Date.now();let o=this.opts.doPX;return t.forEach(({topicID:a})=>{if(!a)return;const c=this.mesh.get(a);if(!c){o=!1;return}if(c.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),o=!1;return}const u=this.backoff.get(a)?.get(e);if(typeof u=="number"&&i<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,d1.GraftBackoff),o=!1;const l=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;i<l&&this.score.addPenalty(e,1,d1.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(s<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,s,a),n.push(a),o=!1,this.addBackoff(e,a);return}if(c.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),c.add(e),this.metrics?.onAddToMesh(a,ec.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,o))):[]}async handlePrune(e,t){const n=this.score.score(e);for(const{topicID:s,backoff:i,peers:o}of t){if(s==null)continue;const a=this.mesh.get(s);if(!a)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,s),this.score.prune(e,s),a.has(e)&&(a.delete(e),this.metrics?.onRemoveFromMesh(s,Ju.Unsub,1)),typeof i=="number"&&i>0?this.doAddBackoff(e,s,i*1e3):this.addBackoff(e,s),o&&o.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,s);continue}await this.pxConnect(o)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){let s=this.backoff.get(t);s||(s=new Map,this.backoff.set(t,s));const i=Date.now()+n;(s.get(e)??0)<i&&s.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,d1.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%XSe!==0)return;const e=Date.now();this.backoff.forEach((t,n)=>{t.forEach((s,i)=>{s<e&&t.delete(i)}),t.size===0&&this.backoff.delete(n)})}async directConnect(){const e=[];this.direct.forEach(t=>{this.streamsOutbound.has(t)||e.push(t)}),await Promise.all(e.map(async t=>await this.connect(t)))}async pxConnect(e){e.length>this.opts.prunePeers&&(jo(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;const s=No(n.peerID).toString();if(!this.peers.has(s)){if(!n.signedPeerRecord){t.push(s);return}try{const i=await fa.openAndCertify(n.signedPeerRecord,"libp2p-peer-record"),o=i.peerId;if(!i.peerId.equals(s)){this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",o,s);return}if(!await this.components.peerStore.addressBook.consumePeerRecord(i)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}t.push(s)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),t.length&&await Promise.all(t.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);const t=Ae(e),n=await this.components.connectionManager.openConnection(t);for(const s of this.multicodecs)for(const i of this.components.registrar.getTopologies(s))i.onConnect(t,n)}subscribe(e){if(this.status.code!==Ss.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Ss.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){if(this.status.code!==Ss.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(s=>{!this.direct.has(s)&&this.score.score(s)>=0&&t.add(s)}),this.metrics?.onAddToMesh(e,ec.Fanout,t.size)),t.size<this.opts.D){const s=t.size;this.getRandomGossipPeers(e,this.opts.D,o=>!t.has(o)&&!this.direct.has(o)&&this.score.score(o)>=0).forEach(o=>{t.add(o)}),this.metrics?.onAddToMesh(e,ec.Random,t.size-s)}this.mesh.set(e,t),t.forEach(s=>{this.log("JOIN: Add mesh link to %s in %s",s,e),this.sendGraft(s,e)})}leave(e){if(this.status.code!==Ss.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map(async n=>(this.log("LEAVE: Remove mesh link to %s in %s",n,e),await this.sendPrune(n,e)))).catch(n=>{this.log("Error sending prunes to mesh peers",n)}),this.mesh.delete(e))}selectPeersToForward(e,t,n){const s=new Set,i=this.topics.get(e);i&&(this.direct.forEach(a=>{i.has(a)&&t!==a&&!n?.has(a)&&s.add(a)}),this.floodsubPeers.forEach(a=>{i.has(a)&&t!==a&&!n?.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&s.add(a)}));const o=this.mesh.get(e);return o&&o.size>0&&o.forEach(a=>{t!==a&&!n?.has(a)&&s.add(a)}),s}selectPeersToPublish(e){const t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(e);if(s)if(this.opts.floodPublish)s.forEach(i=>{this.direct.has(i)?(t.add(i),n.direct++):this.score.score(i)>=this.opts.scoreThresholds.publishThreshold&&(t.add(i),n.floodsub++)});else{this.direct.forEach(o=>{s.has(o)&&(t.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{s.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(t.add(o),n.floodsub++)});const i=this.mesh.get(e);if(i&&i.size>0)i.forEach(o=>{t.add(o),n.mesh++});else{const o=this.fanout.get(e);if(o&&o.size>0)o.forEach(a=>{t.add(a),n.fanout++});else{const a=this.getRandomGossipPeers(e,this.opts.D,c=>this.score.score(c)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(c=>{t.add(c),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,s){n&&this.score.deliverMessage(n,e,t.topic);const i=this.selectPeersToForward(t.topic,n,s);i.forEach(o=>{this.sendRpc(o,{messages:[t]})}),this.metrics?.onForwardMsg(t.topic,i.size)}async publish(e,t,n){const s=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:i,msg:o}=await PAe(this.publishConfig,e,t,s),a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u=n?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(u)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:l,tosendCount:h}=this.selectPeersToPublish(e),f=this.opts.emitSelf===!0&&this.subscriptions.has(e),y=n?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(l.size===0&&!y&&!f)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},i,!0),this.publishedMessageIds.put(c);for(const d of l)this.sendRpc(d,{messages:[i]})||l.delete(d);return this.metrics?.onPublishMsg(e,h,l.size,i.data!=null?i.data.length:0),f&&(l.add(this.components.peerId.toString()),super.dispatchEvent(new oe("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:o}})),super.dispatchEvent(new oe("message",{detail:o}))),{recipients:Array.from(l.values()).map(d=>Ae(d))}}reportMessageValidationResult(e,t,n){if(n===ra.Accept){const s=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(s!==null),s!=null){const{message:i,originatingPeers:o}=s;this.score.deliverMessage(t.toString(),e,i.topic),this.forwardMessage(e,s.message,t.toString(),o),this.metrics?.onReportValidation(i.topic,n)}}else{const s=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(s!==null),s){const i=ZR(n),{message:o,originatingPeers:a}=s;this.score.rejectMessage(t.toString(),e,o.topic,i);for(const c of a)this.score.rejectMessage(c,e,o.topic,i);this.metrics?.onReportValidation(o.topic,n)}}}sendGraft(e,t){const n=[{topicID:t}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,t){const n=[await this.makePrune(e,t,this.opts.doPX)];this.sendRpc(e,{control:{prune:n}})}sendRpc(e,t){const n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const s=this.control.get(e);s&&(this.piggybackControl(e,t,s),this.control.delete(e));const i=this.gossip.get(e);i&&(this.piggybackGossip(e,t,i),this.gossip.delete(e));const o=p9.encode(t).finish();try{n.push(o)}catch(a){return this.log.error(`Cannot send rpc to ${e}`,a),s&&this.control.set(e,s),i&&this.gossip.set(e,i),!1}return this.metrics?.onRpcSent(t,o.length),!0}piggybackControl(e,t,n){if(n.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(const s of n.graft)s.topicID&&this.mesh.get(s.topicID)?.has(e)&&t.control.graft.push(s)}if(n.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(const s of n.prune)s.topicID&&!this.mesh.get(s.topicID)?.has(e)&&t.control.prune.push(s)}}piggybackGossip(e,t,n){t.control||(t.control={}),t.control.ihave=n}async sendGraftPrune(e,t,n){const s=this.opts.doPX;for(const[i,o]of e){const a=o.map(l=>({topicID:l}));let c=[];const u=t.get(i);u&&(c=await Promise.all(u.map(async l=>await this.makePrune(i,l,s&&!(n.get(i)??!1)))),t.delete(i)),this.sendRpc(i,{control:{graft:a,prune:c}})}for(const[i,o]of t){const a=await Promise.all(o.map(async c=>await this.makePrune(i,c,s&&!(n.get(i)??!1))));this.sendRpc(i,{control:{prune:a}})}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[n,s]of e)this.doEmitGossip(n,s,t.get(n)??[])}doEmitGossip(e,t,n){if(!n.length||(jo(n),n.length>xu&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!t.size))return;let s=this.opts.Dlazy;const i=qSe*t.size;let o=t;i>s&&(s=i),s>o.size?s=o.size:o=jo(Array.from(o)).slice(0,s),o.forEach(a=>{let c=n;n.length>xu&&(c=jo(c.slice()).slice(0,xu)),this.pushGossip(a,{topicID:e,messageIDs:c})})}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);const n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(t))}async makePrune(e,t,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===YR)return{topicID:t,peers:[]};const s=this.opts.pruneBackoff/1e3;if(!n)return{topicID:t,peers:[],backoff:s};const i=this.getRandomGossipPeers(t,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),o=await Promise.all(Array.from(i).map(async a=>{const c=Ae(a);return{peerID:c.toBytes(),signedPeerRecord:await this.components.peerStore.addressBook.getRawEnvelope(c)}}));return{topicID:t,peers:o,backoff:s}}async heartbeat(){const{D:e,Dlo:t,Dhi:n,Dscore:s,Dout:i,fanoutTTL:o}=this.opts;this.heartbeatTicks++;const a=new Map,c=d=>{let p=a.get(d);return p===void 0&&(p=this.score.score(d),a.set(d,p)),p},u=new Map,l=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const f=new Map;this.mesh.forEach((d,p)=>{const b=this.topics.get(p),w=new Set,S=new Set;if(f.set(p,S),b){const v=jo(Array.from(b)),A=this.backoff.get(p);for(const g of v){const _=this.streamsOutbound.get(g);if(_&&this.multicodecs.includes(_.protocol)&&!d.has(g)&&!this.direct.has(g)){const $=c(g);(!A||!A.has(g))&&$>=0&&w.add(g),$>=this.opts.scoreThresholds.gossipThreshold&&S.add(g)}}}const E=(v,A)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",v,p),this.addBackoff(v,p),d.delete(v),c(v)>=this.opts.scoreThresholds.gossipThreshold&&S.add(v),this.metrics?.onRemoveFromMesh(p,A,1);const g=l.get(v);g?g.push(p):l.set(v,[p])},m=(v,A)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",v,p),this.score.graft(v,p),d.add(v),S.delete(v),this.metrics?.onAddToMesh(p,A,1);const g=u.get(v);g?g.push(p):u.set(v,[p])};if(d.forEach(v=>{const A=c(v);A<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",v,A,p),E(v,Ju.BadScore),h.set(v,!0))}),d.size<t){const v=e-d.size;IAe(w,v).forEach(g=>{m(g,ec.NotEnough)})}if(d.size>n){let v=Array.from(d);v.sort((g,_)=>c(_)-c(g)),v=v.slice(0,s).concat(jo(v.slice(s)));let A=0;if(v.slice(0,e).forEach(g=>{this.outbound.get(g)&&A++}),A<i){const g=$=>{const x=v[$];for(let k=$;k>0;k--)v[k]=v[k-1];v[0]=x};if(A>0){let $=A;for(let x=1;x<e&&$>0;x++)this.outbound.get(v[x])&&(g(x),$--)}let _=e-A;for(let $=e;$<v.length&&_>0;$++)this.outbound.get(v[$])&&(g($),_--)}v.slice(e).forEach(g=>{E(g,Ju.Excess)})}if(d.size>=t){let v=0;if(d.forEach(A=>{this.outbound.get(A)&&v++}),v<i){const A=i-v;K5(w,A,_=>this.outbound.get(_)===!0).forEach(_=>{m(_,ec.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&d.size>1){const v=Array.from(d).sort((_,$)=>c(_)-c($)),A=Math.floor(d.size/2),g=c(v[A]);if(g<this.opts.scoreThresholds.opportunisticGraftThreshold){const _=this.opts.opportunisticGraftPeers,$=K5(w,_,x=>c(x)>g);for(const x of $)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",x,p),m(x,ec.Opportunistic)}}});const y=Date.now();this.fanoutLastpub.forEach((d,p)=>{d+o<y&&(this.fanout.delete(p),this.fanoutLastpub.delete(p))}),this.fanout.forEach((d,p)=>{const b=this.topics.get(p);d.forEach(m=>{(!b.has(m)||c(m)<this.opts.scoreThresholds.publishThreshold)&&d.delete(m)});const w=this.topics.get(p),S=[],E=new Set;if(f.set(p,E),w){const m=jo(Array.from(w));for(const v of m){const A=this.streamsOutbound.get(v);if(A&&this.multicodecs.includes(A.protocol)&&!d.has(v)&&!this.direct.has(v)){const g=c(v);g>=this.opts.scoreThresholds.publishThreshold&&S.push(v),g>=this.opts.scoreThresholds.gossipThreshold&&E.add(v)}}}if(d.size<e){const m=e-d.size;S.slice(0,m).forEach(v=>{d.add(v),E?.delete(v)})}}),this.emitGossip(f),await this.sendGraftPrune(u,l,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new oe("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,n=()=>!0){const s=this.topics.get(e);if(!s)return new Set;let i=[];return s.forEach(o=>{const a=this.streamsOutbound.get(o);a&&this.multicodecs.includes(a.protocol)&&n(o)&&i.push(o)}),i=jo(i),t>0&&i.length>t&&(i=i.slice(0,t)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(const o of this.backoff.values())t+=o.size;e.cacheSize.set({cache:"backoff"},t);for(const[o,a]of this.topics)e.topicPeersCount.set({topicStr:o},a.size);for(const[o,a]of this.mesh)e.meshPeerCounts.set({topicStr:o},a.size);const n=[],s=new Map;e.behaviourPenalty.reset();for(const o of this.peers.keys()){const a=this.score.score(o);n.push(a),s.set(o,a),e.behaviourPenalty.observe(this.score.peerStats.get(o)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,s);const i=o$e(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(i)}}Pz.multicodec=Tz;function $$e(r={}){return e=>new Pz(e,r)}const T$e=()=>({gossipsub:$$e({fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128})});function I$e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var R$e=I$e,C$e=R$e;const x$e=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};let D$e=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},P$e=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Oz(this,e)}},O$e=class{constructor(e){this.decoders=e}or(e){return Oz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Oz=(r,e)=>new O$e({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let k$e=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new D$e(e,t,n),this.decoder=new P$e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const kz=({name:r,prefix:e,encode:t,decode:n})=>new k$e(r,e,t,n),Nz=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=C$e(t,e);return kz({prefix:r,name:e,encode:n,decode:i=>x$e(s(i))})},N$e=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},L$e=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ns=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>kz({prefix:e,name:r,encode(s){return L$e(s,n,t)},decode(s){return N$e(s,n,t,r)}}),M$e=Ns({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ns({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ns({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ns({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ns({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ns({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ns({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ns({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ns({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const U$e=Nz({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Nz({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const B$e=Ns({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Ns({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Ns({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Ns({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});_e.formatters.b=r=>r==null?"undefined":U$e.baseEncode(r);_e.formatters.t=r=>r==null?"undefined":M$e.baseEncode(r);_e.formatters.m=r=>r==null?"undefined":B$e.baseEncode(r);_e.formatters.p=r=>r==null?"undefined":r.toString();_e.formatters.c=r=>r==null?"undefined":r.toString();_e.formatters.k=r=>r==null?"undefined":r.toString();_e.formatters.a=r=>r==null?"undefined":r.toString();function z$e(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function F$e(r){let e=z$e(`${r}:trace`);return _e.enabled(`${r}:trace`)&&_e.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=_e(`${r}:trace`)),Object.assign(_e(r),{error:_e(`${r}:error`),trace:e})}const V$e=Symbol.for("@libp2p/peer-id");function j$e(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var K$e=j$e,q$e=K$e;const H$e=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},jb=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},G$e=r=>new TextEncoder().encode(r),W$e=r=>new TextDecoder().decode(r);let Q$e=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Y$e=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Lz(this,e)}},X$e=class{constructor(e){this.decoders=e}or(e){return Lz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Lz=(r,e)=>new X$e({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let J$e=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Q$e(e,t,n),this.decoder=new Y$e(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Kb=({name:r,prefix:e,encode:t,decode:n})=>new J$e(r,e,t,n),Jp=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=q$e(t,e);return Kb({prefix:r,name:e,encode:n,decode:i=>jb(s(i))})},Z$e=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},eTe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Jr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Kb({prefix:e,name:r,encode(s){return eTe(s,n,t)},decode(s){return Z$e(s,n,t,r)}}),ji=Jp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),tTe=Jp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),rTe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:ji,base58flickr:tTe},Symbol.toStringTag,{value:"Module"})),nTe=Kb({prefix:"\0",name:"identity",encode:r=>W$e(r),decode:r=>G$e(r)}),sTe=Object.freeze(Object.defineProperty({__proto__:null,identity:nTe},Symbol.toStringTag,{value:"Module"})),iTe=Jr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),oTe=Object.freeze(Object.defineProperty({__proto__:null,base2:iTe},Symbol.toStringTag,{value:"Module"})),aTe=Jr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),cTe=Object.freeze(Object.defineProperty({__proto__:null,base8:aTe},Symbol.toStringTag,{value:"Module"})),lTe=Jp({prefix:"9",name:"base10",alphabet:"0123456789"}),uTe=Object.freeze(Object.defineProperty({__proto__:null,base10:lTe},Symbol.toStringTag,{value:"Module"})),hTe=Jr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),dTe=Jr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),fTe=Object.freeze(Object.defineProperty({__proto__:null,base16:hTe,base16upper:dTe},Symbol.toStringTag,{value:"Module"})),p1=Jr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),pTe=Jr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yTe=Jr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gTe=Jr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wTe=Jr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),bTe=Jr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mTe=Jr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ETe=Jr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vTe=Jr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),_Te=Object.freeze(Object.defineProperty({__proto__:null,base32:p1,base32hex:wTe,base32hexpad:mTe,base32hexpadupper:ETe,base32hexupper:bTe,base32pad:yTe,base32padupper:gTe,base32upper:pTe,base32z:vTe},Symbol.toStringTag,{value:"Module"})),STe=Jp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ATe=Jp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),$Te=Object.freeze(Object.defineProperty({__proto__:null,base36:STe,base36upper:ATe},Symbol.toStringTag,{value:"Module"})),TTe=Jr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ITe=Jr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),RTe=Jr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),CTe=Jr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),xTe=Object.freeze(Object.defineProperty({__proto__:null,base64:TTe,base64pad:ITe,base64url:RTe,base64urlpad:CTe},Symbol.toStringTag,{value:"Module"})),Mz=Array.from(""),DTe=Mz.reduce((r,e,t)=>(r[t]=e,r),[]),PTe=Mz.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function OTe(r){return r.reduce((e,t)=>(e+=DTe[t],e),"")}function kTe(r){const e=[];for(const t of r){const n=PTe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const NTe=Kb({prefix:"",name:"base256emoji",encode:OTe,decode:kTe}),LTe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:NTe},Symbol.toStringTag,{value:"Module"}));var MTe=Uz,lC=128,UTe=127,BTe=~UTe,zTe=Math.pow(2,31);function Uz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=zTe;)e[t++]=r&255|lC,r/=128;for(;r&BTe;)e[t++]=r&255|lC,r>>>=7;return e[t]=r|0,Uz.bytes=t-n+1,e}var FTe=G5,VTe=128,uC=127;function G5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw G5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&uC)<<s:(o&uC)*Math.pow(2,s),s+=7}while(o>=VTe);return G5.bytes=i-n,t}var jTe=Math.pow(2,7),KTe=Math.pow(2,14),qTe=Math.pow(2,21),HTe=Math.pow(2,28),GTe=Math.pow(2,35),WTe=Math.pow(2,42),QTe=Math.pow(2,49),YTe=Math.pow(2,56),XTe=Math.pow(2,63),JTe=function(r){return r<jTe?1:r<KTe?2:r<qTe?3:r<HTe?4:r<GTe?5:r<WTe?6:r<QTe?7:r<YTe?8:r<XTe?9:10},ZTe={encode:MTe,decode:FTe,encodingLength:JTe},Rg=ZTe;const W5=(r,e=0)=>[Rg.decode(r,e),Rg.decode.bytes],Cg=(r,e,t=0)=>(Rg.encode(r,e,t),e),xg=r=>Rg.encodingLength(r),Dg=(r,e)=>{const t=e.byteLength,n=xg(r),s=n+xg(t),i=new Uint8Array(s+t);return Cg(r,i,0),Cg(t,i,n),i.set(e,s),new m9(r,t,e,i)},b9=r=>{const e=jb(r),[t,n]=W5(e),[s,i]=W5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new m9(t,s,o,e)},eIe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&H$e(r.bytes,t.bytes)}};let m9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const tIe=({name:r,code:e,encode:t})=>new rIe(r,e,t);let rIe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Dg(this.code,t):t.then(n=>Dg(this.code,n))}else throw Error("Unknown type, must be binary type")}};const nIe=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Bz=tIe({name:"sha2-256",code:18,encode:nIe("SHA-256")}),zz=0,sIe="identity",Fz=jb,iIe=r=>Dg(zz,Fz(r)),Vz={code:zz,name:sIe,encode:Fz,digest:iIe};new TextEncoder;new TextDecoder;const hC=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return aIe(t,Q5(r),e||ji.encoder);default:return cIe(t,Q5(r),e||p1.encoder)}},dC=new WeakMap,Q5=r=>{const e=dC.get(r);if(e==null){const t=new Map;return dC.set(r,t),t}return e};let jz=class zn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==rf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==lIe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return zn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Dg(e,t);return zn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return zn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&eIe(e.multihash,n.multihash)}toString(e){return hC(this,e)}toJSON(){return{"/":hC(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof zn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new zn(n,s,i,o||fC(n,s,i.bytes))}else if(t[uIe]===!0){const{version:n,multihash:s,code:i}=t,o=b9(s);return zn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==rf)throw new Error(`Version 0 CID must use dag-pb (code: ${rf}) block encoding`);return new zn(e,t,n,n.bytes)}case 1:{const s=fC(e,t,n.bytes);return new zn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return zn.create(0,rf,e)}static createV1(e,t){return zn.create(1,e,t)}static decode(e){const[t,n]=zn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=zn.inspectBytes(e),n=t.size-t.multihashSize,s=jb(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new m9(t.multihashCode,t.digestSize,i,s);return[t.version===0?zn.createV0(o):zn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=W5(e.subarray(t));return t+=f,h};let s=n(),i=rf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=oIe(e,t),i=zn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Q5(i).set(n,e),i}};const oIe=(r,e)=>{switch(r[0]){case"Q":{const t=e||ji;return[ji.prefix,t.decode(`${ji.prefix}${r}`)]}case ji.prefix:{const t=e||ji;return[ji.prefix,t.decode(r)]}case p1.prefix:{const t=e||p1;return[p1.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},aIe=(r,e,t)=>{const{prefix:n}=t;if(n!==ji.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},cIe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},rf=112,lIe=18,fC=(r,e,t)=>{const n=xg(r),s=n+xg(e),i=new Uint8Array(s+t.byteLength);return Cg(r,i,0),Cg(e,i,n),i.set(t,s),i},uIe=Symbol.for("@ipld/js-cid/CID"),pC={...sTe,...oTe,...cTe,...uTe,...fTe,..._Te,...$Te,...rTe,...xTe,...LTe},hIe=Symbol.for("nodejs.util.inspect.custom"),dIe=Object.values(pC).map(r=>r.decoder).reduce((r,e)=>r.or(e),pC.identity.decoder),Kz=114,qz=36,Hz=37;var lnt;class E9{constructor(e){N(this,"type");N(this,"multihash");N(this,"privateKey");N(this,"publicKey");N(this,"string");N(this,lnt,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=ji.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return jz.createV1(Kz,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Ie(this.multihash.bytes,e);if(typeof e=="string")return fIe(e).equals(this);if(e?.multihash?.bytes!=null)return Ie(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(lnt=V$e,hIe)](){return`PeerId(${this.toString()})`}}class v9 extends E9{constructor(t){super({...t,type:"RSA"});N(this,"type","RSA");N(this,"publicKey");this.publicKey=t.publicKey}}class _9 extends E9{constructor(t){super({...t,type:"Ed25519"});N(this,"type","Ed25519");N(this,"publicKey");this.publicKey=t.multihash.digest}}class S9 extends E9{constructor(t){super({...t,type:"secp256k1"});N(this,"type","secp256k1");N(this,"publicKey");this.publicKey=t.multihash.digest}}function fIe(r,e){if(r.charAt(0)==="1"||r.charAt(0)==="Q"){const t=b9(ji.decode(`z${r}`));return r.startsWith("12D")?new _9({multihash:t}):r.startsWith("16U")?new S9({multihash:t}):new v9({multihash:t})}return Gz(dIe.decode(r))}function Gz(r){try{const e=b9(r);if(e.code===Vz.code){if(e.digest.length===qz)return new _9({multihash:e});if(e.digest.length===Hz)return new S9({multihash:e})}if(e.code===Bz.code)return new v9({multihash:e})}catch{return pIe(jz.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function pIe(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==Kz)throw new Error("Supplied PeerID CID is invalid");const e=r.multihash;if(e.code===Bz.code)return new v9({multihash:r.multihash});if(e.code===Vz.code){if(e.digest.length===qz)return new _9({multihash:r.multihash});if(e.digest.length===Hz)return new S9({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}function yC(r){const e=new globalThis.AbortController;function t(){e.abort();for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(const i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=n,s}var yIe=Wz,gC=128,gIe=127,wIe=~gIe,bIe=Math.pow(2,31);function Wz(r,e,t){e=e||[],t=t||0;for(var n=t;r>=bIe;)e[t++]=r&255|gC,r/=128;for(;r&wIe;)e[t++]=r&255|gC,r>>>=7;return e[t]=r|0,Wz.bytes=t-n+1,e}var mIe=Y5,EIe=128,wC=127;function Y5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Y5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&wC)<<s:(o&wC)*Math.pow(2,s),s+=7}while(o>=EIe);return Y5.bytes=i-n,t}var vIe=Math.pow(2,7),_Ie=Math.pow(2,14),SIe=Math.pow(2,21),AIe=Math.pow(2,28),$Ie=Math.pow(2,35),TIe=Math.pow(2,42),IIe=Math.pow(2,49),RIe=Math.pow(2,56),CIe=Math.pow(2,63),xIe=function(r){return r<vIe?1:r<_Ie?2:r<SIe?3:r<AIe?4:r<$Ie?5:r<TIe?6:r<IIe?7:r<RIe?8:r<CIe?9:10},DIe={encode:yIe,decode:mIe,encodingLength:xIe},Pg=DIe;const X5=(r,e=0)=>[Pg.decode(r,e),Pg.decode.bytes],Og=(r,e,t=0)=>(Pg.encode(r,e,t),e),kg=r=>Pg.encodingLength(r),PIe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},A9=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},OIe=(r,e)=>{const t=e.byteLength,n=kg(r),s=n+kg(t),i=new Uint8Array(s+t);return Og(r,i,0),Og(t,i,n),i.set(e,s),new $9(r,t,e,i)},kIe=r=>{const e=A9(r),[t,n]=X5(e),[s,i]=X5(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new $9(t,s,o,e)},NIe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&PIe(r.bytes,t.bytes)}};let $9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function LIe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var MIe=LIe,UIe=MIe;let BIe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},zIe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Qz(this,e)}},FIe=class{constructor(e){this.decoders=e}or(e){return Qz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Qz=(r,e)=>new FIe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let VIe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new BIe(e,t,n),this.decoder=new zIe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Yz=({name:r,prefix:e,encode:t,decode:n})=>new VIe(r,e,t,n),Xz=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=UIe(t,e);return Yz({prefix:r,name:e,encode:n,decode:i=>A9(s(i))})},jIe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},KIe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ia=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Yz({prefix:e,name:r,encode(s){return KIe(s,n,t)},decode(s){return jIe(s,n,t,r)}}),tc=Xz({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Xz({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const L2=Ia({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ia({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ia({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ia({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ia({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ia({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ia({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ia({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ia({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const bC=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return GIe(t,J5(r),e||tc.encoder);default:return WIe(t,J5(r),e||L2.encoder)}},mC=new WeakMap,J5=r=>{const e=mC.get(r);if(e==null){const t=new Map;return mC.set(r,t),t}return e};let qIe=class Fn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==nf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==QIe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Fn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=OIe(e,t);return Fn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Fn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&NIe(e.multihash,n.multihash)}toString(e){return bC(this,e)}toJSON(){return{"/":bC(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Fn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Fn(n,s,i,o||EC(n,s,i.bytes))}else if(t[YIe]===!0){const{version:n,multihash:s,code:i}=t,o=kIe(s);return Fn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==nf)throw new Error(`Version 0 CID must use dag-pb (code: ${nf}) block encoding`);return new Fn(e,t,n,n.bytes)}case 1:{const s=EC(e,t,n.bytes);return new Fn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Fn.create(0,nf,e)}static createV1(e,t){return Fn.create(1,e,t)}static decode(e){const[t,n]=Fn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Fn.inspectBytes(e),n=t.size-t.multihashSize,s=A9(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new $9(t.multihashCode,t.digestSize,i,s);return[t.version===0?Fn.createV0(o):Fn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=X5(e.subarray(t));return t+=f,h};let s=n(),i=nf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=HIe(e,t),i=Fn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return J5(i).set(n,e),i}};const HIe=(r,e)=>{switch(r[0]){case"Q":{const t=e||tc;return[tc.prefix,t.decode(`${tc.prefix}${r}`)]}case tc.prefix:{const t=e||tc;return[tc.prefix,t.decode(r)]}case L2.prefix:{const t=e||L2;return[L2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},GIe=(r,e,t)=>{const{prefix:n}=t;if(n!==tc.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},WIe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},nf=112,QIe=18,EC=(r,e,t)=>{const n=kg(r),s=n+kg(e),i=new Uint8Array(s+t.byteLength);return Og(r,i,0),Og(e,i,n),i.set(t,s),i},YIe=Symbol.for("@ipld/js-cid/CID"),rl=F$e("libp2p:delegated-peer-routing"),vC=3e4,XIe=4;var _C;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})(_C||(_C={}));var SC;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(SC||(SC={}));class JIe{constructor(e){N(this,"client");N(this,"httpQueue");N(this,"started");N(this,"abortController");if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new Cr({concurrency:XIe});const{protocol:t,host:n,port:s}=e.getEndpointConfig();rl(`enabled DelegatedPeerRouting via ${t}://${n}:${s}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(e,t={}){rl("findPeer starts: %p",e),t.timeout=t.timeout??vC;const n=yC([this.abortController.signal,t.signal]),s=pt(),i=pt();this.httpQueue.add(async()=>(s.resolve(),i.promise));try{await s.promise;for await(const o of this.client.dht.findPeer(e,{...t,signal:n}))if(o.name==="FINAL_PEER"&&o.peer.multiaddrs.length>0)return{id:o.peer.id,multiaddrs:o.peer.multiaddrs,protocols:[]};throw new L("Not found","ERR_NOT_FOUND")}catch(o){throw rl.error("findPeer errored: %o",o),o}finally{n.clear(),i.resolve(),rl("findPeer finished: %p",e)}}async*getClosestPeers(e,t={}){let n;const s=qIe.asCID(e);s!=null?n=s:n=Gz(e),rl("getClosestPeers starts: %s",n),t.timeout=t.timeout??vC;const i=yC([this.abortController.signal,t.signal]),o=pt(),a=pt();this.httpQueue.add(async()=>(o.resolve(),a.promise));try{await o.promise;for await(const c of this.client.dht.query(n,{...t,signal:i}))c.name==="PEER_RESPONSE"&&(yield*c.closer.map(u=>({id:u.id,multiaddrs:u.multiaddrs,protocols:[]})))}catch(c){throw rl.error("getClosestPeers errored:",c),c}finally{i.clear(),a.resolve(),rl("getClosestPeers finished: %b",e)}}}function ZIe(r){return()=>new JIe(r)}function eRe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var tRe=eRe,rRe=tRe;const nRe=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};let sRe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},iRe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Jz(this,e)}},oRe=class{constructor(e){this.decoders=e}or(e){return Jz(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Jz=(r,e)=>new oRe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let aRe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new sRe(e,t,n),this.decoder=new iRe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Zz=({name:r,prefix:e,encode:t,decode:n})=>new aRe(r,e,t,n),eF=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=rRe(t,e);return Zz({prefix:r,name:e,encode:n,decode:i=>nRe(s(i))})},cRe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},lRe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ls=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Zz({prefix:e,name:r,encode(s){return lRe(s,n,t)},decode(s){return cRe(s,n,t,r)}}),uRe=Ls({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ls({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ls({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ls({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ls({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ls({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ls({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ls({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ls({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const hRe=eF({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});eF({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const dRe=Ls({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});Ls({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});Ls({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});Ls({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});_e.formatters.b=r=>r==null?"undefined":hRe.baseEncode(r);_e.formatters.t=r=>r==null?"undefined":uRe.baseEncode(r);_e.formatters.m=r=>r==null?"undefined":dRe.baseEncode(r);_e.formatters.p=r=>r==null?"undefined":r.toString();_e.formatters.c=r=>r==null?"undefined":r.toString();_e.formatters.k=r=>r==null?"undefined":r.toString();_e.formatters.a=r=>r==null?"undefined":r.toString();function fRe(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function pRe(r){let e=fRe(`${r}:trace`);return _e.enabled(`${r}:trace`)&&_e.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=_e(`${r}:trace`)),Object.assign(_e(r),{error:_e(`${r}:error`),trace:e})}function Q0(r){const e=new globalThis.AbortController;function t(){e.abort();for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(const i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=n,s}function yRe(r){return r[Symbol.asyncIterator]!=null}function AC(r){if(yRe(r))return(async()=>{for await(const e of r);})();for(const e of r);}const ds=pRe("libp2p:delegated-content-routing"),Y0=3e4,gRe=4,wRe=2;var $C;(function(r){r[r.SENDING_QUERY=0]="SENDING_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADDING_PEER=6]="ADDING_PEER",r[r.DIALING_PEER=7]="DIALING_PEER"})($C||($C={}));var TC;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(TC||(TC={}));class bRe{constructor(e){N(this,"client");N(this,"httpQueue");N(this,"httpQueueRefs");N(this,"started");N(this,"abortController");if(e==null)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new Cr({concurrency:gRe}),this.httpQueueRefs=new Cr({concurrency:wRe});const{protocol:t,host:n,port:s}=e.getEndpointConfig();ds(`enabled DelegatedContentRouting via ${t}://${n}:${s}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(e,t={}){ds("findProviders starts: %c",e),t.timeout=t.timeout??Y0;const n=Q0([this.abortController.signal,t.signal]),s=pt(),i=pt();this.httpQueue.add(async()=>(s.resolve(),i.promise));try{await s.promise;for await(const o of this.client.dht.findProvs(e,{...t,signal:n}))o.name==="PROVIDER"&&(yield*o.providers.map(a=>({id:a.id,protocols:[],multiaddrs:a.multiaddrs})))}catch(o){throw ds.error("findProviders errored:",o),o}finally{n.clear(),i.resolve(),ds("findProviders finished: %c",e)}}async provide(e,t={}){ds("provide starts: %c",e),t.timeout=t.timeout??Y0;const n=Q0([this.abortController.signal,t.signal]),s=pt(),i=pt();this.httpQueue.add(async()=>(s.resolve(),i.promise));try{await s.promise,await this.client.block.stat(e,{...t,signal:n}),await AC(this.client.dht.provide(e,{...t,signal:n}))}catch(o){throw ds.error("provide errored:",o),o}finally{n.clear(),i.resolve(),ds("provide finished: %c",e)}}async put(e,t,n={}){ds("put value start: %b",e),n.timeout=n.timeout??Y0;const s=Q0([this.abortController.signal,n.signal]),i=pt(),o=pt();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise,await AC(this.client.dht.put(e,t,{...n,signal:s}))}catch(a){throw ds.error("put errored:",a),a}finally{s.clear(),o.resolve(),ds("put finished: %b",e)}}async get(e,t={}){ds("get value start: %b",e),t.timeout=t.timeout??Y0;const n=Q0([this.abortController.signal,t.signal]),s=pt(),i=pt();this.httpQueue.add(async()=>(s.resolve(),i.promise));try{await s.promise;for await(const o of this.client.dht.get(e,{...t,signal:n}))if(o.name==="VALUE")return ds("get value finished: %b",e),o.value;throw T(new Error("Not found"),"ERR_NOT_FOUND")}catch(o){throw ds.error("put errored:",o),o}finally{n.clear(),i.resolve(),ds("put finished: %b",e)}}}function mRe(r){return()=>new bRe(r)}const ERe=r=>Promise.reject(new Error(`No base found for "${r}"`));class tF{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||ERe;for(const t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];const t=await this._loadBase(e);return this._basesByName[t.name]==null&&this._basesByPrefix[t.prefix]==null&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}}const vRe=r=>Promise.reject(new Error(`No codec found for "${r}"`));class rF{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||vRe;for(const t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){const t=typeof e=="string"?this._codecsByName:this._codecsByCode;if(t[e])return t[e];const n=await this._loadCodec(e);return t[e]==null&&this.addCodec(n),n}listCodecs(){return Object.values(this._codecsByName)}}const _Re=r=>Promise.reject(new Error(`No hasher found for "${r}"`));class nF{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||_Re;for(const t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){const t=typeof e=="string"?this._hashersByName:this._hashersByCode;if(t[e])return t[e];const n=await this._loadHasher(e);return t[e]==null&&this.addHasher(n),n}listHashers(){return Object.values(this._hashersByName)}}const SRe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},yd=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},ARe=r=>new TextEncoder().encode(r),$Re=r=>new TextDecoder().decode(r);var TRe=sF,IC=128,IRe=127,RRe=~IRe,CRe=Math.pow(2,31);function sF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=CRe;)e[t++]=r&255|IC,r/=128;for(;r&RRe;)e[t++]=r&255|IC,r>>>=7;return e[t]=r|0,sF.bytes=t-n+1,e}var xRe=Z5,DRe=128,RC=127;function Z5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Z5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&RC)<<s:(o&RC)*Math.pow(2,s),s+=7}while(o>=DRe);return Z5.bytes=i-n,t}var PRe=Math.pow(2,7),ORe=Math.pow(2,14),kRe=Math.pow(2,21),NRe=Math.pow(2,28),LRe=Math.pow(2,35),MRe=Math.pow(2,42),URe=Math.pow(2,49),BRe=Math.pow(2,56),zRe=Math.pow(2,63),FRe=function(r){return r<PRe?1:r<ORe?2:r<kRe?3:r<NRe?4:r<LRe?5:r<MRe?6:r<URe?7:r<BRe?8:r<zRe?9:10},VRe={encode:TRe,decode:xRe,encodingLength:FRe},Ng=VRe;const e8=(r,e=0)=>[Ng.decode(r,e),Ng.decode.bytes],Lg=(r,e,t=0)=>(Ng.encode(r,e,t),e),Mg=r=>Ng.encodingLength(r),Ug=(r,e)=>{const t=e.byteLength,n=Mg(r),s=n+Mg(t),i=new Uint8Array(s+t);return Lg(r,i,0),Lg(t,i,n),i.set(e,s),new T9(r,t,e,i)},iF=r=>{const e=yd(r),[t,n]=e8(e),[s,i]=e8(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new T9(t,s,o,e)},jRe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&SRe(r.bytes,t.bytes)}};let T9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const oF=0,KRe="identity",aF=yd,qRe=r=>Ug(oF,aF(r)),t8={code:oF,name:KRe,encode:aF,digest:qRe},HRe=Object.freeze(Object.defineProperty({__proto__:null,identity:t8},Symbol.toStringTag,{value:"Module"}));function GRe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var WRe=GRe,QRe=WRe;let YRe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},XRe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return cF(this,e)}},JRe=class{constructor(e){this.decoders=e}or(e){return cF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const cF=(r,e)=>new JRe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let ZRe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new YRe(e,t,n),this.decoder=new XRe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const qb=({name:r,prefix:e,encode:t,decode:n})=>new ZRe(r,e,t,n),Zp=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=QRe(t,e);return qb({prefix:r,name:e,encode:n,decode:i=>yd(s(i))})},eCe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},tCe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Zr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>qb({prefix:e,name:r,encode(s){return tCe(s,n,t)},decode(s){return eCe(s,n,t,r)}}),rCe=qb({prefix:"\0",name:"identity",encode:r=>$Re(r),decode:r=>ARe(r)}),nCe=Object.freeze(Object.defineProperty({__proto__:null,identity:rCe},Symbol.toStringTag,{value:"Module"})),sCe=Zr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),iCe=Object.freeze(Object.defineProperty({__proto__:null,base2:sCe},Symbol.toStringTag,{value:"Module"})),oCe=Zr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),aCe=Object.freeze(Object.defineProperty({__proto__:null,base8:oCe},Symbol.toStringTag,{value:"Module"})),cCe=Zp({prefix:"9",name:"base10",alphabet:"0123456789"}),lCe=Object.freeze(Object.defineProperty({__proto__:null,base10:cCe},Symbol.toStringTag,{value:"Module"})),uCe=Zr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),hCe=Zr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),dCe=Object.freeze(Object.defineProperty({__proto__:null,base16:uCe,base16upper:hCe},Symbol.toStringTag,{value:"Module"})),xl=Zr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),fCe=Zr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),pCe=Zr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),yCe=Zr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gCe=Zr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wCe=Zr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bCe=Zr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mCe=Zr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ECe=Zr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),vCe=Object.freeze(Object.defineProperty({__proto__:null,base32:xl,base32hex:gCe,base32hexpad:bCe,base32hexpadupper:mCe,base32hexupper:wCe,base32pad:pCe,base32padupper:yCe,base32upper:fCe,base32z:ECe},Symbol.toStringTag,{value:"Module"})),_Ce=Zp({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),SCe=Zp({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ACe=Object.freeze(Object.defineProperty({__proto__:null,base36:_Ce,base36upper:SCe},Symbol.toStringTag,{value:"Module"})),Ki=Zp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),$Ce=Zp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),TCe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ki,base58flickr:$Ce},Symbol.toStringTag,{value:"Module"})),ICe=Zr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),RCe=Zr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Hb=Zr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),CCe=Zr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),xCe=Object.freeze(Object.defineProperty({__proto__:null,base64:ICe,base64pad:RCe,base64url:Hb,base64urlpad:CCe},Symbol.toStringTag,{value:"Module"})),lF=Array.from(""),DCe=lF.reduce((r,e,t)=>(r[t]=e,r),[]),PCe=lF.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function OCe(r){return r.reduce((e,t)=>(e+=DCe[t],e),"")}function kCe(r){const e=[];for(const t of r){const n=PCe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const NCe=qb({prefix:"",name:"base256emoji",encode:OCe,decode:kCe}),LCe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:NCe},Symbol.toStringTag,{value:"Module"})),uF=({name:r,code:e,encode:t})=>new MCe(r,e,t);let MCe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ug(this.code,t):t.then(n=>Ug(this.code,n))}else throw Error("Unknown type, must be binary type")}};const hF=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),UCe=uF({name:"sha2-256",code:18,encode:hF("SHA-256")}),BCe=uF({name:"sha2-512",code:19,encode:hF("SHA-512")}),zCe=Object.freeze(Object.defineProperty({__proto__:null,sha256:UCe,sha512:BCe},Symbol.toStringTag,{value:"Module"})),FCe="raw",VCe=85,jCe=r=>yd(r),KCe=r=>yd(r),qCe=Object.freeze(Object.defineProperty({__proto__:null,code:VCe,decode:KCe,encode:jCe,name:FCe},Symbol.toStringTag,{value:"Module"})),HCe=new TextEncoder,GCe=new TextDecoder,WCe="json",QCe=512,YCe=r=>HCe.encode(JSON.stringify(r)),XCe=r=>JSON.parse(GCe.decode(r)),JCe=Object.freeze(Object.defineProperty({__proto__:null,code:QCe,decode:XCe,encode:YCe,name:WCe},Symbol.toStringTag,{value:"Module"})),CC=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return exe(t,r8(r),e||Ki.encoder);default:return txe(t,r8(r),e||xl.encoder)}},xC=new WeakMap,r8=r=>{const e=xC.get(r);if(e==null){const t=new Map;return xC.set(r,t),t}return e};let Re=class Vn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==sf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==rxe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Vn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Ug(e,t);return Vn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Vn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&jRe(e.multihash,n.multihash)}toString(e){return CC(this,e)}toJSON(){return{"/":CC(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Vn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Vn(n,s,i,o||DC(n,s,i.bytes))}else if(t[nxe]===!0){const{version:n,multihash:s,code:i}=t,o=iF(s);return Vn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==sf)throw new Error(`Version 0 CID must use dag-pb (code: ${sf}) block encoding`);return new Vn(e,t,n,n.bytes)}case 1:{const s=DC(e,t,n.bytes);return new Vn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Vn.create(0,sf,e)}static createV1(e,t){return Vn.create(1,e,t)}static decode(e){const[t,n]=Vn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Vn.inspectBytes(e),n=t.size-t.multihashSize,s=yd(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new T9(t.multihashCode,t.digestSize,i,s);return[t.version===0?Vn.createV0(o):Vn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=e8(e.subarray(t));return t+=f,h};let s=n(),i=sf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=ZCe(e,t),i=Vn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return r8(i).set(n,e),i}};const ZCe=(r,e)=>{switch(r[0]){case"Q":{const t=e||Ki;return[Ki.prefix,t.decode(`${Ki.prefix}${r}`)]}case Ki.prefix:{const t=e||Ki;return[Ki.prefix,t.decode(r)]}case xl.prefix:{const t=e||xl;return[xl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},exe=(r,e,t)=>{const{prefix:n}=t;if(n!==Ki.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},txe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},sf=112,rxe=18,DC=(r,e,t)=>{const n=Mg(r),s=n+Mg(e),i=new Uint8Array(s+t.byteLength);return Lg(r,i,0),Lg(e,i,n),i.set(t,s),i},nxe=Symbol.for("@ipld/js-cid/CID"),dF={...nCe,...iCe,...aCe,...lCe,...dCe,...vCe,...ACe,...TCe,...xCe,...LCe},sxe={...zCe,...HRe},ixe={raw:qCe,json:JCe},PC=mi,oxe=Ei,fF=function(r){let e=0;if(r=r.toString().trim(),PC(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(oxe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=PC(t[n]);let o;i&&(o=fF(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},axe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},qs=-1,Bg={},n8={},cxe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,qs,"ip6zone"],[43,8,"ipcidr"],[53,qs,"dns",!0],[54,qs,"dns4",!0],[55,qs,"dns6",!0],[56,qs,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,qs,"unix",!1,!0],[421,qs,"ipfs"],[421,qs,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,qs,"garlic64"],[448,0,"tls"],[449,qs,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,qs,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,qs,"memory"]];cxe.forEach(r=>{const e=lxe(...r);n8[e.code]=e,Bg[e.name]=e});function lxe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function mr(r){if(typeof r=="number"){if(n8[r]!=null)return n8[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Bg[r]!=null)return Bg[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}function uxe(r,e){switch(mr(r).code){case 4:case 41:return fxe(e);case 42:return NC(e);case 6:case 273:case 33:case 132:return pF(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return NC(e);case 421:return wxe(e);case 444:return LC(e);case 445:return LC(e);case 466:return gxe(e);default:return R(e,"base16")}}function hxe(r,e){switch(mr(r).code){case 4:return OC(e);case 41:return OC(e);case 42:return kC(e);case 6:case 273:case 33:case 132:return I9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return kC(e);case 421:return pxe(e);case 444:return bxe(e);case 445:return mxe(e);case 466:return yxe(e);default:return M(e,"base16")}}const Q6=Object.values(dF).map(r=>r.decoder),dxe=function(){let r=Q6[0].or(Q6[1]);return Q6.slice(2).forEach(e=>r=r.or(e)),r}();function OC(r){if(!Nt(r))throw new Error("invalid ip address");return fF(r)}function fxe(r){const e=axe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function I9(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function pF(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function kC(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function NC(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function pxe(r){let e;r[0]==="Q"||r[0]==="1"?e=iF(Ki.decode(`z${r}`)).bytes:e=Re.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function yxe(r){const e=dxe.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function gxe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function wxe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function bxe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=xl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=I9(n);return z([t,s],t.length+s.length)}function mxe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=xl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=I9(n);return z([t,s],t.length+s.length)}function LC(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=pF(t);return`${n}:${s}`}function Exe(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=mr(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw bF("invalid address: "+r);if(i.path===!0){e.push([s,C9(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function vxe(r){const e=[];return r.map(t=>{const n=Gb(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),C9(e.join("/"))}function _xe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=Gb(e);return e.length>1?[t.code,hxe(t.code,e[1])]:[t.code]})}function yF(r){return r.map(e=>{const t=Gb(e);return e[1]!=null?[t.code,uxe(t.code,e[1])]:[t.code]})}function gF(r){return s8(z(r.map(e=>{const t=Gb(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function wF(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function R9(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=mr(n),o=wF(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw bF("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function MC(r){const e=R9(r),t=yF(e);return vxe(t)}function Sxe(r){r=C9(r);const e=Exe(r),t=_xe(e);return gF(t)}function Axe(r){return Sxe(r)}function s8(r){const e=$xe(r);if(e!=null)throw e;return Uint8Array.from(r)}function $xe(r){try{R9(r)}catch(e){return e}}function C9(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function bF(r){return new Error("Error parsing address: "+r)}function Gb(r){return mr(r[0])}var Pu=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Y6=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},of,af,cf,UC;const Txe=Symbol.for("nodejs.util.inspect.custom"),Ixe=[mr("dns").code,mr("dns4").code,mr("dns6").code,mr("dnsaddr").code],Rxe=new Map,mF=Symbol.for("@multiformats/js-multiaddr/multiaddr");function i8(r){return!!r?.[mF]}let Cxe=class Ku{constructor(e){if(of.set(this,void 0),af.set(this,void 0),cf.set(this,void 0),this[UC]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=s8(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Axe(e)}else if(i8(e))this.bytes=s8(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Pu(this,of,"f")==null&&Y6(this,of,MC(this.bytes),"f"),Pu(this,of,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=mr("tcp"),a=mr("udp"),c=mr("ip4"),u=mr("ip6"),l=mr("dns6"),h=mr("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),Ixe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=mr(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=mr(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},mr(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=mr(s),a=wF(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Pu(this,af,"f")==null&&Y6(this,af,R9(this.bytes),"f"),Pu(this,af,"f")}stringTuples(){return Pu(this,cf,"f")==null&&Y6(this,cf,yF(this.tuples()),"f"),Pu(this,cf,"f")}encapsulate(e){return e=new Ku(e),new Ku(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Ku(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Ku(gF(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===Bg.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Ki.decode(`z${n}`),"base58btc"):R(Re.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>mr(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=Rxe.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new Ku(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(of=new WeakMap,af=new WeakMap,cf=new WeakMap,UC=mF,Txe)](){return`Multiaddr(${MC(this.bytes)})`}};function Cs(r){return new Cxe(r)}const BC=mi,xxe=Ei,EF=function(r){let e=0;if(r=r.toString().trim(),BC(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(xxe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=BC(t[n]);let o;i&&(o=EF(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},Dxe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Hs=-1,zg={},o8={},Pxe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Hs,"ip6zone"],[43,8,"ipcidr"],[53,Hs,"dns",!0],[54,Hs,"dns4",!0],[55,Hs,"dns6",!0],[56,Hs,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Hs,"unix",!1,!0],[421,Hs,"ipfs"],[421,Hs,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Hs,"garlic64"],[448,0,"tls"],[449,Hs,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Hs,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Hs,"memory"]];Pxe.forEach(r=>{const e=Oxe(...r);o8[e.code]=e,zg[e.name]=e});function Oxe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function Er(r){if(typeof r=="number"){if(o8[r]!=null)return o8[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(zg[r]!=null)return zg[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}const kxe=tb({prefix:"\0",name:"identity",encode:r=>aie(r),decode:r=>oie(r)}),Nxe=Object.freeze(Object.defineProperty({__proto__:null,identity:kxe},Symbol.toStringTag,{value:"Module"})),Lxe=Gr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Mxe=Object.freeze(Object.defineProperty({__proto__:null,base2:Lxe},Symbol.toStringTag,{value:"Module"})),Uxe=Gr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Bxe=Object.freeze(Object.defineProperty({__proto__:null,base8:Uxe},Symbol.toStringTag,{value:"Module"})),zxe=_p({prefix:"9",name:"base10",alphabet:"0123456789"}),Fxe=Object.freeze(Object.defineProperty({__proto__:null,base10:zxe},Symbol.toStringTag,{value:"Module"})),Vxe=Gr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),jxe=Gr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Kxe=Object.freeze(Object.defineProperty({__proto__:null,base16:Vxe,base16upper:jxe},Symbol.toStringTag,{value:"Module"})),qxe=_p({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Hxe=_p({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Gxe=Object.freeze(Object.defineProperty({__proto__:null,base36:qxe,base36upper:Hxe},Symbol.toStringTag,{value:"Module"})),Wxe=Gr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qxe=Gr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Yxe=Gr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Xxe=Gr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Jxe=Object.freeze(Object.defineProperty({__proto__:null,base64:Wxe,base64pad:Qxe,base64url:Yxe,base64urlpad:Xxe},Symbol.toStringTag,{value:"Module"})),vF=Array.from(""),Zxe=vF.reduce((r,e,t)=>(r[t]=e,r),[]),eDe=vF.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function tDe(r){return r.reduce((e,t)=>(e+=Zxe[t],e),"")}function rDe(r){const e=[];for(const t of r){const n=eDe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const nDe=tb({prefix:"",name:"base256emoji",encode:tDe,decode:rDe}),sDe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:nDe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const iDe={...Nxe,...Mxe,...Bxe,...Fxe,...Kxe,...Cie,...Gxe,...Eie,...Jxe,...sDe};function oDe(r,e){switch(Er(r).code){case 4:case 41:return lDe(e);case 42:return VC(e);case 6:case 273:case 33:case 132:return _F(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return VC(e);case 421:return fDe(e);case 444:return jC(e);case 445:return jC(e);case 466:return dDe(e);default:return R(e,"base16")}}function aDe(r,e){switch(Er(r).code){case 4:return zC(e);case 41:return zC(e);case 42:return FC(e);case 6:case 273:case 33:case 132:return x9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return FC(e);case 421:return uDe(e);case 444:return pDe(e);case 445:return yDe(e);case 466:return hDe(e);default:return M(e,"base16")}}const X6=Object.values(iDe).map(r=>r.decoder),cDe=function(){let r=X6[0].or(X6[1]);return X6.slice(2).forEach(e=>r=r.or(e)),r}();function zC(r){if(!Nt(r))throw new Error("invalid ip address");return EF(r)}function lDe(r){const e=Dxe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function x9(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function _F(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function FC(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function VC(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function uDe(r){let e;r[0]==="Q"||r[0]==="1"?e=PN(Mi.decode(`z${r}`)).bytes:e=Tl.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function hDe(r){const e=cDe.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function dDe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function fDe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function pDe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=$l.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=x9(n);return z([t,s],t.length+s.length)}function yDe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=$l.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=x9(n);return z([t,s],t.length+s.length)}function jC(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=_F(t);return`${n}:${s}`}function gDe(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=Er(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw TF("invalid address: "+r);if(i.path===!0){e.push([s,P9(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function wDe(r){const e=[];return r.map(t=>{const n=Wb(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),P9(e.join("/"))}function bDe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=Wb(e);return e.length>1?[t.code,aDe(t.code,e[1])]:[t.code]})}function SF(r){return r.map(e=>{const t=Wb(e);return e[1]!=null?[t.code,oDe(t.code,e[1])]:[t.code]})}function AF(r){return a8(z(r.map(e=>{const t=Wb(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function $F(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function D9(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=Er(n),o=$F(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw TF("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function KC(r){const e=D9(r),t=SF(e);return wDe(t)}function mDe(r){r=P9(r);const e=gDe(r),t=bDe(e);return AF(t)}function EDe(r){return mDe(r)}function a8(r){const e=vDe(r);if(e!=null)throw e;return Uint8Array.from(r)}function vDe(r){try{D9(r)}catch(e){return e}}function P9(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function TF(r){return new Error("Error parsing address: "+r)}function Wb(r){return Er(r[0])}var Ou=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},J6=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},lf,uf,hf,qC;const _De=Symbol.for("nodejs.util.inspect.custom"),SDe=[Er("dns").code,Er("dns4").code,Er("dns6").code,Er("dnsaddr").code],ADe=new Map,IF=Symbol.for("@multiformats/js-multiaddr/multiaddr");function $De(r){return!!r?.[IF]}let TDe=class qu{constructor(e){if(lf.set(this,void 0),uf.set(this,void 0),hf.set(this,void 0),this[qC]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=a8(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=EDe(e)}else if($De(e))this.bytes=a8(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Ou(this,lf,"f")==null&&J6(this,lf,KC(this.bytes),"f"),Ou(this,lf,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=Er("tcp"),a=Er("udp"),c=Er("ip4"),u=Er("ip6"),l=Er("dns6"),h=Er("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),SDe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=Er(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=Er(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},Er(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=Er(s),a=$F(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Ou(this,uf,"f")==null&&J6(this,uf,D9(this.bytes),"f"),Ou(this,uf,"f")}stringTuples(){return Ou(this,hf,"f")==null&&J6(this,hf,SF(this.tuples()),"f"),Ou(this,hf,"f")}encapsulate(e){return e=new qu(e),new qu(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new qu(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new qu(AF(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===zg.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Mi.decode(`z${n}`),"base58btc"):R(Tl.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>Er(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=ADe.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new qu(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(lf=new WeakMap,uf=new WeakMap,hf=new WeakMap,qC=IF,_De)](){return`Multiaddr(${KC(this.bytes)})`}};function IDe(r){return new TDe(r)}function HC(r){try{r=qv(IDe(r))}catch{}return r=r.toString(),r}const RDe=()=>{},GC=U("ipfs-http-client:lib:error-handler"),CDe=kt.bind({ignoreUndefined:!0}),xDe=pa.isBrowser||pa.isWebWorker?location.protocol:"http",DDe=pa.isBrowser||pa.isWebWorker?location.hostname:"localhost",PDe=pa.isBrowser||pa.isWebWorker?location.port:"5001",ODe=(r={})=>{let e,t={},n;if(typeof r=="string"||i8(r))e=new URL(HC(r));else if(r instanceof URL)e=r;else if(typeof r.url=="string"||i8(r.url))e=new URL(HC(r.url)),t=r;else if(r.url instanceof URL)e=r.url,t=r;else{t=r||{};const s=(t.protocol||xDe).replace(":",""),i=(t.host||DDe).split(":")[0],o=t.port||PDe;e=new URL(`${s}://${i}:${o}`)}if(t.apiPath?e.pathname=t.apiPath:(e.pathname==="/"||e.pathname===void 0)&&(e.pathname="api/v0"),pa.isNode){const s=RDe();n=t.agent||new s({keepAlive:!0,maxSockets:6})}return{...t,host:e.host,protocol:e.protocol.replace(":",""),port:Number(e.port),apiPath:e.pathname,url:e,agent:n}},kDe=async r=>{let e;try{if((r.headers.get("Content-Type")||"").startsWith("application/json")){const n=await r.json();GC(n),e=n.Message||n.message}else e=await r.text()}catch(n){GC("Failed to parse error response",n),e=n.message}let t=new aa.HTTPError(r);throw e&&(e.includes("deadline has elapsed")&&(t=new aa.TimeoutError),e&&e.includes("context deadline exceeded")&&(t=new aa.TimeoutError)),e&&e.includes("request timed out")&&(t=new aa.TimeoutError),e&&(t.message=e),t},NDe=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,WC=r=>r.replace(NDe,function(e){return"-"+e.toLowerCase()}),LDe=r=>typeof r=="string"?Te(r):r;class O9 extends aa{constructor(e={}){const t=ODe(e);super({timeout:LDe(t.timeout||0)||void 0,headers:t.headers,base:`${t.url}`,handleError:kDe,transformSearchParams:s=>{const i=new URLSearchParams;for(const[o,a]of s)a!=="undefined"&&a!=="null"&&o!=="signal"&&i.append(WC(o),a),o==="timeout"&&!isNaN(a)&&i.append(WC(o),a);return i},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;const n=this.fetch;this.fetch=(s,i={})=>(typeof s=="string"&&!s.startsWith("/")&&(s=`${t.url}/${s}`),n.call(this,s,CDe(i,{method:"POST"})))}}aa.HTTPError;const K=r=>e=>r(new O9(e),e);function RF(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}function CF(r){if(r==null)return;let e;if(r.secs!=null&&(e={secs:r.secs,nsecs:r.nsecs}),r.Seconds!=null&&(e={secs:r.Seconds,nsecs:r.FractionalNanoseconds}),Array.isArray(r)&&(e={secs:r[0],nsecs:r[1]}),r instanceof Date){const t=r.getTime(),n=Math.floor(t/1e3);e={secs:n,nsecs:(t-n*1e3)*1e3}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(e!=null&&e.nsecs!=null&&(e.nsecs<0||e.nsecs>999999999))throw T(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}function H({arg:r,searchParams:e,hashAlg:t,mtime:n,mode:s,...i}={}){e&&(i={...i,...e}),t&&(i.hash=t),n!=null&&(n=CF(n),i.mtime=n.secs,i.mtimeNsecs=n.nsecs),s!=null&&(i.mode=RF(s)),i.timeout&&!isNaN(i.timeout)&&(i.timeout=`${i.timeout}ms`),r==null?r=[]:Array.isArray(r)||(r=[r]);const o=new URLSearchParams(i);return r.forEach(a=>o.append("arg",a)),o}const MDe=K(r=>{async function e(t={}){return((await(await r.post("bitswap/wantlist",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()).Keys||[]).map(s=>Re.parse(s["/"]))}return e}),UDe=K(r=>{async function e(t,n={}){return((await(await r.post("bitswap/wantlist",{signal:n.signal,searchParams:H({...n,peer:t.toString()}),headers:n.headers})).json()).Keys||[]).map(i=>Re.parse(i["/"]))}return e}),xF=K(r=>{async function e(t={}){const n=await r.post("bitswap/stat",{searchParams:H(t),signal:t.signal,headers:t.headers});return BDe(await n.json())}return e});function BDe(r){return{provideBufLen:r.ProvideBufLen,wantlist:(r.Wantlist||[]).map(e=>Re.parse(e["/"])),peers:(r.Peers||[]).map(e=>Ae(e)),blocksReceived:BigInt(r.BlocksReceived),dataReceived:BigInt(r.DataReceived),blocksSent:BigInt(r.BlocksSent),dataSent:BigInt(r.DataSent),dupBlksReceived:BigInt(r.DupBlksReceived),dupDataReceived:BigInt(r.DupDataReceived)}}const zDe=K(r=>{async function e(t,n={}){return(await r.post("bitswap/unwant",{signal:n.signal,searchParams:H({arg:t.toString(),...n}),headers:n.headers})).json()}return e});function FDe(r){return{wantlist:MDe(r),wantlistForPeer:UDe(r),unwant:zDe(r),stat:xF(r)}}const DF=K(r=>{async function e(t,n={}){const s=await r.post("block/get",{signal:n.signal,searchParams:H({arg:t.toString(),...n}),headers:n.headers});return new Uint8Array(await s.arrayBuffer())}return e});async function VDe(r){if(Bc(r))return new Blob([r]);if(typeof r=="string"||r instanceof String)return new Blob([r.toString()]);if(L1(r))return r;if(M1(r)&&(r=Kl(r)),Symbol.iterator in r||Symbol.asyncIterator in r){const e=Mp(r),{value:t,done:n}=await e.peek();if(n)return QC(e);if(e.push(t),Number.isInteger(t))return new Blob([Uint8Array.from(await Kc(e))]);if(Bc(t)||typeof t=="string"||t instanceof String)return QC(e)}throw T(new Error(`Unexpected input: ${r}`),"ERR_UNEXPECTED_INPUT")}async function QC(r){const e=[];for await(const t of r)e.push(t);return new Blob(e)}function jDe(r){return YM(r,VDe)}function KDe(r){if(r!=null)return typeof r=="string"?r:r.toString(8).padStart(4,"0")}async function Mo(r,e,t={}){const n=[],s=new FormData;let i=0,o=0;for await(const{content:a,path:c,mode:u,mtime:l}of jDe(r)){let h="";const f=a?"file":"dir";i>0&&(h=`-${i}`);let y=f+h;const d=[];if(u!=null&&d.push(`mode=${KDe(u)}`),l!=null){const{secs:p,nsecs:b}=l;d.push(`mtime=${p}`),b!=null&&d.push(`mtime-nsecs=${b}`)}if(d.length&&(y=`${y}?${d.join("&")}`),a){s.set(y,a,c!=null?encodeURIComponent(c):void 0);const p=o+a.size;n.push({name:c,start:o,end:p}),o=p}else if(c!=null)s.set(y,new File([""],encodeURIComponent(c),{type:"application/x-directory"}));else throw new Error("path or content or both must be set");i++}return{total:o,parts:n,headers:t,body:s}}function qDe(r){return r.filter(Boolean)}function Uo(...r){return Io(qDe(r))}const HDe=K(r=>{async function e(t,n={}){const s=new AbortController,i=Uo(s.signal,n.signal);let o;try{o=await(await r.post("block/put",{signal:i,searchParams:H(n),...await Mo([t],s,n.headers)})).json()}catch(a){if(n.format==="dag-pb")return e(t,{...n,format:"protobuf"});if(n.format==="dag-cbor")return e(t,{...n,format:"cbor"});throw a}return Re.parse(o.Key)}return e}),GDe=K(r=>{async function*e(t,n={}){Array.isArray(t)||(t=[t]);const s=await r.post("block/rm",{signal:n.signal,searchParams:H({arg:t.map(i=>i.toString()),"stream-channels":!0,...n}),headers:n.headers});for await(const i of s.ndjson())yield WDe(i)}return e});function WDe(r){const e={cid:Re.parse(r.Hash)};return r.Error&&(e.error=new Error(r.Error)),e}const QDe=K(r=>{async function e(t,n={}){const i=await(await r.post("block/stat",{signal:n.signal,searchParams:H({arg:t.toString(),...n}),headers:n.headers})).json();return{cid:Re.parse(i.Key),size:i.Size}}return e});function YDe(r){return{get:DF(r),put:HDe(r),rm:GDe(r),stat:QDe(r)}}const XDe=K(r=>{async function e(t,n={}){const s=await r.post("bootstrap/add",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers}),{Peers:i}=await s.json();return{Peers:i.map(o=>Cs(o))}}return e}),JDe=K(r=>{async function e(t={}){const n=await r.post("bootstrap/rm",{signal:t.signal,searchParams:H({...t,all:!0}),headers:t.headers}),{Peers:s}=await n.json();return{Peers:s.map(i=>Cs(i))}}return e}),ZDe=K(r=>{async function e(t={}){const n=await r.post("bootstrap/list",{signal:t.signal,searchParams:H(t),headers:t.headers}),{Peers:s}=await n.json();return{Peers:s.map(i=>Cs(i))}}return e}),ePe=K(r=>{async function e(t={}){const n=await r.post("bootstrap/add",{signal:t.signal,searchParams:H({...t,default:!0}),headers:t.headers}),{Peers:s}=await n.json();return{Peers:s.map(i=>Cs(i))}}return e}),tPe=K(r=>{async function e(t,n={}){const s=await r.post("bootstrap/rm",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers}),{Peers:i}=await s.json();return{Peers:i.map(o=>Cs(o))}}return e});function rPe(r){return{add:XDe(r),clear:JDe(r),list:ZDe(r),reset:ePe(r),rm:tPe(r)}}const nPe=K(r=>{async function e(t,n={}){const i=await(await r.post("config/profile/apply",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).json();return{original:i.OldCfg,updated:i.NewCfg}}return e});function xr(r){if(r==null)return r;const e=/^[A-Z]+$/,t={};return Object.keys(r).reduce((n,s)=>(e.test(s)?n[s.toLowerCase()]=r[s]:e.test(s[0])?n[s[0].toLowerCase()+s.slice(1)]=r[s]:n[s]=r[s],n),t)}const sPe=K(r=>{async function e(t={}){return(await(await r.post("config/profile/list",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()).map(i=>xr(i))}return e});function iPe(r){return{apply:nPe(r),list:sPe(r)}}const oPe=K(r=>async(t,n={})=>{if(!t)throw new Error("key argument is required");return(await(await r.post("config",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).json()).Value}),aPe=K(r=>async(t={})=>await(await r.post("config/show",{signal:t.signal,searchParams:H({...t}),headers:t.headers})).json()),cPe=K(r=>async(t,n={})=>{const s=new AbortController,i=Uo(s.signal,n.signal);await(await r.post("config/replace",{signal:i,searchParams:H(n),...await Mo([M(JSON.stringify(t))],s,n.headers)})).text()}),lPe=K(r=>async(t,n,s={})=>{if(typeof t!="string")throw new Error("Invalid key type");const i={...s,...uPe(t,n)};await(await r.post("config",{signal:s.signal,searchParams:H(i),headers:s.headers})).text()}),uPe=(r,e)=>{switch(typeof e){case"boolean":return{arg:[r,e.toString()],bool:!0};case"string":return{arg:[r,e]};default:return{arg:[r,JSON.stringify(e)],json:!0}}};function hPe(r){return{getAll:aPe(r),get:oPe(r),set:lPe(r),replace:cPe(r),profiles:iPe(r)}}const dPe=K(r=>{async function*e(t,n={}){yield*(await r.post("dag/export",{signal:n.signal,searchParams:H({arg:t.toString()}),headers:n.headers})).iterator()}return e});async function*YC(r,e,t,n,s){const i=async u=>{const l=await t.getCodec(u.code),h=await n(u,s);return l.decode(h)},o=e.split("/").filter(Boolean);let a=await i(r),c=r;for(;o.length;){const u=o.shift();if(!u)throw T(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(Object.prototype.hasOwnProperty.call(a,u))a=a[u],yield{value:a,remainderPath:o.join("/")};else throw T(new Error(`no link named "${u}" under ${c}`),"ERR_NO_LINK");const l=Re.asCID(a);l&&(c=l,a=await i(a))}yield{value:a,remainderPath:""}}const fPe=(r,e)=>K((n,s)=>{const i=DF(s);return async(a,c={})=>{if(c.path){const y=c.localResolve?await to(YC(a,c.path,r,i,c)):await ks(YC(a,c.path,r,i,c));if(!y)throw T(new Error("Not found"),"ERR_NOT_FOUND");return y}const u=await r.getCodec(a.code),l=await i(a,c);return{value:u.decode(l),remainderPath:""}}})(e),pPe=K(r=>{async function*e(t,n={}){const s=new AbortController,i=Uo(s.signal,n.signal),{headers:o,body:a}=await Mo(t,s,n.headers),c=await r.post("dag/import",{signal:i,headers:o,body:a,searchParams:H({"pin-roots":n.pinRoots})});for await(const{Root:u}of c.ndjson())if(u!==void 0){const{Cid:{"/":l},PinErrorMsg:h}=u;yield{root:{cid:Re.parse(l),pinErrorMsg:h}}}}return e}),PF=(r,e)=>K(n=>async(i,o={})=>{const a={storeCodec:"dag-cbor",hashAlg:"sha2-256",...o};let c;if(a.inputCodec){if(!(i instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");c=i}else c=(await r.getCodec(a.storeCodec)).encode(i),a.inputCodec=a.storeCodec;const u=new AbortController,l=Uo(u.signal,a.signal),f=await(await n.post("dag/put",{timeout:a.timeout,signal:l,searchParams:H(a),...await Mo([c],u,a.headers)})).json();return Re.parse(f.Cid["/"])})(e),yPe=K(r=>async(t,n={})=>{const i=await(await r.post("dag/resolve",{signal:n.signal,searchParams:H({arg:`${t}${n.path?`/${n.path}`.replace(/\/[/]+/g,"/"):""}`,...n}),headers:n.headers})).json();return{cid:Re.parse(i.Cid["/"]),remainderPath:i.RemPath}});function gPe(r,e){return{export:dPe(e),get:fPe(r,e),import:pPe(e),put:PF(r,e),resolve:yPe(e)}}const wPe=0,bPe=1,mPe=2,EPe=3,vPe=4,_Pe=5,SPe=6,APe=7,gd=r=>{if(r.Type===wPe)return{name:"SENDING_QUERY",type:r.Type};if(r.Type===bPe)return{from:Ae(r.ID),name:"PEER_RESPONSE",type:r.Type,messageType:0,messageName:"PUT_VALUE",closer:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:Ae(e),multiaddrs:t.map(n=>Cs(n)),protocols:[]})),providers:(r.Responses||[]).map(({ID:e,Addrs:t})=>({id:Ae(e),multiaddrs:t.map(n=>Cs(n)),protocols:[]}))};if(r.Type===mPe){let e={id:r.ID??Ae(r.ID),multiaddrs:[],protocols:[]};return r.Responses&&r.Responses.length&&(e={id:Ae(r.Responses[0].ID),multiaddrs:r.Responses[0].Addrs.map(t=>Cs(t)),protocols:[]}),{name:"FINAL_PEER",type:r.Type,peer:e}}if(r.Type===EPe)return{name:"QUERY_ERROR",type:r.Type,error:new Error(r.Extra)};if(r.Type===vPe)return{name:"PROVIDER",type:r.Type,providers:r.Responses.map(({ID:e,Addrs:t})=>({id:Ae(e),multiaddrs:t.map(n=>Cs(n)),protocols:[]}))};if(r.Type===_Pe)return{name:"VALUE",type:r.Type,value:M(r.Extra,"base64pad")};if(r.Type===SPe){const e=r.Responses.map(({ID:t})=>Ae(t));if(!e.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:r.Type,peer:e[0]}}if(r.Type===APe)return{name:"DIALING_PEER",type:r.Type,peer:Ae(r.ID)};throw new Error("Unknown DHT event type")},$Pe=K(r=>{async function*e(t,n={}){const s=await r.post("dht/findpeer",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers});for await(const i of s.ndjson())yield gd(i)}return e}),TPe=K(r=>{async function*e(t,n={}){const s=await r.post("dht/findprovs",{signal:n.signal,searchParams:H({arg:t.toString(),...n}),headers:n.headers});for await(const i of s.ndjson())yield gd(i)}return e}),IPe=K(r=>{async function*e(t,n={}){const s=await r.post("dht/get",{signal:n.signal,searchParams:H({arg:t instanceof Uint8Array?R(t):t.toString(),...n}),headers:n.headers});for await(const i of s.ndjson())yield gd(i)}return e}),RPe=K(r=>{async function*e(t,n={recursive:!1}){const s=Array.isArray(t)?t:[t],i=await r.post("dht/provide",{signal:n.signal,searchParams:H({arg:s.map(o=>o.toString()),...n}),headers:n.headers});for await(const o of i.ndjson())yield gd(o)}return e}),CPe=K(r=>{async function*e(t,n,s={}){const i=new AbortController,o=Uo(i.signal,s.signal),a=await r.post("dht/put",{signal:o,searchParams:H({arg:t instanceof Uint8Array?R(t):t.toString(),...s}),...await Mo([n],i,s.headers)});for await(const c of a.ndjson())yield gd(c)}return e}),xPe=K(r=>{async function*e(t,n={}){const s=await r.post("dht/query",{signal:n.signal,searchParams:H({arg:t.toString(),...n}),headers:n.headers});for await(const i of s.ndjson())yield gd(i)}return e});function DPe(r){return{findPeer:$Pe(r),findProvs:TPe(r),get:IPe(r),provide:RPe(r),put:CPe(r),query:xPe(r)}}const PPe=K(r=>{async function e(t={}){return(await r.post("diag/cmds",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()}return e}),OPe=K(r=>{async function e(t={}){return(await r.post("diag/net",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()}return e}),kPe=K(r=>{async function e(t={}){return(await r.post("diag/sys",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()}return e});function NPe(r){return{cmds:PPe(r),net:OPe(r),sys:kPe(r)}}const LPe=K(r=>{async function e(t,n,s={}){await(await r.post("files/chmod",{signal:s.signal,searchParams:H({arg:t,mode:n,...s}),headers:s.headers})).text()}return e}),MPe=K(r=>{async function e(t,n,s={}){const i=Array.isArray(t)?t:[t];await(await r.post("files/cp",{signal:s.signal,searchParams:H({arg:i.concat(n).map(a=>Re.asCID(a)?`/ipfs/${a}`:a),...s}),headers:s.headers})).text()}return e}),UPe=K(r=>{async function e(t,n={}){if(!t||typeof t!="string")throw new Error("ipfs.files.flush requires a path");const i=await(await r.post("files/flush",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).json();return Re.parse(i.Cid)}return e});function c8(r){const e=xr(r);return Object.prototype.hasOwnProperty.call(e,"mode")&&(e.mode=parseInt(e.mode,8)),Object.prototype.hasOwnProperty.call(e,"mtime")&&(e.mtime={secs:e.mtime,nsecs:e.mtimeNsecs||0},delete e.mtimeNsecs),e}const BPe=K(r=>{async function*e(t,n={}){if(!t)throw new Error("ipfs.files.ls requires a path");const s=await r.post("files/ls",{signal:n.signal,searchParams:H({arg:Re.asCID(t)?`/ipfs/${t}`:t,long:!0,...n,stream:!0}),headers:n.headers});for await(const i of s.ndjson())if("Entries"in i)for(const o of i.Entries||[])yield XC(c8(o));else yield XC(c8(i))}return e});function XC(r){return r.hash&&(r.cid=Re.parse(r.hash)),delete r.hash,r.type=r.type===1?"directory":"file",r}const zPe=K(r=>{async function e(t,n={}){await(await r.post("files/mkdir",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).text()}return e}),FPe=K(r=>{async function e(t,n,s={}){Array.isArray(t)||(t=[t]),await(await r.post("files/mv",{signal:s.signal,searchParams:H({arg:t.concat(n),...s}),headers:s.headers})).text()}return e});var VPe=r=>{if(r[Symbol.asyncIterator])return r;if(r.getReader)return async function*(){const e=r.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")};const jPe=Et(VPe),KPe=K(r=>{async function*e(t,n={}){const s=await r.post("files/read",{signal:n.signal,searchParams:H({arg:t,count:n.length,...n}),headers:n.headers});yield*jPe(s.body)}return e}),qPe=K(r=>{async function e(t,n={}){const s=await r.post("files/rm",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers}),i=await s.text();if(i!==""){const o=new aa.HTTPError(s);throw o.message=i,o}}return e}),OF=K(r=>{async function e(t,n={}){const i=await(await r.post("files/stat",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).json();return i.WithLocality=i.WithLocality||!1,HPe(c8(i))}return e});function HPe(r){return r.cid=Re.parse(r.hash),delete r.hash,r}const GPe=K(r=>{async function e(t,n={}){await(await r.post("files/touch",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).text()}return e}),WPe=K(r=>{async function e(t,n,s={}){const i=new AbortController,o=Uo(i.signal,s.signal);await(await r.post("files/write",{signal:o,searchParams:H({arg:t,streamChannels:!0,count:s.length,...s}),...await Mo([{content:n,path:"arg",mode:RF(s.mode),mtime:CF(s.mtime)}],i,s.headers)})).text()}return e});function QPe(r){return{chmod:LPe(r),cp:MPe(r),flush:UPe(r),ls:BPe(r),mkdir:zPe(r),mv:FPe(r),read:KPe(r),rm:qPe(r),stat:OF(r),touch:GPe(r),write:WPe(r)}}const YPe=K(r=>async(t,n,s={})=>{throw T(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")}),XPe=K(r=>{async function e(t,n){const s=n??{type:"Ed25519"},o=await(await r.post("key/gen",{signal:s.signal,searchParams:H({arg:t,...s}),headers:s.headers})).json();return xr(o)}return e}),JPe=K(r=>{async function e(t,n,s,i={}){const a=await(await r.post("key/import",{signal:i.signal,searchParams:H({arg:t,pem:n,password:s,...i}),headers:i.headers})).json();return xr(a)}return e}),ZPe=K(r=>async(t,n={})=>{throw T(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")}),eOe=K(r=>{async function e(t={}){return((await(await r.post("key/list",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()).Keys||[]).map(i=>xr(i))}return e}),tOe=K(r=>{async function e(t,n,s={}){const i=await r.post("key/rename",{signal:s.signal,searchParams:H({arg:[t,n],...s}),headers:s.headers});return xr(await i.json())}return e}),rOe=K(r=>{async function e(t,n={}){const i=await(await r.post("key/rm",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).json();return xr(i.Keys[0])}return e});function nOe(r){return{export:YPe(r),gen:XPe(r),import:JPe(r),info:ZPe(r),list:eOe(r),rename:tOe(r),rm:rOe(r)}}const sOe=K(r=>{async function e(t,n,s={}){const i=await r.post("log/level",{signal:s.signal,searchParams:H({arg:[t,n],...s}),headers:s.headers});return xr(await i.json())}return e}),iOe=K(r=>{async function e(t={}){return(await(await r.post("log/ls",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()).Strings}return e}),oOe=K(r=>{async function*e(t={}){yield*(await r.post("log/tail",{signal:t.signal,searchParams:H(t),headers:t.headers})).ndjson()}return e});function aOe(r){return{level:sOe(r),ls:iOe(r),tail:oOe(r)}}const cOe=K(r=>{async function e(t,n={}){const s=await r.post("name/publish",{signal:n.signal,searchParams:H({arg:`${t}`,...n}),headers:n.headers});return xr(await s.json())}return e}),lOe=K(r=>{async function*e(t,n={}){const s=await r.post("name/resolve",{signal:n.signal,searchParams:H({arg:t,stream:!0,...n}),headers:n.headers});for await(const i of s.ndjson())yield i.Path}return e}),uOe=K(r=>{async function e(t,n={}){const s=await r.post("name/pubsub/cancel",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers});return xr(await s.json())}return e}),hOe=K(r=>{async function e(t={}){const n=await r.post("name/pubsub/state",{signal:t.signal,searchParams:H(t),headers:t.headers});return xr(await n.json())}return e}),dOe=K(r=>{async function e(t={}){return(await(await r.post("name/pubsub/subs",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()).Strings||[]}return e});function fOe(r){return{cancel:uOe(r),state:hOe(r),subs:dOe(r)}}function pOe(r){return{publish:cOe(r),resolve:lOe(r),pubsub:fOe(r)}}const yOe=K(r=>{async function e(t,n={}){const i=await(await r.post("object/data",{signal:n.signal,searchParams:H({arg:`${t instanceof Uint8Array?Re.decode(t):t}`,...n}),headers:n.headers})).arrayBuffer();return new Uint8Array(i,0,i.byteLength)}return e}),gOe=K(r=>{async function e(t,n={}){const i=await(await r.post("object/get",{signal:n.signal,searchParams:H({arg:`${t instanceof Uint8Array?Re.decode(t):t}`,dataEncoding:"base64",...n}),headers:n.headers})).json();return{Data:M(i.Data,"base64pad"),Links:(i.Links||[]).map(o=>({Name:o.Name,Hash:Re.parse(o.Hash),Tsize:o.Size}))}}return e}),wOe=K(r=>{async function e(t,n={}){return((await(await r.post("object/links",{signal:n.signal,searchParams:H({arg:`${t instanceof Uint8Array?Re.decode(t):t}`,...n}),headers:n.headers})).json()).Links||[]).map(o=>({Name:o.Name,Tsize:o.Size,Hash:Re.parse(o.Hash)}))}return e}),bOe=K(r=>{async function e(t={}){const n=await r.post("object/new",{signal:t.signal,searchParams:H({arg:t.template,...t}),headers:t.headers}),{Hash:s}=await n.json();return Re.parse(s)}return e}),mOe=(r,e)=>K(n=>{const s=PF(r,e);async function i(o,a={}){return s(o,{...a,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}return i})(e),EOe=K(r=>{async function e(t,n={}){const i=await(await r.post("object/stat",{signal:n.signal,searchParams:H({arg:`${t}`,...n}),headers:n.headers})).json();return{...i,Hash:Re.parse(i.Hash)}}return e}),vOe=K(r=>{async function e(t,n,s={}){const i=await r.post("object/patch/add-link",{signal:s.signal,searchParams:H({arg:[`${t}`,n.Name||n.name||"",(n.Hash||n.cid||"").toString()||null],...s}),headers:s.headers}),{Hash:o}=await i.json();return Re.parse(o)}return e}),_Oe=K(r=>{async function e(t,n,s={}){const i=new AbortController,o=Uo(i.signal,s.signal),a=await r.post("object/patch/append-data",{signal:o,searchParams:H({arg:`${t}`,...s}),...await Mo([n],i,s.headers)}),{Hash:c}=await a.json();return Re.parse(c)}return e}),SOe=K(r=>{async function e(t,n,s={}){const i=await r.post("object/patch/rm-link",{signal:s.signal,searchParams:H({arg:[`${t}`,n.Name||n.name||null],...s}),headers:s.headers}),{Hash:o}=await i.json();return Re.parse(o)}return e}),AOe=K(r=>{async function e(t,n,s={}){const i=new AbortController,o=Uo(i.signal,s.signal),a=await r.post("object/patch/set-data",{signal:o,searchParams:H({arg:[`${t}`],...s}),...await Mo([n],i,s.headers)}),{Hash:c}=await a.json();return Re.parse(c)}return e});function $Oe(r){return{addLink:vOe(r),appendData:_Oe(r),rmLink:SOe(r),setData:AOe(r)}}function TOe(r,e){return{data:yOe(e),get:gOe(e),links:wOe(e),new:bOe(e),put:mOe(r,e),stat:EOe(e),patch:$Oe(e)}}const kF=K(r=>{async function*e(t,n={}){for await(const{path:s,recursive:i,metadata:o}of Cp(t)){const a=await r.post("pin/add",{signal:n.signal,searchParams:H({...n,arg:s,recursive:i,metadata:o?JSON.stringify(o):void 0,stream:!0}),headers:n.headers});for await(const c of a.ndjson()){if(c.Pins){for(const u of c.Pins)yield Re.parse(u);continue}yield Re.parse(c)}}}return e});function IOe(r){const e=kF(r);return K(()=>{async function t(n,s={}){return ks(e([{path:n,...s}],s))}return t})(r)}function JC(r,e,t){const n={type:r,cid:Re.parse(e)};return t&&(n.metadata=t),n}const ROe=K(r=>{async function*e(t={}){let n=[];t.paths&&(n=Array.isArray(t.paths)?t.paths:[t.paths]);const s=await r.post("pin/ls",{signal:t.signal,searchParams:H({...t,arg:n.map(i=>`${i}`),stream:!0}),headers:t.headers});for await(const i of s.ndjson()){if(i.Keys){for(const o of Object.keys(i.Keys))yield JC(i.Keys[o].Type,o,i.Keys[o].Metadata);return}yield JC(i.Type,i.Cid,i.Metadata)}}return e}),NF=K(r=>{async function*e(t,n={}){for await(const{path:s,recursive:i}of Cp(t)){const o=new URLSearchParams(n.searchParams);o.append("arg",`${s}`),i!=null&&o.set("recursive",String(i));const a=await r.post("pin/rm",{signal:n.signal,headers:n.headers,searchParams:H({...n,arg:`${s}`,recursive:i})});for await(const c of a.ndjson()){if(c.Pins){yield*c.Pins.map(u=>Re.parse(u));continue}yield Re.parse(c)}}}return e}),COe=r=>{const e=NF(r);return K(()=>{async function t(n,s={}){return ks(e([{path:n,...s}],s))}return t})(r)},LF=({Name:r,Status:e,Cid:t})=>({cid:Re.parse(t),name:r,status:e}),MF=r=>{if(typeof r=="string"&&r!=="")return r;throw new TypeError("service name must be passed")},UF=r=>{if(Re.asCID(r))return r.toString();throw new TypeError(`CID instance expected instead of ${typeof r}`)},k9=({service:r,cid:e,name:t,status:n,all:s})=>{const i=H({service:MF(r),name:t,force:s?!0:void 0});if(e)for(const o of e)i.append("cid",UF(o));if(n)for(const o of n)i.append("status",o);return i},xOe=({cid:r,service:e,background:t,name:n,origins:s})=>{const i=H({arg:UF(r),service:MF(e),name:n,background:t?!0:void 0});if(s)for(const o of s)i.append("origin",o.toString());return i};function DOe(r){async function e(t,{timeout:n,signal:s,headers:i,...o}){const a=await r.post("pin/remote/add",{timeout:n,signal:s,headers:i,searchParams:xOe({cid:t,...o})});return LF(await a.json())}return e}function POe(r){async function*e({timeout:t,signal:n,headers:s,...i}){const o=await r.post("pin/remote/ls",{timeout:t,signal:n,headers:s,searchParams:k9(i)});for await(const a of o.ndjson())yield LF(a)}return e}function OOe(r){async function e({timeout:t,signal:n,headers:s,...i}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:s,searchParams:k9({...i,all:!1})})}return e}function kOe(r){async function e({timeout:t,signal:n,headers:s,...i}){await r.post("pin/remote/rm",{timeout:t,signal:n,headers:s,searchParams:k9({...i,all:!0})})}return e}function NOe(r){const e=String(r);if(e==="undefined")throw Error("endpoint is required");return e[e.length-1]==="/"?e.slice(0,-1):e}function LOe(r){return{service:r.Service,endpoint:new URL(r.ApiEndpoint),...r.Stat&&{stat:MOe(r.Stat)}}}function MOe(r){switch(r.Status){case"valid":{const{Pinning:e,Pinned:t,Queued:n,Failed:s}=r.PinCount;return{status:"valid",pinCount:{queued:n,pinning:e,pinned:t,failed:s}}}case"invalid":return{status:"invalid"};default:return{status:r.Status}}}function UOe(r){async function e(t,n){const{endpoint:s,key:i,headers:o,timeout:a,signal:c}=n;await r.post("pin/remote/service/add",{timeout:a,signal:c,searchParams:H({arg:[t,NOe(s),i]}),headers:o})}return e}function BOe(r){async function e(t={}){const{stat:n,headers:s,timeout:i,signal:o}=t,a=await r.post("pin/remote/service/ls",{timeout:i,signal:o,headers:s,searchParams:n===!0?H({stat:n}):void 0}),{RemoteServices:c}=await a.json();return c.map(LOe)}return e}function zOe(r){async function e(t,n={}){await r.post("pin/remote/service/rm",{signal:n.signal,headers:n.headers,searchParams:H({arg:t})})}return e}function FOe(r){const e=new O9(r);return{add:UOe(e),ls:BOe(e),rm:zOe(e)}}function VOe(r){const e=new O9(r);return{add:DOe(e),ls:POe(e),rm:OOe(e),rmAll:kOe(e),service:FOe(r)}}function jOe(r){return{addAll:kF(r),add:IOe(r),ls:ROe(r),rmAll:NF(r),rm:COe(r),remote:VOe(r)}}const KOe=r=>Array.isArray(r)?r.map(l8):r,l8=r=>R(Qf(r)),Qf=r=>Hb.decode(r),qOe=r=>BigInt(`0x${R(Hb.decode(r),"base16")}`),N9=r=>Hb.encode(M(r)),HOe=K(r=>{async function e(t={}){const{Strings:n}=await(await r.post("pubsub/ls",{signal:t.signal,searchParams:H(t),headers:t.headers})).json();return KOe(n)||[]}return e}),GOe=K(r=>{async function e(t,n={}){const s=await r.post("pubsub/peers",{signal:n.signal,searchParams:H({arg:N9(t),...n}),headers:n.headers}),{Strings:i}=await s.json();return i||[]}return e}),WOe=K(r=>{async function e(t,n,s={}){const i=H({arg:N9(t),...s}),o=new AbortController,a=Uo(o.signal,s.signal);await(await r.post("pubsub/pub",{signal:a,searchParams:i,...await Mo([n],o,s.headers)})).text()}return e}),QOe=U("ipfs-http-client:pubsub:subscribe"),YOe=(r,e)=>K(t=>{async function n(s,i,o={}){o.signal=e.subscribe(s,i,o.signal);let a,c;const u=new Promise((h,f)=>{a=h,c=f}),l=setTimeout(()=>a(),1e3);return t.post("pubsub/sub",{signal:o.signal,searchParams:H({arg:N9(s),...o}),headers:o.headers}).catch(h=>{e.unsubscribe(s,i),c(h)}).then(h=>{clearTimeout(l),h&&(XOe(h,{onMessage:f=>{if(i){if(typeof i=="function"){i(f);return}typeof i.handleEvent=="function"&&i.handleEvent(f)}},onEnd:()=>e.unsubscribe(s,i),onError:o.onError}),a())}),u}return n})(r);async function XOe(r,{onMessage:e,onEnd:t,onError:n}){n=n||QOe;try{for await(const s of r.ndjson())try{if(!s.from)continue;s.from!=null&&s.seqno!=null?e({type:"signed",from:Ae(s.from),data:Qf(s.data),sequenceNumber:qOe(s.seqno),topic:l8(s.topicIDs[0]),key:Qf(s.key??"u"),signature:Qf(s.signature??"u")}):e({type:"unsigned",data:Qf(s.data),topic:l8(s.topicIDs[0])})}catch(i){i.message=`Failed to parse pubsub message: ${i.message}`,n(i,!1,s)}}catch(s){JOe(s)||n(s,!0)}finally{t()}}const JOe=r=>{switch(r.type){case"aborted":return!0;case"abort":return!0;default:return r.name==="AbortError"}},ZOe=(r,e)=>{async function t(n,s){e.unsubscribe(n,s)}return t};class eke{constructor(){this._subs=new Map}subscribe(e,t,n){const s=this._subs.get(e)||[];if(s.find(o=>o.handler===t))throw new Error(`Already subscribed to ${e} with this handler`);const i=new AbortController;return this._subs.set(e,[{handler:t,controller:i}].concat(s)),n&&n.addEventListener("abort",()=>this.unsubscribe(e,t)),i.signal}unsubscribe(e,t){const n=this._subs.get(e)||[];let s;t?(this._subs.set(e,n.filter(i=>i.handler!==t)),s=n.filter(i=>i.handler===t)):(this._subs.set(e,[]),s=n),(this._subs.get(e)||[]).length||this._subs.delete(e),s.forEach(i=>i.controller.abort())}}function tke(r){const e=new eke;return{ls:HOe(r),peers:GOe(r),publish:WOe(r),subscribe:YOe(r,e),unsubscribe:ZOe(r,e)}}const rke=K(r=>{async function*e(t={}){yield*(await r.post("refs/local",{signal:t.signal,transform:xr,searchParams:H(t),headers:t.headers})).ndjson()}return e}),nke=K((r,e)=>Object.assign(async function*(n,s={}){const i=Array.isArray(n)?n:[n];yield*(await r.post("refs",{signal:s.signal,searchParams:H({arg:i.map(a=>`${a instanceof Uint8Array?Re.decode(a):a}`),...s}),headers:s.headers,transform:xr})).ndjson()},{local:rke(e)})),ske=K(r=>{async function*e(t={}){yield*(await r.post("repo/gc",{signal:t.signal,searchParams:H(t),headers:t.headers,transform:s=>({err:s.Error?new Error(s.Error):null,cid:(s.Key||{})["/"]?Re.parse(s.Key["/"]):null})})).ndjson()}return e}),BF=K(r=>{async function e(t={}){const s=await(await r.post("repo/stat",{signal:t.signal,searchParams:H(t),headers:t.headers})).json();return{numObjects:BigInt(s.NumObjects),repoSize:BigInt(s.RepoSize),repoPath:s.RepoPath,version:s.Version,storageMax:BigInt(s.StorageMax)}}return e}),ike=K(r=>{async function e(t={}){return(await(await r.post("repo/version",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()).Version}return e});function oke(r){return{gc:ske(r),stat:BF(r),version:ike(r)}}const ake=K(r=>{async function*e(t={}){yield*(await r.post("stats/bw",{signal:t.signal,searchParams:H(t),headers:t.headers,transform:s=>({totalIn:BigInt(s.TotalIn),totalOut:BigInt(s.TotalOut),rateIn:parseFloat(s.RateIn),rateOut:parseFloat(s.RateOut)})})).ndjson()}return e});function cke(r){return{bitswap:xF(r),repo:BF(r),bw:ake(r)}}const lke=K(r=>{async function e(t={}){const n=await r.post("swarm/addrs",{signal:t.signal,searchParams:H(t),headers:t.headers}),{Addrs:s}=await n.json();return Object.keys(s).map(i=>({id:Ae(i),addrs:(s[i]||[]).map(o=>Cs(o))}))}return e}),uke=K(r=>{async function e(t,n={}){const s=await r.post("swarm/connect",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers}),{Strings:i}=await s.json();return i||[]}return e}),hke=K(r=>{async function e(t,n={}){const s=await r.post("swarm/disconnect",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers}),{Strings:i}=await s.json();return i||[]}return e}),dke=K(r=>{async function e(t={}){const n=await r.post("swarm/addrs/local",{signal:t.signal,searchParams:H(t),headers:t.headers}),{Strings:s}=await n.json();return(s||[]).map(i=>Cs(i))}return e}),fke=K(r=>{async function e(t={}){const n=await r.post("swarm/peers",{signal:t.signal,searchParams:H(t),headers:t.headers}),{Peers:s}=await n.json();return(s||[]).map(i=>({addr:Cs(i.Addr),peer:Ae(i.Peer),muxer:i.Muxer,latency:i.Latency,streams:i.Streams,direction:i.Direction==null?void 0:i.Direction===0?"inbound":"outbound"}))}return e});function pke(r){return{addrs:lke(r),connect:uke(r),disconnect:hke(r),localAddrs:dke(r),peers:fke(r)}}const zF=K(r=>{async function*e(t,n={}){const s=new AbortController,i=Uo(s.signal,n.signal),{headers:o,body:a,total:c,parts:u}=await Mo(t,s,n.headers),[l,h]=typeof n.progress=="function"?yke(c,u,n.progress):[void 0,void 0],f=await r.post("add",{searchParams:H({"stream-channels":!0,...n,progress:!!l}),onUploadProgress:h,signal:i,headers:o,body:a});for await(let y of f.ndjson())y=xr(y),y.hash!==void 0?yield wke(y):l&&l(y.bytes||0,y.name)}return e}),yke=(r,e,t)=>e?[void 0,gke(r,e,t)]:[t,void 0],gke=(r,e,t)=>{let n=0;const s=e.length;return({loaded:i,total:o})=>{const a=Math.floor(i/o*r);for(;n<s;){const{start:c,end:u,name:l}=e[n];if(a<u){t(a-c,l);break}else t(u-c,l),n+=1}}};function wke({name:r,hash:e,size:t,mode:n,mtime:s,mtimeNsecs:i}){const o={path:r,cid:Re.parse(e),size:parseInt(t)};return n!=null&&(o.mode=parseInt(n,8)),s!=null&&(o.mtime={secs:s,nsecs:i||0}),o}function bke(r){const e=zF(r);return K(()=>{async function t(n,s={}){return await ks(e(RM(n),s))}return t})(r)}const mke=K(r=>{async function*e(t,n={}){yield*(await r.post("cat",{signal:n.signal,searchParams:H({arg:t.toString(),...n}),headers:n.headers})).iterator()}return e}),Eke=K(r=>async(t={})=>(await r.post("commands",{signal:t.signal,searchParams:H(t),headers:t.headers})).json()),vke=K(r=>async(t,n={})=>(await(await r.post("dns",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers})).json()).Path),_ke=K(r=>()=>{const e=new URL(r.opts.base||"");return{host:e.hostname,port:e.port,protocol:e.protocol,pathname:e.pathname,"api-path":e.pathname}}),Ske=K(r=>{async function*e(t,n={}){const s={arg:`${t instanceof Uint8Array?Re.decode(t):t}`,...n};s.compressionLevel&&(s["compression-level"]=s.compressionLevel,delete s.compressionLevel),yield*(await r.post("get",{signal:n.signal,searchParams:H(s),headers:n.headers})).iterator()}return e}),FF=K(r=>{async function e(t={}){const s=await(await r.post("id",{signal:t.signal,searchParams:H({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers})).json(),i={...xr(s)};return i.id=Ae(i.id),i.addresses&&(i.addresses=i.addresses.map(o=>Cs(o))),i}return e}),Ake=r=>{const e=FF(r);async function t(n={}){const s=await e(n);return!!(s&&s.addresses&&s.addresses.length)}return t},$ke=K((r,e)=>{async function*t(n,s={}){const i=`${n instanceof Uint8Array?Re.decode(n):n}`;async function o(c){let u=c.Hash;if(u.includes("/")){const h=u.startsWith("/ipfs/")?u:`/ipfs/${u}`;u=(await OF(e)(h)).cid}else u=Re.parse(u);const l={name:c.Name,path:i+(c.Name?`/${c.Name}`:""),size:c.Size,cid:u,type:Tke(c)};return c.Mode&&(l.mode=parseInt(c.Mode,8)),c.Mtime!==void 0&&c.Mtime!==null&&(l.mtime={secs:c.Mtime},c.MtimeNsecs!==void 0&&c.MtimeNsecs!==null&&(l.mtime.nsecs=c.MtimeNsecs)),l}const a=await r.post("ls",{signal:s.signal,searchParams:H({arg:i,...s}),headers:s.headers});for await(let c of a.ndjson()){if(c=c.Objects,!c)throw new Error("expected .Objects in results");if(c=c[0],!c)throw new Error("expected one array in results.Objects");const u=c.Links;if(!Array.isArray(u))throw new Error("expected one array in results.Objects[0].Links");if(!u.length){yield o(c);return}yield*u.map(o)}}return t});function Tke(r){switch(r.Type){case 1:case 5:return"dir";case 2:return"file";default:return"file"}}const Ike=K(r=>{async function e(t={}){const n=await r.post("dns",{signal:t.signal,searchParams:H(t),headers:t.headers});return xr(await n.json())}return e}),Rke=K(r=>{async function*e(t,n={}){yield*(await r.post("ping",{signal:n.signal,searchParams:H({arg:`${t}`,...n}),headers:n.headers,transform:xr})).ndjson()}return e}),Cke=K(r=>{async function e(t,n={}){const s=await r.post("resolve",{signal:n.signal,searchParams:H({arg:t,...n}),headers:n.headers}),{Path:i}=await s.json();return i}return e}),xke=K(r=>async(t={})=>{throw T(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")}),Dke=K(r=>{async function e(t={}){await(await r.post("shutdown",{signal:t.signal,searchParams:H(t),headers:t.headers})).text()}return e}),Pke=K(r=>{async function e(t={}){const n=await r.post("version",{signal:t.signal,searchParams:H(t),headers:t.headers});return{...xr(await n.json()),"ipfs-http-client":"1.0.0"}}return e});function Oke(r={}){const e={name:t8.name,code:t8.code,encode:u=>u,decode:u=>u},t=Object.values(dF);(r.ipld&&r.ipld.bases?r.ipld.bases:[]).forEach(u=>t.push(u));const n=new tF({bases:t,loadBase:r.ipld&&r.ipld.loadBase}),s=Object.values(ixe);[kc,Ak,qk,eN,e].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>s.push(u));const i=new rF({codecs:s,loadCodec:r.ipld&&r.ipld.loadCodec}),o=Object.values(sxe);(r.ipld&&r.ipld.hashers?r.ipld.hashers:[]).forEach(u=>o.push(u));const a=new nF({hashers:o,loadHasher:r.ipld&&r.ipld.loadHasher});return{add:bke(r),addAll:zF(r),bitswap:FDe(r),block:YDe(r),bootstrap:rPe(r),cat:mke(r),commands:Eke(r),config:hPe(r),dag:gPe(i,r),dht:DPe(r),diag:NPe(r),dns:vke(r),files:QPe(r),get:Ske(r),getEndpointConfig:_ke(r),id:FF(r),isOnline:Ake(r),key:nOe(r),log:aOe(r),ls:$ke(r),mount:Ike(r),name:pOe(r),object:TOe(i,r),pin:jOe(r),ping:Rke(r),pubsub:tke(r),refs:nke(r),repo:oke(r),resolve:Cke(r),start:xke(r),stats:cke(r),stop:Dke(r),swarm:pke(r),version:Pke(r),bases:n,codecs:i,hashers:a}}let Fg=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function ZC(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new Fg(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new Fg(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}const ex=mi,kke=Ei,VF=function(r){let e=0;if(r=r.toString().trim(),ex(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(kke(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=ex(t[n]);let o;i&&(o=VF(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},Nke=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Gs=-1,Vg={},u8={},Lke=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Gs,"ip6zone"],[43,8,"ipcidr"],[53,Gs,"dns",!0],[54,Gs,"dns4",!0],[55,Gs,"dns6",!0],[56,Gs,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Gs,"unix",!1,!0],[421,Gs,"ipfs"],[421,Gs,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Gs,"garlic64"],[448,0,"tls"],[449,Gs,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Gs,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Gs,"memory"]];Lke.forEach(r=>{const e=Mke(...r);u8[e.code]=e,Vg[e.name]=e});function Mke(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function vr(r){if(typeof r=="number"){if(u8[r]!=null)return u8[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Vg[r]!=null)return Vg[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var Uke=jF,tx=128,Bke=127,zke=~Bke,Fke=Math.pow(2,31);function jF(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Fke;)e[t++]=r&255|tx,r/=128;for(;r&zke;)e[t++]=r&255|tx,r>>>=7;return e[t]=r|0,jF.bytes=t-n+1,e}var Vke=h8,jke=128,rx=127;function h8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw h8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&rx)<<s:(o&rx)*Math.pow(2,s),s+=7}while(o>=jke);return h8.bytes=i-n,t}var Kke=Math.pow(2,7),qke=Math.pow(2,14),Hke=Math.pow(2,21),Gke=Math.pow(2,28),Wke=Math.pow(2,35),Qke=Math.pow(2,42),Yke=Math.pow(2,49),Xke=Math.pow(2,56),Jke=Math.pow(2,63),Zke=function(r){return r<Kke?1:r<qke?2:r<Hke?3:r<Gke?4:r<Wke?5:r<Qke?6:r<Yke?7:r<Xke?8:r<Jke?9:10},eNe={encode:Uke,decode:Vke,encodingLength:Zke},jg=eNe;const d8=(r,e=0)=>[jg.decode(r,e),jg.decode.bytes],Kg=(r,e,t=0)=>(jg.encode(r,e,t),e),qg=r=>jg.encodingLength(r),tNe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},L9=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},rNe=r=>new TextEncoder().encode(r),nNe=r=>new TextDecoder().decode(r),sNe=(r,e)=>{const t=e.byteLength,n=qg(r),s=n+qg(t),i=new Uint8Array(s+t);return Kg(r,i,0),Kg(t,i,n),i.set(e,s),new M9(r,t,e,i)},KF=r=>{const e=L9(r),[t,n]=d8(e),[s,i]=d8(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new M9(t,s,o,e)},iNe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&tNe(r.bytes,t.bytes)}};let M9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function oNe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var aNe=oNe,cNe=aNe;let lNe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},uNe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return qF(this,e)}},hNe=class{constructor(e){this.decoders=e}or(e){return qF(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const qF=(r,e)=>new hNe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let dNe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new lNe(e,t,n),this.decoder=new uNe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Qb=({name:r,prefix:e,encode:t,decode:n})=>new dNe(r,e,t,n),e0=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=cNe(t,e);return Qb({prefix:r,name:e,encode:n,decode:i=>L9(s(i))})},fNe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},pNe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},en=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Qb({prefix:e,name:r,encode(s){return pNe(s,n,t)},decode(s){return fNe(s,n,t,r)}}),qi=e0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),yNe=e0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),gNe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:qi,base58flickr:yNe},Symbol.toStringTag,{value:"Module"})),Dl=en({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),wNe=en({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bNe=en({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mNe=en({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ENe=en({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vNe=en({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_Ne=en({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),SNe=en({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ANe=en({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),$Ne=Object.freeze(Object.defineProperty({__proto__:null,base32:Dl,base32hex:ENe,base32hexpad:_Ne,base32hexpadupper:SNe,base32hexupper:vNe,base32pad:bNe,base32padupper:mNe,base32upper:wNe,base32z:ANe},Symbol.toStringTag,{value:"Module"})),nx=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return INe(t,f8(r),e||qi.encoder);default:return RNe(t,f8(r),e||Dl.encoder)}},sx=new WeakMap,f8=r=>{const e=sx.get(r);if(e==null){const t=new Map;return sx.set(r,t),t}return e};let HF=class jn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==df)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==CNe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return jn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=sNe(e,t);return jn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return jn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&iNe(e.multihash,n.multihash)}toString(e){return nx(this,e)}toJSON(){return{"/":nx(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof jn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new jn(n,s,i,o||ix(n,s,i.bytes))}else if(t[xNe]===!0){const{version:n,multihash:s,code:i}=t,o=KF(s);return jn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==df)throw new Error(`Version 0 CID must use dag-pb (code: ${df}) block encoding`);return new jn(e,t,n,n.bytes)}case 1:{const s=ix(e,t,n.bytes);return new jn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return jn.create(0,df,e)}static createV1(e,t){return jn.create(1,e,t)}static decode(e){const[t,n]=jn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=jn.inspectBytes(e),n=t.size-t.multihashSize,s=L9(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new M9(t.multihashCode,t.digestSize,i,s);return[t.version===0?jn.createV0(o):jn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=d8(e.subarray(t));return t+=f,h};let s=n(),i=df;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=TNe(e,t),i=jn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return f8(i).set(n,e),i}};const TNe=(r,e)=>{switch(r[0]){case"Q":{const t=e||qi;return[qi.prefix,t.decode(`${qi.prefix}${r}`)]}case qi.prefix:{const t=e||qi;return[qi.prefix,t.decode(r)]}case Dl.prefix:{const t=e||Dl;return[Dl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},INe=(r,e,t)=>{const{prefix:n}=t;if(n!==qi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},RNe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},df=112,CNe=18,ix=(r,e,t)=>{const n=qg(r),s=n+qg(e),i=new Uint8Array(s+t.byteLength);return Kg(r,i,0),Kg(e,i,n),i.set(t,s),i},xNe=Symbol.for("@ipld/js-cid/CID"),DNe=Qb({prefix:"\0",name:"identity",encode:r=>nNe(r),decode:r=>rNe(r)}),PNe=Object.freeze(Object.defineProperty({__proto__:null,identity:DNe},Symbol.toStringTag,{value:"Module"})),ONe=en({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),kNe=Object.freeze(Object.defineProperty({__proto__:null,base2:ONe},Symbol.toStringTag,{value:"Module"})),NNe=en({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),LNe=Object.freeze(Object.defineProperty({__proto__:null,base8:NNe},Symbol.toStringTag,{value:"Module"})),MNe=e0({prefix:"9",name:"base10",alphabet:"0123456789"}),UNe=Object.freeze(Object.defineProperty({__proto__:null,base10:MNe},Symbol.toStringTag,{value:"Module"})),BNe=en({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),zNe=en({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),FNe=Object.freeze(Object.defineProperty({__proto__:null,base16:BNe,base16upper:zNe},Symbol.toStringTag,{value:"Module"})),VNe=e0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),jNe=e0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),KNe=Object.freeze(Object.defineProperty({__proto__:null,base36:VNe,base36upper:jNe},Symbol.toStringTag,{value:"Module"})),qNe=en({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),HNe=en({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),GNe=en({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),WNe=en({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),QNe=Object.freeze(Object.defineProperty({__proto__:null,base64:qNe,base64pad:HNe,base64url:GNe,base64urlpad:WNe},Symbol.toStringTag,{value:"Module"})),GF=Array.from(""),YNe=GF.reduce((r,e,t)=>(r[t]=e,r),[]),XNe=GF.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function JNe(r){return r.reduce((e,t)=>(e+=YNe[t],e),"")}function ZNe(r){const e=[];for(const t of r){const n=XNe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const eLe=Qb({prefix:"",name:"base256emoji",encode:JNe,decode:ZNe}),tLe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:eLe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const rLe={...PNe,...kNe,...LNe,...UNe,...FNe,...$Ne,...KNe,...gNe,...QNe,...tLe};function nLe(r,e){switch(vr(r).code){case 4:case 41:return oLe(e);case 42:return cx(e);case 6:case 273:case 33:case 132:return WF(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return cx(e);case 421:return uLe(e);case 444:return lx(e);case 445:return lx(e);case 466:return lLe(e);default:return R(e,"base16")}}function sLe(r,e){switch(vr(r).code){case 4:return ox(e);case 41:return ox(e);case 42:return ax(e);case 6:case 273:case 33:case 132:return U9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return ax(e);case 421:return aLe(e);case 444:return hLe(e);case 445:return dLe(e);case 466:return cLe(e);default:return M(e,"base16")}}const Z6=Object.values(rLe).map(r=>r.decoder),iLe=function(){let r=Z6[0].or(Z6[1]);return Z6.slice(2).forEach(e=>r=r.or(e)),r}();function ox(r){if(!Nt(r))throw new Error("invalid ip address");return VF(r)}function oLe(r){const e=Nke(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function U9(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function WF(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function ax(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function cx(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function aLe(r){let e;r[0]==="Q"||r[0]==="1"?e=KF(qi.decode(`z${r}`)).bytes:e=HF.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function cLe(r){const e=iLe.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function lLe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function uLe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function hLe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Dl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=U9(n);return z([t,s],t.length+s.length)}function dLe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Dl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=U9(n);return z([t,s],t.length+s.length)}function lx(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=WF(t);return`${n}:${s}`}function fLe(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=vr(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw JF("invalid address: "+r);if(i.path===!0){e.push([s,z9(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function pLe(r){const e=[];return r.map(t=>{const n=Yb(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),z9(e.join("/"))}function yLe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=Yb(e);return e.length>1?[t.code,sLe(t.code,e[1])]:[t.code]})}function QF(r){return r.map(e=>{const t=Yb(e);return e[1]!=null?[t.code,nLe(t.code,e[1])]:[t.code]})}function YF(r){return p8(z(r.map(e=>{const t=Yb(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function XF(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function B9(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=vr(n),o=XF(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw JF("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function ux(r){const e=B9(r),t=QF(e);return pLe(t)}function gLe(r){r=z9(r);const e=fLe(r),t=yLe(e);return YF(t)}function wLe(r){return gLe(r)}function p8(r){const e=bLe(r);if(e!=null)throw e;return Uint8Array.from(r)}function bLe(r){try{B9(r)}catch(e){return e}}function z9(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function JF(r){return new Error("Error parsing address: "+r)}function Yb(r){return vr(r[0])}var ku=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},em=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ff,pf,yf,hx;const mLe=Symbol.for("nodejs.util.inspect.custom"),ELe=[vr("dns").code,vr("dns4").code,vr("dns6").code,vr("dnsaddr").code],vLe=new Map,ZF=Symbol.for("@multiformats/js-multiaddr/multiaddr");function _Le(r){return eV(r)?r.protos().some(e=>e.resolvable):!1}function eV(r){return!!r?.[ZF]}let SLe=class Hu{constructor(e){if(ff.set(this,void 0),pf.set(this,void 0),yf.set(this,void 0),this[hx]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=p8(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=wLe(e)}else if(eV(e))this.bytes=p8(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return ku(this,ff,"f")==null&&em(this,ff,ux(this.bytes),"f"),ku(this,ff,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=vr("tcp"),a=vr("udp"),c=vr("ip4"),u=vr("ip6"),l=vr("dns6"),h=vr("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),ELe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=vr(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=vr(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},vr(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=vr(s),a=XF(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return ku(this,pf,"f")==null&&em(this,pf,B9(this.bytes),"f"),ku(this,pf,"f")}stringTuples(){return ku(this,yf,"f")==null&&em(this,yf,QF(this.tuples()),"f"),ku(this,yf,"f")}encapsulate(e){return e=new Hu(e),new Hu(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Hu(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Hu(YF(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===Vg.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(qi.decode(`z${n}`),"base58btc"):R(HF.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>vr(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=vLe.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new Hu(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(ff=new WeakMap,pf=new WeakMap,yf=new WeakMap,hx=ZF,mLe)](){return`Multiaddr(${ux(this.bytes)})`}};function tV(r){return new SLe(r)}function ALe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var $Le=ALe,TLe=$Le;const ILe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},F9=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},RLe=r=>new TextEncoder().encode(r),CLe=r=>new TextDecoder().decode(r);let xLe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},DLe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return rV(this,e)}},PLe=class{constructor(e){this.decoders=e}or(e){return rV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const rV=(r,e)=>new PLe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let OLe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new xLe(e,t,n),this.decoder=new DLe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Xb=({name:r,prefix:e,encode:t,decode:n})=>new OLe(r,e,t,n),t0=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=TLe(t,e);return Xb({prefix:r,name:e,encode:n,decode:i=>F9(s(i))})},kLe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},NLe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},tn=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Xb({prefix:e,name:r,encode(s){return NLe(s,n,t)},decode(s){return kLe(s,n,t,r)}}),Hi=t0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),LLe=t0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),MLe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Hi,base58flickr:LLe},Symbol.toStringTag,{value:"Module"}));var ULe=nV,dx=128,BLe=127,zLe=~BLe,FLe=Math.pow(2,31);function nV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=FLe;)e[t++]=r&255|dx,r/=128;for(;r&zLe;)e[t++]=r&255|dx,r>>>=7;return e[t]=r|0,nV.bytes=t-n+1,e}var VLe=y8,jLe=128,fx=127;function y8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw y8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&fx)<<s:(o&fx)*Math.pow(2,s),s+=7}while(o>=jLe);return y8.bytes=i-n,t}var KLe=Math.pow(2,7),qLe=Math.pow(2,14),HLe=Math.pow(2,21),GLe=Math.pow(2,28),WLe=Math.pow(2,35),QLe=Math.pow(2,42),YLe=Math.pow(2,49),XLe=Math.pow(2,56),JLe=Math.pow(2,63),ZLe=function(r){return r<KLe?1:r<qLe?2:r<HLe?3:r<GLe?4:r<WLe?5:r<QLe?6:r<YLe?7:r<XLe?8:r<JLe?9:10},eMe={encode:ULe,decode:VLe,encodingLength:ZLe},Hg=eMe;const g8=(r,e=0)=>[Hg.decode(r,e),Hg.decode.bytes],Gg=(r,e,t=0)=>(Hg.encode(r,e,t),e),Wg=r=>Hg.encodingLength(r),tMe=(r,e)=>{const t=e.byteLength,n=Wg(r),s=n+Wg(t),i=new Uint8Array(s+t);return Gg(r,i,0),Gg(t,i,n),i.set(e,s),new V9(r,t,e,i)},sV=r=>{const e=F9(r),[t,n]=g8(e),[s,i]=g8(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new V9(t,s,o,e)},rMe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&ILe(r.bytes,t.bytes)}};let V9=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const Pl=tn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),nMe=tn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sMe=tn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),iMe=tn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oMe=tn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),aMe=tn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cMe=tn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lMe=tn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uMe=tn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),hMe=Object.freeze(Object.defineProperty({__proto__:null,base32:Pl,base32hex:oMe,base32hexpad:cMe,base32hexpadupper:lMe,base32hexupper:aMe,base32pad:sMe,base32padupper:iMe,base32upper:nMe,base32z:uMe},Symbol.toStringTag,{value:"Module"})),px=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return fMe(t,w8(r),e||Hi.encoder);default:return pMe(t,w8(r),e||Pl.encoder)}},yx=new WeakMap,w8=r=>{const e=yx.get(r);if(e==null){const t=new Map;return yx.set(r,t),t}return e};let iV=class Kn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==gf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==yMe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Kn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=tMe(e,t);return Kn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Kn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&rMe(e.multihash,n.multihash)}toString(e){return px(this,e)}toJSON(){return{"/":px(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Kn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Kn(n,s,i,o||gx(n,s,i.bytes))}else if(t[gMe]===!0){const{version:n,multihash:s,code:i}=t,o=sV(s);return Kn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==gf)throw new Error(`Version 0 CID must use dag-pb (code: ${gf}) block encoding`);return new Kn(e,t,n,n.bytes)}case 1:{const s=gx(e,t,n.bytes);return new Kn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Kn.create(0,gf,e)}static createV1(e,t){return Kn.create(1,e,t)}static decode(e){const[t,n]=Kn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Kn.inspectBytes(e),n=t.size-t.multihashSize,s=F9(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new V9(t.multihashCode,t.digestSize,i,s);return[t.version===0?Kn.createV0(o):Kn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=g8(e.subarray(t));return t+=f,h};let s=n(),i=gf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=dMe(e,t),i=Kn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return w8(i).set(n,e),i}};const dMe=(r,e)=>{switch(r[0]){case"Q":{const t=e||Hi;return[Hi.prefix,t.decode(`${Hi.prefix}${r}`)]}case Hi.prefix:{const t=e||Hi;return[Hi.prefix,t.decode(r)]}case Pl.prefix:{const t=e||Pl;return[Pl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},fMe=(r,e,t)=>{const{prefix:n}=t;if(n!==Hi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},pMe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},gf=112,yMe=18,gx=(r,e,t)=>{const n=Wg(r),s=n+Wg(e),i=new Uint8Array(s+t.byteLength);return Gg(r,i,0),Gg(e,i,n),i.set(t,s),i},gMe=Symbol.for("@ipld/js-cid/CID"),wMe=Math.pow(2,7),bMe=Math.pow(2,14),mMe=Math.pow(2,21),j9=Math.pow(2,28),K9=Math.pow(2,35),q9=Math.pow(2,42),H9=Math.pow(2,49),lt=128,Zn=127;function Gc(r){if(r<wMe)return 1;if(r<bMe)return 2;if(r<mMe)return 3;if(r<j9)return 4;if(r<K9)return 5;if(r<q9)return 6;if(r<H9)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function EMe(r,e,t=0){switch(Gc(r)){case 8:e[t++]=r&255|lt,r/=128;case 7:e[t++]=r&255|lt,r/=128;case 6:e[t++]=r&255|lt,r/=128;case 5:e[t++]=r&255|lt,r/=128;case 4:e[t++]=r&255|lt,r>>>=7;case 3:e[t++]=r&255|lt,r>>>=7;case 2:e[t++]=r&255|lt,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function vMe(r,e,t=0){switch(Gc(r)){case 8:e.set(t++,r&255|lt),r/=128;case 7:e.set(t++,r&255|lt),r/=128;case 6:e.set(t++,r&255|lt),r/=128;case 5:e.set(t++,r&255|lt),r/=128;case 4:e.set(t++,r&255|lt),r>>>=7;case 3:e.set(t++,r&255|lt),r>>>=7;case 2:e.set(t++,r&255|lt),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function _Me(r,e){let t=r[e],n=0;if(n+=t&Zn,t<lt||(t=r[e+1],n+=(t&Zn)<<7,t<lt)||(t=r[e+2],n+=(t&Zn)<<14,t<lt)||(t=r[e+3],n+=(t&Zn)<<21,t<lt)||(t=r[e+4],n+=(t&Zn)*j9,t<lt)||(t=r[e+5],n+=(t&Zn)*K9,t<lt)||(t=r[e+6],n+=(t&Zn)*q9,t<lt)||(t=r[e+7],n+=(t&Zn)*H9,t<lt))return n;throw new RangeError("Could not decode varint")}function SMe(r,e){let t=r.get(e),n=0;if(n+=t&Zn,t<lt||(t=r.get(e+1),n+=(t&Zn)<<7,t<lt)||(t=r.get(e+2),n+=(t&Zn)<<14,t<lt)||(t=r.get(e+3),n+=(t&Zn)<<21,t<lt)||(t=r.get(e+4),n+=(t&Zn)*j9,t<lt)||(t=r.get(e+5),n+=(t&Zn)*K9,t<lt)||(t=r.get(e+6),n+=(t&Zn)*q9,t<lt)||(t=r.get(e+7),n+=(t&Zn)*H9,t<lt))return n;throw new RangeError("Could not decode varint")}function Jb(r,e,t=0){return e==null&&(e=$o(Gc(r))),e instanceof Uint8Array?EMe(r,e,t):vMe(r,e,t)}function r0(r,e=0){return r instanceof Uint8Array?_Me(r,e):SMe(r,e)}const AMe=Xb({prefix:"\0",name:"identity",encode:r=>CLe(r),decode:r=>RLe(r)}),$Me=Object.freeze(Object.defineProperty({__proto__:null,identity:AMe},Symbol.toStringTag,{value:"Module"})),TMe=tn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),IMe=Object.freeze(Object.defineProperty({__proto__:null,base2:TMe},Symbol.toStringTag,{value:"Module"})),RMe=tn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),CMe=Object.freeze(Object.defineProperty({__proto__:null,base8:RMe},Symbol.toStringTag,{value:"Module"})),xMe=t0({prefix:"9",name:"base10",alphabet:"0123456789"}),DMe=Object.freeze(Object.defineProperty({__proto__:null,base10:xMe},Symbol.toStringTag,{value:"Module"})),PMe=tn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),OMe=tn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),kMe=Object.freeze(Object.defineProperty({__proto__:null,base16:PMe,base16upper:OMe},Symbol.toStringTag,{value:"Module"})),NMe=t0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),LMe=t0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),MMe=Object.freeze(Object.defineProperty({__proto__:null,base36:NMe,base36upper:LMe},Symbol.toStringTag,{value:"Module"})),UMe=tn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),BMe=tn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zMe=tn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),FMe=tn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),VMe=Object.freeze(Object.defineProperty({__proto__:null,base64:UMe,base64pad:BMe,base64url:zMe,base64urlpad:FMe},Symbol.toStringTag,{value:"Module"})),oV=Array.from(""),jMe=oV.reduce((r,e,t)=>(r[t]=e,r),[]),KMe=oV.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function qMe(r){return r.reduce((e,t)=>(e+=jMe[t],e),"")}function HMe(r){const e=[];for(const t of r){const n=KMe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const GMe=Xb({prefix:"",name:"base256emoji",encode:qMe,decode:HMe}),WMe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:GMe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const QMe={...$Me,...IMe,...CMe,...DMe,...kMe,...hMe,...MMe,...MLe,...VMe,...WMe},wx=mi,YMe=Ei,aV=function(r){let e=0;if(r=r.toString().trim(),wx(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(YMe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=wx(t[n]);let o;i&&(o=aV(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},XMe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Ws=-1,Y1={},b8={},JMe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Ws,"ip6zone"],[43,8,"ipcidr"],[53,Ws,"dns",!0],[54,Ws,"dns4",!0],[55,Ws,"dns6",!0],[56,Ws,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Ws,"unix",!1,!0],[421,Ws,"ipfs"],[421,Ws,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Ws,"garlic64"],[448,0,"tls"],[449,Ws,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Ws,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Ws,"memory"]];JMe.forEach(r=>{const e=ZMe(...r);b8[e.code]=e,Y1[e.name]=e});function ZMe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function Wt(r){if(typeof r=="number"){if(b8[r]!=null)return b8[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Y1[r]!=null)return Y1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}Wt("ip4");Wt("ip6");Wt("ipcidr");function cV(r,e){switch(Wt(r).code){case 4:case 41:return tUe(e);case 42:return vx(e);case 6:case 273:case 33:case 132:return lV(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return vx(e);case 421:return iUe(e);case 444:return _x(e);case 445:return _x(e);case 466:return sUe(e);default:return R(e,"base16")}}function bx(r,e){switch(Wt(r).code){case 4:return mx(e);case 41:return mx(e);case 42:return Ex(e);case 6:case 273:case 33:case 132:return G9(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Ex(e);case 421:return rUe(e);case 444:return oUe(e);case 445:return aUe(e);case 466:return nUe(e);default:return M(e,"base16")}}const tm=Object.values(QMe).map(r=>r.decoder),eUe=function(){let r=tm[0].or(tm[1]);return tm.slice(2).forEach(e=>r=r.or(e)),r}();function mx(r){if(!Nt(r))throw new Error("invalid ip address");return aV(r)}function tUe(r){const e=XMe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function G9(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function lV(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function Ex(r){const e=M(r),t=Uint8Array.from(Jb(e.length));return z([t,e],t.length+e.length)}function vx(r){const e=r0(r);if(r=r.slice(Gc(e)),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function rUe(r){let e;r[0]==="Q"||r[0]==="1"?e=sV(Hi.decode(`z${r}`)).bytes:e=iV.parse(r).multihash.bytes;const t=Uint8Array.from(Jb(e.length));return z([t,e],t.length+e.length)}function nUe(r){const e=eUe.decode(r),t=Uint8Array.from(Jb(e.length));return z([t,e],t.length+e.length)}function sUe(r){const e=r0(r),t=r.slice(Gc(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function iUe(r){const e=r0(r),t=r.slice(Gc(e));if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function oUe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Pl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=G9(n);return z([t,s],t.length+s.length)}function aUe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Pl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=G9(n);return z([t,s],t.length+s.length)}function _x(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=lV(t);return`${n}:${s}`}function cUe(r){r=m8(r);const e=[],t=[];let n=null;const s=r.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){const o=s[i],a=Wt(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw dV("invalid address: "+r);if(a.path===!0){n=m8(s.slice(i).join("/")),e.push([a.code,bx(a.code,n)]),t.push([a.code,n]);break}const c=bx(a.code,s[i]);e.push([a.code,c]),t.push([a.code,cV(a.code,c)])}return{string:uV(t),bytes:hV(e),tuples:e,stringTuples:t,path:n}}function Sx(r){const e=[],t=[];let n=null,s=0;for(;s<r.length;){const i=r0(r,s),o=Gc(i),a=Wt(i),c=lUe(a,r.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}const u=r.slice(s+o,s+o+c);if(s+=c+o,s>r.length)throw dV("Invalid address Uint8Array: "+R(r,"base16"));e.push([i,u]);const l=cV(i,u);if(t.push([i,l]),a.path===!0){n=l;break}}return{bytes:Uint8Array.from(r),string:uV(t),tuples:e,stringTuples:t,path:n}}function uV(r){const e=[];return r.map(t=>{const n=Wt(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),m8(e.join("/"))}function hV(r){return z(r.map(e=>{const t=Wt(e[0]);let n=Uint8Array.from(Jb(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n}))}function lUe(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=r0(e instanceof Uint8Array?e:Uint8Array.from(e));return t+Gc(t)}}function m8(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function dV(r){return new Error("Error parsing address: "+r)}const uUe=Symbol.for("nodejs.util.inspect.custom"),hUe=[Wt("dns").code,Wt("dns4").code,Wt("dns6").code,Wt("dnsaddr").code],dUe=new Map,fV=Symbol.for("@multiformats/js-multiaddr/multiaddr");function fUe(r){return!!r?.[fV]}var gh,hc,ap,cp,unt,ia;let pUe=(ia=class{constructor(e){N(this,"bytes");ar(this,gh,void 0);ar(this,hc,void 0);ar(this,ap,void 0);ar(this,cp,void 0);N(this,unt,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=Sx(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=cUe(e)}else if(fUe(e))t=Sx(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,Dt(this,gh,t.string),Dt(this,hc,t.tuples),Dt(this,ap,t.stringTuples),Dt(this,cp,t.path)}toString(){return ve(this,gh)}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=Wt("tcp"),a=Wt("udp"),c=Wt("ip4"),u=Wt("ip6"),l=Wt("dns6"),h=Wt("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),hUe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=Wt(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=Wt(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return ve(this,hc).map(([e])=>Object.assign({},Wt(e)))}protoCodes(){return ve(this,hc).map(([e])=>e)}protoNames(){return ve(this,hc).map(([e])=>Wt(e).name)}tuples(){return ve(this,hc)}stringTuples(){return ve(this,ap)}encapsulate(e){return e=new ia(e),new ia(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ia(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new ia(hV(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,s])=>{n===Y1.p2p.code&&e.push([n,s]),n===Y1["p2p-circuit"].code&&(e=[])});const t=e.pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Hi.decode(`z${n}`),"base58btc"):R(iV.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ve(this,cp)}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=dUe.get(t.name);if(n==null)throw new Bw(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new ia(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(unt=fV,uUe)](){return`Multiaddr(${ve(this,gh)})`}},gh=new WeakMap,hc=new WeakMap,ap=new WeakMap,cp=new WeakMap,ia);function pV(r){return new pUe(r)}const yUe=nr("dns4"),gUe=nr("dns6"),wUe=nr("dnsaddr"),Qg=wd(nr("dns"),wUe,yUe,gUe),bUe=wd(nr("ip4"),nr("ip6")),E8=wd(hi(bUe,nr("tcp")),hi(Qg,nr("tcp"))),Ax=wd(hi(E8,nr("ws")),hi(Qg,nr("ws"))),$x=wd(hi(E8,nr("wss")),hi(Qg,nr("wss")),hi(E8,nr("tls"),nr("ws")),hi(Qg,nr("tls"),nr("ws"))),mUe=wd(hi(Ax,nr("p2p-webrtc-star"),nr("p2p")),hi($x,nr("p2p-webrtc-star"),nr("p2p")),hi(Ax,nr("p2p-webrtc-star")),hi($x,nr("p2p-webrtc-star")));function yV(r){function e(t){let n;try{n=pV(t)}catch{return!1}const s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return e}function hi(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(s=>(n=typeof s=="function"?s().partialMatch(t):s.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:yV(e),partialMatch:e}}function wd(...r){function e(n){let s=null;return r.some(i=>{const o=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return o!=null?(s=o,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:yV(e),partialMatch:e}}function nr(r){const e=r;function t(s){let i;try{i=pV(s)}catch{return!1}const o=i.protoNames();return o.length===1&&o[0]===e}function n(s){return s.length===0?null:s[0]===e?s.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const Tx=421,EUe=290,vUe=2e3,Po=Object.create(null);Po.open="0";Po.close="1";Po.ping="2";Po.pong="3";Po.message="4";Po.upgrade="5";Po.noop="6";const M2=Object.create(null);Object.keys(Po).forEach(r=>{M2[Po[r]]=r});const v8={type:"error",data:"parser error"},gV=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",wV=typeof ArrayBuffer=="function",bV=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,W9=({type:r,data:e},t,n)=>gV&&e instanceof Blob?t?n(e):Ix(e,n):wV&&(e instanceof ArrayBuffer||bV(e))?t?n(e):Ix(new Blob([e]),n):n(Po[r]+(e||"")),Ix=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function Rx(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let rm;function _Ue(r,e){if(gV&&r.data instanceof Blob)return r.data.arrayBuffer().then(Rx).then(e);if(wV&&(r.data instanceof ArrayBuffer||bV(r.data)))return e(Rx(r.data));W9(r,!1,t=>{rm||(rm=new TextEncoder),e(rm.encode(t))})}const Cx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Yf=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<Cx.length;r++)Yf[Cx.charCodeAt(r)]=r;const SUe=r=>{let e=r.length*.75,t=r.length,n,s=0,i,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const u=new ArrayBuffer(e),l=new Uint8Array(u);for(n=0;n<t;n+=4)i=Yf[r.charCodeAt(n)],o=Yf[r.charCodeAt(n+1)],a=Yf[r.charCodeAt(n+2)],c=Yf[r.charCodeAt(n+3)],l[s++]=i<<2|o>>4,l[s++]=(o&15)<<4|a>>2,l[s++]=(a&3)<<6|c&63;return u},AUe=typeof ArrayBuffer=="function",Q9=(r,e)=>{if(typeof r!="string")return{type:"message",data:mV(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:$Ue(r.substring(1),e)}:M2[t]?r.length>1?{type:M2[t],data:r.substring(1)}:{type:M2[t]}:v8},$Ue=(r,e)=>{if(AUe){const t=SUe(r);return mV(t,e)}else return{base64:!0,data:r}},mV=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},EV=String.fromCharCode(30),TUe=(r,e)=>{const t=r.length,n=new Array(t);let s=0;r.forEach((i,o)=>{W9(i,!1,a=>{n[o]=a,++s===t&&e(n.join(EV))})})},IUe=(r,e)=>{const t=r.split(EV),n=[];for(let s=0;s<t.length;s++){const i=Q9(t[s],e);if(n.push(i),i.type==="error")break}return n};function RUe(){return new TransformStream({transform(r,e){_Ue(r,t=>{const n=t.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const i=new DataView(s.buffer);i.setUint8(0,126),i.setUint16(1,n)}else{s=new Uint8Array(9);const i=new DataView(s.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(n))}r.data&&typeof r.data!="string"&&(s[0]|=128),e.enqueue(s),e.enqueue(t)})}})}let nm;function X0(r){return r.reduce((e,t)=>e+t.length,0)}function J0(r,e){if(r[0].length===e)return r.shift();const t=new Uint8Array(e);let n=0;for(let s=0;s<e;s++)t[s]=r[0][n++],n===r[0].length&&(r.shift(),n=0);return r.length&&n<r[0].length&&(r[0]=r[0].slice(n)),t}function CUe(r,e){nm||(nm=new TextDecoder);const t=[];let n=0,s=-1,i=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(n===0){if(X0(t)<1)break;const c=J0(t,1);i=(c[0]&128)===128,s=c[0]&127,s<126?n=3:s===126?n=1:n=2}else if(n===1){if(X0(t)<2)break;const c=J0(t,2);s=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),n=3}else if(n===2){if(X0(t)<8)break;const c=J0(t,8),u=new DataView(c.buffer,c.byteOffset,c.length),l=u.getUint32(0);if(l>Math.pow(2,53-32)-1){a.enqueue(v8);break}s=l*Math.pow(2,32)+u.getUint32(4),n=3}else{if(X0(t)<s)break;const c=J0(t,s);a.enqueue(Q9(i?c:nm.decode(c),e)),n=0}if(s===0||s>r){a.enqueue(v8);break}}}})}const vV=4;function Sr(r){if(r)return xUe(r)}function xUe(r){for(var e in Sr.prototype)r[e]=Sr.prototype[e];return r}Sr.prototype.on=Sr.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};Sr.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};Sr.prototype.off=Sr.prototype.removeListener=Sr.prototype.removeAllListeners=Sr.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,s=0;s<t.length;s++)if(n=t[s],n===e||n.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+r],this};Sr.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,s=t.length;n<s;++n)t[n].apply(this,e)}return this};Sr.prototype.emitReserved=Sr.prototype.emit;Sr.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Sr.prototype.hasListeners=function(r){return!!this.listeners(r).length};const ai=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function _V(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const DUe=ai.setTimeout,PUe=ai.clearTimeout;function Zb(r,e){e.useNativeTimers?(r.setTimeoutFn=DUe.bind(ai),r.clearTimeoutFn=PUe.bind(ai)):(r.setTimeoutFn=ai.setTimeout.bind(ai),r.clearTimeoutFn=ai.clearTimeout.bind(ai))}const OUe=1.33;function kUe(r){return typeof r=="string"?NUe(r):Math.ceil((r.byteLength||r.size)*OUe)}function NUe(r){let e=0,t=0;for(let n=0,s=r.length;n<s;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function LUe(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function MUe(r){let e={},t=r.split("&");for(let n=0,s=t.length;n<s;n++){let i=t[n].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}class UUe extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Y9 extends Sr{constructor(e){super(),this.writable=!1,Zb(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new UUe(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Q9(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=LUe(e);return t.length?"?"+t:""}}const SV="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),_8=64,BUe={};let xx=0,Z0=0,Dx;function Px(r){let e="";do e=SV[r%_8]+e,r=Math.floor(r/_8);while(r>0);return e}function AV(){const r=Px(+new Date);return r!==Dx?(xx=0,Dx=r):r+"."+Px(xx++)}for(;Z0<_8;Z0++)BUe[SV[Z0]]=Z0;let $V=!1;try{$V=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const zUe=$V;function TV(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||zUe))return new XMLHttpRequest}catch{}if(!e)try{return new ai[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function FUe(){}const VUe=function(){return new TV({xdomain:!1}).responseType!=null}();class jUe extends Y9{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}const t=e&&e.forceBase64;this.supportsBinary=VUe&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};IUe(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,TUe(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=AV()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Ao(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(s,i)=>{this.onError("xhr post error",s,i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class Ao extends Sr{constructor(e,t){super(),Zb(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;const t=_V(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new TV(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var s;n.readyState===3&&((s=this.opts.cookieJar)===null||s===void 0||s.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document<"u"&&(this.index=Ao.requestsCount++,Ao.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=FUe,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Ao.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Ao.requestsCount=0;Ao.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ox);else if(typeof addEventListener=="function"){const r="onpagehide"in ai?"pagehide":"unload";addEventListener(r,Ox,!1)}}function Ox(){for(let r in Ao.requests)Ao.requests.hasOwnProperty(r)&&Ao.requests[r].abort()}const X9=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),e2=ai.WebSocket||ai.MozWebSocket,kx=!0,KUe="arraybuffer",Nx=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class qUe extends Y9{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=Nx?{}:_V(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=kx&&!Nx?t?new e2(e,t):new e2(e):new e2(e,t,n)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;W9(n,this.supportsBinary,i=>{const o={};try{kx&&this.ws.send(i)}catch{}s&&X9(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=AV()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!e2}}class HUe extends Y9{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const t=CUe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),s=RUe();s.readable.pipeTo(e.writable),this.writer=s.writable.getWriter();const i=()=>{n.read().then(({done:a,value:c})=>{a||(this.onPacket(c),i())}).catch(a=>{})};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;this.writer.write(n).then(()=>{s&&X9(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const GUe={websocket:qUe,webtransport:HUe,polling:jUe},WUe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,QUe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function S8(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let s=WUe.exec(r||""),i={},o=14;for(;o--;)i[QUe[o]]=s[o]||"";return t!=-1&&n!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=YUe(i,i.path),i.queryKey=XUe(i,i.query),i}function YUe(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function XUe(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,i){s&&(t[s]=i)}),t}let IV=class Gu extends Sr{constructor(e,t={}){super(),this.binaryType=KUe,this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=S8(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=S8(t.host).host),Zb(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=MUe(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=vV,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new GUe[e](n)}open(){let e;if(this.opts.rememberUpgrade&&Gu.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;Gu.priorWebsocketSuccess=!1;const s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!n)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Gu.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=t.name,this.emitReserved("upgradeError",f)}}))};function i(){n||(n=!0,l(),t.close(),t=null)}const o=h=>{const f=new Error("probe error: "+h);f.transport=t.name,i(),this.emitReserved("upgradeError",f)};function a(){o("transport closed")}function c(){o("socket closed")}function u(h){t&&h.name!==t.name&&i()}const l=()=>{t.removeListener("open",s),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",s),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onOpen(){if(this.readyState="open",Gu.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(t+=kUe(s)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,s){if(typeof t=="function"&&(s=t,t=void 0),typeof n=="function"&&(s=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){Gu.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const s=e.length;for(;n<s;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};IV.protocol=vV;function JUe(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=S8(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+e,n.href=n.protocol+"://"+i+(t&&t.port===n.port?"":":"+n.port),n}const ZUe=typeof ArrayBuffer=="function",eBe=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,RV=Object.prototype.toString,tBe=typeof Blob=="function"||typeof Blob<"u"&&RV.call(Blob)==="[object BlobConstructor]",rBe=typeof File=="function"||typeof File<"u"&&RV.call(File)==="[object FileConstructor]";function J9(r){return ZUe&&(r instanceof ArrayBuffer||eBe(r))||tBe&&r instanceof Blob||rBe&&r instanceof File}function U2(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(U2(r[t]))return!0;return!1}if(J9(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return U2(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&U2(r[t]))return!0;return!1}function nBe(r){const e=[],t=r.data,n=r;return n.data=A8(t,e),n.attachments=e.length,{packet:n,buffers:e}}function A8(r,e){if(!r)return r;if(J9(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=A8(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=A8(r[n],e));return t}return r}function sBe(r,e){return r.data=$8(r.data,e),delete r.attachments,r}function $8(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=$8(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=$8(r[t],e));return r}const iBe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],oBe=5;var Ne;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(Ne||(Ne={}));let aBe=class{constructor(e){this.replacer=e}encode(e){return(e.type===Ne.EVENT||e.type===Ne.ACK)&&U2(e)?this.encodeAsBinary({type:e.type===Ne.EVENT?Ne.BINARY_EVENT:Ne.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Ne.BINARY_EVENT||e.type===Ne.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=nBe(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}};function Lx(r){return Object.prototype.toString.call(r)==="[object Object]"}let cBe=class CV extends Sr{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===Ne.BINARY_EVENT;n||t.type===Ne.BINARY_ACK?(t.type=n?Ne.EVENT:Ne.ACK,this.reconstructor=new lBe(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(J9(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(Ne[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===Ne.BINARY_EVENT||n.type===Ne.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(i,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(i,t)}else n.nsp="/";const s=e.charAt(t+1);if(s!==""&&Number(s)==s){const i=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(CV.isPayloadValid(n.type,i))n.data=i;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case Ne.CONNECT:return Lx(t);case Ne.DISCONNECT:return t===void 0;case Ne.CONNECT_ERROR:return typeof t=="string"||Lx(t);case Ne.EVENT:case Ne.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&iBe.indexOf(t[0])===-1);case Ne.ACK:case Ne.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}};class lBe{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=sBe(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const uBe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:cBe,Encoder:aBe,get PacketType(){return Ne},protocol:oBe},Symbol.toStringTag,{value:"Module"}));function Ni(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const hBe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class xV extends Sr{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ni(e,"open",this.onopen.bind(this)),Ni(e,"packet",this.onpacket.bind(this)),Ni(e,"error",this.onerror.bind(this)),Ni(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(hBe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:Ne.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const s=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},s);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...o])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((s,i)=>{t.push((o,a)=>n?o?i(o):s(a):s(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...i)=>n!==this._queue[0]?void 0:(s!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...i)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Ne.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Ne.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ne.EVENT:case Ne.BINARY_EVENT:this.onevent(e);break;case Ne.ACK:case Ne.BINARY_ACK:this.onack(e);break;case Ne.DISCONNECT:this.ondisconnect();break;case Ne.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:Ne.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ne.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function bd(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}bd.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};bd.prototype.reset=function(){this.attempts=0};bd.prototype.setMin=function(r){this.ms=r};bd.prototype.setMax=function(r){this.max=r};bd.prototype.setJitter=function(r){this.jitter=r};class T8 extends Sr{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Zb(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new bd({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||uBe;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new IV(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=Ni(t,"open",function(){n.onopen(),e&&e()}),i=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Ni(t,"error",i);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{s(),i(new Error("timeout")),t.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ni(e,"ping",this.onping.bind(this)),Ni(e,"data",this.ondata.bind(this)),Ni(e,"error",this.onerror.bind(this)),Ni(e,"close",this.onclose.bind(this)),Ni(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){X9(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new xV(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const wf={};function B2(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=JUe(r,e.path||"/socket.io"),n=t.source,s=t.id,i=t.path,o=wf[s]&&i in wf[s].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new T8(n,e):(wf[s]||(wf[s]=new T8(n,e)),c=wf[s]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(B2,{Manager:T8,Socket:xV,io:B2,connect:B2});const t2=65536;function dBe(r){const e=new Uint8Array(r);let t=0;if(r>0)if(r>t2)for(;t<r;)t+t2>r?(crypto.getRandomValues(e.subarray(t,t+(r-t))),t+=r-t):(crypto.getRandomValues(e.subarray(t,t+t2)),t+=t2);else crypto.getRandomValues(e);return e}var fBe=dBe;const Z9=Et(fBe),Mx=64*1024,pBe=5*1e3;class yBe{constructor(e,t){this.label=e.label,this.open=pt(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,typeof this.channel.bufferedAmountLowThreshold=="number"&&(this.channel.bufferedAmountLowThreshold=Mx),e.addEventListener("message",s=>{t.onMessage(s)}),e.addEventListener("bufferedamountlow",()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()}),e.addEventListener("open",()=>{this.open.resolve(),t.onOpen()}),e.addEventListener("close",()=>{t.onClose()}),e.addEventListener("error",s=>{if(s.error?.message==="Transport channel closed")return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,s.error?.message,s.error?.errorDetail);const i=s.error instanceof Error?s.error:new Error(`datachannel error: ${s.error?.message} ${s.error?.errorDetail}`);t.onError(T(i,"ERR_DATA_CHANNEL"))});let n=!1;this.closingInterval=setInterval(()=>{e.readyState==="closing"?(n&&t.onClose(),n=!0):n=!1},pBe)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>Mx&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=pt())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}}var e_={exports:{}};const gBe=(r,e)=>Math.floor(Math.random()*(e-r+1)+r),Ux=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},Bx=({clearTimeout:r,setTimeout:e,willResolve:t})=>(n,{value:s,signal:i}={})=>{if(i&&i.aborted)return Promise.reject(Ux());let o,a,c;const u=r||clearTimeout,l=()=>{u(o),c(Ux())},h=()=>{i&&i.removeEventListener("abort",l)},f=new Promise((y,d)=>{a=()=>{h(),t?y(s):d(s)},c=d,o=(e||setTimeout)(a,n)});return i&&i.addEventListener("abort",l,{once:!0}),f.clear=()=>{u(o),o=null,a()},f},DV=r=>{const e=Bx({...r,willResolve:!0});return e.reject=Bx({...r,willResolve:!1}),e.range=(t,n,s)=>e(gBe(t,n),s),e},t_=DV();t_.createWithTimers=DV;e_.exports=t_;e_.exports.default=t_;var wBe=e_.exports;const PV=Et(wBe),bBe={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};function mBe(){if(typeof globalThis>"u")throw T(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");const r={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(r.RTCPeerConnection==null)throw T(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return r}class OV extends Zt{constructor(e){super(),this.id=e.id??R(Z9(4),"hex").slice(0,7),this.log=U(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??mBe(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},bBe,e.peerConnectionConfig)),this.closed=!1,this.connected=pt(),this.source=$r(),this.sink=async t=>{if(await this.connected.promise,this.channel==null)throw T(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(const n of t)await this.channel.send(n);await this.close()}}handleDataChannelEvent(e){const t=e.channel;if(t==null){this.close(T(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch(n=>{this.log("Error closing after event channel was found to be null",n)});return}this.channel=new yBe(t,{log:this.log,onMessage:n=>{this.source.push(new Uint8Array(n.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new oe("ready"))},onClose:()=>{this.close().catch(n=>{this.log("error closing connection after channel close",n)})},onError:n=>{this.close(n).catch(s=>{this.log("error closing connection after channel error",s)})}})}async close(e){if(this.closed=!0,e==null&&this.channel!=null)for(;this.channel.bufferedAmount>0;)await PV(100);this.channel?.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new oe("close"))}}class kV extends Zt{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch(t=>{this.log.error("could not renegotiate %o",t)})})}async handleSignal(e){if(this.log('incoming signal "%s"',e.type),e.type==="offer")return await this.handleOffer(e);if(e.type==="answer")return await this.handleAnswer(e);if(e.type==="candidate")return await this.handleCandidate(e);if(e.type==="renegotiate")return await this.handleRenegotiate(e);if(e.type==="goodbye")return await this.handleGoodye(e);this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){const t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(n){if(t.address==null||t.address.endsWith(".local"))this.log("ignoring unsupported ICE candidate.");else throw T(n,"ERR_ADD_ICE_CANDIDATE")}}}const zx=U("libp2p:webrtc-peer:receiver");class EBe extends OV{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new vBe({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",t=>this.dispatchEvent(new oe("signal",{detail:t.detail}))),this.peerConnection.addEventListener("datachannel",t=>{this.handleDataChannelEvent(t)})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}}class vBe extends kV{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){zx.trace("renegotiate"),this.dispatchEvent(new oe("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(const n of this.iceCandidates)await this.handleCandidate(n);this.iceCandidates=[];const t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),zx.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new oe("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){if(this.peerConnection.remoteDescription==null||this.peerConnection.remoteDescription.type==null){this.iceCandidates.push(e);return}await super.handleCandidate(e)}}const _Be=r=>{const e=r.on||r.addListener||r.addEventListener,t=r.off||r.removeListener||r.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function SBe(r,e,t){let n;const s=new Promise((i,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");const a=[e].flat(),c=[],{addListener:u,removeListener:l}=_Be(r),h=(...y)=>{const d=t.multiArgs?y:y[0];t.filter&&!t.filter(d)||(c.push(d),t.count===c.length&&(n(),i(c)))},f=y=>{n(),o(y)};n=()=>{for(const y of a)l(y,h);for(const y of t.rejectionEvents)l(y,f)};for(const y of a)u(y,h);for(const y of t.rejectionEvents)u(y,f);t.resolveImmediately&&i(c)});if(s.cancel=n,typeof t.timeout=="number"){const i=IO(s,t.timeout);return i.cancel=n,i}return s}function ABe(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=SBe(r,e,t),s=n.then(i=>i[0]);return s.cancel=n.cancel,s}const sm=U("libp2p:webrtc-peer:initator"),$Be=1e3;class TBe extends OV{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??R(Z9(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new IBe({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",t=>{this.dispatchEvent(new oe("signal",{detail:t.detail}))})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}}class IBe extends kV{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",t=>{if(t.candidate==null)return;const n={type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}};sm.trace("create candidate",n),this.dispatchEvent(new oe("signal",{detail:n})),this.dispatchEvent(new oe("ice-candidate"))})}async handleRenegotiate(){if(this.status==="negotiating"){this.log("already negotiating, queueing");return}this.status="negotiating";const e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await ABe(this,"ice-candidate"),await PV($Be),sm.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new oe("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){sm.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}}const im=U("libp2p:webrtc-star:socket");function NV(r,e){const{sink:t,source:n}=r,s={remoteAddr:e.remoteAddr,async sink(i){e.signal!=null&&(i=ZC(i,e.signal));try{await t(i)}catch(o){o.type!=="aborted"&&im.error(o)}},source:e.signal!=null?ZC(n,e.signal):n,timeline:{open:Date.now()},async close(){if(r.closed)return;const i=Date.now(),o=setTimeout(()=>{if(s.remoteAddr!=null){const{host:a,port:c}=s.remoteAddr.toOptions();im("timeout closing socket to %s:%s after %dms, destroying it manually",a,c,Date.now()-i)}r.closed||r.close().catch(a=>{im.error("could not close socket",a)})},vUe);try{await r.close()}finally{clearTimeout(o)}}};return r.addEventListener("close",()=>{s.timeline.close==null&&(s.timeline.close=Date.now())},{once:!0}),s}function LV(r){const e=r.toString().split("/"),t=r.protos()[1].name,n=r.protos()[2].name,s=r.stringTuples()[1][1];if(t!=="tcp"||n!=="ws"&&n!=="wss")throw new Error(`invalid multiaddr: ${r.toString()}`);if(!_Le(r))return`http://${e[2]}:${e[4]}`;if(n==="ws")return`http://${e[2]}${s==null||s==="80"?"":`:${s}`}`;if(n==="wss")return`https://${e[2]}${s==null||s==="443"?"":`:${s}`}`;throw new Error("invalid multiaddr: "+r.toString())}function RBe(r){const e="/libp2p-webrtc-star";if(r.startsWith(e)){r=r.substring(e.length,r.length);let t=tV(r);const n=t.stringTuples().filter(s=>s[0]===421)[0];if(n[1]==null)throw new Error("invalid multiaddr: "+r);t=t.decapsulate("p2p"),t=t.encapsulate("/p2p-webrtc-star"),t=t.encapsulate(`/p2p/${n[1]}`),r=t.toString()}return r}const Yn=U("libp2p:webrtc-star:listener"),CBe={transports:["websocket"],path:"/socket.io-next/"};class xBe extends Zt{constructor(e,t,n,s,i){super(),this.signallingAddr=t,this.socket=B2(e,CBe),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=n,this.handler=s,this.channelOptions=i,this.handleWsHandshake=this.handleWsHandshake.bind(this);let o=!1;this.socket.on("connect_error",a=>{o&&a.type==="TransportError"||this.dispatchEvent(new oe("error",{detail:a}))}),this.socket.on("error",a=>{this.dispatchEvent(new oe("error",{detail:a}))}),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",a=>{this.dispatchEvent(new oe("peer",{detail:a}))}),this.socket.on("connect",()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),o&&this.dispatchEvent(new oe("reconnect"))}),this.socket.once("connect",()=>{o=!0,this.dispatchEvent(new oe("listening"))}),this.socket.on("disconnect",()=>{this.dispatchEvent(new oe("disconnect"))})}_createChannel(e,t,n){const s={...this.channelOptions},i=new EBe(s),o=a=>{const c=a.detail;Yn.error("incoming connection errored",c)};return i.addEventListener("error",o),i.addEventListener("close",()=>{i.removeEventListener("error",o)},{once:!0}),i.addEventListener("signal",a=>{const c=a.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:n,answer:!0,signal:c})}),i.addEventListener("ready",()=>{const a=NV(i,{remoteAddr:this.signallingAddr});Yn("new inbound connection %s",a.remoteAddr);try{this.upgrader.upgradeInbound(a).then(c=>{Yn("inbound connection %s upgraded",a.remoteAddr),this.connections.push(a);const u=()=>{this.connections=this.connections.filter(l=>l!==a),this.channels.delete(e),this.pendingSignals.delete(e)};i.addEventListener("close",u,{once:!0}),this.dispatchEvent(new oe("connection",{detail:c})),this.handler(c)}).catch(c=>{Yn.error("inbound connection failed to upgrade",c),a.close().catch(u=>{Yn.error("inbound connection failed to close after failing to upgrade",u)})})}catch(c){Yn.error("inbound connection failed to upgrade",c),a.close().catch(u=>{Yn.error("inbound connection failed to close after failing to upgrade",u)})}},{once:!0}),i}handleWsHandshake(e){if(Yn('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),e.answer===!0||e.err!=null||e.intentId==null)return;const t=e.intentId;let n=this.pendingSignals.get(t);n==null&&(n=[],this.pendingSignals.set(t,n)),n.push(e);let s=this.channels.get(t);if(s==null){if(e.signal.type!=="offer"){Yn("handshake is not an offer and channel does not exist, buffering until we receive an offer");return}Yn("creating new channel to handle offer handshake"),s=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,s)}else Yn("channel already exists, using it to handle handshake");for(;n.length>0;){const i=n.shift();i?.signal!=null&&s.handleSignal(i.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map(async e=>await e.close()),...Array.from(this.channels.values()).map(async e=>await e.close())]),this.dispatchEvent(new oe("close"))}}class DBe extends Zt{constructor(e,t,n,s,i){super(),this.upgrader=e,this.handler=t,this.peerId=n,this.transport=s,this.options=i}async listen(e){if(this.listeningAddr!=null)throw T(new Error("listener already in use"),"ERR_ALREADY_LISTENING");const t=pt();this.listeningAddr=e;let n;e.protoCodes().includes(Tx)?n=e:n=e.encapsulate(`/p2p/${this.peerId.toString()}`);const s=this.signallingUrl=LV(e);Yn("connecting to signalling server on: %s",this.signallingUrl);const i=new xBe(this.signallingUrl,n,this.upgrader,this.handler,this.options.channelOptions);return i.addEventListener("error",o=>{const a=o.detail;Yn("error connecting to signalling server %o",a),i.close().catch(c=>{Yn.error("error closing server after error",c)}),t.reject(a)}),i.addEventListener("listening",()=>{Yn("connected to signalling server"),this.dispatchEvent(new oe("listening")),t.resolve()}),i.addEventListener("peer",o=>{this.transport.peerDiscovered(o.detail)}),i.addEventListener("connection",o=>{const a=o.detail;if(a.remoteAddr==null)try{a.remoteAddr=e.decapsulateCode(Tx).encapsulate(`/p2p/${a.remotePeer.toString()}`)}catch(c){Yn.error("could not determine remote address",c)}this.dispatchEvent(new oe("connection",{detail:a}))}),i.addEventListener("disconnect",()=>{this.transport.sigServers.delete(s)}),i.addEventListener("reconnect",()=>{this.transport.sigServers.set(s,i)}),this.transport.sigServers.set(this.signallingUrl,i),await t.promise}async close(){if(this.signallingUrl!=null){const e=this.transport.sigServers.get(this.signallingUrl);e!=null&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new oe("close")),this.listeningAddr=void 0}getAddrs(){return this.listeningAddr!=null?[this.listeningAddr]:[]}}function PBe(r,e,t,n,s){return new DBe(r,e,t,n,s)}const r_=Symbol.for("@libp2p/transport");var hh;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(hh||(hh={}));const n0=Symbol.for("@libp2p/peer-discovery"),OBe="RTCPeerConnection"in globalThis,nl=U("libp2p:webrtc-star"),kBe=()=>{};class NBe extends Zt{constructor(){super(...arguments),this.started=!1}get[n0](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return this.isStarted()?super.dispatchEvent(e):!1}}let LBe=class{constructor(e){e?.wrtc!=null&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new NBe,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[r_](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){const n=await this._connect(e,t),s=NV(n,{remoteAddr:e,signal:t.signal});nl("new outbound connection %s",s.remoteAddr);const i=await t.upgrader.upgradeOutbound(s);return nl("outbound connection %s upgraded",s.remoteAddr),i}async _connect(e,t){if(t.signal?.aborted===!0)throw new Fg;const n={...t.channelOptions??{}};this.wrtc!=null&&(n.wrtc=this.wrtc);const s=e.toOptions(),i=R(Z9(36),"hex");return await new Promise((o,a)=>{const c=this.sigServers.get(LV(e));if(c?.socket==null)return a(T(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let u=!1;nl("dialing %s:%s",s.host,s.port);const l=new TBe(n),h=p=>{const b=p.detail;if(!u){const w=`connection error ${s.host}:${s.port}: ${b.message}`;nl.error(w),d(b)}},f=()=>{u=!0,nl("connection opened %s:%s",s.host,s.port),d()},y=()=>{nl.error("connection aborted %s:%s",s.host,s.port),l.close().finally(()=>{d(new Fg)})},d=p=>{l.removeEventListener("ready",f),t.signal?.removeEventListener("abort",y),p==null?o(l):a(p)};l.addEventListener("ready",f,{once:!0}),l.addEventListener("close",()=>{l.removeEventListener("error",h)}),t.signal?.addEventListener("abort",y),l.addEventListener("signal",p=>{const b=p.detail;c.socket.emit("ss-handshake",{intentId:i,srcMultiaddr:c.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:b})}),c.socket.on("ws-handshake",p=>{p.intentId===i&&p.err!=null&&l.close().finally(()=>{a(T(new Error(p.err),"ERR_SIGNALLING_FAILED"))}),!(p.intentId!==i||p.answer==null||l.closed)&&l.handleSignal(p.signal)})})}createListener(e){if(!OBe&&this.wrtc==null)throw T(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},this.wrtc!=null&&(e.channelOptions.wrtc=this.wrtc),this.peerId==null)throw T(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return PBe(e.upgrader,e.handler??kBe,this.peerId,this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(EUe)?!1:mUe.matches(t))}peerDiscovered(e){nl("peer discovered: %s",e),e=RBe(e);const t=tV(e),n=t.getPeerId();if(n==null)return;const s=Ae(n);this._discovery.dispatchEvent(new oe("peer",{detail:{id:s,multiaddrs:[t],protocols:[]}}))}};function MBe(r={}){const e=new LBe(r);return{transport:t=>(e.peerId=t.peerId,e),discovery:e.discovery}}function UBe(){const r=MBe();return{transports:[r.transport],peerDiscovery:[r.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1}}}function ol(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}const Fx=mi,BBe=Ei,MV=function(r){let e=0;if(r=r.toString().trim(),Fx(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(BBe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=Fx(t[n]);let o;i&&(o=MV(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},zBe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Qs=-1,Yg={},I8={},FBe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Qs,"ip6zone"],[43,8,"ipcidr"],[53,Qs,"dns",!0],[54,Qs,"dns4",!0],[55,Qs,"dns6",!0],[56,Qs,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Qs,"unix",!1,!0],[421,Qs,"ipfs"],[421,Qs,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Qs,"garlic64"],[448,0,"tls"],[449,Qs,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Qs,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Qs,"memory"]];FBe.forEach(r=>{const e=VBe(...r);I8[e.code]=e,Yg[e.name]=e});function VBe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function Ht(r){if(typeof r=="number"){if(I8[r]!=null)return I8[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Yg[r]!=null)return Yg[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var jBe=UV,Vx=128,KBe=127,qBe=~KBe,HBe=Math.pow(2,31);function UV(r,e,t){e=e||[],t=t||0;for(var n=t;r>=HBe;)e[t++]=r&255|Vx,r/=128;for(;r&qBe;)e[t++]=r&255|Vx,r>>>=7;return e[t]=r|0,UV.bytes=t-n+1,e}var GBe=R8,WBe=128,jx=127;function R8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw R8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&jx)<<s:(o&jx)*Math.pow(2,s),s+=7}while(o>=WBe);return R8.bytes=i-n,t}var QBe=Math.pow(2,7),YBe=Math.pow(2,14),XBe=Math.pow(2,21),JBe=Math.pow(2,28),ZBe=Math.pow(2,35),eze=Math.pow(2,42),tze=Math.pow(2,49),rze=Math.pow(2,56),nze=Math.pow(2,63),sze=function(r){return r<QBe?1:r<YBe?2:r<XBe?3:r<JBe?4:r<ZBe?5:r<eze?6:r<tze?7:r<rze?8:r<nze?9:10},ize={encode:jBe,decode:GBe,encodingLength:sze},Xg=ize;const C8=(r,e=0)=>[Xg.decode(r,e),Xg.decode.bytes],Jg=(r,e,t=0)=>(Xg.encode(r,e,t),e),Zg=r=>Xg.encodingLength(r),oze=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},n_=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},aze=r=>new TextEncoder().encode(r),cze=r=>new TextDecoder().decode(r),x8=(r,e)=>{const t=e.byteLength,n=Zg(r),s=n+Zg(t),i=new Uint8Array(s+t);return Jg(r,i,0),Jg(t,i,n),i.set(e,s),new s_(r,t,e,i)},BV=r=>{const e=n_(r),[t,n]=C8(e),[s,i]=C8(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new s_(t,s,o,e)},lze=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&oze(r.bytes,t.bytes)}};let s_=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function uze(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var hze=uze,dze=hze;let fze=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},pze=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zV(this,e)}},yze=class{constructor(e){this.decoders=e}or(e){return zV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const zV=(r,e)=>new yze({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let gze=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new fze(e,t,n),this.decoder=new pze(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const e3=({name:r,prefix:e,encode:t,decode:n})=>new gze(r,e,t,n),s0=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=dze(t,e);return e3({prefix:r,name:e,encode:n,decode:i=>n_(s(i))})},wze=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},bze=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},rn=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>e3({prefix:e,name:r,encode(s){return bze(s,n,t)},decode(s){return wze(s,n,t,r)}}),Gi=s0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mze=s0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Eze=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Gi,base58flickr:mze},Symbol.toStringTag,{value:"Module"})),Ol=rn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vze=rn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_ze=rn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sze=rn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Aze=rn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$ze=rn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Tze=rn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ize=rn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Rze=rn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Cze=Object.freeze(Object.defineProperty({__proto__:null,base32:Ol,base32hex:Aze,base32hexpad:Tze,base32hexpadupper:Ize,base32hexupper:$ze,base32pad:_ze,base32padupper:Sze,base32upper:vze,base32z:Rze},Symbol.toStringTag,{value:"Module"})),Kx=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return Dze(t,D8(r),e||Gi.encoder);default:return Pze(t,D8(r),e||Ol.encoder)}},qx=new WeakMap,D8=r=>{const e=qx.get(r);if(e==null){const t=new Map;return qx.set(r,t),t}return e};let i_=class qn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==bf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Oze)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return qn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=x8(e,t);return qn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return qn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&lze(e.multihash,n.multihash)}toString(e){return Kx(this,e)}toJSON(){return{"/":Kx(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof qn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new qn(n,s,i,o||Hx(n,s,i.bytes))}else if(t[kze]===!0){const{version:n,multihash:s,code:i}=t,o=BV(s);return qn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==bf)throw new Error(`Version 0 CID must use dag-pb (code: ${bf}) block encoding`);return new qn(e,t,n,n.bytes)}case 1:{const s=Hx(e,t,n.bytes);return new qn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return qn.create(0,bf,e)}static createV1(e,t){return qn.create(1,e,t)}static decode(e){const[t,n]=qn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=qn.inspectBytes(e),n=t.size-t.multihashSize,s=n_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new s_(t.multihashCode,t.digestSize,i,s);return[t.version===0?qn.createV0(o):qn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=C8(e.subarray(t));return t+=f,h};let s=n(),i=bf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=xze(e,t),i=qn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return D8(i).set(n,e),i}};const xze=(r,e)=>{switch(r[0]){case"Q":{const t=e||Gi;return[Gi.prefix,t.decode(`${Gi.prefix}${r}`)]}case Gi.prefix:{const t=e||Gi;return[Gi.prefix,t.decode(r)]}case Ol.prefix:{const t=e||Ol;return[Ol.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Dze=(r,e,t)=>{const{prefix:n}=t;if(n!==Gi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},Pze=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},bf=112,Oze=18,Hx=(r,e,t)=>{const n=Zg(r),s=n+Zg(e),i=new Uint8Array(s+t.byteLength);return Jg(r,i,0),Jg(e,i,n),i.set(t,s),i},kze=Symbol.for("@ipld/js-cid/CID"),Nze=e3({prefix:"\0",name:"identity",encode:r=>cze(r),decode:r=>aze(r)}),Lze=Object.freeze(Object.defineProperty({__proto__:null,identity:Nze},Symbol.toStringTag,{value:"Module"})),Mze=rn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Uze=Object.freeze(Object.defineProperty({__proto__:null,base2:Mze},Symbol.toStringTag,{value:"Module"})),Bze=rn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),zze=Object.freeze(Object.defineProperty({__proto__:null,base8:Bze},Symbol.toStringTag,{value:"Module"})),Fze=s0({prefix:"9",name:"base10",alphabet:"0123456789"}),Vze=Object.freeze(Object.defineProperty({__proto__:null,base10:Fze},Symbol.toStringTag,{value:"Module"})),jze=rn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kze=rn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),qze=Object.freeze(Object.defineProperty({__proto__:null,base16:jze,base16upper:Kze},Symbol.toStringTag,{value:"Module"})),Hze=s0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gze=s0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Wze=Object.freeze(Object.defineProperty({__proto__:null,base36:Hze,base36upper:Gze},Symbol.toStringTag,{value:"Module"})),Qze=rn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Yze=rn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Xze=rn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Jze=rn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Zze=Object.freeze(Object.defineProperty({__proto__:null,base64:Qze,base64pad:Yze,base64url:Xze,base64urlpad:Jze},Symbol.toStringTag,{value:"Module"})),FV=Array.from(""),eFe=FV.reduce((r,e,t)=>(r[t]=e,r),[]),tFe=FV.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function rFe(r){return r.reduce((e,t)=>(e+=eFe[t],e),"")}function nFe(r){const e=[];for(const t of r){const n=tFe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const sFe=e3({prefix:"",name:"base256emoji",encode:rFe,decode:nFe}),iFe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:sFe},Symbol.toStringTag,{value:"Module"})),oFe=({name:r,code:e,encode:t})=>new aFe(r,e,t);let aFe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?x8(this.code,t):t.then(n=>x8(this.code,n))}else throw Error("Unknown type, must be binary type")}};const cFe=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),lFe=oFe({name:"sha2-256",code:18,encode:cFe("SHA-256")});new TextEncoder;new TextDecoder;const uFe={...Lze,...Uze,...zze,...Vze,...qze,...Cze,...Wze,...Eze,...Zze,...iFe};function hFe(r,e){switch(Ht(r).code){case 4:case 41:return pFe(e);case 42:return Qx(e);case 6:case 273:case 33:case 132:return VV(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Qx(e);case 421:return bFe(e);case 444:return Yx(e);case 445:return Yx(e);case 466:return wFe(e);default:return R(e,"base16")}}function dFe(r,e){switch(Ht(r).code){case 4:return Gx(e);case 41:return Gx(e);case 42:return Wx(e);case 6:case 273:case 33:case 132:return o_(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Wx(e);case 421:return yFe(e);case 444:return mFe(e);case 445:return EFe(e);case 466:return gFe(e);default:return M(e,"base16")}}const om=Object.values(uFe).map(r=>r.decoder),fFe=function(){let r=om[0].or(om[1]);return om.slice(2).forEach(e=>r=r.or(e)),r}();function Gx(r){if(!Nt(r))throw new Error("invalid ip address");return MV(r)}function pFe(r){const e=zBe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function o_(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function VV(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function Wx(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function Qx(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function yFe(r){let e;r[0]==="Q"||r[0]==="1"?e=BV(Gi.decode(`z${r}`)).bytes:e=i_.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function gFe(r){const e=fFe.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function wFe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function bFe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function mFe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ol.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=o_(n);return z([t,s],t.length+s.length)}function EFe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Ol.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=o_(n);return z([t,s],t.length+s.length)}function Yx(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=VV(t);return`${n}:${s}`}function vFe(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=Ht(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw HV("invalid address: "+r);if(i.path===!0){e.push([s,c_(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function _Fe(r){const e=[];return r.map(t=>{const n=t3(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),c_(e.join("/"))}function SFe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=t3(e);return e.length>1?[t.code,dFe(t.code,e[1])]:[t.code]})}function jV(r){return r.map(e=>{const t=t3(e);return e[1]!=null?[t.code,hFe(t.code,e[1])]:[t.code]})}function KV(r){return P8(z(r.map(e=>{const t=t3(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function qV(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function a_(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=Ht(n),o=qV(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw HV("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function Xx(r){const e=a_(r),t=jV(e);return _Fe(t)}function AFe(r){r=c_(r);const e=vFe(r),t=SFe(e);return KV(t)}function $Fe(r){return AFe(r)}function P8(r){const e=TFe(r);if(e!=null)throw e;return Uint8Array.from(r)}function TFe(r){try{a_(r)}catch(e){return e}}function c_(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function HV(r){return new Error("Error parsing address: "+r)}function t3(r){return Ht(r[0])}var Nu=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},am=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},mf,Ef,vf,Jx;const IFe=Symbol.for("nodejs.util.inspect.custom"),RFe=[Ht("dns").code,Ht("dns4").code,Ht("dns6").code,Ht("dnsaddr").code],GV=new Map,WV=Symbol.for("@multiformats/js-multiaddr/multiaddr");function CFe(r,e){if(r==null)throw new Error("requires node address object");if(e==null)throw new Error("requires transport protocol");let t,n=r.address;switch(r.family){case 4:t="ip4";break;case 6:if(t="ip6",n.includes("%")){const s=n.split("%");if(s.length!==2)throw Error("Multiple ip6 zones in multiaddr");n=s[0],t=`/ip6zone/${s[1]}/ip6`}break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new QV("/"+[t,n,e,r.port].join("/"))}function kl(r){return!!r?.[WV]}let QV=class Wu{constructor(e){if(mf.set(this,void 0),Ef.set(this,void 0),vf.set(this,void 0),this[Jx]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=P8(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=$Fe(e)}else if(kl(e))this.bytes=P8(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Nu(this,mf,"f")==null&&am(this,mf,Xx(this.bytes),"f"),Nu(this,mf,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=Ht("tcp"),a=Ht("udp"),c=Ht("ip4"),u=Ht("ip6"),l=Ht("dns6"),h=Ht("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),RFe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=Ht(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=Ht(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},Ht(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=Ht(s),a=qV(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Nu(this,Ef,"f")==null&&am(this,Ef,a_(this.bytes),"f"),Nu(this,Ef,"f")}stringTuples(){return Nu(this,vf,"f")==null&&am(this,vf,jV(this.tuples()),"f"),Nu(this,vf,"f")}encapsulate(e){return e=new Wu(e),new Wu(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Wu(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Wu(KV(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===Yg.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Gi.decode(`z${n}`),"base58btc"):R(i_.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>Ht(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=GV.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new Wu(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(mf=new WeakMap,Ef=new WeakMap,vf=new WeakMap,Jx=WV,IFe)](){return`Multiaddr(${Xx(this.bytes)})`}};function ur(r){return new QV(r)}var st;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.DHT_DISABLED="DHT is not available",r.PUBSUB_DISABLED="PubSub is not available",r.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",r.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",r.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",r.NOT_FOUND="Not found"})(st||(st={}));var O;(function(r){r.DHT_DISABLED="ERR_DHT_DISABLED",r.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",r.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",r.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",r.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",r.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",r.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",r.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",r.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",r.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",r.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",r.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",r.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",r.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",r.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",r.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",r.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",r.ERR_DIALED_SELF="ERR_DIALED_SELF",r.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",r.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",r.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",r.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",r.ERR_INVALID_KEY="ERR_INVALID_KEY",r.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",r.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",r.ERR_INVALID_PEER="ERR_INVALID_PEER",r.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",r.ERR_NOT_FOUND="ERR_NOT_FOUND",r.ERR_TIMEOUT="ERR_TIMEOUT",r.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",r.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",r.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",r.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",r.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",r.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",r.ERR_FIND_SELF="ERR_FIND_SELF",r.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",r.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",r.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",r.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",r.ERR_INVALID_CMS="ERR_INVALID_CMS",r.ERR_MISSING_KEYS="ERR_MISSING_KEYS",r.ERR_NO_KEY="ERR_NO_KEY",r.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",r.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",r.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",r.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",r.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",r.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",r.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",r.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",r.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",r.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",r.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",r.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",r.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",r.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",r.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",r.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",r.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",r.ERR_INVALID_RECORD="ERR_INVALID_RECORD",r.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",r.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",r.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",r.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",r.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED"})(O||(O={}));async function*O8(r,e){yield*ls(r,async t=>(await e.addressBook.add(t.id,t.multiaddrs),t))}function YV(r){const e=new Set;return Yt(r,t=>e.has(t.id.toString())?!1:(e.add(t.id.toString()),!0))}async function*XV(r,e=1){let t=0;for await(const n of r)t++,yield n;if(t<e)throw T(new Error("not found"),"NOT_FOUND")}const dh=new Map,xFe=()=>`${Date.now()}:${Math.floor(Math.random()*1e6)}`;async function DFe(r,e,t){for(;dh.get(t);){try{await r()}catch(n){setTimeout(()=>{throw n},1);break}if(!dh.get(t))break;await new Promise(n=>{const s=setTimeout(n,e);dh.set(t,s)})}}function PFe(r,e,t){t=t||e;const n=xFe(),s=setTimeout(()=>{DFe(r,e,n)},t);return dh.set(n,s),n}function OFe(r){const e=dh.get(r);e&&(clearTimeout(e),dh.delete(r))}var ew={setDelayedInterval:PFe,clearDelayedInterval:OFe};const Zx=U("libp2p:peer-routing");class kFe{constructor(e,t){this.components=e,this.routers=t.routers??[],this.refreshManagerInit=t.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||this.routers.length===0||this.timeoutId!=null||this.refreshManagerInit.enabled===!1||(this.timeoutId=ew.setDelayedInterval(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){if(this.abortController==null)try{this.abortController=new Xt.TimeoutController(this.refreshManagerInit.timeout??1e4);try{Rt.setMaxListeners?.(1/0,this.abortController.signal)}catch{}await jr(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(e){Zx.error(e)}finally{this.abortController?.clear(),this.abortController=void 0}}async stop(){ew.clearDelayedInterval(this.timeoutId),this.abortController?.abort(),this.started=!1}async findPeer(e,t){if(this.routers.length===0)throw T(new Error("No peer routers available"),O.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw T(new Error("Should not try to find self"),O.ERR_FIND_SELF);const n=await Ve(ys(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(i){Zx.error(i)}}())),s=>Yt(s,Boolean),s=>O8(s,this.components.peerStore),async s=>await to(s));if(n!=null)return n;throw T(new Error(st.NOT_FOUND),O.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(this.routers.length===0)throw T(new Error("No peer routers available"),O.ERR_NO_ROUTERS_AVAILABLE);yield*Ve(ys(...this.routers.map(n=>n.getClosestPeers(e,t))),n=>O8(n,this.components.peerStore),n=>YV(n),n=>XV(n))}}class NFe{constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw T(new Error("No content this.routers available"),O.ERR_NO_ROUTERS_AVAILABLE);yield*Ve(ys(...this.routers.map(n=>n.findProviders(e,t))),n=>O8(n,this.components.peerStore),n=>YV(n),n=>XV(n))}async provide(e,t={}){if(this.routers.length===0)throw T(new Error("No content routers available"),O.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async n=>await n.provide(e,t)))}async put(e,t,n){if(!this.isStarted())throw T(new Error(st.NOT_STARTED_YET),O.DHT_NOT_STARTED);const s=this.components.dht;s!=null&&await jr(s.put(e,t,n))}async get(e,t){if(!this.isStarted())throw T(new Error(st.NOT_STARTED_YET),O.DHT_NOT_STARTED);const n=this.components.dht;if(n!=null){for await(const s of n.get(e,t))if(s.name==="VALUE")return s.value}throw T(new Error(st.NOT_FOUND),O.ERR_NOT_FOUND)}async*getMany(e,t,n){if(!this.isStarted())throw T(new Error(st.NOT_STARTED_YET),O.DHT_NOT_STARTED);if(t==null||t===0)return;let s=0;const i=this.components.dht;if(i!=null){for await(const o of i.get(e,n))if(o.name==="VALUE"&&(yield{from:o.from,val:o.value},s++,s===t))break}if(s===0)throw T(new Error(st.NOT_FOUND),O.ERR_NOT_FOUND)}}const LFe=r=>r;class MFe extends Zt{constructor(e,t){super();const{listen:n=[],announce:s=[]}=t;this.components=e,this.listen=n.map(i=>i.toString()),this.announce=new Set(s.map(i=>i.toString())),this.observed=new Set,this.announceFilter=t.announceFilter??LFe}getListenAddrs(){return Array.from(this.listen).map(e=>ur(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>ur(e))}getObservedAddrs(){return Array.from(this.observed).map(e=>ur(e))}confirmObservedAddr(e){}removeObservedAddr(e){}addObservedAddr(e){let t=ur(e);const n=t.getPeerId();n!=null&&Ae(n).equals(this.components.peerId)&&(t=t.decapsulate(ur(`/p2p/${this.components.peerId.toString()}`)));const s=t.toString();this.observed.has(s)||(this.observed.add(s),this.dispatchEvent(new oe("change:addresses")))}getAddresses(){let e=this.getAnnounceAddrs().map(n=>n.toString());e.length===0&&(e=this.components.transportManager.getAddrs().map(n=>n.toString())),e=e.concat(this.getObservedAddrs().map(n=>n.toString()));const t=new Set(e);return this.announceFilter(Array.from(t).map(n=>ur(n))).map(n=>n.protos().pop()?.path===!0||n.getPeerId()===this.components.peerId.toString()?n:n.encapsulate(`/p2p/${this.components.peerId.toString()}`))}}const eD=U("libp2p:connection-manager:latency-monitor:visibility-change-emitter");class UFe extends Zt{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",globalThis.document!=null&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let e="hidden",t="visibilitychange";typeof globalThis.document.hidden<"u"?(e="hidden",t="visibilitychange"):typeof globalThis.document.mozHidden<"u"?(e="mozHidden",t="mozvisibilitychange"):typeof globalThis.document.msHidden<"u"?(e="msHidden",t="msvisibilitychange"):typeof globalThis.document.webkitHidden<"u"&&(e="webkitHidden",t="webkitvisibilitychange"),this.hidden=e,this.visibilityChange=t}_addVisibilityChangeListener(){typeof globalThis.document.addEventListener>"u"||typeof document[this.hidden]>"u"?eD("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(!(this.hidden===void 0||document[this.hidden]===void 0))return document[this.hidden]==null}_handleVisibilityChange(){const e=globalThis.document[this.hidden]===!1;eD(e?"Page Visible":"Page Hidden"),this.dispatchEvent(new oe("visibilityChange",{detail:e}))}}const Ko=U("libp2p:connection-manager:latency-monitor");class BFe extends Zt{constructor(e={}){super();const{latencyCheckIntervalMs:t,dataEmitIntervalMs:n,asyncTestFn:s,latencyRandomPercentage:i}=e;this.latencyCheckIntervalMs=t??500,this.latencyRandomPercentage=i??10,this.latencyCheckMultiply=2*(this.latencyRandomPercentage/100)*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=n===null||n===0?void 0:n??5*1e3,Ko("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),this.dataEmitIntervalMs!=null?Ko("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):Ko("Not emitting summaries"),this.asyncTestFn=s,globalThis.process?.hrtime!=null?(Ko("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=o=>{const a=this.now(o);return a[0]*1e3+a[1]/1e6}):typeof window<"u"&&window.performance?.now!=null?(Ko("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=o=>Math.round(this.now()-o)):(Ko("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=o=>this.now()-o),this.latencyData=this.initLatencyData()}start(){zFe()&&(this.visibilityChangeEmitter=new UFe,this.visibilityChangeEmitter.addEventListener("visibilityChange",e=>{const{detail:t}=e;t?this._startTimers():(this._emitSummary(),this._stopTimers())})),this.visibilityChangeEmitter?.isVisible()===!0&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){this.checkLatencyID==null&&(this.checkLatency(),this.dataEmitIntervalMs!=null&&(this.emitIntervalID=setInterval(()=>this._emitSummary(),this.dataEmitIntervalMs),typeof this.emitIntervalID.unref=="function"&&this.emitIntervalID.unref()))}_stopTimers(){this.checkLatencyID!=null&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),this.emitIntervalID!=null&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.dispatchEvent(new oe("data",{detail:e}))}getSummary(){const e={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),Ko.trace("Summary: %O",e),e}checkLatency(){const e=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,t={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+e),startTime:this.now()},n=()=>{if(this.checkLatencyID==null)return;const s=this.getDeltaMS(t.startTime)-t.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,s),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,s),this.latencyData.totalMs+=s,Ko.trace("MS: %s Data: %O",s,this.latencyData)};Ko.trace("localData: %O",t),this.checkLatencyID=setTimeout(()=>{this.asyncTestFn!=null?(t.deltaOffset=0,t.startTime=this.now(),this.asyncTestFn(n)):(t.deltaOffset-=1,n())},t.deltaOffset),typeof this.checkLatencyID.unref=="function"&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function zFe(){return typeof globalThis.window<"u"}const JV="OPEN",tD="CLOSING",cm="CLOSED";function tw(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),s=n.value;return n.done===!0||s==null?{done:!0,value:void 0}:{done:!1,value:e(s)}}};return t}class FFe{constructor(e){N(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return tw(this.map.entries(),e=>[Ae(e[0]),e[1]])}forEach(e){this.map.forEach((t,n)=>{e(t,Ae(n),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return tw(this.map.keys(),e=>Ae(e))}values(){return this.map.values()}get size(){return this.map.size}}class Pc{constructor(e){N(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return tw(this.set.entries(),e=>{const t=Ae(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=Ae(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return tw(this.set.values(),e=>Ae(e))}intersection(e){const t=new Pc;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new Pc;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new Pc;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}const VFe="keep-alive";function ZV(r){if(ua(r))return{peerId:r};if(kl(r)){const e=r.getPeerId();return{multiaddr:r,peerId:e==null?void 0:Ae(e)}}throw T(new Error(`${r} is not a PeerId or a Multiaddr`),O.ERR_INVALID_MULTIADDR)}const dr=U("libp2p:connection-manager"),jFe={maxConnections:1/0,minConnections:0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},KFe=6e4;class qFe extends Zt{constructor(e,t){if(super(),this.opts=kt.call({ignoreUndefined:!0},jFe,t),this.opts.maxConnections<this.opts.minConnections)throw T(new Error("Connection Manager maxConnections must be greater than minConnections"),O.ERR_INVALID_PARAMETERS);dr("options: %o",this.opts),this.components=e,this.connections=new Map,this.started=!1,t.maxEventLoopDelay!=null&&t.maxEventLoopDelay>0&&t.maxEventLoopDelay!==1/0&&(this.latencyMonitor=new BFe({latencyCheckIntervalMs:t.pollInterval,dataEmitIntervalMs:t.pollInterval}));try{Rt.setMaxListeners?.(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=t.startupReconnectTimeout??KFe,this.dialTimeout=t.dialTimeout??3e4,this.allow=(t.allow??[]).map(n=>ur(n)),this.deny=(t.deny??[]).map(n=>ur(n)),this.inboundConnectionRateLimiter=new k7.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){this.components.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,outbound:0};for(const t of this.connections.values())for(const n of t)n.stat.direction==="inbound"?e.inbound++:e.outbound++;return e}}),this.components.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const n of t)for(const s of n.streams){const i=`${s.stat.direction} ${s.stat.protocol??"unnegotiated"}`;e[i]=(e[i]??0)+1}return e}}),this.components.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const n of this.connections.values())for(const s of n){const i={};for(const o of s.streams){const a=`${o.stat.direction} ${o.stat.protocol??"unnegotiated"}`;i[a]=(i[a]??0)+1}for(const[o,a]of Object.entries(i))e[o]=e[o]??[],e[o].push(a)}const t={};for(let[n,s]of Object.entries(e)){s=s.sort((o,a)=>o-a);const i=Math.floor(s.length*.9);t[n]=s[i]}return t}}),this.latencyMonitor?.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this.latencyMonitor?.addEventListener("data",this._onLatencyMeasure),this.started=!0,dr("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then(async()=>{const e=[];for(const t of await this.components.peerStore.all())(await this.components.peerStore.getTags(t.id)).filter(i=>i.name===VFe).length>0&&e.push(t.id);this.connectOnStartupController?.clear(),this.connectOnStartupController=new Xt.TimeoutController(this.startupReconnectTimeout);try{Rt.setMaxListeners?.(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(e.map(async t=>{await this.openConnection(t,{signal:this.connectOnStartupController?.signal}).catch(n=>{dr.error(n)})}))}).catch(e=>{dr.error(e)}).finally(()=>{this.connectOnStartupController?.clear()})}async beforeStop(){this.connectOnStartupController?.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){this.latencyMonitor?.removeEventListener("data",this._onLatencyMeasure),this.latencyMonitor?.stop(),this.started=!1,await this._close(),dr("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(s){dr.error(s)}})());dr("closing %d connections",e.length),await Promise.all(e),this.connections.clear()}onConnect(e){this._onConnect(e).catch(t=>{dr.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}const n=t.remotePeer,s=n.toString(),i=this.connections.get(s);i!=null?i.push(t):this.connections.set(s,[t]),n.publicKey!=null&&await this.components.peerStore.keyBook.set(n,n.publicKey);const o=this.getConnections().length,a=o-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",o,a),this.dispatchEvent(new oe("peer:connect",{detail:t}))}onDisconnect(e){const{detail:t}=e;if(!this.started)return;const n=t.remotePeer.toString();let s=this.connections.get(n);s!=null&&s.length>1?(s=s.filter(i=>i.id!==t.id),this.connections.set(n,s)):s!=null&&(this.connections.delete(n),this.dispatchEvent(new oe("peer:disconnect",{detail:t})))}getConnections(e){if(e!=null)return this.connections.get(e.toString())??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}async openConnection(e,t={}){const{peerId:n,multiaddr:s}=ZV(e);if(n==null&&s==null)throw T(new TypeError("Can only open connections to PeerIds or Multiaddrs"),O.ERR_INVALID_PARAMETERS);if(n!=null){dr("dial to",n);const o=this.getConnections(n);if(o.length>0)return dr("had an existing connection to %p",n),o[0]}let i;if(t?.signal==null){i=new Xt.TimeoutController(this.dialTimeout),t.signal=i.signal;try{Rt.setMaxListeners?.(1/0,i.signal)}catch{}}try{const o=await this.components.dialer.dial(e,t);let a=this.connections.get(o.remotePeer.toString());a==null&&(a=[],this.connections.set(o.remotePeer.toString(),a));let c=!1;for(const u of a)u.id===o.id&&(c=!0);return c||a.push(o),o}finally{i?.clear()}}async closeConnections(e){const t=this.connections.get(e.toString())??[];await Promise.all(t.map(async n=>await n.close()))}getAll(e){if(!ua(e))throw T(new Error("peerId must be an instance of peer-id"),O.ERR_INVALID_PARAMETERS);const t=e.toString(),n=this.connections.get(t);return n!=null?n.filter(s=>s.stat.status===JV):[]}_onLatencyMeasure(e){const{detail:t}=e;this._checkMaxLimit("maxEventLoopDelay",t.avgMs,1).catch(n=>{dr.error(n)})}async _checkMaxLimit(e,t,n=1){const s=this.opts[e];if(s==null){dr.trace("limit %s was not set so it cannot be applied",e);return}dr.trace("checking limit of %s. current value: %d of %d",e,t,s),t>s&&(dr("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,e,t,s,n),await this._pruneConnections(n))}async _pruneConnections(e){const t=this.getConnections(),n=new FFe;for(const o of t){const a=o.remotePeer;if(n.has(a))continue;const c=await this.components.peerStore.getTags(a);n.set(a,c.reduce((u,l)=>u+l.value,0))}const s=t.sort((o,a)=>{const c=n.get(o.remotePeer)??0,u=n.get(a.remotePeer)??0;if(c>u)return 1;if(c<u)return-1;const l=o.stat.timeline.open,h=a.stat.timeline.open;return l<h?1:l>h?-1:0}),i=[];for(const o of s)if(dr("too many connections open - closing a connection to %p",o.remotePeer),i.push(o),i.length===e)break;await Promise.all(i.map(async o=>{try{await o.close()}catch(a){dr.error(a)}this.onDisconnect(new oe("connectionEnd",{detail:o}))}))}async acceptIncomingConnection(e){if(this.deny.some(s=>e.remoteAddr.toString().startsWith(s.toString())))return dr("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(s=>e.remoteAddr.toString().startsWith(s.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return dr("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const s=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(s,1)}catch{return dr("connection from %s refused - inboundConnectionThreshold exceeded by host %s",s,e.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(dr("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}}const Ma=U("libp2p:connection-manager:auto-dialler"),HFe={enabled:!0,minConnections:0,autoDialInterval:1e4};class GFe{constructor(e,t){this.components=e,this.options=kt.call({ignoreUndefined:!0},HFe,t),this.running=!1,this._autoDial=this._autoDial.bind(this),Ma("options: %j",this.options)}isStarted(){return this.running}async start(){if(!this.options.enabled){Ma("not enabled");return}this.running=!0,this._autoDial().catch(e=>{Ma.error("could start autodial",e)}),Ma("started")}async stop(){if(!this.options.enabled){Ma("not enabled");return}this.running=!1,this.autoDialTimeout!=null&&this.autoDialTimeout.clear(),Ma("stopped")}async _autoDial(){this.autoDialTimeout!=null&&this.autoDialTimeout.clear();const e=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=e){this.autoDialTimeout=oS(this._autoDial,this.options.autoDialInterval);return}const t=await this.components.peerStore.all(),n=await Ve(t.sort(()=>Math.random()>.5?1:-1),s=>Yt(s,i=>!i.id.equals(this.components.peerId)),s=>Eg(s,(i,o)=>o.protocols.length>i.protocols.length||o.id.publicKey!=null&&i.id.publicKey==null?1:-1),async s=>await Kc(s));for(let s=0;this.running&&s<n.length&&this.components.connectionManager.getConnections().length<e;s++){if(!this.running)return;const i=n[s];if(this.components.connectionManager.getConnections(i.id).length===0){Ma("connecting to a peerStore stored peer %p",i.id);try{await this.components.connectionManager.openConnection(i.id)}catch(o){Ma.error("could not connect to peerStore stored peer",o)}}}this.running&&(this.autoDialTimeout=oS(this._autoDial,this.options.autoDialInterval))}}function WFe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var QFe=WFe,YFe=QFe;const XFe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},l_=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},JFe=r=>new TextEncoder().encode(r),ZFe=r=>new TextDecoder().decode(r);let eVe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},tVe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ej(this,e)}},rVe=class{constructor(e){this.decoders=e}or(e){return ej(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ej=(r,e)=>new rVe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let nVe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new eVe(e,t,n),this.decoder=new tVe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const r3=({name:r,prefix:e,encode:t,decode:n})=>new nVe(r,e,t,n),i0=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=YFe(t,e);return r3({prefix:r,name:e,encode:n,decode:i=>l_(s(i))})},sVe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},iVe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},nn=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>r3({prefix:e,name:r,encode(s){return iVe(s,n,t)},decode(s){return sVe(s,n,t,r)}}),Wi=i0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),oVe=i0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),aVe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Wi,base58flickr:oVe},Symbol.toStringTag,{value:"Module"}));var cVe=tj,rD=128,lVe=127,uVe=~lVe,hVe=Math.pow(2,31);function tj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=hVe;)e[t++]=r&255|rD,r/=128;for(;r&uVe;)e[t++]=r&255|rD,r>>>=7;return e[t]=r|0,tj.bytes=t-n+1,e}var dVe=k8,fVe=128,nD=127;function k8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw k8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&nD)<<s:(o&nD)*Math.pow(2,s),s+=7}while(o>=fVe);return k8.bytes=i-n,t}var pVe=Math.pow(2,7),yVe=Math.pow(2,14),gVe=Math.pow(2,21),wVe=Math.pow(2,28),bVe=Math.pow(2,35),mVe=Math.pow(2,42),EVe=Math.pow(2,49),vVe=Math.pow(2,56),_Ve=Math.pow(2,63),SVe=function(r){return r<pVe?1:r<yVe?2:r<gVe?3:r<wVe?4:r<bVe?5:r<mVe?6:r<EVe?7:r<vVe?8:r<_Ve?9:10},AVe={encode:cVe,decode:dVe,encodingLength:SVe},rw=AVe;const N8=(r,e=0)=>[rw.decode(r,e),rw.decode.bytes],nw=(r,e,t=0)=>(rw.encode(r,e,t),e),sw=r=>rw.encodingLength(r),$Ve=(r,e)=>{const t=e.byteLength,n=sw(r),s=n+sw(t),i=new Uint8Array(s+t);return nw(r,i,0),nw(t,i,n),i.set(e,s),new u_(r,t,e,i)},rj=r=>{const e=l_(r),[t,n]=N8(e),[s,i]=N8(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new u_(t,s,o,e)},TVe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&XFe(r.bytes,t.bytes)}};let u_=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const Nl=nn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),IVe=nn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),RVe=nn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),CVe=nn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xVe=nn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),DVe=nn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),PVe=nn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),OVe=nn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kVe=nn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),NVe=Object.freeze(Object.defineProperty({__proto__:null,base32:Nl,base32hex:xVe,base32hexpad:PVe,base32hexpadupper:OVe,base32hexupper:DVe,base32pad:RVe,base32padupper:CVe,base32upper:IVe,base32z:kVe},Symbol.toStringTag,{value:"Module"})),sD=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return MVe(t,L8(r),e||Wi.encoder);default:return UVe(t,L8(r),e||Nl.encoder)}},iD=new WeakMap,L8=r=>{const e=iD.get(r);if(e==null){const t=new Map;return iD.set(r,t),t}return e};let nj=class Hn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==_f)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==BVe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Hn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=$Ve(e,t);return Hn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Hn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&TVe(e.multihash,n.multihash)}toString(e){return sD(this,e)}toJSON(){return{"/":sD(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Hn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Hn(n,s,i,o||oD(n,s,i.bytes))}else if(t[zVe]===!0){const{version:n,multihash:s,code:i}=t,o=rj(s);return Hn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==_f)throw new Error(`Version 0 CID must use dag-pb (code: ${_f}) block encoding`);return new Hn(e,t,n,n.bytes)}case 1:{const s=oD(e,t,n.bytes);return new Hn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Hn.create(0,_f,e)}static createV1(e,t){return Hn.create(1,e,t)}static decode(e){const[t,n]=Hn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Hn.inspectBytes(e),n=t.size-t.multihashSize,s=l_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new u_(t.multihashCode,t.digestSize,i,s);return[t.version===0?Hn.createV0(o):Hn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=N8(e.subarray(t));return t+=f,h};let s=n(),i=_f;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=LVe(e,t),i=Hn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return L8(i).set(n,e),i}};const LVe=(r,e)=>{switch(r[0]){case"Q":{const t=e||Wi;return[Wi.prefix,t.decode(`${Wi.prefix}${r}`)]}case Wi.prefix:{const t=e||Wi;return[Wi.prefix,t.decode(r)]}case Nl.prefix:{const t=e||Nl;return[Nl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},MVe=(r,e,t)=>{const{prefix:n}=t;if(n!==Wi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},UVe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},_f=112,BVe=18,oD=(r,e,t)=>{const n=sw(r),s=n+sw(e),i=new Uint8Array(s+t.byteLength);return nw(r,i,0),nw(e,i,n),i.set(t,s),i},zVe=Symbol.for("@ipld/js-cid/CID"),FVe=Math.pow(2,7),VVe=Math.pow(2,14),jVe=Math.pow(2,21),h_=Math.pow(2,28),d_=Math.pow(2,35),f_=Math.pow(2,42),p_=Math.pow(2,49),ut=128,es=127;function Wc(r){if(r<FVe)return 1;if(r<VVe)return 2;if(r<jVe)return 3;if(r<h_)return 4;if(r<d_)return 5;if(r<f_)return 6;if(r<p_)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function KVe(r,e,t=0){switch(Wc(r)){case 8:e[t++]=r&255|ut,r/=128;case 7:e[t++]=r&255|ut,r/=128;case 6:e[t++]=r&255|ut,r/=128;case 5:e[t++]=r&255|ut,r/=128;case 4:e[t++]=r&255|ut,r>>>=7;case 3:e[t++]=r&255|ut,r>>>=7;case 2:e[t++]=r&255|ut,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function qVe(r,e,t=0){switch(Wc(r)){case 8:e.set(t++,r&255|ut),r/=128;case 7:e.set(t++,r&255|ut),r/=128;case 6:e.set(t++,r&255|ut),r/=128;case 5:e.set(t++,r&255|ut),r/=128;case 4:e.set(t++,r&255|ut),r>>>=7;case 3:e.set(t++,r&255|ut),r>>>=7;case 2:e.set(t++,r&255|ut),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function HVe(r,e){let t=r[e],n=0;if(n+=t&es,t<ut||(t=r[e+1],n+=(t&es)<<7,t<ut)||(t=r[e+2],n+=(t&es)<<14,t<ut)||(t=r[e+3],n+=(t&es)<<21,t<ut)||(t=r[e+4],n+=(t&es)*h_,t<ut)||(t=r[e+5],n+=(t&es)*d_,t<ut)||(t=r[e+6],n+=(t&es)*f_,t<ut)||(t=r[e+7],n+=(t&es)*p_,t<ut))return n;throw new RangeError("Could not decode varint")}function GVe(r,e){let t=r.get(e),n=0;if(n+=t&es,t<ut||(t=r.get(e+1),n+=(t&es)<<7,t<ut)||(t=r.get(e+2),n+=(t&es)<<14,t<ut)||(t=r.get(e+3),n+=(t&es)<<21,t<ut)||(t=r.get(e+4),n+=(t&es)*h_,t<ut)||(t=r.get(e+5),n+=(t&es)*d_,t<ut)||(t=r.get(e+6),n+=(t&es)*f_,t<ut)||(t=r.get(e+7),n+=(t&es)*p_,t<ut))return n;throw new RangeError("Could not decode varint")}function n3(r,e,t=0){return e==null&&(e=$o(Wc(r))),e instanceof Uint8Array?KVe(r,e,t):qVe(r,e,t)}function o0(r,e=0){return r instanceof Uint8Array?HVe(r,e):GVe(r,e)}const WVe=r3({prefix:"\0",name:"identity",encode:r=>ZFe(r),decode:r=>JFe(r)}),QVe=Object.freeze(Object.defineProperty({__proto__:null,identity:WVe},Symbol.toStringTag,{value:"Module"})),YVe=nn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),XVe=Object.freeze(Object.defineProperty({__proto__:null,base2:YVe},Symbol.toStringTag,{value:"Module"})),JVe=nn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ZVe=Object.freeze(Object.defineProperty({__proto__:null,base8:JVe},Symbol.toStringTag,{value:"Module"})),eje=i0({prefix:"9",name:"base10",alphabet:"0123456789"}),tje=Object.freeze(Object.defineProperty({__proto__:null,base10:eje},Symbol.toStringTag,{value:"Module"})),rje=nn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nje=nn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),sje=Object.freeze(Object.defineProperty({__proto__:null,base16:rje,base16upper:nje},Symbol.toStringTag,{value:"Module"})),ije=i0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),oje=i0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),aje=Object.freeze(Object.defineProperty({__proto__:null,base36:ije,base36upper:oje},Symbol.toStringTag,{value:"Module"})),cje=nn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lje=nn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),uje=nn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hje=nn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),dje=Object.freeze(Object.defineProperty({__proto__:null,base64:cje,base64pad:lje,base64url:uje,base64urlpad:hje},Symbol.toStringTag,{value:"Module"})),sj=Array.from(""),fje=sj.reduce((r,e,t)=>(r[t]=e,r),[]),pje=sj.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function yje(r){return r.reduce((e,t)=>(e+=fje[t],e),"")}function gje(r){const e=[];for(const t of r){const n=pje[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const wje=r3({prefix:"",name:"base256emoji",encode:yje,decode:gje}),bje=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:wje},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const mje={...QVe,...XVe,...ZVe,...tje,...sje,...NVe,...aje,...aVe,...dje,...bje},aD=mi,Eje=Ei,ij=function(r){let e=0;if(r=r.toString().trim(),aD(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Eje(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=aD(t[n]);let o;i&&(o=ij(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},vje=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Ys=-1,X1={},M8={},_je=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Ys,"ip6zone"],[43,8,"ipcidr"],[53,Ys,"dns",!0],[54,Ys,"dns4",!0],[55,Ys,"dns6",!0],[56,Ys,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Ys,"unix",!1,!0],[421,Ys,"ipfs"],[421,Ys,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Ys,"garlic64"],[448,0,"tls"],[449,Ys,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Ys,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Ys,"memory"]];_je.forEach(r=>{const e=Sje(...r);M8[e.code]=e,X1[e.name]=e});function Sje(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function Qt(r){if(typeof r=="number"){if(M8[r]!=null)return M8[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(X1[r]!=null)return X1[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}Qt("ip4");Qt("ip6");Qt("ipcidr");function oj(r,e){switch(Qt(r).code){case 4:case 41:return $je(e);case 42:return hD(e);case 6:case 273:case 33:case 132:return aj(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return hD(e);case 421:return Cje(e);case 444:return dD(e);case 445:return dD(e);case 466:return Rje(e);default:return R(e,"base16")}}function cD(r,e){switch(Qt(r).code){case 4:return lD(e);case 41:return lD(e);case 42:return uD(e);case 6:case 273:case 33:case 132:return y_(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return uD(e);case 421:return Tje(e);case 444:return xje(e);case 445:return Dje(e);case 466:return Ije(e);default:return M(e,"base16")}}const lm=Object.values(mje).map(r=>r.decoder),Aje=function(){let r=lm[0].or(lm[1]);return lm.slice(2).forEach(e=>r=r.or(e)),r}();function lD(r){if(!Nt(r))throw new Error("invalid ip address");return ij(r)}function $je(r){const e=vje(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function y_(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function aj(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function uD(r){const e=M(r),t=Uint8Array.from(n3(e.length));return z([t,e],t.length+e.length)}function hD(r){const e=o0(r);if(r=r.slice(Wc(e)),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function Tje(r){let e;r[0]==="Q"||r[0]==="1"?e=rj(Wi.decode(`z${r}`)).bytes:e=nj.parse(r).multihash.bytes;const t=Uint8Array.from(n3(e.length));return z([t,e],t.length+e.length)}function Ije(r){const e=Aje.decode(r),t=Uint8Array.from(n3(e.length));return z([t,e],t.length+e.length)}function Rje(r){const e=o0(r),t=r.slice(Wc(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function Cje(r){const e=o0(r),t=r.slice(Wc(e));if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function xje(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Nl.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=y_(n);return z([t,s],t.length+s.length)}function Dje(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Nl.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=y_(n);return z([t,s],t.length+s.length)}function dD(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=aj(t);return`${n}:${s}`}function Pje(r){r=U8(r);const e=[],t=[];let n=null;const s=r.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){const o=s[i],a=Qt(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw uj("invalid address: "+r);if(a.path===!0){n=U8(s.slice(i).join("/")),e.push([a.code,cD(a.code,n)]),t.push([a.code,n]);break}const c=cD(a.code,s[i]);e.push([a.code,c]),t.push([a.code,oj(a.code,c)])}return{string:cj(t),bytes:lj(e),tuples:e,stringTuples:t,path:n}}function fD(r){const e=[],t=[];let n=null,s=0;for(;s<r.length;){const i=o0(r,s),o=Wc(i),a=Qt(i),c=Oje(a,r.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}const u=r.slice(s+o,s+o+c);if(s+=c+o,s>r.length)throw uj("Invalid address Uint8Array: "+R(r,"base16"));e.push([i,u]);const l=oj(i,u);if(t.push([i,l]),a.path===!0){n=l;break}}return{bytes:Uint8Array.from(r),string:cj(t),tuples:e,stringTuples:t,path:n}}function cj(r){const e=[];return r.map(t=>{const n=Qt(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),U8(e.join("/"))}function lj(r){return z(r.map(e=>{const t=Qt(e[0]);let n=Uint8Array.from(n3(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n}))}function Oje(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{const t=o0(e instanceof Uint8Array?e:Uint8Array.from(e));return t+Wc(t)}}function U8(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function uj(r){return new Error("Error parsing address: "+r)}const kje=Symbol.for("nodejs.util.inspect.custom"),Nje=[Qt("dns").code,Qt("dns4").code,Qt("dns6").code,Qt("dnsaddr").code],Lje=new Map,hj=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Mje(r){return!!r?.[hj]}var wh,dc,lp,up,hnt,oa;let Uje=(oa=class{constructor(e){N(this,"bytes");ar(this,wh,void 0);ar(this,dc,void 0);ar(this,lp,void 0);ar(this,up,void 0);N(this,hnt,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=fD(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=Pje(e)}else if(Mje(e))t=fD(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,Dt(this,wh,t.string),Dt(this,dc,t.tuples),Dt(this,lp,t.stringTuples),Dt(this,up,t.path)}toString(){return ve(this,wh)}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=Qt("tcp"),a=Qt("udp"),c=Qt("ip4"),u=Qt("ip6"),l=Qt("dns6"),h=Qt("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),Nje.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=Qt(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=Qt(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return ve(this,dc).map(([e])=>Object.assign({},Qt(e)))}protoCodes(){return ve(this,dc).map(([e])=>e)}protoNames(){return ve(this,dc).map(([e])=>Qt(e).name)}tuples(){return ve(this,dc)}stringTuples(){return ve(this,lp)}encapsulate(e){return e=new oa(e),new oa(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new oa(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new oa(lj(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,s])=>{n===X1.p2p.code&&e.push([n,s]),n===X1["p2p-circuit"].code&&(e=[])});const t=e.pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Wi.decode(`z${n}`),"base58btc"):R(nj.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return ve(this,up)}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=Lje.get(t.name);if(n==null)throw new Bw(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new oa(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(hnt=hj,kje)](){return`Multiaddr(${ve(this,wh)})`}},wh=new WeakMap,dc=new WeakMap,lp=new WeakMap,up=new WeakMap,oa);function dj(r){return new Uje(r)}const Bje=Ee("dns4"),zje=Ee("dns6"),Fje=Ee("dnsaddr"),Ql=ms(Ee("dns"),Fje,Bje,zje),s3=ms(Ee("ip4"),Ee("ip6")),Lh=ms(Fe(s3,Ee("tcp")),Fe(Ql,Ee("tcp"))),g_=Fe(s3,Ee("udp")),Vje=Fe(g_,Ee("utp")),jje=Fe(g_,Ee("quic")),B8=ms(Fe(Lh,Ee("ws")),Fe(Ql,Ee("ws"))),z8=ms(Fe(Lh,Ee("wss")),Fe(Ql,Ee("wss")),Fe(Lh,Ee("tls"),Ee("ws")),Fe(Ql,Ee("tls"),Ee("ws"))),F8=ms(Fe(Lh,Ee("http")),Fe(s3,Ee("http")),Fe(Ql,Ee("http"))),V8=ms(Fe(Lh,Ee("https")),Fe(s3,Ee("https")),Fe(Ql,Ee("https"))),pD=Fe(g_,Ee("webrtc"),Ee("certhash")),fj=ms(Fe(pD,Ee("p2p")),pD),pj=ms(Fe(B8,Ee("p2p-webrtc-star"),Ee("p2p")),Fe(z8,Ee("p2p-webrtc-star"),Ee("p2p")),Fe(B8,Ee("p2p-webrtc-star")),Fe(z8,Ee("p2p-webrtc-star"))),yj=ms(Fe(F8,Ee("p2p-webrtc-direct"),Ee("p2p")),Fe(V8,Ee("p2p-webrtc-direct"),Ee("p2p")),Fe(F8,Ee("p2p-webrtc-direct")),Fe(V8,Ee("p2p-webrtc-direct"))),j8=ms(B8,z8,F8,V8,pj,yj,Lh,Vje,jje,Ql,fj),r2=ms(Fe(j8,Ee("p2p")),pj,yj,fj,Ee("p2p")),yD=ms(Fe(r2,Ee("p2p-circuit"),r2),Fe(r2,Ee("p2p-circuit")),Fe(Ee("p2p-circuit"),r2),Fe(j8,Ee("p2p-circuit")),Fe(Ee("p2p-circuit"),j8),Ee("p2p-circuit")),gj=()=>ms(Fe(yD,gj),yD),Kje=gj();function wj(r){function e(t){let n;try{n=dj(t)}catch{return!1}const s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return e}function Fe(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(s=>(n=typeof s=="function"?s().partialMatch(t):s.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:wj(e),partialMatch:e}}function ms(...r){function e(n){let s=null;return r.some(i=>{const o=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return o!=null?(s=o,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:wj(e),partialMatch:e}}function Ee(r){const e=r;function t(s){let i;try{i=dj(s)}catch{return!1}const o=i.protoNames();return o.length===1&&o[0]===e}function n(s){return s.length===0?null:s[0]===e?s.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}function qje(){RO._configure(),Mw._configure(CO),Uw._configure(xO)}qje();const bj=["uint64","int64","sint64","fixed64","sfixed64"];function Hje(r){for(const e of bj){if(r[e]==null)continue;const t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function Gje(r){return Hje(new Mw(r))}function Wje(r){for(const e of bj){if(r[e]==null)continue;const t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function Qje(){return Wje(Uw.create())}function J1(r,e){const t=Gje(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}function Z1(r,e){const t=Qje();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var iw;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(iw||(iw={}));function mj(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function K8(r){function e(s){if(r[s.toString()]==null)throw new Error("Invalid enum value");return r[s]}const t=function(i,o){const a=e(i);o.int32(a)},n=function(i){const o=i.int32();return e(o)};return mj("enum",iw.VARINT,t,n)}function ep(r,e){return mj("message",iw.LENGTH_DELIMITED,r,e)}var De;(function(r){(function(s){s.SUCCESS="SUCCESS",s.HOP_SRC_ADDR_TOO_LONG="HOP_SRC_ADDR_TOO_LONG",s.HOP_DST_ADDR_TOO_LONG="HOP_DST_ADDR_TOO_LONG",s.HOP_SRC_MULTIADDR_INVALID="HOP_SRC_MULTIADDR_INVALID",s.HOP_DST_MULTIADDR_INVALID="HOP_DST_MULTIADDR_INVALID",s.HOP_NO_CONN_TO_DST="HOP_NO_CONN_TO_DST",s.HOP_CANT_DIAL_DST="HOP_CANT_DIAL_DST",s.HOP_CANT_OPEN_DST_STREAM="HOP_CANT_OPEN_DST_STREAM",s.HOP_CANT_SPEAK_RELAY="HOP_CANT_SPEAK_RELAY",s.HOP_CANT_RELAY_TO_SELF="HOP_CANT_RELAY_TO_SELF",s.STOP_SRC_ADDR_TOO_LONG="STOP_SRC_ADDR_TOO_LONG",s.STOP_DST_ADDR_TOO_LONG="STOP_DST_ADDR_TOO_LONG",s.STOP_SRC_MULTIADDR_INVALID="STOP_SRC_MULTIADDR_INVALID",s.STOP_DST_MULTIADDR_INVALID="STOP_DST_MULTIADDR_INVALID",s.STOP_RELAY_REFUSED="STOP_RELAY_REFUSED",s.MALFORMED_MESSAGE="MALFORMED_MESSAGE"})(r.Status||(r.Status={}));let e;(function(s){s[s.SUCCESS=100]="SUCCESS",s[s.HOP_SRC_ADDR_TOO_LONG=220]="HOP_SRC_ADDR_TOO_LONG",s[s.HOP_DST_ADDR_TOO_LONG=221]="HOP_DST_ADDR_TOO_LONG",s[s.HOP_SRC_MULTIADDR_INVALID=250]="HOP_SRC_MULTIADDR_INVALID",s[s.HOP_DST_MULTIADDR_INVALID=251]="HOP_DST_MULTIADDR_INVALID",s[s.HOP_NO_CONN_TO_DST=260]="HOP_NO_CONN_TO_DST",s[s.HOP_CANT_DIAL_DST=261]="HOP_CANT_DIAL_DST",s[s.HOP_CANT_OPEN_DST_STREAM=262]="HOP_CANT_OPEN_DST_STREAM",s[s.HOP_CANT_SPEAK_RELAY=270]="HOP_CANT_SPEAK_RELAY",s[s.HOP_CANT_RELAY_TO_SELF=280]="HOP_CANT_RELAY_TO_SELF",s[s.STOP_SRC_ADDR_TOO_LONG=320]="STOP_SRC_ADDR_TOO_LONG",s[s.STOP_DST_ADDR_TOO_LONG=321]="STOP_DST_ADDR_TOO_LONG",s[s.STOP_SRC_MULTIADDR_INVALID=350]="STOP_SRC_MULTIADDR_INVALID",s[s.STOP_DST_MULTIADDR_INVALID=351]="STOP_DST_MULTIADDR_INVALID",s[s.STOP_RELAY_REFUSED=390]="STOP_RELAY_REFUSED",s[s.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE"})(e||(e={})),function(s){s.codec=()=>K8(e)}(r.Status||(r.Status={})),function(s){s.HOP="HOP",s.STOP="STOP",s.STATUS="STATUS",s.CAN_HOP="CAN_HOP"}(r.Type||(r.Type={}));let t;(function(s){s[s.HOP=1]="HOP",s[s.STOP=2]="STOP",s[s.STATUS=3]="STATUS",s[s.CAN_HOP=4]="CAN_HOP"})(t||(t={})),function(s){s.codec=()=>K8(t)}(r.Type||(r.Type={})),function(s){let i;s.codec=()=>(i==null&&(i=ep((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),(c.writeDefaults===!0||o.id!=null&&o.id.byteLength>0)&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const u of o.addrs)a.uint32(18),a.bytes(u);c.lengthDelimited!==!1&&a.ldelim()},(o,a)=>{const c={id:new Uint8Array(0),addrs:[]},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const l=o.uint32();switch(l>>>3){case 1:c.id=o.bytes();break;case 2:c.addrs.push(o.bytes());break;default:o.skipType(l&7);break}}return c})),i),s.encode=o=>Z1(o,s.codec()),s.decode=o=>J1(o,s.codec())}(r.Peer||(r.Peer={}));let n;r.codec=()=>(n==null&&(n=ep((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.Type.codec().encode(s.type,i)),s.srcPeer!=null&&(i.uint32(18),r.Peer.codec().encode(s.srcPeer,i,{writeDefaults:!1})),s.dstPeer!=null&&(i.uint32(26),r.Peer.codec().encode(s.dstPeer,i,{writeDefaults:!1})),s.code!=null&&(i.uint32(32),r.Status.codec().encode(s.code,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{const o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){const c=s.uint32();switch(c>>>3){case 1:o.type=r.Type.codec().decode(s);break;case 2:o.srcPeer=r.Peer.codec().decode(s,s.uint32());break;case 3:o.dstPeer=r.Peer.codec().decode(s,s.uint32());break;case 4:o.code=r.Status.codec().decode(s);break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>Z1(s,r.codec()),r.decode=s=>J1(s,r.codec())})(De||(De={}));const Yje=U("libp2p:stream:converter");function gD(r,e={}){const{stream:t,remoteAddr:n}=r,{sink:s,source:i}=t,o=async function*(){for await(const u of i)u instanceof Uint8Array?yield u:yield*u}(),a={async sink(u){e.signal!=null&&(u=m1(u,e.signal));try{await s(u),await c()}catch(l){l.type!=="aborted"&&Yje(l)}},source:e.signal!=null?m1(o,e.signal):o,remoteAddr:n,timeline:{open:Date.now(),close:void 0},async close(){await s(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){a.timeline.close==null&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}const Mh="/libp2p/circuit/relay/0.1.0";function Xje(r){const e=new Map;async function t(i){const o=i.toString().split("/p2p-circuit").find(f=>f!==""),a=ur(o),c=a.getPeerId();if(c==null)throw new Error("Could not determine relay peer from multiaddr");const u=Ae(c);await r.peerStore.addressBook.add(u,[a]);const l=await r.connectionManager.openConnection(u),h=l.remoteAddr.encapsulate("/p2p-circuit");e.set(l.remotePeer.toString(),h),s.dispatchEvent(new oe("listening"))}function n(){const i=[];for(const o of e.values())i.push(o);return i}const s=Object.assign(new Zt,{close:async()=>await Promise.resolve(),listen:t,getAddrs:n});return r.connectionManager.addEventListener("peer:disconnect",i=>{const{detail:o}=i;e.delete(o.remotePeer.toString())&&s.dispatchEvent(new oe("close"))}),s}function wD(r,e){r.write({type:De.Type.STATUS,code:e})}function Ej(r,e){try{r.dstPeer?.addrs!=null&&r.dstPeer.addrs.forEach(t=>ur(t))}catch(t){throw wD(e,r.type===De.Type.HOP?De.Status.HOP_DST_MULTIADDR_INVALID:De.Status.STOP_DST_MULTIADDR_INVALID),t}try{r.srcPeer?.addrs!=null&&r.srcPeer.addrs.forEach(t=>ur(t))}catch(t){throw wD(e,r.type===De.Type.HOP?De.Status.HOP_SRC_MULTIADDR_INVALID:De.Status.STOP_SRC_MULTIADDR_INVALID),t}}function Jje(r){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}const i3=r=>{const e=Jt.encodingLength(r),t=Jje(e);return Jt.encode(r,t),i3.bytes=e,t};i3.bytes=0;function Uh(r){r=r??{};const e=r.lengthEncoder??i3;return async function*(n){for await(const s of n){const i=e(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}}}Uh.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??i3;return new Se(t(r.byteLength),r)};const Zje=8,eKe=1024*1024*4;var ll;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ll||(ll={}));const w_=r=>{const e=Jt.decode(r);return w_.bytes=Jt.encodingLength(e),e};w_.bytes=0;function Yl(r){return async function*(t){const n=new Se;let s=ll.LENGTH,i=-1;const o=r?.lengthDecoder??w_,a=r?.maxLengthLength??Zje,c=r?.maxDataLength??eKe;for await(const u of t)for(n.append(u);n.byteLength>0;){if(s===ll.LENGTH)try{if(i=o(n),i<0)throw T(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>c)throw T(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const l=o.bytes;n.consume(l),r?.onLength!=null&&r.onLength(i),s=ll.DATA}catch(l){if(l instanceof RangeError){if(n.byteLength>a)throw T(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(s===ll.DATA){if(n.byteLength<i)break;const l=n.sublist(0,i);n.consume(i),r?.onData!=null&&r.onData(l),yield l,s=ll.LENGTH}}if(n.byteLength>0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}Yl.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return Yl({...e??{},onLength:i=>{t=i}})(n)};function b_(r){const e=$r(),t=Qge(r.source),n=pt();let s;const i=r.sink(async function*(){yield*e,yield*await n.promise}());return i.catch(a=>{s=a}),{reader:t,writer:e,stream:{sink:async a=>{if(s!=null){await Promise.reject(s);return}n.resolve(a),await i},source:t},rest:()=>e.end(),write:e.push,read:async()=>{const a=await t.next();if(a.value!=null)return a.value}}}const Sf=U("libp2p:circuit:stream-handler");class o3{constructor(e){const{stream:t,maxLength:n=4096}=e;this.stream=t,this.shake=b_(this.stream),this.decoder=Yl.fromReader(this.shake.reader,{maxDataLength:n})}async read(){const e=await this.decoder.next();if(e.value!=null){const t=De.decode(e.value);return Sf("read message type",t.type),t}Sf("read received no value, closing stream"),this.close()}write(e){Sf("write message type %s",e.type),this.shake.write(Uh.single(De.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){Sf("closing the stream"),this.rest().sink([]).catch(e=>{Sf.error(e)})}}const y1=U("libp2p:circuit:stop");function tKe(r){const{connection:e,request:t,streamHandler:n}=r;try{Ej(t,n)}catch(s){y1.error("invalid stop request via peer %p %o",e.remotePeer,s);return}return y1("stop request is valid"),n.write({type:De.Type.STATUS,code:De.Status.SUCCESS}),n.rest()}async function rKe(r){const{connection:e,request:t,signal:n}=r,s=await e.newStream(Mh,{signal:n});y1("starting stop request to %p",e.remotePeer);const i=new o3({stream:s});i.write(t);const o=await i.read();if(o==null){i.close();return}if(o.code===De.Status.SUCCESS)return y1("stop request to %p was successful",e.remotePeer),i.rest();y1("stop request failed with code %d",o.code),i.close()}const ii=U("libp2p:circuit:hop");async function nKe(r){const{connection:e,request:t,streamHandler:n,circuit:s,connectionManager:i}=r;if(!s.hopEnabled())return ii("HOP request received but we are not acting as a relay"),n.end({type:De.Type.STATUS,code:De.Status.HOP_CANT_SPEAK_RELAY});try{Ej(t,n)}catch(h){ii.error("invalid hop request via peer %p %o",e.remotePeer,h);return}if(t.dstPeer==null){ii("HOP request received but we do not receive a dstPeer");return}const o=No(t.dstPeer.id),a=i.getConnections(o);if(a.length===0&&!s.hopActive())return ii("HOP request received but we are not connected to the destination peer"),n.end({type:De.Type.STATUS,code:De.Status.HOP_NO_CONN_TO_DST});if(a.length===0)return ii("did not have connection to remote peer"),n.end({type:De.Type.STATUS,code:De.Status.HOP_NO_CONN_TO_DST});const c={type:De.Type.STOP,dstPeer:t.dstPeer,srcPeer:t.srcPeer};let u;try{ii("performing STOP request");const h=await rKe({connection:a[0],request:c});if(h==null)throw new Error("Could not stop");u=h}catch(h){ii.error(h);return}ii("hop request from %p is valid",e.remotePeer),n.write({type:De.Type.STATUS,code:De.Status.SUCCESS});const l=n.rest();return ii("creating related connections"),await Ve(l,u,l)}async function sKe(r){const{connection:e,request:t,signal:n}=r,s=await e.newStream(Mh,{signal:n}),i=new o3({stream:s});i.write(t);const o=await i.read();if(o==null)throw T(new Error("HOP request had no response"),O.ERR_HOP_REQUEST_FAILED);if(o.code===De.Status.SUCCESS)return ii("hop request was successful"),i.rest();throw ii("hop request failed with code %d, closing stream",o.code),i.close(),T(new Error(`HOP request failed with code "${o.code??"unknown"}"`),O.ERR_HOP_REQUEST_FAILED)}async function iKe(r){const{connection:e,signal:t}=r,n=await e.newStream(Mh,{signal:t}),s=new o3({stream:n});s.write({type:De.Type.CAN_HOP});const i=await s.read();return await s.close(),!(i==null||i.code!==De.Status.SUCCESS)}function oKe(r){const{connection:e,streamHandler:t,circuit:n}=r,s=n.hopEnabled();ii("can hop (%s) request from %p",s,e.remotePeer),t.end({type:De.Type.STATUS,code:s?De.Status.SUCCESS:De.Status.HOP_CANT_SPEAK_RELAY})}let bD=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function vj(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new bD(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new bD(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}function aKe(r,e,t){return n=>r(vj(n,e,t))}function mc(r,e,t){return{sink:aKe(r.sink,e,{...t,onAbort:void 0}),source:vj(r.source,e,t)}}const Xs=U("libp2p:circuit");let cKe=class{constructor(e,t){this._init=t,this.components=e,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(Mh,e=>{this._onProtocol(e).catch(t=>{Xs.error(t)})},{...this._init}).catch(e=>{Xs.error(e)}))}async stop(){await this.components.registrar.unhandle(Mh)}hopEnabled(){return!0}hopActive(){return!0}get[r_](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(e){const{connection:t,stream:n}=e,s=new Xt.TimeoutController(this._init.hop.timeout);try{Rt.setMaxListeners?.(1/0,s.signal)}catch{}try{const i=mc(n,s.signal),o=new o3({stream:{...n,...i}}),a=await o.read();if(a==null){Xs("request was invalid, could not read from stream"),o.write({type:De.Type.STATUS,code:De.Status.MALFORMED_MESSAGE}),o.close();return}let c;switch(a.type){case De.Type.CAN_HOP:{Xs("received CAN_HOP request from %p",t.remotePeer),await oKe({circuit:this,connection:t,streamHandler:o});break}case De.Type.HOP:{Xs("received HOP request from %p",t.remotePeer),await nKe({connection:t,request:a,streamHandler:o,circuit:this,connectionManager:this.components.connectionManager});break}case De.Type.STOP:{Xs("received STOP request from %p",t.remotePeer),c=await tKe({connection:t,request:a,streamHandler:o});break}default:{Xs("Request of type %s not supported",a.type),o.write({type:De.Type.STATUS,code:De.Status.MALFORMED_MESSAGE}),o.close();return}}if(c!=null){const u=t.remoteAddr.encapsulate("/p2p-circuit").encapsulate(ur(a.dstPeer?.addrs[0])),l=ur(a.srcPeer?.addrs[0]),h=gD({stream:c,remoteAddr:u,localAddr:l}),f=a.type===De.Type.HOP?"relay":"inbound";Xs("new %s connection %s",f,h.remoteAddr);const y=await this.components.upgrader.upgradeInbound(h);Xs("%s connection %s upgraded",f,h.remoteAddr),this.handler!=null&&this.handler(y)}}finally{s.clear()}}async dial(e,t={}){const n=e.toString().split("/p2p-circuit"),s=ur(n[0]),i=ur(n[n.length-1]),o=s.getPeerId(),a=i.getPeerId();if(o==null||a==null){const y="Circuit relay dial failed as addresses did not have peer id";throw Xs.error(y),T(new Error(y),O.ERR_RELAYED_DIAL)}const c=Ae(o),u=Ae(a);let l=!1,f=this.components.connectionManager.getConnections(c)[0];f==null&&(await this.components.peerStore.addressBook.add(c,[s]),f=await this.components.connectionManager.openConnection(c,t),l=!0);try{const y=await sKe({...t,connection:f,request:{type:De.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map(b=>b.bytes)},dstPeer:{id:u.toBytes(),addrs:[ur(i).bytes]}}}),d=s.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),p=gD({stream:y,remoteAddr:e,localAddr:d});return Xs("new outbound connection %s",p.remoteAddr),await this.components.upgrader.upgradeOutbound(p)}catch(y){throw Xs.error("Circuit relay dial failed",y),l&&await f.close(),y}}createListener(e){return this.handler=e.handler,Xje({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>Kje.matches(t))}};async function _j(r){const e=new TextEncoder().encode(r),t=await lFe.digest(e);return i_.createV0(t)}const Sj=60*1e3,lKe=15*Sj,uKe=30*Sj,hKe=290,mD="hop_relay",ED="true",Aj="/libp2p/relay";var $j;(function(){var r,e,t,n,s,i,o,a;a=function(c){var u,l,h,f;return u=(c&255<<24)>>>24,l=(c&255<<16)>>>16,h=(c&65280)>>>8,f=c&255,[u,l,h,f].join(".")},o=function(c){var u,l,h,f,y,d;for(u=[],h=f=0;f<=3&&c.length!==0;h=++f){if(h>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}d=e(c),y=d[0],l=d[1],c=c.substring(l),u.push(y)}if(c.length!==0)throw new Error("Invalid IP");switch(u.length){case 1:if(u[0]>4294967295)throw new Error("Invalid IP");return u[0]>>>0;case 2:if(u[0]>255||u[1]>16777215)throw new Error("Invalid IP");return(u[0]<<24|u[1])>>>0;case 3:if(u[0]>255||u[1]>255||u[2]>65535)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2])>>>0;case 4:if(u[0]>255||u[1]>255||u[2]>255||u[3]>255)throw new Error("Invalid IP");return(u[0]<<24|u[1]<<16|u[2]<<8|u[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),i=t("a"),s=t("A"),e=function(c){var u,l,h,f,y;for(f=0,u=10,l="9",h=0,c.length>1&&c[h]==="0"&&(c[h+1]==="x"||c[h+1]==="X"?(h+=2,u=16):"0"<=c[h+1]&&c[h+1]<="9"&&(h++,u=8,l="7")),y=h;h<c.length;){if("0"<=c[h]&&c[h]<=l)f=f*u+(t(c[h])-n)>>>0;else if(u===16)if("a"<=c[h]&&c[h]<="f")f=f*u+(10+t(c[h])-i)>>>0;else if("A"<=c[h]&&c[h]<="F")f=f*u+(10+t(c[h])-s)>>>0;else break;else break;if(f>4294967295)throw new Error("too large");h++}if(h===y)throw new Error("empty octet");return[f,h]},r=function(){function c(u,l){var h,f,y;if(typeof u!="string")throw new Error("Missing `net' parameter");if(l||(y=u.split("/",2),u=y[0],l=y[1]),l||(l=32),typeof l=="string"&&l.indexOf(".")>-1){try{this.maskLong=o(l)}catch{throw new Error("Invalid mask: "+l)}for(h=f=32;f>=0;h=--f)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(l||l===0)this.bitmask=parseInt(l,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(u)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+u)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+l);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(u){return typeof u=="string"&&(u.indexOf("/")>0||u.split(".").length!==4)&&(u=new c(u)),u instanceof c?this.contains(u.base)&&this.contains(u.broadcast||u.last):(o(u)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(u){return u==null&&(u=1),new c(a(this.netLong+this.size*u),this.mask)},c.prototype.forEach=function(u){var l,h,f;for(f=o(this.first),h=o(this.last),l=0;f<=h;)u(a(f),f,l),l++,f++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),$j=r}).call(Is);const vD="[a-fA-F\\d:]",Ec=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${vD})|(?<=${vD})(?=\\s|$))`:"",Li="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",fr="[a-fA-F\\d]{1,4}",a3=`
(?:
(?:${fr}:){7}(?:${fr}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${fr}:){6}(?:${Li}|:${fr}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${fr}:){5}(?::${Li}|(?::${fr}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${fr}:){4}(?:(?::${fr}){0,1}:${Li}|(?::${fr}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${fr}:){3}(?:(?::${fr}){0,2}:${Li}|(?::${fr}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${fr}:){2}(?:(?::${fr}){0,3}:${Li}|(?::${fr}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${fr}:){1}(?:(?::${fr}){0,4}:${Li}|(?::${fr}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${fr}){0,5}:${Li}|(?::${fr}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),dKe=new RegExp(`(?:^${Li}$)|(?:^${a3}$)`),fKe=new RegExp(`^${Li}$`),pKe=new RegExp(`^${a3}$`),m_=r=>r&&r.exact?dKe:new RegExp(`(?:${Ec(r)}${Li}${Ec(r)})|(?:${Ec(r)}${a3}${Ec(r)})`,"g");m_.v4=r=>r&&r.exact?fKe:new RegExp(`${Ec(r)}${Li}${Ec(r)}`,"g");m_.v6=r=>r&&r.exact?pKe:new RegExp(`${Ec(r)}${a3}${Ec(r)}`,"g");var Tj={exports:{}};(function(r){(function(e){const t="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp(`^${t}\\.${t}\\.${t}\\.${t}$`,"i"),threeOctet:new RegExp(`^${t}\\.${t}\\.${t}$`,"i"),twoOctet:new RegExp(`^${t}\\.${t}$`,"i"),longValue:new RegExp(`^${t}$`,"i")},s=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${t}\\.${t}\\.${t}\\.${t}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${t}\\.${t}\\.${t}\\.${t}(${o})?$`,"i")};function u(d,p){if(d.indexOf("::")!==d.lastIndexOf("::"))return null;let b=0,w=-1,S=(d.match(c.zoneIndex)||[])[0],E,m;for(S&&(S=S.substring(1),d=d.replace(/%.+$/,""));(w=d.indexOf(":",w+1))>=0;)b++;if(d.substr(0,2)==="::"&&b--,d.substr(-2,2)==="::"&&b--,b>p)return null;for(m=p-b,E=":";m--;)E+="0:";return d=d.replace("::",E),d[0]===":"&&(d=d.slice(1)),d[d.length-1]===":"&&(d=d.slice(0,-1)),p=function(){const v=d.split(":"),A=[];for(let g=0;g<v.length;g++)A.push(parseInt(v[g],16));return A}(),{parts:p,zoneId:S}}function l(d,p,b,w){if(d.length!==p.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let S=0,E;for(;w>0;){if(E=b-w,E<0&&(E=0),d[S]>>E!==p[S]>>E)return!1;w-=b,S+=1}return!0}function h(d){if(i.test(d))return parseInt(d,16);if(d[0]==="0"&&!isNaN(parseInt(d[1],10))){if(s.test(d))return parseInt(d,8);throw new Error(`ipaddr: cannot parse ${d} as octal`)}return parseInt(d,10)}function f(d,p){for(;d.length<p;)d=`0${d}`;return d}const y={};y.IPv4=function(){function d(p){if(p.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let b,w;for(b=0;b<p.length;b++)if(w=p[b],!(0<=w&&w<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=p}return d.prototype.SpecialRanges={unspecified:[[new d([0,0,0,0]),8]],broadcast:[[new d([255,255,255,255]),32]],multicast:[[new d([224,0,0,0]),4]],linkLocal:[[new d([169,254,0,0]),16]],loopback:[[new d([127,0,0,0]),8]],carrierGradeNat:[[new d([100,64,0,0]),10]],private:[[new d([10,0,0,0]),8],[new d([172,16,0,0]),12],[new d([192,168,0,0]),16]],reserved:[[new d([192,0,0,0]),24],[new d([192,0,2,0]),24],[new d([192,88,99,0]),24],[new d([198,18,0,0]),15],[new d([198,51,100,0]),24],[new d([203,0,113,0]),24],[new d([240,0,0,0]),4]]},d.prototype.kind=function(){return"ipv4"},d.prototype.match=function(p,b){let w;if(b===void 0&&(w=p,p=w[0],b=w[1]),p.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return l(this.octets,p.octets,8,b)},d.prototype.prefixLengthFromSubnetMask=function(){let p=0,b=!1;const w={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let S,E,m;for(S=3;S>=0;S-=1)if(E=this.octets[S],E in w){if(m=w[E],b&&m!==0)return null;m!==8&&(b=!0),p+=m}else return null;return 32-p},d.prototype.range=function(){return y.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){return this.octets.slice(0)},d.prototype.toIPv4MappedAddress=function(){return y.IPv6.parse(`::ffff:${this.toString()}`)},d.prototype.toNormalizedString=function(){return this.toString()},d.prototype.toString=function(){return this.octets.join(".")},d}(),y.IPv4.broadcastAddressFromCIDR=function(d){try{const p=this.parseCIDR(d),b=p[0].toByteArray(),w=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),S=[];let E=0;for(;E<4;)S.push(parseInt(b[E],10)|parseInt(w[E],10)^255),E++;return new this(S)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},y.IPv4.isIPv4=function(d){return this.parser(d)!==null},y.IPv4.isValid=function(d){try{return new this(this.parser(d)),!0}catch{return!1}},y.IPv4.isValidFourPartDecimal=function(d){return!!(y.IPv4.isValid(d)&&d.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},y.IPv4.networkAddressFromCIDR=function(d){let p,b,w,S,E;try{for(p=this.parseCIDR(d),w=p[0].toByteArray(),E=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),S=[],b=0;b<4;)S.push(parseInt(w[b],10)&parseInt(E[b],10)),b++;return new this(S)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},y.IPv4.parse=function(d){const p=this.parser(d);if(p===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(p)},y.IPv4.parseCIDR=function(d){let p;if(p=d.match(/^(.+)\/(\d+)$/)){const b=parseInt(p[2]);if(b>=0&&b<=32){const w=[this.parse(p[1]),b];return Object.defineProperty(w,"toString",{value:function(){return this.join("/")}}),w}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},y.IPv4.parser=function(d){let p,b,w;if(p=d.match(n.fourOctet))return function(){const S=p.slice(1,6),E=[];for(let m=0;m<S.length;m++)b=S[m],E.push(h(b));return E}();if(p=d.match(n.longValue)){if(w=h(p[1]),w>4294967295||w<0)throw new Error("ipaddr: address outside defined range");return function(){const S=[];let E;for(E=0;E<=24;E+=8)S.push(w>>E&255);return S}().reverse()}else return(p=d.match(n.twoOctet))?function(){const S=p.slice(1,4),E=[];if(w=h(S[1]),w>16777215||w<0)throw new Error("ipaddr: address outside defined range");return E.push(h(S[0])),E.push(w>>16&255),E.push(w>>8&255),E.push(w&255),E}():(p=d.match(n.threeOctet))?function(){const S=p.slice(1,5),E=[];if(w=h(S[2]),w>65535||w<0)throw new Error("ipaddr: address outside defined range");return E.push(h(S[0])),E.push(h(S[1])),E.push(w>>8&255),E.push(w&255),E}():null},y.IPv4.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>32)throw new Error("ipaddr: invalid IPv4 prefix length");const p=[0,0,0,0];let b=0;const w=Math.floor(d/8);for(;b<w;)p[b]=255,b++;return w<4&&(p[w]=Math.pow(2,d%8)-1<<8-d%8),new this(p)},y.IPv6=function(){function d(p,b){let w,S;if(p.length===16)for(this.parts=[],w=0;w<=14;w+=2)this.parts.push(p[w]<<8|p[w+1]);else if(p.length===8)this.parts=p;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(w=0;w<this.parts.length;w++)if(S=this.parts[w],!(0<=S&&S<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");b&&(this.zoneId=b)}return d.prototype.SpecialRanges={unspecified:[new d([0,0,0,0,0,0,0,0]),128],linkLocal:[new d([65152,0,0,0,0,0,0,0]),10],multicast:[new d([65280,0,0,0,0,0,0,0]),8],loopback:[new d([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new d([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new d([0,0,0,0,0,65535,0,0]),96],rfc6145:[new d([0,0,0,0,65535,0,0,0]),96],rfc6052:[new d([100,65435,0,0,0,0,0,0]),96],"6to4":[new d([8194,0,0,0,0,0,0,0]),16],teredo:[new d([8193,0,0,0,0,0,0,0]),32],reserved:[[new d([8193,3512,0,0,0,0,0,0]),32]],benchmarking:[new d([8193,2,0,0,0,0,0,0]),48],amt:[new d([8193,3,0,0,0,0,0,0]),32],as112v6:[new d([8193,4,274,0,0,0,0,0]),48],deprecated:[new d([8193,16,0,0,0,0,0,0]),28],orchid2:[new d([8193,32,0,0,0,0,0,0]),28]},d.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},d.prototype.kind=function(){return"ipv6"},d.prototype.match=function(p,b){let w;if(b===void 0&&(w=p,p=w[0],b=w[1]),p.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return l(this.parts,p.parts,16,b)},d.prototype.prefixLengthFromSubnetMask=function(){let p=0,b=!1;const w={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let S,E;for(let m=7;m>=0;m-=1)if(S=this.parts[m],S in w){if(E=w[S],b&&E!==0)return null;E!==16&&(b=!0),p+=E}else return null;return 128-p},d.prototype.range=function(){return y.subnetMatch(this,this.SpecialRanges)},d.prototype.toByteArray=function(){let p;const b=[],w=this.parts;for(let S=0;S<w.length;S++)p=w[S],b.push(p>>8),b.push(p&255);return b},d.prototype.toFixedLengthString=function(){const p=function(){const w=[];for(let S=0;S<this.parts.length;S++)w.push(f(this.parts[S].toString(16),4));return w}.call(this).join(":");let b="";return this.zoneId&&(b=`%${this.zoneId}`),p+b},d.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const p=this.parts.slice(-2),b=p[0],w=p[1];return new y.IPv4([b>>8,b&255,w>>8,w&255])},d.prototype.toNormalizedString=function(){const p=function(){const w=[];for(let S=0;S<this.parts.length;S++)w.push(this.parts[S].toString(16));return w}.call(this).join(":");let b="";return this.zoneId&&(b=`%${this.zoneId}`),p+b},d.prototype.toRFC5952String=function(){const p=/((^|:)(0(:|$)){2,})/g,b=this.toNormalizedString();let w=0,S=-1,E;for(;E=p.exec(b);)E[0].length>S&&(w=E.index,S=E[0].length);return S<0?b:`${b.substring(0,w)}::${b.substring(w+S)}`},d.prototype.toString=function(){return this.toRFC5952String()},d}(),y.IPv6.broadcastAddressFromCIDR=function(d){try{const p=this.parseCIDR(d),b=p[0].toByteArray(),w=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),S=[];let E=0;for(;E<16;)S.push(parseInt(b[E],10)|parseInt(w[E],10)^255),E++;return new this(S)}catch(p){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${p})`)}},y.IPv6.isIPv6=function(d){return this.parser(d)!==null},y.IPv6.isValid=function(d){if(typeof d=="string"&&d.indexOf(":")===-1)return!1;try{const p=this.parser(d);return new this(p.parts,p.zoneId),!0}catch{return!1}},y.IPv6.networkAddressFromCIDR=function(d){let p,b,w,S,E;try{for(p=this.parseCIDR(d),w=p[0].toByteArray(),E=this.subnetMaskFromPrefixLength(p[1]).toByteArray(),S=[],b=0;b<16;)S.push(parseInt(w[b],10)&parseInt(E[b],10)),b++;return new this(S)}catch(m){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${m})`)}},y.IPv6.parse=function(d){const p=this.parser(d);if(p.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(p.parts,p.zoneId)},y.IPv6.parseCIDR=function(d){let p,b,w;if((b=d.match(/^(.+)\/(\d+)$/))&&(p=parseInt(b[2]),p>=0&&p<=128))return w=[this.parse(b[1]),p],Object.defineProperty(w,"toString",{value:function(){return this.join("/")}}),w;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},y.IPv6.parser=function(d){let p,b,w,S,E,m;if(w=d.match(c.deprecatedTransitional))return this.parser(`::ffff:${w[1]}`);if(c.native.test(d))return u(d,8);if((w=d.match(c.transitional))&&(m=w[6]||"",p=u(w[1].slice(0,-1)+m,6),p.parts)){for(E=[parseInt(w[2]),parseInt(w[3]),parseInt(w[4]),parseInt(w[5])],b=0;b<E.length;b++)if(S=E[b],!(0<=S&&S<=255))return null;return p.parts.push(E[0]<<8|E[1]),p.parts.push(E[2]<<8|E[3]),{parts:p.parts,zoneId:p.zoneId}}return null},y.IPv6.subnetMaskFromPrefixLength=function(d){if(d=parseInt(d),d<0||d>128)throw new Error("ipaddr: invalid IPv6 prefix length");const p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let b=0;const w=Math.floor(d/8);for(;b<w;)p[b]=255,b++;return w<16&&(p[w]=Math.pow(2,d%8)-1<<8-d%8),new this(p)},y.fromByteArray=function(d){const p=d.length;if(p===4)return new y.IPv4(d);if(p===16)return new y.IPv6(d);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},y.isValid=function(d){return y.IPv6.isValid(d)||y.IPv4.isValid(d)},y.parse=function(d){if(y.IPv6.isValid(d))return y.IPv6.parse(d);if(y.IPv4.isValid(d))return y.IPv4.parse(d);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},y.parseCIDR=function(d){try{return y.IPv6.parseCIDR(d)}catch{try{return y.IPv4.parseCIDR(d)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},y.process=function(d){const p=this.parse(d);return p.kind()==="ipv6"&&p.isIPv4MappedAddress()?p.toIPv4Address():p},y.subnetMatch=function(d,p,b){let w,S,E,m;b==null&&(b="unicast");for(S in p)if(Object.prototype.hasOwnProperty.call(p,S)){for(E=p[S],E[0]&&!(E[0]instanceof Array)&&(E=[E]),w=0;w<E.length;w++)if(m=E[w],d.kind()===m[0].kind()&&d.match.apply(d,m))return S}return b},r.exports?r.exports=y:e.ipaddr=y})(Is)})(Tj);var yKe=Tj.exports;const gKe=Et(yKe),{isValid:wKe,parse:bKe}=gKe,mKe=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],EKe=mKe.map(r=>new $j(r));function vKe(r){for(let e of EKe)if(e.contains(r))return!0;return!1}function _D(r){return/^::$/.test(r)||/^::1$/.test(r)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}const c3=r=>{if(wKe(r)){const e=bKe(r);if(e.kind()==="ipv4")return vKe(e.toNormalizedString());if(e.kind()==="ipv6")return _D(r)}else if(Nt(r)&&m_.v6().test(r))return _D(r)};function SD(r){try{const{address:e}=r.nodeAddress();return!!c3(e)}catch{return!0}}function E_(r,e){const t=SD(r.multiaddr),n=SD(e.multiaddr);return t&&!n?1:!t&&n||r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}const Af=U("libp2p:auto-relay"),_Ke=()=>{};class SKe{constructor(e,t){this.components=e,this.addressSorter=t.addressSorter??E_,this.maxListeners=t.maxListeners??1,this.listenRelays=new Set,this.onError=t.onError??_Ke,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",n=>{this._onProtocolChange(n).catch(s=>{Af.error(s)})}),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(e){const{peerId:t,protocols:n}=e.detail,s=t.toString();if(n.find(o=>o===Mh)==null){this.listenRelays.has(s)&&await this._removeListenRelay(s);return}if(!this.listenRelays.has(s))try{const o=this.components.connectionManager.getConnections(t);if(o.length===0)return;const a=o[0];if(a.remoteAddr.protoCodes().includes(hKe)){Af(`relayed connection to ${s} will not be used to hop on`);return}await iKe({connection:a})&&(await this.components.peerStore.metadataBook.setValue(t,mD,M(ED)),await this._addListenRelay(a,s))}catch(o){this.onError(o)}}_onPeerDisconnected(e){const s=e.detail.remotePeer.toString();this.listenRelays.has(s)&&this._removeListenRelay(s).catch(i=>{Af.error(i)})}async _addListenRelay(e,t){try{if(this.listenRelays.size>=this.maxListeners)return;const n=await Ve(await this.components.peerStore.addressBook.get(e.remotePeer),i=>Eg(i,this.addressSorter),async i=>await Kc(i));(await Promise.all(n.map(async i=>{try{let o=i.multiaddr;return o.getPeerId()==null&&(o=o.encapsulate(`/p2p/${e.remotePeer.toString()}`)),o=o.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([o]),!0}catch(o){Af.error("error listening on circuit address",o),this.onError(o)}return!1}))).includes(!0)&&this.listenRelays.add(t)}catch(n){this.onError(n),this.listenRelays.delete(t)}}async _removeListenRelay(e){this.listenRelays.delete(e)&&await this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this.listenRelays.size>=this.maxListeners)return;const t=[],n=await this.components.peerStore.all();for(const{id:s,metadata:i}of n){const o=s.toString();if(this.listenRelays.has(o)||e.includes(o))continue;const a=i.get(mD);if(a==null||R(a)!==ED)continue;const c=this.components.connectionManager.getConnections(s);if(c.length===0){t.push(s);continue}if(await this._addListenRelay(c[0],o),this.listenRelays.size>=this.maxListeners)return}for(const s of t)if(await this._tryToListenOnRelay(s),this.listenRelays.size>=this.maxListeners)return;try{const s=await _j(Aj);for await(const i of this.components.contentRouting.findProviders(s)){if(i.multiaddrs.length===0)continue;const o=i.id;if(!o.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(o,i.multiaddrs),await this._tryToListenOnRelay(o),this.listenRelays.size>=this.maxListeners))return}}catch(s){this.onError(s)}}async _tryToListenOnRelay(e){try{const t=await this.components.connectionManager.openConnection(e);await this._addListenRelay(t,e.toString())}catch(t){Af.error("Could not use %p as relay",e,t),this.onError(t,`could not connect and listen on known hop relay ${e.toString()}`)}}}const AD=U("libp2p:relay");class AKe{constructor(e,t){this.components=e,this.autoRelay=t.autoRelay?.enabled!==!1?new SKe(e,{addressSorter:t.addressSorter,...t.autoRelay}):void 0,this.started=!1,this.init=t,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){this.init.hop.enabled!==!1&&this.init.advertise.enabled!==!1&&(this.timeout=ew.setDelayedInterval(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){this.timeout!=null&&ew.clearDelayedInterval(this.timeout),this.started=!1}async _advertiseService(){try{const e=await _j(Aj);await this.components.contentRouting.provide(e)}catch(e){e.code===O.ERR_NO_ROUTERS_AVAILABLE?(AD.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),await this.stop()):AD.error(e)}}}function $Ke(r){return r>=55296&&r<=56319}function TKe(r){return r>=56320&&r<=57343}var IKe=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var s=t.length,i=0,o,a,c=0;c<s;c+=1){if(o=t.charCodeAt(c),a=t[c],$Ke(o)&&TKe(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),i+=e(a),i===n)return t.slice(0,c+1);if(i>n)return t.slice(0,c-a.length+1)}return t};function RKe(r){return r>=55296&&r<=56319}function CKe(r){return r>=56320&&r<=57343}var xKe=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,s=null,i=null,o=0;o<t;o++)s=e.charCodeAt(o),CKe(s)?i!=null&&RKe(i)?n+=1:n+=3:s<=127?n+=1:s>=128&&s<=2047?n+=2:s>=2048&&s<=65535&&(n+=3),i=s;return n},DKe=IKe,PKe=xKe,OKe=DKe.bind(null,PKe),kKe=OKe,NKe=/[\/\?<>\\:\*\|"]/g,LKe=/[\x00-\x1f\x80-\x9f]/g,MKe=/^\.+$/,UKe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,BKe=/[\. ]+$/;function $D(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(NKe,e).replace(LKe,e).replace(MKe,e).replace(UKe,e).replace(BKe,e);return kKe(t,255)}var zKe=function(r,e){var t=e&&e.replacement||"",n=$D(r,t);return t===""?n:$D(n,"")};const FKe=Et(zKe);var Bh=Hh,se=Bh.asn1,md=Bh.pkcs7asn1=Bh.pkcs7asn1||{};Bh.pkcs7=Bh.pkcs7||{};Bh.pkcs7.asn1=md;var Ij={name:"ContentInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:se.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};md.contentInfoValidator=Ij;var Rj={name:"EncryptedContentInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:se.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:se.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};md.envelopedDataValidator={name:"EnvelopedData",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:se.Class.UNIVERSAL,type:se.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(Rj)};md.encryptedDataValidator={name:"EncryptedData",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"version"}].concat(Rj)};var VKe={name:"SignerInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:se.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:se.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:se.Class.UNIVERSAL,type:se.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:se.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};md.signedDataValidator={name:"SignedData",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:se.Class.UNIVERSAL,type:se.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},Ij,{name:"SignedData.Certificates",tagClass:se.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:se.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:se.Class.UNIVERSAL,type:se.Type.SET,capture:"signerInfos",optional:!0,value:[VKe]}]};md.recipientInfoValidator={name:"RecipientInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:se.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:se.Class.UNIVERSAL,type:se.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]};var Ll=Hh;Ll.mgf=Ll.mgf||{};var jKe=Ll.mgf.mgf1=Ll.mgf1=Ll.mgf1||{};jKe.create=function(r){var e={generate:function(t,n){for(var s=new Ll.util.ByteBuffer,i=Math.ceil(n/r.digestLength),o=0;o<i;o++){var a=new Ll.util.ByteBuffer;a.putInt32(o),r.start(),r.update(t+a.getBytes()),s.putBuffer(r.digest())}return s.truncate(s.length()-n),s.getBytes()}};return e};var ow=Hh;ow.mgf=ow.mgf||{};ow.mgf.mgf1=ow.mgf1;var ul=Hh,KKe=ul.pss=ul.pss||{};KKe.create=function(r){arguments.length===3&&(r={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e=r.md,t=r.mgf,n=e.digestLength,s=r.salt||null;typeof s=="string"&&(s=ul.util.createBuffer(s));var i;if("saltLength"in r)i=r.saltLength;else if(s!==null)i=s.length();else throw new Error("Salt length not specified or specific salt not given.");if(s!==null&&s.length()!==i)throw new Error("Given salt length does not match length of given salt.");var o=r.prng||ul.random,a={};return a.encode=function(c,u){var l,h=u-1,f=Math.ceil(h/8),y=c.digest().getBytes();if(f<n+i+2)throw new Error("Message is too long to encrypt.");var d;s===null?d=o.getBytesSync(i):d=s.bytes();var p=new ul.util.ByteBuffer;p.fillWithByte(0,8),p.putBytes(y),p.putBytes(d),e.start(),e.update(p.getBytes());var b=e.digest().getBytes(),w=new ul.util.ByteBuffer;w.fillWithByte(0,f-i-n-2),w.putByte(1),w.putBytes(d);var S=w.getBytes(),E=f-n-1,m=t.generate(b,E),v="";for(l=0;l<E;l++)v+=String.fromCharCode(S.charCodeAt(l)^m.charCodeAt(l));var A=65280>>8*f-h&255;return v=String.fromCharCode(v.charCodeAt(0)&~A)+v.substr(1),v+b+String.fromCharCode(188)},a.verify=function(c,u,l){var h,f=l-1,y=Math.ceil(f/8);if(u=u.substr(-y),y<n+i+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(u.charCodeAt(y-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var d=y-n-1,p=u.substr(0,d),b=u.substr(d,n),w=65280>>8*y-f&255;if(p.charCodeAt(0)&w)throw new Error("Bits beyond keysize not zero as expected.");var S=t.generate(b,d),E="";for(h=0;h<d;h++)E+=String.fromCharCode(p.charCodeAt(h)^S.charCodeAt(h));E=String.fromCharCode(E.charCodeAt(0)&~w)+E.substr(1);var m=y-n-i-2;for(h=0;h<m;h++)if(E.charCodeAt(h)!==0)throw new Error("Leftmost octets not zero as expected");if(E.charCodeAt(m)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var v=E.substr(-i),A=new ul.util.ByteBuffer;A.fillWithByte(0,8),A.putBytes(c),A.putBytes(v),e.start(),e.update(A.getBytes());var g=e.digest().getBytes();return b===g},a};var pe=Hh,I=pe.asn1,X=pe.pki=pe.pki||{},ze=X.oids,sr={};sr.CN=ze.commonName;sr.commonName="CN";sr.C=ze.countryName;sr.countryName="C";sr.L=ze.localityName;sr.localityName="L";sr.ST=ze.stateOrProvinceName;sr.stateOrProvinceName="ST";sr.O=ze.organizationName;sr.organizationName="O";sr.OU=ze.organizationalUnitName;sr.organizationalUnitName="OU";sr.E=ze.emailAddress;sr.emailAddress="E";var Cj=pe.pki.rsa.publicKeyValidator,qKe={name:"Certificate",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:I.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:I.Class.UNIVERSAL,type:I.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:I.Class.UNIVERSAL,type:I.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:I.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:I.Class.UNIVERSAL,type:I.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:I.Class.UNIVERSAL,type:I.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:I.Class.UNIVERSAL,type:I.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:I.Class.UNIVERSAL,type:I.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},Cj,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:I.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:I.Class.UNIVERSAL,type:I.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:I.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:I.Class.UNIVERSAL,type:I.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:I.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:I.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:I.Class.UNIVERSAL,type:I.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},HKe={name:"rsapss",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:I.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:I.Class.UNIVERSAL,type:I.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:I.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:I.Class.UNIVERSAL,type:I.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:I.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:I.Class.UNIVERSAL,type:I.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:I.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:I.Class.UNIVERSAL,type:I.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},GKe={name:"CertificationRequestInfo",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:I.Class.UNIVERSAL,type:I.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},Cj,{name:"CertificationRequestInfo.attributes",tagClass:I.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:I.Class.UNIVERSAL,type:I.Type.SET,constructed:!0}]}]}]},WKe={name:"CertificationRequest",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[GKe,{name:"CertificationRequest.signatureAlgorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:I.Class.UNIVERSAL,type:I.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:I.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:I.Class.UNIVERSAL,type:I.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};X.RDNAttributesAsArray=function(r,e){for(var t=[],n,s,i,o=0;o<r.value.length;++o){n=r.value[o];for(var a=0;a<n.value.length;++a)i={},s=n.value[a],i.type=I.derToOid(s.value[0].value),i.value=s.value[1].value,i.valueTagClass=s.value[1].type,i.type in ze&&(i.name=ze[i.type],i.name in sr&&(i.shortName=sr[i.name])),e&&(e.update(i.type),e.update(i.value)),t.push(i)}return t};X.CRIAttributesAsArray=function(r){for(var e=[],t=0;t<r.length;++t)for(var n=r[t],s=I.derToOid(n.value[0].value),i=n.value[1].value,o=0;o<i.length;++o){var a={};if(a.type=s,a.value=i[o].value,a.valueTagClass=i[o].type,a.type in ze&&(a.name=ze[a.type],a.name in sr&&(a.shortName=sr[a.name])),a.type===ze.extensionRequest){a.extensions=[];for(var c=0;c<a.value.length;++c)a.extensions.push(X.certificateExtensionFromAsn1(a.value[c]))}e.push(a)}return e};function Fc(r,e){typeof e=="string"&&(e={shortName:e});for(var t=null,n,s=0;t===null&&s<r.attributes.length;++s)n=r.attributes[s],(e.type&&e.type===n.type||e.name&&e.name===n.name||e.shortName&&e.shortName===n.shortName)&&(t=n);return t}var aw=function(r,e,t){var n={};if(r!==ze["RSASSA-PSS"])return n;t&&(n={hash:{algorithmOid:ze.sha1},mgf:{algorithmOid:ze.mgf1,hash:{algorithmOid:ze.sha1}},saltLength:20});var s={},i=[];if(!I.validate(e,HKe,s,i)){var o=new Error("Cannot read RSASSA-PSS parameter block.");throw o.errors=i,o}return s.hashOid!==void 0&&(n.hash=n.hash||{},n.hash.algorithmOid=I.derToOid(s.hashOid)),s.maskGenOid!==void 0&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=I.derToOid(s.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=I.derToOid(s.maskGenHashOid)),s.saltLength!==void 0&&(n.saltLength=s.saltLength.charCodeAt(0)),n},l3=function(r){switch(ze[r.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return pe.md.sha1.create();case"md5WithRSAEncryption":return pe.md.md5.create();case"sha256WithRSAEncryption":return pe.md.sha256.create();case"sha384WithRSAEncryption":return pe.md.sha384.create();case"sha512WithRSAEncryption":return pe.md.sha512.create();case"RSASSA-PSS":return pe.md.sha256.create();default:var e=new Error("Could not compute "+r.type+" digest. Unknown signature OID.");throw e.signatureOid=r.signatureOid,e}},xj=function(r){var e=r.certificate,t;switch(e.signatureOid){case ze.sha1WithRSAEncryption:case ze.sha1WithRSASignature:break;case ze["RSASSA-PSS"]:var n,s;if(n=ze[e.signatureParameters.mgf.hash.algorithmOid],n===void 0||pe.md[n]===void 0){var i=new Error("Unsupported MGF hash function.");throw i.oid=e.signatureParameters.mgf.hash.algorithmOid,i.name=n,i}if(s=ze[e.signatureParameters.mgf.algorithmOid],s===void 0||pe.mgf[s]===void 0){var i=new Error("Unsupported MGF function.");throw i.oid=e.signatureParameters.mgf.algorithmOid,i.name=s,i}if(s=pe.mgf[s].create(pe.md[n].create()),n=ze[e.signatureParameters.hash.algorithmOid],n===void 0||pe.md[n]===void 0){var i=new Error("Unsupported RSASSA-PSS hash function.");throw i.oid=e.signatureParameters.hash.algorithmOid,i.name=n,i}t=pe.pss.create(pe.md[n].create(),s,e.signatureParameters.saltLength);break}return e.publicKey.verify(r.md.digest().getBytes(),r.signature,t)};X.certificateFromPem=function(r,e,t){var n=pe.pem.decode(r)[0];if(n.type!=="CERTIFICATE"&&n.type!=="X509 CERTIFICATE"&&n.type!=="TRUSTED CERTIFICATE"){var s=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw s.headerType=n.type,s}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var i=I.fromDer(n.body,t);return X.certificateFromAsn1(i,e)};X.certificateToPem=function(r,e){var t={type:"CERTIFICATE",body:I.toDer(X.certificateToAsn1(r)).getBytes()};return pe.pem.encode(t,{maxline:e})};X.publicKeyFromPem=function(r){var e=pe.pem.decode(r)[0];if(e.type!=="PUBLIC KEY"&&e.type!=="RSA PUBLIC KEY"){var t=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var n=I.fromDer(e.body);return X.publicKeyFromAsn1(n)};X.publicKeyToPem=function(r,e){var t={type:"PUBLIC KEY",body:I.toDer(X.publicKeyToAsn1(r)).getBytes()};return pe.pem.encode(t,{maxline:e})};X.publicKeyToRSAPublicKeyPem=function(r,e){var t={type:"RSA PUBLIC KEY",body:I.toDer(X.publicKeyToRSAPublicKey(r)).getBytes()};return pe.pem.encode(t,{maxline:e})};X.getPublicKeyFingerprint=function(r,e){e=e||{};var t=e.md||pe.md.sha1.create(),n=e.type||"RSAPublicKey",s;switch(n){case"RSAPublicKey":s=I.toDer(X.publicKeyToRSAPublicKey(r)).getBytes();break;case"SubjectPublicKeyInfo":s=I.toDer(X.publicKeyToAsn1(r)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}t.start(),t.update(s);var i=t.digest();if(e.encoding==="hex"){var o=i.toHex();return e.delimiter?o.match(/.{2}/g).join(e.delimiter):o}else{if(e.encoding==="binary")return i.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return i};X.certificationRequestFromPem=function(r,e,t){var n=pe.pem.decode(r)[0];if(n.type!=="CERTIFICATE REQUEST"){var s=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw s.headerType=n.type,s}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var i=I.fromDer(n.body,t);return X.certificationRequestFromAsn1(i,e)};X.certificationRequestToPem=function(r,e){var t={type:"CERTIFICATE REQUEST",body:I.toDer(X.certificationRequestToAsn1(r)).getBytes()};return pe.pem.encode(t,{maxline:e})};X.createCertificate=function(){var r={};return r.version=2,r.serialNumber="00",r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.validity={},r.validity.notBefore=new Date,r.validity.notAfter=new Date,r.issuer={},r.issuer.getField=function(e){return Fc(r.issuer,e)},r.issuer.addField=function(e){di([e]),r.issuer.attributes.push(e)},r.issuer.attributes=[],r.issuer.hash=null,r.subject={},r.subject.getField=function(e){return Fc(r.subject,e)},r.subject.addField=function(e){di([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.extensions=[],r.publicKey=null,r.md=null,r.setSubject=function(e,t){di(e),r.subject.attributes=e,delete r.subject.uniqueId,t&&(r.subject.uniqueId=t),r.subject.hash=null},r.setIssuer=function(e,t){di(e),r.issuer.attributes=e,delete r.issuer.uniqueId,t&&(r.issuer.uniqueId=t),r.issuer.hash=null},r.setExtensions=function(e){for(var t=0;t<e.length;++t)Dj(e[t],{cert:r});r.extensions=e},r.getExtension=function(e){typeof e=="string"&&(e={name:e});for(var t=null,n,s=0;t===null&&s<r.extensions.length;++s)n=r.extensions[s],(e.id&&n.id===e.id||e.name&&n.name===e.name)&&(t=n);return t},r.sign=function(e,t){r.md=t||pe.md.sha1.create();var n=ze[r.md.algorithm+"WithRSAEncryption"];if(!n){var s=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw s.algorithm=r.md.algorithm,s}r.signatureOid=r.siginfo.algorithmOid=n,r.tbsCertificate=X.getTBSCertificate(r);var i=I.toDer(r.tbsCertificate);r.md.update(i.getBytes()),r.signature=e.sign(r.md)},r.verify=function(e){var t=!1;if(!r.issued(e)){var n=e.issuer,s=r.subject,i=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw i.expectedIssuer=s.attributes,i.actualIssuer=n.attributes,i}var o=e.md;if(o===null){o=l3({signatureOid:e.signatureOid,type:"certificate"});var a=e.tbsCertificate||X.getTBSCertificate(e),c=I.toDer(a);o.update(c.getBytes())}return o!==null&&(t=xj({certificate:r,md:o,signature:e.signature})),t},r.isIssuer=function(e){var t=!1,n=r.issuer,s=e.subject;if(n.hash&&s.hash)t=n.hash===s.hash;else if(n.attributes.length===s.attributes.length){t=!0;for(var i,o,a=0;t&&a<n.attributes.length;++a)i=n.attributes[a],o=s.attributes[a],(i.type!==o.type||i.value!==o.value)&&(t=!1)}return t},r.issued=function(e){return e.isIssuer(r)},r.generateSubjectKeyIdentifier=function(){return X.getPublicKeyFingerprint(r.publicKey,{type:"RSAPublicKey"})},r.verifySubjectKeyIdentifier=function(){for(var e=ze.subjectKeyIdentifier,t=0;t<r.extensions.length;++t){var n=r.extensions[t];if(n.id===e){var s=r.generateSubjectKeyIdentifier().getBytes();return pe.util.hexToBytes(n.subjectKeyIdentifier)===s}}return!1},r};X.certificateFromAsn1=function(r,e){var t={},n=[];if(!I.validate(r,qKe,t,n)){var s=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw s.errors=n,s}var i=I.derToOid(t.publicKeyOid);if(i!==X.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var o=X.createCertificate();o.version=t.certVersion?t.certVersion.charCodeAt(0):0;var a=pe.util.createBuffer(t.certSerialNumber);o.serialNumber=a.toHex(),o.signatureOid=pe.asn1.derToOid(t.certSignatureOid),o.signatureParameters=aw(o.signatureOid,t.certSignatureParams,!0),o.siginfo.algorithmOid=pe.asn1.derToOid(t.certinfoSignatureOid),o.siginfo.parameters=aw(o.siginfo.algorithmOid,t.certinfoSignatureParams,!1),o.signature=t.certSignature;var c=[];if(t.certValidity1UTCTime!==void 0&&c.push(I.utcTimeToDate(t.certValidity1UTCTime)),t.certValidity2GeneralizedTime!==void 0&&c.push(I.generalizedTimeToDate(t.certValidity2GeneralizedTime)),t.certValidity3UTCTime!==void 0&&c.push(I.utcTimeToDate(t.certValidity3UTCTime)),t.certValidity4GeneralizedTime!==void 0&&c.push(I.generalizedTimeToDate(t.certValidity4GeneralizedTime)),c.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(c.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(o.validity.notBefore=c[0],o.validity.notAfter=c[1],o.tbsCertificate=t.tbsCertificate,e){o.md=l3({signatureOid:o.signatureOid,type:"certificate"});var u=I.toDer(o.tbsCertificate);o.md.update(u.getBytes())}var l=pe.md.sha1.create(),h=I.toDer(t.certIssuer);l.update(h.getBytes()),o.issuer.getField=function(d){return Fc(o.issuer,d)},o.issuer.addField=function(d){di([d]),o.issuer.attributes.push(d)},o.issuer.attributes=X.RDNAttributesAsArray(t.certIssuer),t.certIssuerUniqueId&&(o.issuer.uniqueId=t.certIssuerUniqueId),o.issuer.hash=l.digest().toHex();var f=pe.md.sha1.create(),y=I.toDer(t.certSubject);return f.update(y.getBytes()),o.subject.getField=function(d){return Fc(o.subject,d)},o.subject.addField=function(d){di([d]),o.subject.attributes.push(d)},o.subject.attributes=X.RDNAttributesAsArray(t.certSubject),t.certSubjectUniqueId&&(o.subject.uniqueId=t.certSubjectUniqueId),o.subject.hash=f.digest().toHex(),t.certExtensions?o.extensions=X.certificateExtensionsFromAsn1(t.certExtensions):o.extensions=[],o.publicKey=X.publicKeyFromAsn1(t.subjectPublicKeyInfo),o};X.certificateExtensionsFromAsn1=function(r){for(var e=[],t=0;t<r.value.length;++t)for(var n=r.value[t],s=0;s<n.value.length;++s)e.push(X.certificateExtensionFromAsn1(n.value[s]));return e};X.certificateExtensionFromAsn1=function(r){var e={};if(e.id=I.derToOid(r.value[0].value),e.critical=!1,r.value[1].type===I.Type.BOOLEAN?(e.critical=r.value[1].value.charCodeAt(0)!==0,e.value=r.value[2].value):e.value=r.value[1].value,e.id in ze){if(e.name=ze[e.id],e.name==="keyUsage"){var t=I.fromDer(e.value),n=0,s=0;t.value.length>1&&(n=t.value.charCodeAt(1),s=t.value.length>2?t.value.charCodeAt(2):0),e.digitalSignature=(n&128)===128,e.nonRepudiation=(n&64)===64,e.keyEncipherment=(n&32)===32,e.dataEncipherment=(n&16)===16,e.keyAgreement=(n&8)===8,e.keyCertSign=(n&4)===4,e.cRLSign=(n&2)===2,e.encipherOnly=(n&1)===1,e.decipherOnly=(s&128)===128}else if(e.name==="basicConstraints"){var t=I.fromDer(e.value);t.value.length>0&&t.value[0].type===I.Type.BOOLEAN?e.cA=t.value[0].value.charCodeAt(0)!==0:e.cA=!1;var i=null;t.value.length>0&&t.value[0].type===I.Type.INTEGER?i=t.value[0].value:t.value.length>1&&(i=t.value[1].value),i!==null&&(e.pathLenConstraint=I.derToInteger(i))}else if(e.name==="extKeyUsage")for(var t=I.fromDer(e.value),o=0;o<t.value.length;++o){var a=I.derToOid(t.value[o].value);a in ze?e[ze[a]]=!0:e[a]=!0}else if(e.name==="nsCertType"){var t=I.fromDer(e.value),n=0;t.value.length>1&&(n=t.value.charCodeAt(1)),e.client=(n&128)===128,e.server=(n&64)===64,e.email=(n&32)===32,e.objsign=(n&16)===16,e.reserved=(n&8)===8,e.sslCA=(n&4)===4,e.emailCA=(n&2)===2,e.objCA=(n&1)===1}else if(e.name==="subjectAltName"||e.name==="issuerAltName"){e.altNames=[];for(var c,t=I.fromDer(e.value),u=0;u<t.value.length;++u){c=t.value[u];var l={type:c.type,value:c.value};switch(e.altNames.push(l),c.type){case 1:case 2:case 6:break;case 7:l.ip=pe.util.bytesToIP(c.value);break;case 8:l.oid=I.derToOid(c.value);break}}}else if(e.name==="subjectKeyIdentifier"){var t=I.fromDer(e.value);e.subjectKeyIdentifier=pe.util.bytesToHex(t.value)}}return e};X.certificationRequestFromAsn1=function(r,e){var t={},n=[];if(!I.validate(r,WKe,t,n)){var s=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw s.errors=n,s}var i=I.derToOid(t.publicKeyOid);if(i!==X.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var o=X.createCertificationRequest();if(o.version=t.csrVersion?t.csrVersion.charCodeAt(0):0,o.signatureOid=pe.asn1.derToOid(t.csrSignatureOid),o.signatureParameters=aw(o.signatureOid,t.csrSignatureParams,!0),o.siginfo.algorithmOid=pe.asn1.derToOid(t.csrSignatureOid),o.siginfo.parameters=aw(o.siginfo.algorithmOid,t.csrSignatureParams,!1),o.signature=t.csrSignature,o.certificationRequestInfo=t.certificationRequestInfo,e){o.md=l3({signatureOid:o.signatureOid,type:"certification request"});var a=I.toDer(o.certificationRequestInfo);o.md.update(a.getBytes())}var c=pe.md.sha1.create();return o.subject.getField=function(u){return Fc(o.subject,u)},o.subject.addField=function(u){di([u]),o.subject.attributes.push(u)},o.subject.attributes=X.RDNAttributesAsArray(t.certificationRequestInfoSubject,c),o.subject.hash=c.digest().toHex(),o.publicKey=X.publicKeyFromAsn1(t.subjectPublicKeyInfo),o.getAttribute=function(u){return Fc(o,u)},o.addAttribute=function(u){di([u]),o.attributes.push(u)},o.attributes=X.CRIAttributesAsArray(t.certificationRequestInfoAttributes||[]),o};X.createCertificationRequest=function(){var r={};return r.version=0,r.signatureOid=null,r.signature=null,r.siginfo={},r.siginfo.algorithmOid=null,r.subject={},r.subject.getField=function(e){return Fc(r.subject,e)},r.subject.addField=function(e){di([e]),r.subject.attributes.push(e)},r.subject.attributes=[],r.subject.hash=null,r.publicKey=null,r.attributes=[],r.getAttribute=function(e){return Fc(r,e)},r.addAttribute=function(e){di([e]),r.attributes.push(e)},r.md=null,r.setSubject=function(e){di(e),r.subject.attributes=e,r.subject.hash=null},r.setAttributes=function(e){di(e),r.attributes=e},r.sign=function(e,t){r.md=t||pe.md.sha1.create();var n=ze[r.md.algorithm+"WithRSAEncryption"];if(!n){var s=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw s.algorithm=r.md.algorithm,s}r.signatureOid=r.siginfo.algorithmOid=n,r.certificationRequestInfo=X.getCertificationRequestInfo(r);var i=I.toDer(r.certificationRequestInfo);r.md.update(i.getBytes()),r.signature=e.sign(r.md)},r.verify=function(){var e=!1,t=r.md;if(t===null){t=l3({signatureOid:r.signatureOid,type:"certification request"});var n=r.certificationRequestInfo||X.getCertificationRequestInfo(r),s=I.toDer(n);t.update(s.getBytes())}return t!==null&&(e=xj({certificate:r,md:t,signature:r.signature})),e},r};function zh(r){for(var e=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]),t,n,s=r.attributes,i=0;i<s.length;++i){t=s[i];var o=t.value,a=I.Type.PRINTABLESTRING;"valueTagClass"in t&&(a=t.valueTagClass,a===I.Type.UTF8&&(o=pe.util.encodeUtf8(o))),n=I.create(I.Class.UNIVERSAL,I.Type.SET,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(t.type).getBytes()),I.create(I.Class.UNIVERSAL,a,!1,o)])]),e.value.push(n)}return e}function di(r){for(var e,t=0;t<r.length;++t){if(e=r[t],typeof e.name>"u"&&(e.type&&e.type in X.oids?e.name=X.oids[e.type]:e.shortName&&e.shortName in sr&&(e.name=X.oids[sr[e.shortName]])),typeof e.type>"u")if(e.name&&e.name in X.oids)e.type=X.oids[e.name];else{var n=new Error("Attribute type not specified.");throw n.attribute=e,n}if(typeof e.shortName>"u"&&e.name&&e.name in sr&&(e.shortName=sr[e.name]),e.type===ze.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=I.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var s=0;s<e.extensions.length;++s)e.value.push(X.certificateExtensionToAsn1(Dj(e.extensions[s])))}if(typeof e.value>"u"){var n=new Error("Attribute value not specified.");throw n.attribute=e,n}}}function Dj(r,e){if(e=e||{},typeof r.name>"u"&&r.id&&r.id in X.oids&&(r.name=X.oids[r.id]),typeof r.id>"u")if(r.name&&r.name in X.oids)r.id=X.oids[r.name];else{var t=new Error("Extension ID not specified.");throw t.extension=r,t}if(typeof r.value<"u")return r;if(r.name==="keyUsage"){var n=0,s=0,i=0;r.digitalSignature&&(s|=128,n=7),r.nonRepudiation&&(s|=64,n=6),r.keyEncipherment&&(s|=32,n=5),r.dataEncipherment&&(s|=16,n=4),r.keyAgreement&&(s|=8,n=3),r.keyCertSign&&(s|=4,n=2),r.cRLSign&&(s|=2,n=1),r.encipherOnly&&(s|=1,n=0),r.decipherOnly&&(i|=128,n=7);var o=String.fromCharCode(n);i!==0?o+=String.fromCharCode(s)+String.fromCharCode(i):s!==0&&(o+=String.fromCharCode(s)),r.value=I.create(I.Class.UNIVERSAL,I.Type.BITSTRING,!1,o)}else if(r.name==="basicConstraints")r.value=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]),r.cA&&r.value.value.push(I.create(I.Class.UNIVERSAL,I.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in r&&r.value.value.push(I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(r.pathLenConstraint).getBytes()));else if(r.name==="extKeyUsage"){r.value=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]);var a=r.value.value;for(var c in r)r[c]===!0&&(c in ze?a.push(I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(ze[c]).getBytes())):c.indexOf(".")!==-1&&a.push(I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(c).getBytes())))}else if(r.name==="nsCertType"){var n=0,s=0;r.client&&(s|=128,n=7),r.server&&(s|=64,n=6),r.email&&(s|=32,n=5),r.objsign&&(s|=16,n=4),r.reserved&&(s|=8,n=3),r.sslCA&&(s|=4,n=2),r.emailCA&&(s|=2,n=1),r.objCA&&(s|=1,n=0);var o=String.fromCharCode(n);s!==0&&(o+=String.fromCharCode(s)),r.value=I.create(I.Class.UNIVERSAL,I.Type.BITSTRING,!1,o)}else if(r.name==="subjectAltName"||r.name==="issuerAltName"){r.value=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]);for(var u,l=0;l<r.altNames.length;++l){u=r.altNames[l];var o=u.value;if(u.type===7&&u.ip){if(o=pe.util.bytesFromIP(u.ip),o===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?o=I.oidToDer(I.oidToDer(u.oid)):o=I.oidToDer(o));r.value.value.push(I.create(I.Class.CONTEXT_SPECIFIC,u.type,!1,o))}}else if(r.name==="nsComment"&&e.cert){if(!/^[\x00-\x7F]*$/.test(r.comment)||r.comment.length<1||r.comment.length>128)throw new Error('Invalid "nsComment" content.');r.value=I.create(I.Class.UNIVERSAL,I.Type.IA5STRING,!1,r.comment)}else if(r.name==="subjectKeyIdentifier"&&e.cert){var h=e.cert.generateSubjectKeyIdentifier();r.subjectKeyIdentifier=h.toHex(),r.value=I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,h.getBytes())}else if(r.name==="authorityKeyIdentifier"&&e.cert){r.value=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]);var a=r.value.value;if(r.keyIdentifier){var f=r.keyIdentifier===!0?e.cert.generateSubjectKeyIdentifier().getBytes():r.keyIdentifier;a.push(I.create(I.Class.CONTEXT_SPECIFIC,0,!1,f))}if(r.authorityCertIssuer){var y=[I.create(I.Class.CONTEXT_SPECIFIC,4,!0,[zh(r.authorityCertIssuer===!0?e.cert.issuer:r.authorityCertIssuer)])];a.push(I.create(I.Class.CONTEXT_SPECIFIC,1,!0,y))}if(r.serialNumber){var d=pe.util.hexToBytes(r.serialNumber===!0?e.cert.serialNumber:r.serialNumber);a.push(I.create(I.Class.CONTEXT_SPECIFIC,2,!1,d))}}else if(r.name==="cRLDistributionPoints"){r.value=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]);for(var a=r.value.value,p=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]),b=I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[]),u,l=0;l<r.altNames.length;++l){u=r.altNames[l];var o=u.value;if(u.type===7&&u.ip){if(o=pe.util.bytesFromIP(u.ip),o===null){var t=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw t.extension=r,t}}else u.type===8&&(u.oid?o=I.oidToDer(I.oidToDer(u.oid)):o=I.oidToDer(o));b.value.push(I.create(I.Class.CONTEXT_SPECIFIC,u.type,!1,o))}p.value.push(I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[b])),a.push(p)}if(typeof r.value>"u"){var t=new Error("Extension value not specified.");throw t.extension=r,t}return r}function v_(r,e){switch(r){case ze["RSASSA-PSS"]:var t=[];return e.hash.algorithmOid!==void 0&&t.push(I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(e.hash.algorithmOid).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")])])),e.mgf.algorithmOid!==void 0&&t.push(I.create(I.Class.CONTEXT_SPECIFIC,1,!0,[I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(e.mgf.algorithmOid).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(e.mgf.hash.algorithmOid).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")])])])),e.saltLength!==void 0&&t.push(I.create(I.Class.CONTEXT_SPECIFIC,2,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(e.saltLength).getBytes())])),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,t);default:return I.create(I.Class.UNIVERSAL,I.Type.NULL,!1,"")}}function QKe(r){var e=I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[]);if(r.attributes.length===0)return e;for(var t=r.attributes,n=0;n<t.length;++n){var s=t[n],i=s.value,o=I.Type.UTF8;"valueTagClass"in s&&(o=s.valueTagClass),o===I.Type.UTF8&&(i=pe.util.encodeUtf8(i));var a=!1;"valueConstructed"in s&&(a=s.valueConstructed);var c=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(s.type).getBytes()),I.create(I.Class.UNIVERSAL,I.Type.SET,!0,[I.create(I.Class.UNIVERSAL,o,a,i)])]);e.value.push(c)}return e}var YKe=new Date("1950-01-01T00:00:00Z"),XKe=new Date("2050-01-01T00:00:00Z");function TD(r){return r>=YKe&&r<XKe?I.create(I.Class.UNIVERSAL,I.Type.UTCTIME,!1,I.dateToUtcTime(r)):I.create(I.Class.UNIVERSAL,I.Type.GENERALIZEDTIME,!1,I.dateToGeneralizedTime(r))}X.getTBSCertificate=function(r){var e=TD(r.validity.notBefore),t=TD(r.validity.notAfter),n=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.CONTEXT_SPECIFIC,0,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(r.version).getBytes())]),I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,pe.util.hexToBytes(r.serialNumber)),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(r.siginfo.algorithmOid).getBytes()),v_(r.siginfo.algorithmOid,r.siginfo.parameters)]),zh(r.issuer),I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[e,t]),zh(r.subject),X.publicKeyToAsn1(r.publicKey)]);return r.issuer.uniqueId&&n.value.push(I.create(I.Class.CONTEXT_SPECIFIC,1,!0,[I.create(I.Class.UNIVERSAL,I.Type.BITSTRING,!1,String.fromCharCode(0)+r.issuer.uniqueId)])),r.subject.uniqueId&&n.value.push(I.create(I.Class.CONTEXT_SPECIFIC,2,!0,[I.create(I.Class.UNIVERSAL,I.Type.BITSTRING,!1,String.fromCharCode(0)+r.subject.uniqueId)])),r.extensions.length>0&&n.value.push(X.certificateExtensionsToAsn1(r.extensions)),n};X.getCertificationRequestInfo=function(r){var e=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.INTEGER,!1,I.integerToDer(r.version).getBytes()),zh(r.subject),X.publicKeyToAsn1(r.publicKey),QKe(r)]);return e};X.distinguishedNameToAsn1=function(r){return zh(r)};X.certificateToAsn1=function(r){var e=r.tbsCertificate||X.getTBSCertificate(r);return I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[e,I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(r.signatureOid).getBytes()),v_(r.signatureOid,r.signatureParameters)]),I.create(I.Class.UNIVERSAL,I.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};X.certificateExtensionsToAsn1=function(r){var e=I.create(I.Class.CONTEXT_SPECIFIC,3,!0,[]),t=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]);e.value.push(t);for(var n=0;n<r.length;++n)t.value.push(X.certificateExtensionToAsn1(r[n]));return e};X.certificateExtensionToAsn1=function(r){var e=I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[]);e.value.push(I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(r.id).getBytes())),r.critical&&e.value.push(I.create(I.Class.UNIVERSAL,I.Type.BOOLEAN,!1,String.fromCharCode(255)));var t=r.value;return typeof r.value!="string"&&(t=I.toDer(t).getBytes()),e.value.push(I.create(I.Class.UNIVERSAL,I.Type.OCTETSTRING,!1,t)),e};X.certificationRequestToAsn1=function(r){var e=r.certificationRequestInfo||X.getCertificationRequestInfo(r);return I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[e,I.create(I.Class.UNIVERSAL,I.Type.SEQUENCE,!0,[I.create(I.Class.UNIVERSAL,I.Type.OID,!1,I.oidToDer(r.signatureOid).getBytes()),v_(r.signatureOid,r.signatureParameters)]),I.create(I.Class.UNIVERSAL,I.Type.BITSTRING,!1,String.fromCharCode(0)+r.signature)])};X.createCaStore=function(r){var e={certs:{}};e.getIssuer=function(o){var a=t(o.issuer);return a},e.addCertificate=function(o){if(typeof o=="string"&&(o=pe.pki.certificateFromPem(o)),n(o.subject),!e.hasCertificate(o))if(o.subject.hash in e.certs){var a=e.certs[o.subject.hash];pe.util.isArray(a)||(a=[a]),a.push(o),e.certs[o.subject.hash]=a}else e.certs[o.subject.hash]=o},e.hasCertificate=function(o){typeof o=="string"&&(o=pe.pki.certificateFromPem(o));var a=t(o.subject);if(!a)return!1;pe.util.isArray(a)||(a=[a]);for(var c=I.toDer(X.certificateToAsn1(o)).getBytes(),u=0;u<a.length;++u){var l=I.toDer(X.certificateToAsn1(a[u])).getBytes();if(c===l)return!0}return!1},e.listAllCertificates=function(){var o=[];for(var a in e.certs)if(e.certs.hasOwnProperty(a)){var c=e.certs[a];if(!pe.util.isArray(c))o.push(c);else for(var u=0;u<c.length;++u)o.push(c[u])}return o},e.removeCertificate=function(o){var a;if(typeof o=="string"&&(o=pe.pki.certificateFromPem(o)),n(o.subject),!e.hasCertificate(o))return null;var c=t(o.subject);if(!pe.util.isArray(c))return a=e.certs[o.subject.hash],delete e.certs[o.subject.hash],a;for(var u=I.toDer(X.certificateToAsn1(o)).getBytes(),l=0;l<c.length;++l){var h=I.toDer(X.certificateToAsn1(c[l])).getBytes();u===h&&(a=c[l],c.splice(l,1))}return c.length===0&&delete e.certs[o.subject.hash],a};function t(o){return n(o),e.certs[o.hash]||null}function n(o){if(!o.hash){var a=pe.md.sha1.create();o.attributes=X.RDNAttributesAsArray(zh(o),a),o.hash=a.digest().toHex()}}if(r)for(var s=0;s<r.length;++s){var i=r[s];e.addCertificate(i)}return e};X.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};X.verifyCertificateChain=function(r,e,t){typeof t=="function"&&(t={verify:t}),t=t||{},e=e.slice(0);var n=e.slice(0),s=t.validityCheckDate;typeof s>"u"&&(s=new Date);var i=!0,o=null,a=0;do{var c=e.shift(),u=null,l=!1;if(s&&(s<c.validity.notBefore||s>c.validity.notAfter)&&(o={message:"Certificate is not valid yet or has expired.",error:X.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:s}),o===null){if(u=e[0]||r.getIssuer(c),u===null&&c.isIssuer(c)&&(l=!0,u=c),u){var h=u;pe.util.isArray(h)||(h=[h]);for(var f=!1;!f&&h.length>0;){u=h.shift();try{f=u.verify(c)}catch{}}f||(o={message:"Certificate signature is invalid.",error:X.certificateError.bad_certificate})}o===null&&(!u||l)&&!r.hasCertificate(c)&&(o={message:"Certificate is not trusted.",error:X.certificateError.unknown_ca})}if(o===null&&u&&!c.isIssuer(u)&&(o={message:"Certificate issuer is invalid.",error:X.certificateError.bad_certificate}),o===null)for(var y={keyUsage:!0,basicConstraints:!0},d=0;o===null&&d<c.extensions.length;++d){var p=c.extensions[d];p.critical&&!(p.name in y)&&(o={message:"Certificate has an unsupported critical extension.",error:X.certificateError.unsupported_certificate})}if(o===null&&(!i||e.length===0&&(!u||l))){var b=c.getExtension("basicConstraints"),w=c.getExtension("keyUsage");if(w!==null&&(!w.keyCertSign||b===null)&&(o={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:X.certificateError.bad_certificate}),o===null&&b!==null&&!b.cA&&(o={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:X.certificateError.bad_certificate}),o===null&&w!==null&&"pathLenConstraint"in b){var S=a-1;S>b.pathLenConstraint&&(o={message:"Certificate basicConstraints pathLenConstraint violated.",error:X.certificateError.bad_certificate})}}var E=o===null?!0:o.error,m=t.verify?t.verify(E,a,n):E;if(m===!0)o=null;else throw E===!0&&(o={message:"The application rejected the certificate.",error:X.certificateError.bad_certificate}),(m||m===0)&&(typeof m=="object"&&!pe.util.isArray(m)?(m.message&&(o.message=m.message),m.error&&(o.error=m.error)):typeof m=="string"&&(o.error=m)),o;i=!1,++a}while(e.length>0);return!0};var Z=Hh,C=Z.asn1,as=Z.pkcs7=Z.pkcs7||{};as.messageFromPem=function(r){var e=Z.pem.decode(r)[0];if(e.type!=="PKCS7"){var t=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var n=C.fromDer(e.body);return as.messageFromAsn1(n)};as.messageToPem=function(r,e){var t={type:"PKCS7",body:C.toDer(r.toAsn1()).getBytes()};return Z.pem.encode(t,{maxline:e})};as.messageFromAsn1=function(r){var e={},t=[];if(!C.validate(r,as.asn1.contentInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw n.errors=t,n}var s=C.derToOid(e.contentType),i;switch(s){case Z.pki.oids.envelopedData:i=as.createEnvelopedData();break;case Z.pki.oids.encryptedData:i=as.createEncryptedData();break;case Z.pki.oids.signedData:i=as.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+s+" is not (yet) supported.")}return i.fromAsn1(e.content.value[0]),i};as.createSignedData=function(){var r=null;return r={type:Z.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(n){if(__(r,n,as.asn1.signedDataValidator),r.certificates=[],r.crls=[],r.digestAlgorithmIdentifiers=[],r.contentInfo=null,r.signerInfos=[],r.rawCapture.certificates)for(var s=r.rawCapture.certificates.value,i=0;i<s.length;++i)r.certificates.push(Z.pki.certificateFromAsn1(s[i]))},toAsn1:function(){r.contentInfo||r.sign();for(var n=[],s=0;s<r.certificates.length;++s)n.push(Z.pki.certificateToAsn1(r.certificates[s]));var i=[],o=C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(r.version).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SET,!0,r.digestAlgorithmIdentifiers),r.contentInfo])]);return n.length>0&&o.value[0].value.push(C.create(C.Class.CONTEXT_SPECIFIC,0,!0,n)),i.length>0&&o.value[0].value.push(C.create(C.Class.CONTEXT_SPECIFIC,1,!0,i)),o.value[0].value.push(C.create(C.Class.UNIVERSAL,C.Type.SET,!0,r.signerInfos)),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.type).getBytes()),o])},addSigner:function(n){var s=n.issuer,i=n.serialNumber;if(n.certificate){var o=n.certificate;typeof o=="string"&&(o=Z.pki.certificateFromPem(o)),s=o.issuer.attributes,i=o.serialNumber}var a=n.key;if(!a)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof a=="string"&&(a=Z.pki.privateKeyFromPem(a));var c=n.digestAlgorithm||Z.pki.oids.sha1;switch(c){case Z.pki.oids.sha1:case Z.pki.oids.sha256:case Z.pki.oids.sha384:case Z.pki.oids.sha512:case Z.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+c)}var u=n.authenticatedAttributes||[];if(u.length>0){for(var l=!1,h=!1,f=0;f<u.length;++f){var y=u[f];if(!l&&y.type===Z.pki.oids.contentType){if(l=!0,h)break;continue}if(!h&&y.type===Z.pki.oids.messageDigest){if(h=!0,l)break;continue}}if(!l||!h)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}r.signers.push({key:a,version:1,issuer:s,serialNumber:i,digestAlgorithm:c,signatureAlgorithm:Z.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:u,unauthenticatedAttributes:[]})},sign:function(n){if(n=n||{},(typeof r.content!="object"||r.contentInfo===null)&&(r.contentInfo=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(Z.pki.oids.data).getBytes())]),"content"in r)){var s;r.content instanceof Z.util.ByteBuffer?s=r.content.bytes():typeof r.content=="string"&&(s=Z.util.encodeUtf8(r.content)),n.detached?r.detachedContent=C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,s):r.contentInfo.value.push(C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,s)]))}if(r.signers.length!==0){var i=e();t(i)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(n){typeof n=="string"&&(n=Z.pki.certificateFromPem(n)),r.certificates.push(n)},addCertificateRevokationList:function(n){throw new Error("PKCS#7 CRL support not yet implemented.")}},r;function e(){for(var n={},s=0;s<r.signers.length;++s){var i=r.signers[s],o=i.digestAlgorithm;o in n||(n[o]=Z.md[Z.pki.oids[o]].create()),i.authenticatedAttributes.length===0?i.md=n[o]:i.md=Z.md[Z.pki.oids[o]].create()}r.digestAlgorithmIdentifiers=[];for(var o in n)r.digestAlgorithmIdentifiers.push(C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(o).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.NULL,!1,"")]));return n}function t(n){var s;if(r.detachedContent?s=r.detachedContent:(s=r.contentInfo.value[1],s=s.value[0]),!s)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var i=C.derToOid(r.contentInfo.value[0].value),o=C.toDer(s);o.getByte(),C.getBerValueLength(o),o=o.getBytes();for(var a in n)n[a].start().update(o);for(var c=new Date,u=0;u<r.signers.length;++u){var l=r.signers[u];if(l.authenticatedAttributes.length===0){if(i!==Z.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{l.authenticatedAttributesAsn1=C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var h=C.create(C.Class.UNIVERSAL,C.Type.SET,!0,[]),f=0;f<l.authenticatedAttributes.length;++f){var y=l.authenticatedAttributes[f];y.type===Z.pki.oids.messageDigest?y.value=n[l.digestAlgorithm].digest():y.type===Z.pki.oids.signingTime&&(y.value||(y.value=c)),h.value.push(q8(y)),l.authenticatedAttributesAsn1.value.push(q8(y))}o=C.toDer(h).getBytes(),l.md.start().update(o)}l.signature=l.key.sign(l.md,"RSASSA-PKCS1-V1_5")}r.signerInfos=nqe(r.signers)}};as.createEncryptedData=function(){var r=null;return r={type:Z.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:Z.pki.oids["aes256-CBC"]},fromAsn1:function(e){__(r,e,as.asn1.encryptedDataValidator)},decrypt:function(e){e!==void 0&&(r.encryptedContent.key=e),Pj(r)}},r};as.createEnvelopedData=function(){var r=null;return r={type:Z.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:Z.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=__(r,e,as.asn1.envelopedDataValidator);r.recipients=eqe(t.recipientInfos.value)},toAsn1:function(){return C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.type).getBytes()),C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(r.version).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SET,!0,tqe(r.recipients)),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,sqe(r.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,n=0;n<r.recipients.length;++n){var s=r.recipients[n],i=s.issuer;if(s.serialNumber===e.serialNumber&&i.length===t.length){for(var o=!0,a=0;a<t.length;++a)if(i[a].type!==t[a].type||i[a].value!==t[a].value){o=!1;break}if(o)return s}}return null},decrypt:function(e,t){if(r.encryptedContent.key===void 0&&e!==void 0&&t!==void 0)switch(e.encryptedContent.algorithm){case Z.pki.oids.rsaEncryption:case Z.pki.oids.desCBC:var n=t.decrypt(e.encryptedContent.content);r.encryptedContent.key=Z.util.createBuffer(n);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}Pj(r)},addRecipient:function(e){r.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:Z.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,t){if(r.encryptedContent.content===void 0){t=t||r.encryptedContent.algorithm,e=e||r.encryptedContent.key;var n,s,i;switch(t){case Z.pki.oids["aes128-CBC"]:n=16,s=16,i=Z.aes.createEncryptionCipher;break;case Z.pki.oids["aes192-CBC"]:n=24,s=16,i=Z.aes.createEncryptionCipher;break;case Z.pki.oids["aes256-CBC"]:n=32,s=16,i=Z.aes.createEncryptionCipher;break;case Z.pki.oids["des-EDE3-CBC"]:n=24,s=8,i=Z.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(e===void 0)e=Z.util.createBuffer(Z.random.getBytes(n));else if(e.length()!=n)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+n+".");r.encryptedContent.algorithm=t,r.encryptedContent.key=e,r.encryptedContent.parameter=Z.util.createBuffer(Z.random.getBytes(s));var o=i(e);if(o.start(r.encryptedContent.parameter.copy()),o.update(r.content),!o.finish())throw new Error("Symmetric encryption failed.");r.encryptedContent.content=o.output}for(var a=0;a<r.recipients.length;++a){var c=r.recipients[a];if(c.encryptedContent.content===void 0)switch(c.encryptedContent.algorithm){case Z.pki.oids.rsaEncryption:c.encryptedContent.content=c.encryptedContent.key.encrypt(r.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+c.encryptedContent.algorithm)}}}},r};function JKe(r){var e={},t=[];if(!C.validate(r,as.asn1.recipientInfoValidator,e,t)){var n=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw n.errors=t,n}return{version:e.version.charCodeAt(0),issuer:Z.pki.RDNAttributesAsArray(e.issuer),serialNumber:Z.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:C.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function ZKe(r){return C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(r.version).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[Z.pki.distinguishedNameToAsn1({attributes:r.issuer}),C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,Z.util.hexToBytes(r.serialNumber))]),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.encryptedContent.algorithm).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.NULL,!1,"")]),C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,r.encryptedContent.content)])}function eqe(r){for(var e=[],t=0;t<r.length;++t)e.push(JKe(r[t]));return e}function tqe(r){for(var e=[],t=0;t<r.length;++t)e.push(ZKe(r[t]));return e}function rqe(r){var e=C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,C.integerToDer(r.version).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[Z.pki.distinguishedNameToAsn1({attributes:r.issuer}),C.create(C.Class.UNIVERSAL,C.Type.INTEGER,!1,Z.util.hexToBytes(r.serialNumber))]),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.digestAlgorithm).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.NULL,!1,"")])]);if(r.authenticatedAttributesAsn1&&e.value.push(r.authenticatedAttributesAsn1),e.value.push(C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.signatureAlgorithm).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.NULL,!1,"")])),e.value.push(C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,r.signature)),r.unauthenticatedAttributes.length>0){for(var t=C.create(C.Class.CONTEXT_SPECIFIC,1,!0,[]),n=0;n<r.unauthenticatedAttributes.length;++n){var s=r.unauthenticatedAttributes[n];t.values.push(q8(s))}e.value.push(t)}return e}function nqe(r){for(var e=[],t=0;t<r.length;++t)e.push(rqe(r[t]));return e}function q8(r){var e;if(r.type===Z.pki.oids.contentType)e=C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.value).getBytes());else if(r.type===Z.pki.oids.messageDigest)e=C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,r.value.bytes());else if(r.type===Z.pki.oids.signingTime){var t=new Date("1950-01-01T00:00:00Z"),n=new Date("2050-01-01T00:00:00Z"),s=r.value;if(typeof s=="string"){var i=Date.parse(s);isNaN(i)?s.length===13?s=C.utcTimeToDate(s):s=C.generalizedTimeToDate(s):s=new Date(i)}s>=t&&s<n?e=C.create(C.Class.UNIVERSAL,C.Type.UTCTIME,!1,C.dateToUtcTime(s)):e=C.create(C.Class.UNIVERSAL,C.Type.GENERALIZEDTIME,!1,C.dateToGeneralizedTime(s))}return C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.type).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SET,!0,[e])])}function sqe(r){return[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(Z.pki.oids.data).getBytes()),C.create(C.Class.UNIVERSAL,C.Type.SEQUENCE,!0,[C.create(C.Class.UNIVERSAL,C.Type.OID,!1,C.oidToDer(r.algorithm).getBytes()),r.parameter?C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,r.parameter.getBytes()):void 0]),C.create(C.Class.CONTEXT_SPECIFIC,0,!0,[C.create(C.Class.UNIVERSAL,C.Type.OCTETSTRING,!1,r.content.getBytes())])]}function __(r,e,t){var n={},s=[];if(!C.validate(e,t,n,s)){var i=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw i.errors=i,i}var o=C.derToOid(n.contentType);if(o!==Z.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(n.encryptedContent){var a="";if(Z.util.isArray(n.encryptedContent))for(var c=0;c<n.encryptedContent.length;++c){if(n.encryptedContent[c].type!==C.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");a+=n.encryptedContent[c].value}else a=n.encryptedContent;r.encryptedContent={algorithm:C.derToOid(n.encAlgorithm),parameter:Z.util.createBuffer(n.encParameter.value),content:Z.util.createBuffer(a)}}if(n.content){var a="";if(Z.util.isArray(n.content))for(var c=0;c<n.content.length;++c){if(n.content[c].type!==C.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");a+=n.content[c].value}else a=n.content;r.content=Z.util.createBuffer(a)}return r.version=n.version.charCodeAt(0),r.rawCapture=n,n}function Pj(r){if(r.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(r.content===void 0){var e;switch(r.encryptedContent.algorithm){case Z.pki.oids["aes128-CBC"]:case Z.pki.oids["aes192-CBC"]:case Z.pki.oids["aes256-CBC"]:e=Z.aes.createDecryptionCipher(r.encryptedContent.key);break;case Z.pki.oids.desCBC:case Z.pki.oids["des-EDE3-CBC"]:e=Z.des.createDecryptionCipher(r.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+r.encryptedContent.algorithm)}if(e.start(r.encryptedContent.parameter),e.update(r.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");r.content=e.output}}const ID=At.pki,iqe=(r,e)=>{const t=ID.rsa.setPublicKey(e.n,e.e),n=ID.createCertificate();n.publicKey=t,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);const s=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:r.id}];return n.setSubject(s),n.setIssuer(s),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(e),n};async function oqe(r,e){const t=r.map(e),s=(await Promise.all(t)).findIndex(i=>i);return r[s]}const aqe=U("libp2p:keychain:cms"),um=new WeakMap;class cqe{constructor(e,t){if(e==null)throw T(new Error("keychain is required"),O.ERR_KEYCHAIN_REQUIRED);this.keychain=e,um.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw T(new Error("Plain data must be a Uint8Array"),O.ERR_INVALID_PARAMETERS);const n=await this.keychain.findKeyByName(e),s=await this.keychain.getPrivateKey(e),i=um.get(this);if(i==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const o=i.dek,a=At.pki.decryptRsaPrivateKey(s,o),c=await iqe(n,a),u=At.pkcs7.createEnvelopedData();u.addRecipient(c),u.content=At.util.createBuffer(t),u.encrypt();const l=At.asn1.toDer(u.toAsn1()).getBytes();return M(l,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw T(new Error("CMS data is required"),O.ERR_INVALID_PARAMETERS);let t;try{const l=At.util.createBuffer(R(e,"ascii")),h=At.asn1.fromDer(l);t=At.pkcs7.messageFromAsn1(h)}catch(l){throw aqe.error(l),T(new Error("Invalid CMS"),O.ERR_INVALID_CMS)}const n=t.recipients.filter(l=>l.issuer.find(h=>h.shortName==="O"&&h.value==="ipfs")).filter(l=>l.issuer.find(h=>h.shortName==="CN")).map(l=>({recipient:l,keyId:l.issuer.find(h=>h.shortName==="CN").value})),s=await oqe(n,async l=>{try{if(await this.keychain.findKeyById(l.keyId)!=null)return!0}catch{return!1}return!1});if(s==null){const l=n.map(h=>h.keyId);throw T(new Error(`Decryption needs one of the key(s): ${l.join(", ")}`),O.ERR_MISSING_KEYS,{missingKeys:l})}const i=await this.keychain.findKeyById(s.keyId);if(i==null)throw T(new Error("No key available to decrypto"),O.ERR_NO_KEY);const o=await this.keychain.getPrivateKey(i.name),a=um.get(this);if(a==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const c=a.dek,u=At.pki.decryptRsaPrivateKey(o,c);return t.decrypt(s.recipient,u),M(t.content.getBytes(),"ascii")}}const n2=U("libp2p:keychain"),lqe="/pkcs8/",Oj="/info/",Ua=new WeakMap,sl={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},hm={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function qo(r){return r==null||typeof r!="string"?!1:r===FKe(r.trim())&&r.length>0}async function wt(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function oo(r){return new be(lqe+r)}function Ho(r){return new be(Oj+r)}class cw{constructor(e,t){if(this.components=e,this.init=kt(hm,t),this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<sl.minKeyLength)throw new Error(`dek.keyLength must be least ${sl.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<sl.minSaltLength)throw new Error(`dek.saltLength must be least ${sl.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<sl.minIterationCount)throw new Error(`dek.iterationCount must be least ${sl.minIterationCount}`);const n=this.init.pass!=null&&this.init.dek?.salt!=null?rC(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Ua.set(this,{dek:n}),this.started=!1}isStarted(){return this.started}async start(){const e=Ho("self");await this.components.datastore.has(e)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){const e=Ua.get(this);if(e==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const t=e.dek;return new cqe(this,t)}static generateOptions(){const e=Object.assign({},hm),t=Math.ceil(sl.minSaltLength/3)*3;return e.dek.salt=R(Pp(t),"base64"),e}static get options(){return hm}async createKey(e,t,n=2048){if(!qo(e)||e==="self")throw await wt(),T(new Error("Invalid key name"),O.ERR_INVALID_KEY_NAME);if(typeof t!="string")throw await wt(),T(new Error("Invalid key type"),O.ERR_INVALID_KEY_TYPE);const s=oo(e);if(await this.components.datastore.has(s))throw await wt(),T(new Error("Key name already exists"),O.ERR_KEY_ALREADY_EXISTS);switch(t.toLowerCase()){case"rsa":if(!Number.isSafeInteger(n)||n<2048)throw await wt(),T(new Error("Invalid RSA key size"),O.ERR_INVALID_KEY_SIZE);break}let o;try{const a=await qE(t,n),c=await a.id(),u=Ua.get(this);if(u==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const l=u.dek,h=await a.export(l);o={name:e,id:c};const f=this.components.datastore.batch();f.put(s,M(h)),f.put(Ho(e),M(JSON.stringify(o))),await f.commit()}catch(a){throw await wt(),a}return o}async listKeys(){const e={prefix:Oj},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(R(n.value)));return t}async findKeyById(e){try{return(await this.listKeys()).find(n=>n.id===e)}catch(t){throw await wt(),t}}async findKeyByName(e){if(!qo(e))throw await wt(),T(new Error(`Invalid key name '${e}'`),O.ERR_INVALID_KEY_NAME);const t=Ho(e);try{const n=await this.components.datastore.get(t);return JSON.parse(R(n))}catch(n){throw await wt(),n2.error(n),T(new Error(`Key '${e}' does not exist.`),O.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!qo(e)||e==="self")throw await wt(),T(new Error(`Invalid key name '${e}'`),O.ERR_INVALID_KEY_NAME);const t=oo(e),n=await this.findKeyByName(e),s=this.components.datastore.batch();return s.delete(t),s.delete(Ho(e)),await s.commit(),n}async renameKey(e,t){if(!qo(e)||e==="self")throw await wt(),T(new Error(`Invalid old key name '${e}'`),O.ERR_OLD_KEY_NAME_INVALID);if(!qo(t)||t==="self")throw await wt(),T(new Error(`Invalid new key name '${t}'`),O.ERR_NEW_KEY_NAME_INVALID);const n=oo(e),s=oo(t),i=Ho(e),o=Ho(t);if(await this.components.datastore.has(s))throw await wt(),T(new Error(`Key '${t}' already exists`),O.ERR_KEY_ALREADY_EXISTS);try{const c=await this.components.datastore.get(n),u=await this.components.datastore.get(i),l=JSON.parse(R(u));l.name=t;const h=this.components.datastore.batch();return h.put(s,c),h.put(o,M(JSON.stringify(l))),h.delete(n),h.delete(i),await h.commit(),l}catch(c){throw await wt(),c}}async exportKey(e,t){if(!qo(e))throw await wt(),T(new Error(`Invalid key name '${e}'`),O.ERR_INVALID_KEY_NAME);if(t==null)throw await wt(),T(new Error("Password is required"),O.ERR_PASSWORD_REQUIRED);const n=oo(e);try{const s=await this.components.datastore.get(n),i=R(s),o=Ua.get(this);if(o==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const a=o.dek;return await(await Yu(i,a)).export(t)}catch(s){throw await wt(),s}}async exportPeerId(e){const t="temporary-password",n=await this.exportKey(e,t),s=await Yu(n,t);return await vi(s.public.bytes,s.bytes)}async importKey(e,t,n){if(!qo(e)||e==="self")throw await wt(),T(new Error(`Invalid key name '${e}'`),O.ERR_INVALID_KEY_NAME);if(t==null)throw await wt(),T(new Error("PEM encoded key is required"),O.ERR_PEM_REQUIRED);const s=oo(e);if(await this.components.datastore.has(s))throw await wt(),T(new Error(`Key '${e}' already exists`),O.ERR_KEY_ALREADY_EXISTS);let o;try{o=await Yu(t,n)}catch{throw await wt(),T(new Error("Cannot read the key, most likely the password is wrong"),O.ERR_CANNOT_READ_KEY)}let a;try{a=await o.id();const l=Ua.get(this);if(l==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const h=l.dek;t=await o.export(h)}catch(l){throw await wt(),l}const c={name:e,id:a},u=this.components.datastore.batch();return u.put(s,M(t)),u.put(Ho(e),M(JSON.stringify(c))),await u.commit(),c}async importPeer(e,t){try{if(!qo(e))throw T(new Error(`Invalid key name '${e}'`),O.ERR_INVALID_KEY_NAME);if(t==null)throw T(new Error("PeerId is required"),O.ERR_MISSING_PRIVATE_KEY);if(t.privateKey==null)throw T(new Error("PeerId.privKey is required"),O.ERR_MISSING_PRIVATE_KEY);const n=await ba(t.privateKey),s=oo(e);if(await this.components.datastore.has(s))throw await wt(),T(new Error(`Key '${e}' already exists`),O.ERR_KEY_ALREADY_EXISTS);const o=Ua.get(this);if(o==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const a=o.dek,c=await n.export(a),u={name:e,id:t.toString()},l=this.components.datastore.batch();return l.put(s,M(c)),l.put(Ho(e),M(JSON.stringify(u))),await l.commit(),u}catch(n){throw await wt(),n}}async getPrivateKey(e){if(!qo(e))throw await wt(),T(new Error(`Invalid key name '${e}'`),O.ERR_INVALID_KEY_NAME);try{const t=oo(e),n=await this.components.datastore.get(t);return R(n)}catch(t){throw await wt(),n2.error(t),T(new Error(`Key '${e}' does not exist.`),O.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){if(typeof e!="string")throw await wt(),T(new Error(`Invalid old pass type '${typeof e}'`),O.ERR_INVALID_OLD_PASS_TYPE);if(typeof t!="string")throw await wt(),T(new Error(`Invalid new pass type '${typeof t}'`),O.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await wt(),T(new Error(`Invalid pass length ${t.length}`),O.ERR_INVALID_PASS_LENGTH);n2("recreating keychain");const n=Ua.get(this);if(n==null)throw T(new Error("dek missing"),O.ERR_INVALID_PARAMETERS);const s=n.dek;this.init.pass=t;const i=t!=null&&this.init.dek?.salt!=null?rC(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Ua.set(this,{dek:i});const o=await this.listKeys();for(const a of o){const c=await this.components.datastore.get(oo(a.name)),u=R(c),l=await Yu(u,s),h=i.toString(),f=await l.export(h),y=this.components.datastore.batch(),d={name:a.name,id:a.id};y.put(oo(a.name),M(f)),y.put(Ho(a.name),M(JSON.stringify(d))),await y.commit()}n2("keychain reconstructed")}}async function dm(r){try{return{status:"fulfilled",value:await r,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}class uqe{constructor(e){N(this,"value");N(this,"next");this.value=e}}var wo,vl,_l;class hqe{constructor(){ar(this,wo,void 0);ar(this,vl,void 0);ar(this,_l,void 0);this.clear()}enqueue(e){const t=new uqe(e);ve(this,wo)?(ve(this,vl).next=t,Dt(this,vl,t)):(Dt(this,wo,t),Dt(this,vl,t)),R3(this,_l)._++}dequeue(){const e=ve(this,wo);if(e)return Dt(this,wo,ve(this,wo).next),R3(this,_l)._--,e.value}clear(){Dt(this,wo,void 0),Dt(this,vl,void 0),Dt(this,_l,0)}get size(){return ve(this,_l)}*[Symbol.iterator](){let e=ve(this,wo);for(;e;)yield e.value,e=e.next}}wo=new WeakMap,vl=new WeakMap,_l=new WeakMap;function dqe(r){if(!((Number.isInteger(r)||r===Number.POSITIVE_INFINITY)&&r>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new hqe;let t=0;const n=()=>{t--,e.size>0&&e.dequeue()()},s=async(a,c,u)=>{t++;const l=(async()=>a(...u))();c(l);try{await l}catch{}n()},i=(a,c,u)=>{e.enqueue(s.bind(void 0,a,c,u)),(async()=>(await Promise.resolve(),t<r&&e.size>0&&e.dequeue()()))()},o=(a,...c)=>new Promise(u=>{i(a,u,c)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),o}async function fqe(r,e={}){const{concurrency:t=Number.POSITIVE_INFINITY}=e,n=dqe(t);return Promise.all(r.map(s=>s&&typeof s.then=="function"?dm(s):dm(typeof s=="function"?n(()=>s()):Promise.resolve(s))))}class pqe extends Map{constructor(t){super();N(this,"metric");const{name:n,metrics:s}=t;this.metric=s.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function Xl(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new pqe({name:e,metrics:t}):n=new Map,n}const il=U("libp2p:transports");class yqe extends Zt{constructor(e,t={}){super(),this.components=e,this.started=!1,this.transports=new Map,this.listeners=Xl({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??hh.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw T(new Error("Transport must have a valid tag"),O.ERR_INVALID_KEY);if(this.transports.has(t))throw T(new Error("There is already a transport with this tag"),O.ERR_DUPLICATE_TRANSPORT);il("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}async start(){const e=this.components.addressManager.getListenAddrs();await this.listen(e),this.started=!0}async stop(){const e=[];for(const[t,n]of this.listeners)for(il("closing listeners for %s",t);n.length>0;){const s=n.pop();s!=null&&e.push(s.close())}await Promise.all(e),il("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){const n=this.transportForMultiaddr(e);if(n==null)throw T(new Error(`No transport available for address ${String(e)}`),O.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(e,{...t,upgrader:this.components.upgrader})}catch(s){throw s.code==null&&(s.code=O.ERR_TRANSPORT_DIAL_FAILED),s}}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(e){for(const t of this.transports.values())if(t.filter([e]).length>0)return t}async listen(e){if(e==null||e.length===0){il("no addresses were provided for listening, this node is dial only");return}const t=[];for(const[n,s]of this.transports.entries()){const i=s.filter(e),o=[];for(const u of i){il("creating listener for %s on %s",n,u);const l=s.createListener({upgrader:this.components.upgrader});let h=this.listeners.get(n);h==null&&(h=[],this.listeners.set(n,h)),h.push(l),l.addEventListener("listening",()=>{this.dispatchEvent(new oe("listener:listening",{detail:l}))}),l.addEventListener("close",()=>{this.dispatchEvent(new oe("listener:close",{detail:l}))}),o.push(l.listen(u))}if(o.length===0){t.push(n);continue}if((await fqe(o)).find(u=>u.isFulfilled)==null&&this.faultTolerance!==hh.NO_FATAL)throw T(new Error(`Transport (${n}) could not listen on any available address`),O.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){const n=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===hh.FATAL_ALL)throw T(new Error(n),O.ERR_NO_VALID_ADDRESSES);il(`libp2p in dial mode only: ${n}`)}}async remove(e){il("removing %s",e);for(const t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const fh="/multistream/1.0.0",gqe=1024;function wqe(r){return r[Symbol.asyncIterator]!=null}function bqe(...r){const e=[];for(const t of r)wqe(t)||e.push(t);return e.length===r.length?function*(){for(const t of e)yield*t}():async function*(){const t=$r({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async n=>{for await(const s of n)t.push(s)})),t.end()}catch(n){t.end(n)}}),yield*t}()}function mqe(r){return r[Symbol.asyncIterator]!=null}function Eqe(r){if(mqe(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}const vqe=Math.pow(2,7),_qe=Math.pow(2,14),Sqe=Math.pow(2,21),S_=Math.pow(2,28),A_=Math.pow(2,35),$_=Math.pow(2,42),T_=Math.pow(2,49),ht=128,ts=127;function a0(r){if(r<vqe)return 1;if(r<_qe)return 2;if(r<Sqe)return 3;if(r<S_)return 4;if(r<A_)return 5;if(r<$_)return 6;if(r<T_)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Aqe(r,e,t=0){switch(a0(r)){case 8:e[t++]=r&255|ht,r/=128;case 7:e[t++]=r&255|ht,r/=128;case 6:e[t++]=r&255|ht,r/=128;case 5:e[t++]=r&255|ht,r/=128;case 4:e[t++]=r&255|ht,r>>>=7;case 3:e[t++]=r&255|ht,r>>>=7;case 2:e[t++]=r&255|ht,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function $qe(r,e,t=0){switch(a0(r)){case 8:e.set(t++,r&255|ht),r/=128;case 7:e.set(t++,r&255|ht),r/=128;case 6:e.set(t++,r&255|ht),r/=128;case 5:e.set(t++,r&255|ht),r/=128;case 4:e.set(t++,r&255|ht),r>>>=7;case 3:e.set(t++,r&255|ht),r>>>=7;case 2:e.set(t++,r&255|ht),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function Tqe(r,e){let t=r[e],n=0;if(n+=t&ts,t<ht||(t=r[e+1],n+=(t&ts)<<7,t<ht)||(t=r[e+2],n+=(t&ts)<<14,t<ht)||(t=r[e+3],n+=(t&ts)<<21,t<ht)||(t=r[e+4],n+=(t&ts)*S_,t<ht)||(t=r[e+5],n+=(t&ts)*A_,t<ht)||(t=r[e+6],n+=(t&ts)*$_,t<ht)||(t=r[e+7],n+=(t&ts)*T_,t<ht))return n;throw new RangeError("Could not decode varint")}function Iqe(r,e){let t=r.get(e),n=0;if(n+=t&ts,t<ht||(t=r.get(e+1),n+=(t&ts)<<7,t<ht)||(t=r.get(e+2),n+=(t&ts)<<14,t<ht)||(t=r.get(e+3),n+=(t&ts)<<21,t<ht)||(t=r.get(e+4),n+=(t&ts)*S_,t<ht)||(t=r.get(e+5),n+=(t&ts)*A_,t<ht)||(t=r.get(e+6),n+=(t&ts)*$_,t<ht)||(t=r.get(e+7),n+=(t&ts)*T_,t<ht))return n;throw new RangeError("Could not decode varint")}function Rqe(r,e,t=0){return e==null&&(e=$o(a0(r))),e instanceof Uint8Array?Aqe(r,e,t):$qe(r,e,t)}function Cqe(r,e=0){return r instanceof Uint8Array?Tqe(r,e):Iqe(r,e)}function kj(r){return r[Symbol.asyncIterator]!=null}const u3=r=>{const e=a0(r),t=$o(e);return Rqe(r,t),u3.bytes=e,t};u3.bytes=0;function I_(r,e){e=e??{};const t=e.lengthEncoder??u3;function*n(s){const i=t(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}return kj(r)?async function*(){for await(const s of r)yield*n(s)}():function*(){for(const s of r)yield*n(s)}()}I_.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??u3;return new Se(t(r.byteLength),r)};const xqe=8,Dqe=1024*1024*4;var hl;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(hl||(hl={}));const R_=r=>{const e=Cqe(r);return R_.bytes=a0(e),e};R_.bytes=0;function H8(r,e){const t=new Se;let n=hl.LENGTH,s=-1;const i=e?.lengthDecoder??R_,o=e?.maxLengthLength??xqe,a=e?.maxDataLength??Dqe;function*c(){for(;t.byteLength>0;){if(n===hl.LENGTH)try{if(s=i(t),s<0)throw T(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>a)throw T(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const u=i.bytes;t.consume(u),e?.onLength!=null&&e.onLength(s),n=hl.DATA}catch(u){if(u instanceof RangeError){if(t.byteLength>o)throw T(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw u}if(n===hl.DATA){if(t.byteLength<s)break;const u=t.sublist(0,s);t.consume(s),e?.onData!=null&&e.onData(u),yield u,n=hl.LENGTH}}}return kj(r)?async function*(){for await(const u of r)t.append(u),yield*c();if(t.byteLength>0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(const u of r)t.append(u),yield*c();if(t.byteLength>0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}H8.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return H8(n,{...e??{},onLength:i=>{t=i}})};function Pqe(r,...e){if(r==null)throw new Error("Empty pipeline");if(fm(r)){const n=r;r=()=>n.source}else if(Lj(r)||Nj(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&fm(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)fm(t[n])&&(t[n]=kqe(t[n]));return Oqe(...t)}const Oqe=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},Nj=r=>r?.[Symbol.asyncIterator]!=null,Lj=r=>r?.[Symbol.iterator]!=null,fm=r=>r==null?!1:r.sink!=null&&r.source!=null,kqe=r=>e=>{const t=r.sink(e);if(t?.then!=null){const n=$r({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let s;const i=r.source;if(Nj(i))s=async function*(){yield*i,n.end()};else if(Lj(i))s=function*(){yield*i,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return bqe(n,s())}return r.source},Nqe=U("libp2p:mss"),Mj=M(`
`);function C_(r){const e=new Se(r,Mj);return I_.single(e)}function Xf(r,e,t={}){const n=C_(e);t.writeBytes===!0?r.push(n.subarray()):r.push(n)}function Lqe(r,e,t={}){const n=new Se;for(const s of e)n.append(C_(s));t.writeBytes===!0?r.push(n.subarray()):r.push(n)}async function Mqe(r,e){let t=1;const n={[Symbol.asyncIterator]:()=>n,next:async()=>r.next(t)};let s=n;e?.signal!=null&&(s=m1(n,e.signal));const i=a=>{t=a},o=await Pqe(s,a=>H8(a,{onLength:i,maxDataLength:gqe}),async a=>Eqe(a));if(o==null||o.length===0)throw new L("no buffer returned","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(o.get(o.byteLength-1)!==Mj[0])throw Nqe.error("Invalid mss message - missing newline - %s",o.subarray()),new L("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.sublist(0,-1)}async function z2(r,e){const t=await Mqe(r,e);return R(t.subarray())}const $f=U("libp2p:mss:select");async function pm(r,e,t={}){e=Array.isArray(e)?[...e]:[e];const{reader:n,writer:s,rest:i,stream:o}=b_(r),a=e.shift();if(a==null)throw new Error("At least one protocol must be specified");$f.trace('select: write ["%s", "%s"]',fh,a);const c=M(fh),u=M(a);Lqe(s,[c,u],t);let l=await z2(n,t);if($f.trace('select: read "%s"',l),l===fh&&(l=await z2(n,t),$f.trace('select: read "%s"',l)),l===a)return i(),{stream:o,protocol:a};for(const h of e){$f.trace('select: write "%s"',h),Xf(s,M(h),t);const f=await z2(n,t);if($f.trace('select: read "%s" for "%s"',f,h),f===h)return i(),{stream:o,protocol:h}}throw i(),new L("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}const Tf=U("libp2p:mss:handle");async function ym(r,e,t){e=Array.isArray(e)?e:[e];const{writer:n,reader:s,rest:i,stream:o}=b_(r);for(;;){const a=await z2(s,t);if(Tf.trace('read "%s"',a),a===fh){Tf.trace('respond with "%s" for "%s"',fh,a),Xf(n,M(fh),t);continue}if(e.includes(a))return Xf(n,M(a),t),Tf.trace('respond with "%s" for "%s"',a,a),i(),{stream:o,protocol:a};if(a==="ls"){Xf(n,new Se(...e.map(c=>C_(M(c)))),t),Tf.trace('respond with "%s" for %s',e,a);continue}Xf(n,M("na"),t),Tf('respond with "na" for "%s"',a)}}const Uqe=Symbol.for("@libp2p/connection"),Bqe=U("libp2p:connection");class zqe{constructor(e){const{remoteAddr:t,remotePeer:n,newStream:s,close:i,getStreams:o,stat:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.stat={...a,status:JV},this._newStream=s,this._close=i,this._getStreams=o,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[Uqe](){return!0}get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===tD)throw T(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===cm)throw T(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const n=await this._newStream(e,t);return n.stat.direction="outbound",n}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(!(this.stat.status===cm||this._closing)){this.stat.status=tD;try{this.streams.forEach(e=>e.close())}catch(e){Bqe.error(e)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=cm}}}function Fqe(r){return new zqe(r)}const gm=U("libp2p:registrar"),Uj=32,Bj=64;class Vqe{constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this._onConnect=this._onConnect.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.connectionManager.addEventListener("peer:connect",this._onConnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw T(new Error(`No handler registered for protocol ${e}`),O.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw T(new Error(`Handler already registered for protocol ${e}`),O.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const s=kt.bind({ignoreUndefined:!0})({maxInboundStreams:Uj,maxOutboundStreams:Bj},n);this.handlers.set(e,{handler:t,options:s}),await this.components.peerStore.protoBook.add(this.components.peerId,[e])}async unhandle(e){const t=Array.isArray(e)?e:[e];t.forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.protoBook.remove(this.components.peerId,t)}async register(e,t){if(!ASe(t))throw gm.error("topology must be an instance of interfaces/topology"),T(new Error("topology must be an instance of interfaces/topology"),O.ERR_INVALID_PARAMETERS);const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let s=this.topologies.get(e);return s==null&&(s=new Map,this.topologies.set(e,s)),s.set(n,t),await t.setRegistrar(this),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(const s of n){const i=this.topologies.get(s);if(i!=null)for(const o of i.values())o.onDisconnect(t.remotePeer)}}).catch(n=>{gm.error(n)})}_onConnect(e){const t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then(n=>{for(const s of n){const i=this.topologies.get(s);if(i!=null)for(const o of i.values())o.onConnect(t.remotePeer,t)}}).catch(n=>{gm.error(n)})}_onProtocolChange(e){const{peerId:t,protocols:n,oldProtocols:s}=e.detail,i=s.filter(a=>!n.includes(a)),o=n.filter(a=>!s.includes(a));for(const a of i){const c=this.topologies.get(a);if(c!=null)for(const u of c.values())u.onDisconnect(t)}for(const a of o){const c=this.topologies.get(a);if(c!=null)for(const u of c.values()){const l=this.components.connectionManager.getConnections(t)[0];l!=null&&u.onConnect(t,l)}}}}const Tt=U("libp2p:upgrader");function jqe(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.code!==O.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return Uj}function Kqe(r,e){try{const{options:t}=e.getHandler(r);return t.maxOutboundStreams}catch(t){if(t.code!==O.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return Bj}function RD(r,e,t){let n=0;return t.streams.forEach(s=>{s.stat.direction===e&&s.stat.protocol===r&&n++}),n}class qqe extends Zt{constructor(e,t){super(),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach(n=>{this.connectionEncryption.set(n.protocol,n)}),this.muxers=new Map,t.muxers.forEach(n=>{this.muxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout}async upgradeInbound(e,t){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw T(new Error("connection denied"),O.ERR_CONNECTION_DENIED);let s,i,o,a,c;const u=new Xt.TimeoutController(this.inboundUpgradeTimeout);try{Rt.setMaxListeners?.(1/0,u.signal)}catch{}try{const l=mc(e,u.signal);if(e.source=l.source,e.sink=l.sink,await this.components.connectionGater.denyInboundConnection(e))throw T(new Error("The multiaddr connection is blocked by gater.acceptConnection"),O.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(e),Tt("starting the inbound connection upgrade");let h=e;if(t?.skipProtection!==!0){const f=this.components.connectionProtector;f!=null&&(Tt("protecting the inbound connection"),h=await f.protect(e))}try{if(s=h,t?.skipEncryption!==!0){if({conn:s,remotePeer:i,protocol:c}=await this._encryptInbound(h),await this.components.connectionGater.denyInboundEncryptedConnection(i,{...h,...s}))throw T(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),O.ERR_CONNECTION_INTERCEPTED)}else{const f=e.remoteAddr.getPeerId();if(f==null)throw T(new Error("inbound connection that skipped encryption must have a peer id"),O.ERR_INVALID_MULTIADDR);const y=Ae(f);c="native",i=y}if(o=s,t?.muxerFactory!=null)a=t.muxerFactory;else if(this.muxers.size>0){const f=await this._multiplexInbound({...h,...s},this.muxers);a=f.muxerFactory,o=f.stream}}catch(f){throw Tt.error("Failed to upgrade inbound connection",f),f}if(await this.components.connectionGater.denyInboundUpgradedConnection(i,{...h,...s}))throw T(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),O.ERR_CONNECTION_INTERCEPTED);return Tt("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:c,direction:"inbound",maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:i})}finally{this.components.connectionManager.afterUpgradeInbound(),u.clear()}}async upgradeOutbound(e,t){const n=e.remoteAddr.getPeerId();let s;if(n!=null&&(s=Ae(n),await this.components.connectionGater.denyOutboundConnection(s,e)))throw T(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),O.ERR_CONNECTION_INTERCEPTED);let i,o,a,c,u;this.components.metrics?.trackMultiaddrConnection(e),Tt("Starting the outbound connection upgrade");let l=e;if(t?.skipProtection!==!0){const h=this.components.connectionProtector;h!=null&&(l=await h.protect(e))}try{if(i=l,t?.skipEncryption!==!0){if({conn:i,remotePeer:o,protocol:c}=await this._encryptOutbound(l,s),await this.components.connectionGater.denyOutboundEncryptedConnection(o,{...l,...i}))throw T(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),O.ERR_CONNECTION_INTERCEPTED)}else{if(s==null)throw T(new Error("Encryption was skipped but no peer id was passed"),O.ERR_INVALID_PEER);c="native",o=s}if(a=i,t?.muxerFactory!=null)u=t.muxerFactory;else if(this.muxers.size>0){const h=await this._multiplexOutbound({...l,...i},this.muxers);u=h.muxerFactory,a=h.stream}}catch(h){throw Tt.error("Failed to upgrade outbound connection",h),await e.close(h),h}if(await this.components.connectionGater.denyOutboundUpgradedConnection(o,{...l,...i}))throw T(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),O.ERR_CONNECTION_INTERCEPTED);return Tt("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:c,direction:"outbound",maConn:e,upgradedConn:a,muxerFactory:u,remotePeer:o})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:s,upgradedConn:i,remotePeer:o,muxerFactory:a}=e;let c,u,l;a!=null&&(c=a.createStreamMuxer({direction:n,onIncomingStream:y=>{l!=null&&Promise.resolve().then(async()=>{const d=this.components.registrar.getProtocols(),{stream:p,protocol:b}=await ym(y,d);if(Tt("%s: incoming stream opened on %s",n,b),l==null)return;const w=jqe(b,this.components.registrar);if(RD(b,"inbound",l)===w){y.abort(T(new Error(`Too many inbound protocol streams for protocol "${b}" - limit ${w}`),O.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS));return}y.source=p.source,y.sink=p.sink,y.stat.protocol=b,this.components.peerStore.protoBook.add(o,[b]).catch(E=>Tt.error(E)),l.addStream(y),this.components.metrics?.trackProtocolStream(y,l),this._onStream({connection:l,stream:y,protocol:b})}).catch(d=>{Tt.error(d),y.stat.timeline.close==null&&y.close()})},onStreamEnd:y=>{l?.removeStream(y.id)}}),u=async(y,d={})=>{if(c==null)throw T(new Error("Stream is not multiplexed"),O.ERR_MUXER_UNAVAILABLE);Tt("%s: starting new stream on %s",n,y);const p=await c.newStream();let b;try{if(d.signal==null){Tt("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",y),b=new Xt.TimeoutController(3e4),d.signal=b.signal;try{Rt.setMaxListeners?.(1/0,b.signal)}catch{}}const{stream:w,protocol:S}=await pm(p,y,d),E=Kqe(S,this.components.registrar);if(RD(S,"outbound",l)===E){const v=T(new Error(`Too many outbound protocol streams for protocol "${S}" - limit ${E}`),O.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw p.abort(v),v}return this.components.peerStore.protoBook.add(o,[S]).catch(v=>Tt.error(v)),p.source=w.source,p.sink=w.sink,p.stat.protocol=S,this.components.metrics?.trackProtocolStream(p,l),p}catch(w){throw Tt.error("could not create new stream",w),p.stat.timeline.close==null&&p.close(),w.code!=null?w:T(w,O.ERR_UNSUPPORTED_PROTOCOL)}finally{b?.clear()}},Promise.all([c.sink(i.source),i.sink(c.source)]).catch(y=>{Tt.error(y)}));const h=s.timeline;s.timeline=new Proxy(h,{set:(...y)=>(l!=null&&y[1]==="close"&&y[2]!=null&&h.close==null&&(async()=>{try{l.stat.status==="OPEN"&&await l.close()}catch(d){Tt.error(d)}finally{this.dispatchEvent(new oe("connectionEnd",{detail:l}))}})().catch(d=>{Tt.error(d)}),Reflect.set(...y))}),s.timeline.upgraded=Date.now();const f=()=>{throw T(new Error("connection is not multiplexed"),O.ERR_CONNECTION_NOT_MULTIPLEXED)};return l=Fqe({remoteAddr:s.remoteAddr,remotePeer:o,stat:{status:"OPEN",direction:n,timeline:s.timeline,multiplexer:c?.protocol,encryption:t},newStream:u??f,getStreams:()=>c!=null?c.streams:f(),close:async()=>{await s.close(),c?.close()}}),this.dispatchEvent(new oe("connection",{detail:l})),l}_onStream(e){const{connection:t,stream:n,protocol:s}=e,{handler:i}=this.components.registrar.getHandler(s);i({connection:t,stream:n})}async _encryptInbound(e){const t=Array.from(this.connectionEncryption.keys());Tt("handling inbound crypto protocol selection",t);try{const{stream:n,protocol:s}=await ym(e,t,{writeBytes:!0}),i=this.connectionEncryption.get(s);if(i==null)throw new Error(`no crypto module found for ${s}`);return Tt("encrypting inbound connection..."),{...await i.secureInbound(this.components.peerId,n),protocol:s}}catch(n){throw T(n,O.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncryption.keys());Tt("selecting outbound crypto protocol",n);try{const{stream:s,protocol:i}=await pm(e,n,{writeBytes:!0}),o=this.connectionEncryption.get(i);if(o==null)throw new Error(`no crypto module found for ${i}`);return Tt("encrypting outbound connection to %p",t),{...await o.secureOutbound(this.components.peerId,s,t),protocol:i}}catch(s){throw T(s,O.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const n=Array.from(t.keys());Tt("outbound selecting muxer %s",n);try{const{stream:s,protocol:i}=await pm(e,n,{writeBytes:!0});Tt("%s selected as muxer protocol",i);const o=t.get(i);return{stream:s,muxerFactory:o}}catch(s){throw Tt.error("error multiplexing outbound stream",s),T(s,O.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const n=Array.from(t.keys());Tt("inbound handling muxers %s",n);try{const{stream:s,protocol:i}=await ym(e,n,{writeBytes:!0}),o=t.get(i);return{stream:s,muxerFactory:o}}catch(s){throw Tt.error("error multiplexing inbound stream",s),T(s,O.ERR_MUXER_UNAVAILABLE)}}}var eh;(function(r){let e;r.codec=()=>(e==null&&(e=ep((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const i of t.listenAddrs)n.uint32(18),n.bytes(i);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const i of t.protocols)n.uint32(26),n.string(i);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={listenAddrs:[],protocols:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 5:s.protocolVersion=t.string();break;case 6:s.agentVersion=t.string();break;case 1:s.publicKey=t.bytes();break;case 2:s.listenAddrs.push(t.bytes());break;case 4:s.observedAddr=t.bytes();break;case 3:s.protocols.push(t.string());break;case 8:s.signedPeerRecord=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Z1(t,r.codec()),r.decode=t=>J1(t,r.codec())})(eh||(eh={}));const zj="0.0.0",Hqe="libp2p",Fj=`js-libp2p/${zj}`,Gqe="0.1.0",Wqe="id",Qqe="id/push",Yqe="1.0.0",Xqe="1.0.0",_t=U("libp2p:identify"),CD=1024*8;class x_{constructor(e,t){this.components=e,this.started=!1,this.init=t,this.identifyProtocolStr=`/${t.protocolPrefix}/${Wqe}/${Yqe}`,this.identifyPushProtocolStr=`/${t.protocolPrefix}/${Qqe}/${Xqe}`,this.host={protocolVersion:`${t.protocolPrefix}/${Gqe}`,...t.host},this.components.connectionManager.addEventListener("peer:connect",n=>{const s=n.detail;this.identify(s).catch(_t.error)}),this.components.peerStore.addEventListener("change:multiaddrs",n=>{const{peerId:s}=n.detail;this.components.peerId.equals(s)&&this.pushToPeerStore().catch(i=>_t.error(i))}),this.components.peerStore.addEventListener("change:protocols",n=>{const{peerId:s}=n.detail;this.components.peerId.equals(s)&&this.pushToPeerStore().catch(i=>_t.error(i))})}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",M(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",M(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,e=>{this._handleIdentify(e).catch(t=>{_t.error(t)})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,e=>{this._handlePush(e).catch(t=>{_t.error(t)})},{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(e){const t=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),n=this.components.addressManager.getAddresses().map(o=>o.bytes),s=await this.components.peerStore.protoBook.get(this.components.peerId),i=e.map(async o=>{let a;const c=new Xt.TimeoutController(this.init.timeout);try{Rt.setMaxListeners?.(1/0,c.signal)}catch{}try{a=await o.newStream([this.identifyPushProtocolStr],{signal:c.signal}),await mc(a,c.signal).sink(Ve([eh.encode({listenAddrs:n,signedPeerRecord:t,protocols:s})],Uh()))}catch(u){_t.error("could not push identify update to peer",u)}finally{a?.close(),c.clear()}});await Promise.all(i)}async pushToPeerStore(){if(!this.isStarted())return;const e=[];for(const t of this.components.connectionManager.getConnections()){const n=t.remotePeer;(await this.components.peerStore.get(n)).protocols.includes(this.identifyPushProtocolStr)&&e.push(t)}await this.push(e)}async _identify(e,t={}){let n,s=t.signal,i;if(s==null){n=new Xt.TimeoutController(this.init.timeout),s=n.signal;try{Rt.setMaxListeners?.(1/0,n.signal)}catch{}}try{i=await e.newStream([this.identifyProtocolStr],{signal:s});const o=mc(i,s),a=await Ve([],o,Yl({maxDataLength:this.init.maxIdentifyMessageSize??CD}),async c=>await to(c));if(a==null)throw T(new Error("No data could be retrieved"),O.ERR_CONNECTION_ENDED);try{return eh.decode(a)}catch(c){throw T(c,O.ERR_INVALID_MESSAGE)}}finally{n?.clear(),i?.close()}}async identify(e,t={}){const n=await this._identify(e,t),{publicKey:s,listenAddrs:i,protocols:o,observedAddr:a,signedPeerRecord:c,agentVersion:u,protocolVersion:l}=n;if(s==null)throw T(new Error("public key was missing from identify message"),O.ERR_MISSING_PUBLIC_KEY);const h=await vi(s);if(!e.remotePeer.equals(h))throw T(new Error("identified peer does not match the expected peer"),O.ERR_INVALID_PEER);if(this.components.peerId.equals(h))throw T(new Error("identified peer is our own peer id?"),O.ERR_INVALID_PEER);const f=x_.getCleanMultiaddr(a);if(c!=null){_t("received signed peer record from %p",h);try{const y=await fa.openAndCertify(c,Dc.DOMAIN);if(!y.peerId.equals(h))throw T(new Error("identified peer does not match the expected peer"),O.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(y)){await this.components.peerStore.protoBook.set(h,o),u!=null&&await this.components.peerStore.metadataBook.setValue(h,"AgentVersion",M(u)),l!=null&&await this.components.peerStore.metadataBook.setValue(h,"ProtocolVersion",M(l)),_t("identify completed for peer %p and protocols %o",h,o);return}}catch(y){_t("received invalid envelope, discard it and fallback to listenAddrs is available",y)}}else _t("no signed peer record received from %p",h);_t("falling back to legacy addresses from %p",h);try{await this.components.peerStore.addressBook.set(h,i.map(y=>ur(y)))}catch(y){_t.error("received invalid addrs",y)}await this.components.peerStore.protoBook.set(h,o),u!=null&&await this.components.peerStore.metadataBook.setValue(h,"AgentVersion",M(u)),l!=null&&await this.components.peerStore.metadataBook.setValue(h,"ProtocolVersion",M(l)),_t("identify completed for peer %p and protocols %o",h,o),_t("received observed address of %s",f?.toString())}async _handleIdentify(e){const{connection:t,stream:n}=e,s=new Xt.TimeoutController(this.init.timeout);try{Rt.setMaxListeners?.(1/0,s.signal)}catch{}try{const i=this.components.peerId.publicKey??new Uint8Array(0),o=await this.components.peerStore.get(this.components.peerId),a=this.components.addressManager.getAddresses().map(f=>f.decapsulateCode(Ht("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const f=new Dc({peerId:this.components.peerId,multiaddrs:a}),y=await fa.seal(f,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(y),c=y.marshal().subarray()}const u=eh.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:i,listenAddrs:a.map(f=>f.bytes),signedPeerRecord:c,observedAddr:t.remoteAddr.bytes,protocols:o.protocols}),l=mc(n,s.signal),h=Ve([u],Uh());await l.sink(h)}catch(i){_t.error("could not respond to identify request",i)}finally{n.close(),s.clear()}}async _handlePush(e){const{connection:t,stream:n}=e,s=new Xt.TimeoutController(this.init.timeout);try{Rt.setMaxListeners?.(1/0,s.signal)}catch{}let i;try{const a=mc(n,s.signal),c=await Ve([],a,Yl({maxDataLength:this.init.maxIdentifyMessageSize??CD}),async u=>await to(u));c!=null&&(i=eh.decode(c))}catch(a){return _t.error("received invalid message",a)}finally{n.close(),s.clear()}if(i==null)return _t.error("received invalid message");const o=t.remotePeer;if(this.components.peerId.equals(o)){_t("received push from ourselves?");return}if(_t("received push from %p",o),i.signedPeerRecord!=null){_t("received signedPeerRecord in push");try{const a=await fa.openAndCertify(i.signedPeerRecord,Dc.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(a)){_t("consumed signedPeerRecord sent in push"),await this.components.peerStore.protoBook.set(o,i.protocols);return}else _t("failed to consume signedPeerRecord sent in push")}catch(a){_t("received invalid envelope, discard it and fallback to listenAddrs is available",a)}}else _t("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(o,i.listenAddrs.map(a=>ur(a)))}catch(a){_t.error("received invalid addrs",a)}try{await this.components.peerStore.protoBook.set(o,i.protocols)}catch(a){_t.error("received invalid protocols",a)}_t("handled push from %p",o)}static getCleanMultiaddr(e){if(e!=null&&e.length>0)try{return ur(e)}catch{}}}var lw;(function(r){let e;r.codec=()=>(e==null&&(e=ep((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),(s.writeDefaults===!0||t.identifier!=="")&&(n.uint32(10),n.string(t.identifier)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={identifier:""},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.identifier=t.string();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Z1(t,r.codec()),r.decode=t=>J1(t,r.codec())})(lw||(lw={}));var po;(function(r){let e;(function(s){s.OK="OK",s.NOT_FOUND="NOT_FOUND",s.ERROR="ERROR"})(e=r.StatusCode||(r.StatusCode={}));let t;(function(s){s[s.OK=0]="OK",s[s.NOT_FOUND=1]="NOT_FOUND",s[s.ERROR=2]="ERROR"})(t||(t={})),function(s){s.codec=()=>K8(t)}(e=r.StatusCode||(r.StatusCode={}));let n;r.codec=()=>(n==null&&(n=ep((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),(o.writeDefaults===!0||s.status!=null&&t[s.status]!==0)&&(i.uint32(8),r.StatusCode.codec().encode(s.status,i)),(o.writeDefaults===!0||s.data!=null&&s.data.byteLength>0)&&(i.uint32(18),i.bytes(s.data)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{const o={status:e.OK,data:new Uint8Array(0)},a=i==null?s.len:s.pos+i;for(;s.pos<a;){const c=s.uint32();switch(c>>>3){case 1:o.status=r.StatusCode.codec().decode(s);break;case 2:o.data=s.bytes();break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>Z1(s,r.codec()),r.decode=s=>J1(s,r.codec())})(po||(po={}));const Jqe="0.0.1",Zqe="fetch",Js=U("libp2p:fetch");class eHe{constructor(e,t){this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/${Zqe}/${Jqe}`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,e=>{this.handleMessage(e).catch(t=>{Js.error(t)}).finally(()=>{e.stream.close()})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,n={}){Js("dialing %s to %p",this.protocol,e);const s=await this.components.connectionManager.openConnection(e,n);let i,o=n.signal,a;if(o==null){Js("using default timeout of %d ms",this.init.timeout),i=new Xt.TimeoutController(this.init.timeout),o=i.signal;try{Rt.setMaxListeners?.(1/0,i.signal)}catch{}}try{a=await s.newStream(this.protocol,{signal:o});const c=mc(a,o);return Js("fetch %s",t),await Ve([lw.encode({identifier:t})],Uh(),c,Yl(),async function(l){const h=await to(l);if(h==null)throw T(new Error("No data received"),O.ERR_INVALID_MESSAGE);const f=po.decode(h);switch(f.status){case po.StatusCode.OK:return Js("received status for %s ok",t),f.data;case po.StatusCode.NOT_FOUND:return Js("received status for %s not found",t),null;case po.StatusCode.ERROR:{Js("received status for %s error",t);const y=R(f.data);throw T(new Error("Error in fetch protocol response: "+y),O.ERR_INVALID_PARAMETERS)}default:throw Js("received status for %s unknown",t),T(new Error("Unknown response status"),O.ERR_INVALID_MESSAGE)}})??null}finally{i?.clear(),a?.close()}}async handleMessage(e){const{stream:t}=e,n=this;await Ve(t,Yl(),async function*(s){const i=await to(s);if(i==null)throw T(new Error("No data received"),O.ERR_INVALID_MESSAGE);const o=lw.decode(i);let a;const c=n._getLookupFunction(o.identifier);if(c!=null){Js("look up data with identifier %s",o.identifier);const u=await c(o.identifier);u!=null?(Js("sending status for %s ok",o.identifier),a={status:po.StatusCode.OK,data:u}):(Js("sending status for %s not found",o.identifier),a={status:po.StatusCode.NOT_FOUND,data:new Uint8Array(0)})}else{Js("sending status for %s error",o.identifier);const u=M(`No lookup function registered for key: ${o.identifier}`);a={status:po.StatusCode.ERROR,data:u}}yield po.encode(a)},Uh(),t)}_getLookupFunction(e){for(const t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw T(new Error("Fetch protocol handler for key prefix '"+e+"' already registered"),O.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){t!=null&&this.lookupFunctions.get(e)!==t||this.lookupFunctions.delete(e)}}const tHe=32,rHe="1.0.0",nHe="ping",xD=U("libp2p:ping");class sHe{constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix}/${nHe}/${rHe}`,this.init=t}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){const{stream:t}=e;Ve(t,t).catch(n=>{xD.error(n)})}async ping(e,t={}){xD("dialing %s to %p",this.protocol,e);const n=Date.now(),s=Pp(tHe),i=await this.components.connectionManager.openConnection(e,t);let o,a=t.signal,c;if(a==null){o=new Xt.TimeoutController(this.init.timeout),a=o.signal;try{Rt.setMaxListeners?.(1/0,o.signal)}catch{}}try{c=await i.newStream([this.protocol],{signal:a});const u=mc(c,a),l=await Ve([s],u,async f=>await to(f)),h=Date.now();if(l==null||!Ie(s,l.subarray()))throw T(new Error("Received wrong ping ack"),O.ERR_WRONG_PING_ACK);return h-n}finally{o?.clear(),c?.close()}}}async function iHe(){throw new Error("Not supported in browsers")}function oHe(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function aHe(r){const{address:e}=r.nodeAddress();return oHe(e)}const wm=U("libp2p:nat"),bm=7200;function cHe(r=1024,e=65535){return Math.floor(Math.random()*(e-r+1)+r)}class lHe{constructor(e,t){if(this.components=e,this.started=!1,this.enabled=t.enabled,this.externalAddress=t.externalAddress,this.localAddress=t.localAddress,this.description=t.description??`${Hqe}@${zj} ${this.components.peerId.toString()}`,this.ttl=t.ttl??bm,this.keepAlive=t.keepAlive??!0,this.gateway=t.gateway,this.ttl<bm)throw T(new Error(`NatManager ttl should be at least ${bm} seconds`),O.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){b1||!this.enabled||this.started||(this.started=!0,this._start().catch(e=>{wm.error(e)}))}async _start(){const e=this.components.transportManager.getAddrs();for(const t of e){const{family:n,host:s,port:i,transport:o}=t.toOptions();if(!t.isThinWaistAddress()||o!=="tcp"||aHe(t)||n!==4)continue;const a=await this._getClient(),c=this.externalAddress??await a.externalIp(),u=c3(c);if(u===!0)throw new Error(`${c} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);if(u==null)throw new Error(`${c} is not an IP address`);const l=cHe();wm(`opening uPnP connection from ${c}:${l} to ${s}:${i}`),await a.map({publicPort:l,localPort:i,localAddress:this.localAddress,protocol:o.toUpperCase()==="TCP"?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(CFe({family:4,address:c,port:l},o))}}async _getClient(){return this.client!=null?this.client:(this.client=await iHe({description:this.description,ttl:this.ttl,keepAlive:this.keepAlive,gateway:this.gateway}),this.client)}async stop(){if(!(b1||this.client==null))try{await this.client.close(),this.client=void 0}catch(e){wm.error(e)}}}const uHe=U("libp2p:peer-record-updater");class hHe{constructor(e){this.components=e,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then(async()=>{const e=new Dc({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(n=>n.decapsulateCode(Ht("p2p").code))}),t=await fa.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t)}).catch(e=>{uHe.error("Could not update self peer record: %o",e)})}}class dHe{constructor(e){this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw T(new Error(st.NOT_FOUND),O.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const DD=mi,fHe=Ei,Vj=function(r){let e=0;if(r=r.toString().trim(),DD(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(fHe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=DD(t[n]);let o;i&&(o=Vj(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},pHe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Zs=-1,uw={},G8={},yHe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Zs,"ip6zone"],[43,8,"ipcidr"],[53,Zs,"dns",!0],[54,Zs,"dns4",!0],[55,Zs,"dns6",!0],[56,Zs,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Zs,"unix",!1,!0],[421,Zs,"ipfs"],[421,Zs,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Zs,"garlic64"],[448,0,"tls"],[449,Zs,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Zs,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Zs,"memory"]];yHe.forEach(r=>{const e=gHe(...r);G8[e.code]=e,uw[e.name]=e});function gHe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function _r(r){if(typeof r=="number"){if(G8[r]!=null)return G8[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(uw[r]!=null)return uw[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var wHe=jj,PD=128,bHe=127,mHe=~bHe,EHe=Math.pow(2,31);function jj(r,e,t){e=e||[],t=t||0;for(var n=t;r>=EHe;)e[t++]=r&255|PD,r/=128;for(;r&mHe;)e[t++]=r&255|PD,r>>>=7;return e[t]=r|0,jj.bytes=t-n+1,e}var vHe=W8,_He=128,OD=127;function W8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw W8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&OD)<<s:(o&OD)*Math.pow(2,s),s+=7}while(o>=_He);return W8.bytes=i-n,t}var SHe=Math.pow(2,7),AHe=Math.pow(2,14),$He=Math.pow(2,21),THe=Math.pow(2,28),IHe=Math.pow(2,35),RHe=Math.pow(2,42),CHe=Math.pow(2,49),xHe=Math.pow(2,56),DHe=Math.pow(2,63),PHe=function(r){return r<SHe?1:r<AHe?2:r<$He?3:r<THe?4:r<IHe?5:r<RHe?6:r<CHe?7:r<xHe?8:r<DHe?9:10},OHe={encode:wHe,decode:vHe,encodingLength:PHe},hw=OHe;const Q8=(r,e=0)=>[hw.decode(r,e),hw.decode.bytes],dw=(r,e,t=0)=>(hw.encode(r,e,t),e),fw=r=>hw.encodingLength(r),kHe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},D_=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},NHe=r=>new TextEncoder().encode(r),LHe=r=>new TextDecoder().decode(r),MHe=(r,e)=>{const t=e.byteLength,n=fw(r),s=n+fw(t),i=new Uint8Array(s+t);return dw(r,i,0),dw(t,i,n),i.set(e,s),new P_(r,t,e,i)},Kj=r=>{const e=D_(r),[t,n]=Q8(e),[s,i]=Q8(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new P_(t,s,o,e)},UHe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&kHe(r.bytes,t.bytes)}};let P_=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function BHe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var zHe=BHe,FHe=zHe;let VHe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},jHe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return qj(this,e)}},KHe=class{constructor(e){this.decoders=e}or(e){return qj(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const qj=(r,e)=>new KHe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let qHe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new VHe(e,t,n),this.decoder=new jHe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const h3=({name:r,prefix:e,encode:t,decode:n})=>new qHe(r,e,t,n),c0=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=FHe(t,e);return h3({prefix:r,name:e,encode:n,decode:i=>D_(s(i))})},HHe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},GHe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},sn=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>h3({prefix:e,name:r,encode(s){return GHe(s,n,t)},decode(s){return HHe(s,n,t,r)}}),Qi=c0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),WHe=c0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),QHe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Qi,base58flickr:WHe},Symbol.toStringTag,{value:"Module"})),Oc=sn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),YHe=sn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),XHe=sn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),JHe=sn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ZHe=sn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eGe=sn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),tGe=sn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rGe=sn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),nGe=sn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),sGe=Object.freeze(Object.defineProperty({__proto__:null,base32:Oc,base32hex:ZHe,base32hexpad:tGe,base32hexpadupper:rGe,base32hexupper:eGe,base32pad:XHe,base32padupper:JHe,base32upper:YHe,base32z:nGe},Symbol.toStringTag,{value:"Module"})),kD=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return oGe(t,Y8(r),e||Qi.encoder);default:return aGe(t,Y8(r),e||Oc.encoder)}},ND=new WeakMap,Y8=r=>{const e=ND.get(r);if(e==null){const t=new Map;return ND.set(r,t),t}return e};let Hj=class Gn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==If)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cGe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Gn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=MHe(e,t);return Gn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Gn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&UHe(e.multihash,n.multihash)}toString(e){return kD(this,e)}toJSON(){return{"/":kD(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Gn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Gn(n,s,i,o||LD(n,s,i.bytes))}else if(t[lGe]===!0){const{version:n,multihash:s,code:i}=t,o=Kj(s);return Gn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==If)throw new Error(`Version 0 CID must use dag-pb (code: ${If}) block encoding`);return new Gn(e,t,n,n.bytes)}case 1:{const s=LD(e,t,n.bytes);return new Gn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Gn.create(0,If,e)}static createV1(e,t){return Gn.create(1,e,t)}static decode(e){const[t,n]=Gn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Gn.inspectBytes(e),n=t.size-t.multihashSize,s=D_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new P_(t.multihashCode,t.digestSize,i,s);return[t.version===0?Gn.createV0(o):Gn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=Q8(e.subarray(t));return t+=f,h};let s=n(),i=If;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=iGe(e,t),i=Gn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Y8(i).set(n,e),i}};const iGe=(r,e)=>{switch(r[0]){case"Q":{const t=e||Qi;return[Qi.prefix,t.decode(`${Qi.prefix}${r}`)]}case Qi.prefix:{const t=e||Qi;return[Qi.prefix,t.decode(r)]}case Oc.prefix:{const t=e||Oc;return[Oc.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},oGe=(r,e,t)=>{const{prefix:n}=t;if(n!==Qi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},aGe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},If=112,cGe=18,LD=(r,e,t)=>{const n=fw(r),s=n+fw(e),i=new Uint8Array(s+t.byteLength);return dw(r,i,0),dw(e,i,n),i.set(t,s),i},lGe=Symbol.for("@ipld/js-cid/CID"),uGe=h3({prefix:"\0",name:"identity",encode:r=>LHe(r),decode:r=>NHe(r)}),hGe=Object.freeze(Object.defineProperty({__proto__:null,identity:uGe},Symbol.toStringTag,{value:"Module"})),dGe=sn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),fGe=Object.freeze(Object.defineProperty({__proto__:null,base2:dGe},Symbol.toStringTag,{value:"Module"})),pGe=sn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),yGe=Object.freeze(Object.defineProperty({__proto__:null,base8:pGe},Symbol.toStringTag,{value:"Module"})),gGe=c0({prefix:"9",name:"base10",alphabet:"0123456789"}),wGe=Object.freeze(Object.defineProperty({__proto__:null,base10:gGe},Symbol.toStringTag,{value:"Module"})),bGe=sn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),mGe=sn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),EGe=Object.freeze(Object.defineProperty({__proto__:null,base16:bGe,base16upper:mGe},Symbol.toStringTag,{value:"Module"})),vGe=c0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_Ge=c0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),SGe=Object.freeze(Object.defineProperty({__proto__:null,base36:vGe,base36upper:_Ge},Symbol.toStringTag,{value:"Module"})),AGe=sn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),$Ge=sn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),TGe=sn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),IGe=sn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),RGe=Object.freeze(Object.defineProperty({__proto__:null,base64:AGe,base64pad:$Ge,base64url:TGe,base64urlpad:IGe},Symbol.toStringTag,{value:"Module"})),Gj=Array.from(""),CGe=Gj.reduce((r,e,t)=>(r[t]=e,r),[]),xGe=Gj.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function DGe(r){return r.reduce((e,t)=>(e+=CGe[t],e),"")}function PGe(r){const e=[];for(const t of r){const n=xGe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const OGe=h3({prefix:"",name:"base256emoji",encode:DGe,decode:PGe}),kGe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:OGe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const NGe={...hGe,...fGe,...yGe,...wGe,...EGe,...sGe,...SGe,...QHe,...RGe,...kGe};function LGe(r,e){switch(_r(r).code){case 4:case 41:return BGe(e);case 42:return BD(e);case 6:case 273:case 33:case 132:return Wj(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return BD(e);case 421:return jGe(e);case 444:return zD(e);case 445:return zD(e);case 466:return VGe(e);default:return R(e,"base16")}}function MGe(r,e){switch(_r(r).code){case 4:return MD(e);case 41:return MD(e);case 42:return UD(e);case 6:case 273:case 33:case 132:return O_(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return UD(e);case 421:return zGe(e);case 444:return KGe(e);case 445:return qGe(e);case 466:return FGe(e);default:return M(e,"base16")}}const mm=Object.values(NGe).map(r=>r.decoder),UGe=function(){let r=mm[0].or(mm[1]);return mm.slice(2).forEach(e=>r=r.or(e)),r}();function MD(r){if(!Nt(r))throw new Error("invalid ip address");return Vj(r)}function BGe(r){const e=pHe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function O_(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function Wj(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function UD(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function BD(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function zGe(r){let e;r[0]==="Q"||r[0]==="1"?e=Kj(Qi.decode(`z${r}`)).bytes:e=Hj.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function FGe(r){const e=UGe.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function VGe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function jGe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function KGe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Oc.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=O_(n);return z([t,s],t.length+s.length)}function qGe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Oc.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=O_(n);return z([t,s],t.length+s.length)}function zD(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=Wj(t);return`${n}:${s}`}function HGe(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=_r(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw Jj("invalid address: "+r);if(i.path===!0){e.push([s,N_(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function GGe(r){const e=[];return r.map(t=>{const n=d3(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),N_(e.join("/"))}function WGe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=d3(e);return e.length>1?[t.code,MGe(t.code,e[1])]:[t.code]})}function Qj(r){return r.map(e=>{const t=d3(e);return e[1]!=null?[t.code,LGe(t.code,e[1])]:[t.code]})}function Yj(r){return X8(z(r.map(e=>{const t=d3(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function Xj(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function k_(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=_r(n),o=Xj(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw Jj("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function FD(r){const e=k_(r),t=Qj(e);return GGe(t)}function QGe(r){r=N_(r);const e=HGe(r),t=WGe(e);return Yj(t)}function YGe(r){return QGe(r)}function X8(r){const e=XGe(r);if(e!=null)throw e;return Uint8Array.from(r)}function XGe(r){try{k_(r)}catch(e){return e}}function N_(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function Jj(r){return new Error("Error parsing address: "+r)}function d3(r){return _r(r[0])}var Lu=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Em=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Rf,Cf,xf,VD;const JGe=Symbol.for("nodejs.util.inspect.custom"),ZGe=[_r("dns").code,_r("dns4").code,_r("dns6").code,_r("dnsaddr").code],eWe=new Map,Zj=Symbol.for("@multiformats/js-multiaddr/multiaddr");function eK(r){return!!r?.[Zj]}let tWe=class Qu{constructor(e){if(Rf.set(this,void 0),Cf.set(this,void 0),xf.set(this,void 0),this[VD]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=X8(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=YGe(e)}else if(eK(e))this.bytes=X8(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Lu(this,Rf,"f")==null&&Em(this,Rf,FD(this.bytes),"f"),Lu(this,Rf,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=_r("tcp"),a=_r("udp"),c=_r("ip4"),u=_r("ip6"),l=_r("dns6"),h=_r("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),ZGe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=_r(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=_r(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},_r(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=_r(s),a=Xj(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Lu(this,Cf,"f")==null&&Em(this,Cf,k_(this.bytes),"f"),Lu(this,Cf,"f")}stringTuples(){return Lu(this,xf,"f")==null&&Em(this,xf,Qj(this.tuples()),"f"),Lu(this,xf,"f")}encapsulate(e){return e=new Qu(e),new Qu(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Qu(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Qu(Yj(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===uw.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Qi.decode(`z${n}`),"base58btc"):R(Hj.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>_r(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=eWe.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new Qu(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Rf=new WeakMap,Cf=new WeakMap,xf=new WeakMap,VD=Zj,JGe)](){return`Multiaddr(${FD(this.bytes)})`}};function jD(r){return new tWe(r)}const He={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_NOT_FOUND:"ERR_NOT_FOUND"},bt=U("libp2p:peer-store:address-book"),s2="change:multiaddrs";async function rWe(){return!0}class nWe{constructor(e,t,n){this.dispatchEvent=e,this.store=t,this.addressFilter=n??rWe}async consumePeerRecord(e){bt.trace("consumePeerRecord await write lock");const t=await this.store.lock.writeLock();bt.trace("consumePeerRecord got write lock");let n,s,i;try{let o;try{o=Dc.createFromProtobuf(e.payload)}catch{return bt.error("invalid peer record received"),!1}n=o.peerId;const a=o.multiaddrs;if(!n.equals(e.peerId))return bt("signing key does not match PeerId in the PeerRecord"),!1;if(a==null||a.length===0)return!1;if(await this.store.has(n)&&(s=await this.store.load(n),s.peerRecordEnvelope!=null)){const u=await fa.createFromProtobuf(s.peerRecordEnvelope),l=Dc.createFromProtobuf(u.payload);if(l.seqNumber>=o.seqNumber)return bt("sequence number was lower or equal to existing sequence number - stored: %d received: %d",l.seqNumber,o.seqNumber),!1}const c=await vm(n,a,this.addressFilter,!0);i=await this.store.patchOrCreate(n,{addresses:c,peerRecordEnvelope:e.marshal().subarray()}),bt("stored provided peer record for %p",o.peerId)}finally{bt.trace("consumePeerRecord release write lock"),t()}return this.dispatchEvent(new oe(s2,{detail:{peerId:n,multiaddrs:i.addresses.map(({multiaddr:o})=>o),oldMultiaddrs:s==null?[]:s.addresses.map(({multiaddr:o})=>o)}})),!0}async getRawEnvelope(e){bt.trace("getRawEnvelope await read lock");const t=await this.store.lock.readLock();bt.trace("getRawEnvelope got read lock");try{return(await this.store.load(e)).peerRecordEnvelope}catch(n){if(n.code!==He.ERR_NOT_FOUND)throw n}finally{bt.trace("getRawEnvelope release read lock"),t()}}async getPeerRecord(e){const t=await this.getRawEnvelope(e);if(t!=null)return await fa.createFromProtobuf(t)}async get(e){e=Nr(e),bt.trace("get wait for read lock");const t=await this.store.lock.readLock();bt.trace("get got read lock");try{return(await this.store.load(e)).addresses}catch(n){if(n.code!==He.ERR_NOT_FOUND)throw n}finally{bt.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Nr(e),!Array.isArray(t))throw bt.error("multiaddrs must be an array of Multiaddrs"),new L("multiaddrs must be an array of Multiaddrs",He.ERR_INVALID_PARAMETERS);bt.trace("set await write lock");const n=await this.store.lock.writeLock();bt.trace("set got write lock");let s=!1,i,o;try{const a=await vm(e,t,this.addressFilter);if(a.length===0)return;try{if(i=await this.store.load(e),s=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...i.addresses.map(({multiaddr:c})=>c.toString())]).size===i.addresses.length&&a.length===i.addresses.length)return}catch(c){if(c.code!==He.ERR_NOT_FOUND)throw c}o=await this.store.patchOrCreate(e,{addresses:a}),bt("set multiaddrs for %p",e)}finally{bt.trace("set multiaddrs for %p",e),bt("set release write lock"),n()}this.dispatchEvent(new oe(s2,{detail:{peerId:e,multiaddrs:o.addresses.map(a=>a.multiaddr),oldMultiaddrs:i==null?[]:i.addresses.map(({multiaddr:a})=>a)}})),s||this.dispatchEvent(new oe("peer",{detail:{id:e,multiaddrs:o.addresses.map(a=>a.multiaddr),protocols:o.protocols}}))}async add(e,t){if(e=Nr(e),!Array.isArray(t))throw bt.error("multiaddrs must be an array of Multiaddrs"),new L("multiaddrs must be an array of Multiaddrs",He.ERR_INVALID_PARAMETERS);bt.trace("add await write lock");const n=await this.store.lock.writeLock();bt.trace("add got write lock");let s,i,o;try{const a=await vm(e,t,this.addressFilter);if(a.length===0)return;try{if(i=await this.store.load(e),s=!0,new Set([...a.map(({multiaddr:c})=>c.toString()),...i.addresses.map(({multiaddr:c})=>c.toString())]).size===i.addresses.length)return}catch(c){if(c.code!==He.ERR_NOT_FOUND)throw c}o=await this.store.mergeOrCreate(e,{addresses:a}),bt("added multiaddrs for %p",e)}finally{bt.trace("set release write lock"),n()}this.dispatchEvent(new oe(s2,{detail:{peerId:e,multiaddrs:o.addresses.map(a=>a.multiaddr),oldMultiaddrs:i==null?[]:i.addresses.map(({multiaddr:a})=>a)}})),s===!0&&this.dispatchEvent(new oe("peer",{detail:{id:e,multiaddrs:o.addresses.map(a=>a.multiaddr),protocols:o.protocols}}))}async delete(e){e=Nr(e),bt.trace("delete await write lock");const t=await this.store.lock.writeLock();bt.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s}await this.store.patchOrCreate(e,{addresses:[]})}finally{bt.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new oe(s2,{detail:{peerId:e,multiaddrs:[],oldMultiaddrs:n==null?[]:n.addresses.map(({multiaddr:s})=>s)}}))}}async function vm(r,e,t,n=!1){const s=[];return await Promise.all(e.map(async i=>{if(!eK(i))throw bt.error("multiaddr must be an instance of Multiaddr"),new L("multiaddr must be an instance of Multiaddr",He.ERR_INVALID_PARAMETERS);await t(r,i)&&s.push({multiaddr:i,isCertified:n})})),s}const ao=U("libp2p:peer-store:key-book"),KD="change:pubkey";class sWe{constructor(e,t){this.dispatchEvent=e,this.store=t}async set(e,t){if(e=Nr(e),!(t instanceof Uint8Array))throw ao.error("publicKey must be an instance of Uint8Array to store data"),new L("publicKey must be an instance of PublicKey",He.ERR_INVALID_PARAMETERS);ao.trace("set await write lock");const n=await this.store.lock.writeLock();ao.trace("set got write lock");let s=!1,i;try{try{if(i=await this.store.load(e),i.pubKey!=null&&Ie(i.pubKey,t))return}catch(o){if(o.code!==He.ERR_NOT_FOUND)throw o}await this.store.patchOrCreate(e,{pubKey:t}),s=!0}finally{ao.trace("set release write lock"),n()}s&&this.dispatchEvent(new oe(KD,{detail:{peerId:e,publicKey:t,oldPublicKey:i?.pubKey}}))}async get(e){e=Nr(e),ao.trace("get await write lock");const t=await this.store.lock.readLock();ao.trace("get got write lock");try{return(await this.store.load(e)).pubKey}catch(n){if(n.code!==He.ERR_NOT_FOUND)throw n}finally{ao("get release write lock"),t()}}async delete(e){e=Nr(e),ao.trace("delete await write lock");const t=await this.store.lock.writeLock();ao.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s}await this.store.patchOrCreate(e,{pubKey:void 0})}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s}finally{ao.trace("delete release write lock"),t()}this.dispatchEvent(new oe(KD,{detail:{peerId:e,publicKey:void 0,oldPublicKey:n?.pubKey}}))}}const pr=U("libp2p:peer-store:metadata-book"),i2="change:metadata";class iWe{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){e=Nr(e),pr.trace("get await read lock");const t=await this.store.lock.readLock();pr.trace("get got read lock");try{return(await this.store.load(e)).metadata}catch(n){if(n.code!==He.ERR_NOT_FOUND)throw n}finally{pr.trace("get release read lock"),t()}return new Map}async getValue(e,t){e=Nr(e),pr.trace("getValue await read lock");const n=await this.store.lock.readLock();pr.trace("getValue got read lock");try{return(await this.store.load(e)).metadata.get(t)}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s}finally{pr.trace("getValue release write lock"),n()}}async set(e,t){if(e=Nr(e),!(t instanceof Map))throw pr.error("valid metadata must be provided to store data"),new L("valid metadata must be provided",He.ERR_INVALID_PARAMETERS);pr.trace("set await write lock");const n=await this.store.lock.writeLock();pr.trace("set got write lock");let s;try{try{s=await this.store.load(e)}catch(i){if(i.code!==He.ERR_NOT_FOUND)throw i}await this.store.mergeOrCreate(e,{metadata:t})}finally{pr.trace("set release write lock"),n()}this.dispatchEvent(new oe(i2,{detail:{peerId:e,metadata:t,oldMetadata:s==null?new Map:s.metadata}}))}async setValue(e,t,n){if(e=Nr(e),typeof t!="string"||!(n instanceof Uint8Array))throw pr.error("valid key and value must be provided to store data"),new L("valid key and value must be provided",He.ERR_INVALID_PARAMETERS);pr.trace("setValue await write lock");const s=await this.store.lock.writeLock();pr.trace("setValue got write lock");let i,o;try{try{i=await this.store.load(e);const a=i.metadata.get(t);if(a!=null&&Ie(n,a))return}catch(a){if(a.code!==He.ERR_NOT_FOUND)throw a}o=await this.store.mergeOrCreate(e,{metadata:new Map([[t,n]])})}finally{pr.trace("setValue release write lock"),s()}this.dispatchEvent(new oe(i2,{detail:{peerId:e,metadata:o.metadata,oldMetadata:i==null?new Map:i.metadata}}))}async delete(e){e=Nr(e),pr.trace("delete await write lock");const t=await this.store.lock.writeLock();pr.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s}n!=null&&await this.store.patch(e,{metadata:new Map})}finally{pr.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new oe(i2,{detail:{peerId:e,metadata:new Map,oldMetadata:n.metadata}}))}async deleteValue(e,t){e=Nr(e),pr.trace("deleteValue await write lock");const n=await this.store.lock.writeLock();pr.trace("deleteValue got write lock");let s,i;try{i=await this.store.load(e),s=i.metadata,s.delete(t),await this.store.patch(e,{metadata:s})}catch(o){if(o.code!==He.ERR_NOT_FOUND)throw o}finally{pr.trace("deleteValue release write lock"),n()}s!=null&&this.dispatchEvent(new oe(i2,{detail:{peerId:e,metadata:s,oldMetadata:i==null?new Map:i.metadata}}))}}const yr=U("libp2p:peer-store:proto-book"),o2="change:protocols";class oWe{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){yr.trace("get wait for read lock");const t=await this.store.lock.readLock();yr.trace("get got read lock");try{return(await this.store.load(e)).protocols}catch(n){if(n.code!==He.ERR_NOT_FOUND)throw n}finally{yr.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Nr(e),!Array.isArray(t))throw yr.error("protocols must be provided to store data"),new L("protocols must be provided",He.ERR_INVALID_PARAMETERS);yr.trace("set await write lock");const n=await this.store.lock.writeLock();yr.trace("set got write lock");let s,i;try{try{if(s=await this.store.load(e),new Set([...t]).size===s.protocols.length)return}catch(o){if(o.code!==He.ERR_NOT_FOUND)throw o}i=await this.store.patchOrCreate(e,{protocols:t}),yr("stored provided protocols for %p",e)}finally{yr.trace("set release write lock"),n()}this.dispatchEvent(new oe(o2,{detail:{peerId:e,protocols:i.protocols,oldProtocols:s==null?[]:s.protocols}}))}async add(e,t){if(e=Nr(e),!Array.isArray(t))throw yr.error("protocols must be provided to store data"),new L("protocols must be provided",He.ERR_INVALID_PARAMETERS);yr.trace("add await write lock");const n=await this.store.lock.writeLock();yr.trace("add got write lock");let s,i;try{try{if(s=await this.store.load(e),new Set([...s.protocols,...t]).size===s.protocols.length)return}catch(o){if(o.code!==He.ERR_NOT_FOUND)throw o}i=await this.store.mergeOrCreate(e,{protocols:t}),yr("added provided protocols for %p",e)}finally{yr.trace("add release write lock"),n()}this.dispatchEvent(new oe(o2,{detail:{peerId:e,protocols:i.protocols,oldProtocols:s==null?[]:s.protocols}}))}async remove(e,t){if(e=Nr(e),!Array.isArray(t))throw yr.error("protocols must be provided to store data"),new L("protocols must be provided",He.ERR_INVALID_PARAMETERS);yr.trace("remove await write lock");const n=await this.store.lock.writeLock();yr.trace("remove got write lock");let s,i;try{try{s=await this.store.load(e);const o=new Set(s.protocols);for(const a of t)o.delete(a);if(s.protocols.length===o.size)return;t=Array.from(o)}catch(o){if(o.code!==He.ERR_NOT_FOUND)throw o}i=await this.store.patchOrCreate(e,{protocols:t})}finally{yr.trace("remove release write lock"),n()}this.dispatchEvent(new oe(o2,{detail:{peerId:e,protocols:i.protocols,oldProtocols:s==null?[]:s.protocols}}))}async delete(e){e=Nr(e),yr.trace("delete await write lock");const t=await this.store.lock.writeLock();yr.trace("delete got write lock");let n;try{try{n=await this.store.load(e)}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s}await this.store.patchOrCreate(e,{protocols:[]})}finally{yr.trace("delete release write lock"),t()}n!=null&&this.dispatchEvent(new oe(o2,{detail:{peerId:e,protocols:[],oldProtocols:n.protocols}}))}}var pw;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const i of t.addresses)n.uint32(10),yw.codec().encode(i,n);if(t.protocols!=null)for(const i of t.protocols)n.uint32(18),n.string(i);if(t.metadata!=null)for(const i of t.metadata)n.uint32(26),gw.codec().encode(i,n);t.pubKey!=null&&(n.uint32(34),n.bytes(t.pubKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={addresses:[],protocols:[],metadata:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.addresses.push(yw.codec().decode(t,t.uint32()));break;case 2:s.protocols.push(t.string());break;case 3:s.metadata.push(gw.codec().decode(t,t.uint32()));break;case 4:s.pubKey=t.bytes();break;case 5:s.peerRecordEnvelope=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(pw||(pw={}));var yw;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={multiaddr:new Uint8Array(0)},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.multiaddr=t.bytes();break;case 2:s.isCertified=t.bool();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(yw||(yw={}));var gw;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key!==""&&(n.uint32(10),n.string(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={key:"",value:new Uint8Array(0)},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.key=t.string();break;case 2:s.value=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(gw||(gw={}));const qD=U("libp2p:peer-store:store"),HD="/peers/";class aWe{constructor(e){this.components=e,this.lock=Hv({name:"peer-store",singleProcess:!0})}_peerIdToDatastoreKey(e){if(e.type==null)throw qD.error("peerId must be an instance of peer-id to store data"),new L("peerId must be an instance of peer-id",He.ERR_INVALID_PARAMETERS);const t=e.toCID().toString();return new be(`${HD}${t}`)}async has(e){return await this.components.datastore.has(this._peerIdToDatastoreKey(e))}async delete(e){await this.components.datastore.delete(this._peerIdToDatastoreKey(e))}async load(e){const t=await this.components.datastore.get(this._peerIdToDatastoreKey(e)),n=pw.decode(t),s=new Map;for(const i of n.metadata)s.set(i.key,i.value);return{...n,id:e,addresses:n.addresses.map(({multiaddr:i,isCertified:o})=>({multiaddr:jD(i),isCertified:o??!1})),metadata:s,pubKey:n.pubKey??void 0,peerRecordEnvelope:n.peerRecordEnvelope??void 0}}async save(e){if(e.pubKey!=null&&e.id.publicKey!=null&&!Ie(e.pubKey,e.id.publicKey))throw qD.error("peer publicKey bytes do not match peer id publicKey bytes"),new L("publicKey bytes do not match peer id publicKey bytes",He.ERR_INVALID_PARAMETERS);const t=new Set,n=e.addresses.filter(o=>t.has(o.multiaddr.toString())?!1:(t.add(o.multiaddr.toString()),!0)).sort((o,a)=>o.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({multiaddr:o,isCertified:a})=>({multiaddr:o.bytes,isCertified:a})),s=[];[...e.metadata.keys()].sort().forEach(o=>{const a=e.metadata.get(o);a!=null&&s.push({key:o,value:a})});const i=pw.encode({addresses:n,protocols:e.protocols.sort(),pubKey:e.pubKey,metadata:s,peerRecordEnvelope:e.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(e.id),i.subarray()),await this.load(e.id)}async patch(e,t){const n=await this.load(e);return await this._patch(e,t,n)}async patchOrCreate(e,t){let n;try{n=await this.load(e)}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._patch(e,t,n)}async _patch(e,t,n){return await this.save({...n,...t,id:e})}async merge(e,t){const n=await this.load(e);return await this._merge(e,t,n)}async mergeOrCreate(e,t){let n;try{n=await this.load(e)}catch(s){if(s.code!==He.ERR_NOT_FOUND)throw s;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._merge(e,t,n)}async _merge(e,t,n){const s=new Map;return n.addresses.forEach(i=>{s.set(i.multiaddr.toString(),i.isCertified)}),(t.addresses??[]).forEach(i=>{const o=i.multiaddr.toString(),c=!!s.get(o)||i.isCertified;s.set(o,c)}),await this.save({id:e,addresses:Array.from(s.entries()).map(([i,o])=>({multiaddr:jD(i),isCertified:o})),protocols:Array.from(new Set([...n.protocols??[],...t.protocols??[]])),metadata:new Map([...n.metadata?.entries()??[],...t.metadata?.entries()??[]]),pubKey:t.pubKey??n?.pubKey,peerRecordEnvelope:t.peerRecordEnvelope??n?.peerRecordEnvelope})}async*all(){for await(const e of this.components.datastore.queryKeys({prefix:HD})){const t=e.toString().split("/")[2],n=Oc.decode(t);yield this.load(No(n))}}}var rc;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.tags!=null)for(const i of t.tags)n.uint32(10),ww.codec().encode(i,n);s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={tags:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.tags.push(ww.codec().decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(rc||(rc={}));var ww;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.name!=null&&t.name!==""&&(n.uint32(10),n.string(t.name)),t.value!=null&&(n.uint32(16),n.uint32(t.value)),t.expiry!=null&&(n.uint32(24),n.uint64(t.expiry)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={name:""},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.name=t.string();break;case 2:s.value=t.uint32();break;case 3:s.expiry=t.uint64();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(ww||(ww={}));const ei=U("libp2p:peer-store");class cWe extends Zt{constructor(e,t={}){super(),this.components=e,this.store=new aWe(e),this.addressBook=new nWe(this.dispatchEvent.bind(this),this.store,t.addressFilter),this.keyBook=new sWe(this.dispatchEvent.bind(this),this.store),this.metadataBook=new iWe(this.dispatchEvent.bind(this),this.store),this.protoBook=new oWe(this.dispatchEvent.bind(this),this.store)}async forEach(e){ei.trace("getPeers await read lock");const t=await this.store.lock.readLock();ei.trace("getPeers got read lock");try{for await(const n of this.store.all())n.id.equals(this.components.peerId)||e(n)}finally{ei.trace("getPeers release read lock"),t()}}async all(){const e=[];return await this.forEach(t=>{e.push(t)}),e}async delete(e){ei.trace("delete await write lock");const t=await this.store.lock.writeLock();ei.trace("delete got write lock");try{await this.store.delete(e)}finally{ei.trace("delete release write lock"),t()}}async get(e){ei.trace("get await read lock");const t=await this.store.lock.readLock();ei.trace("get got read lock");try{return await this.store.load(e)}finally{ei.trace("get release read lock"),t()}}async has(e){ei.trace("has await read lock");const t=await this.store.lock.readLock();ei.trace("has got read lock");try{return await this.store.has(e)}finally{ei.trace("has release read lock"),t()}}async tagPeer(e,t,n={}){const s=n.value??0,i=Math.round(s),o=n.ttl??void 0;if(i!==s||i<0||i>100)throw new L("Tag value must be between 0-100","ERR_TAG_VALUE_OUT_OF_BOUNDS");const a=await this.metadataBook.getValue(e,"tags");let c=[];a!=null&&(c=rc.decode(a).tags),c=c.filter(u=>u.name!==t),c.push({name:t,value:i,expiry:o==null?void 0:BigInt(Date.now()+o)}),await this.metadataBook.setValue(e,"tags",rc.encode({tags:c}).subarray())}async unTagPeer(e,t){const n=await this.metadataBook.getValue(e,"tags");let s=[];n!=null&&(s=rc.decode(n).tags),s=s.filter(i=>i.name!==t),await this.metadataBook.setValue(e,"tags",rc.encode({tags:s}).subarray())}async getTags(e){const t=await this.metadataBook.getValue(e,"tags");let n=[];t!=null&&(n=rc.decode(t).tags);const s=BigInt(Date.now()),i=n.filter(o=>o.expiry==null||o.expiry>s);return i.length!==n.length&&await this.metadataBook.setValue(e,"tags",rc.encode({tags:i}).subarray()),i.map(o=>({name:o.name,value:o.value??0}))}}class lWe{constructor(e){this.dht=e}async provide(e){await jr(this.dht.provide(e))}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await jr(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw T(new Error("Not found"),"ERR_NOT_FOUND")}}class uWe{constructor(e={}){this._started=!1,this._peerId=e.peerId,this._addressManager=e.addressManager,this._peerStore=e.peerStore,this._upgrader=e.upgrader,this._metrics=e.metrics,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._connectionGater=e.connectionGater,this._contentRouting=e.contentRouting,this._peerRouting=e.peerRouting,this._datastore=e.datastore,this._connectionProtector=e.connectionProtector,this._dht=e.dht,this._pubsub=e.pubsub,this._dialer=e.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter(e=>ol(e)).map(async e=>{e.beforeStart!=null&&await e.beforeStart()}))}async start(){await Promise.all(Object.values(this).filter(e=>ol(e)).map(async e=>{await e.start()})),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter(e=>ol(e)).map(async e=>{e.afterStart!=null&&await e.afterStart()}))}async beforeStop(){await Promise.all(Object.values(this).filter(e=>ol(e)).map(async e=>{e.beforeStop!=null&&await e.beforeStop()}))}async stop(){await Promise.all(Object.values(this).filter(e=>ol(e)).map(async e=>{await e.stop()})),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter(e=>ol(e)).map(async e=>{e.afterStop!=null&&await e.afterStop()}))}get peerId(){if(this._peerId==null)throw T(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(e){this._peerId=e}get addressManager(){if(this._addressManager==null)throw T(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(e){this._addressManager=e}get peerStore(){if(this._peerStore==null)throw T(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(e){this._peerStore=e}get upgrader(){if(this._upgrader==null)throw T(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(e){this._upgrader=e}get registrar(){if(this._registrar==null)throw T(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(e){this._registrar=e}get connectionManager(){if(this._connectionManager==null)throw T(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(e){this._connectionManager=e}get transportManager(){if(this._transportManager==null)throw T(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(e){this._transportManager=e}get connectionGater(){if(this._connectionGater==null)throw T(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(e){this._connectionGater=e}get contentRouting(){if(this._contentRouting==null)throw T(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(e){this._contentRouting=e}get peerRouting(){if(this._peerRouting==null)throw T(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(e){this._peerRouting=e}get datastore(){if(this._datastore==null)throw T(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(e){this._datastore=e}get connectionProtector(){return this._connectionProtector}set connectionProtector(e){this._connectionProtector=e}get dialer(){if(this._dialer==null)throw T(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(e){this._dialer=e}get metrics(){return this._metrics}set metrics(e){this._metrics=e}get dht(){return this._dht}set dht(e){this._dht=e}get pubsub(){return this._pubsub}set pubsub(e){this._pubsub=e}}var Fh=1e3,Vh=Fh*60,jh=Vh*60,Jl=jh*24,hWe=Jl*7,dWe=Jl*365.25,fWe=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return pWe(r);if(t==="number"&&isFinite(r))return e.long?gWe(r):yWe(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function pWe(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*dWe;case"weeks":case"week":case"w":return t*hWe;case"days":case"day":case"d":return t*Jl;case"hours":case"hour":case"hrs":case"hr":case"h":return t*jh;case"minutes":case"minute":case"mins":case"min":case"m":return t*Vh;case"seconds":case"second":case"secs":case"sec":case"s":return t*Fh;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function yWe(r){var e=Math.abs(r);return e>=Jl?Math.round(r/Jl)+"d":e>=jh?Math.round(r/jh)+"h":e>=Vh?Math.round(r/Vh)+"m":e>=Fh?Math.round(r/Fh)+"s":r+"ms"}function gWe(r){var e=Math.abs(r);return e>=Jl?a2(r,e,Jl,"day"):e>=jh?a2(r,e,jh,"hour"):e>=Vh?a2(r,e,Vh,"minute"):e>=Fh?a2(r,e,Fh,"second"):r+" ms"}function a2(r,e,t,n){var s=e>=t*1.5;return Math.round(r/t)+" "+n+(s?"s":"")}var wWe=tK,bWe=fWe,Qc=tK.prototype,mWe=new Date%1e9;function EWe(){return(Math.random()*1e9>>>0)+mWe++}function tK(r){r=r||{},this.id=r.id||EWe(),this.max=r.max||1/0,this.items=r.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(r.lastModified||new Date);for(var e,t,n=this.items.length;n--;)e=this.items[n],t=new Date(e.expires)-new Date,this._lookup[e.key]=e,t>0?this.expire(e.key,t):t<=0&&this.delete(e.key)}Qc.has=function(r){return r in this._lookup};Qc.get=function(r){if(!this.has(r))return null;var e=this._lookup[r];return e.refresh&&this.expire(r,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value};Qc.meta=function(r){if(!this.has(r))return null;var e=this._lookup[r];return"meta"in e?e.meta:null};Qc.set=function(r,e,t){var n=this._lookup[r],s=this._lookup[r]={key:r,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,s)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(s),this.size++),t&&("ttl"in t&&this.expire(r,t.ttl),"meta"in t&&(s.meta=t.meta),t.refresh&&(s.refresh=t.ttl)),this};Qc.delete=function(r){var e=this._lookup[r];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[r],this.size--,this):!1};Qc.expire=function(r,e){var t=e||0,n=this._lookup[r];if(!n)return this;if(typeof t=="string"&&(t=bWe(e)),typeof t!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),t),n.expires=Number(new Date)+t,this};Qc.clear=function(){for(var r=this.items.length;r--;)this.delete(this.items[r].key);return this};Qc.toJSON=function(){for(var r=new Array(this.items.length),e,t=r.length;t--;)e=this.items[t],r[t]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:r}};const GD=Et(wWe),vWe=globalThis.fetch,_We=globalThis.Headers;function _m(r,e,t){return`${r}?name=${e}&type=${t}`}async function SWe(r,e){return await(await vWe(r,{headers:new _We({accept:"application/dns-json"}),signal:e})).json()}function Mu(r,e){return`${e}_${r}`}const Sm=Object.assign(_e("dns-over-http-resolver"),{error:_e("dns-over-http-resolver:error")});class AWe{constructor(e={}){this._cache=new GD({max:e?.maxCache??100}),this._TXTcache=new GD({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??SWe,this._abortControllers=[]}cancel(){this._abortControllers.forEach(e=>e.abort())}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*t),s=e[t];e[t]=e[n],e[n]=s}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",n=this._cache.get(Mu(e,t));if(n!=null)return n;let s=!1;for(const i of this._getShuffledServers()){const o=new AbortController;this._abortControllers.push(o);try{const a=await this._request(_m(i,e,t),o.signal),c=a.Answer.map(l=>l.data),u=Math.min(...a.Answer.map(l=>l.TTL));return this._cache.set(Mu(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(s=!0),Sm.error(`${i} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw s?Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",n=this._cache.get(Mu(e,t));if(n!=null)return n;let s=!1;for(const i of this._getShuffledServers()){const o=new AbortController;this._abortControllers.push(o);try{const a=await this._request(_m(i,e,t),o.signal),c=a.Answer.map(l=>l.data),u=Math.min(...a.Answer.map(l=>l.TTL));return this._cache.set(Mu(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(s=!0),Sm.error(`${i} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw s?Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",n=this._TXTcache.get(Mu(e,t));if(n!=null)return n;let s=!1;for(const i of this._getShuffledServers()){const o=new AbortController;this._abortControllers.push(o);try{const a=await this._request(_m(i,e,t),o.signal),c=a.Answer.map(l=>[l.data.replace(/['"]+/g,"")]),u=Math.min(...a.Answer.map(l=>l.TTL));return this._TXTcache.set(Mu(e,t),c,{ttl:u}),c}catch{o.signal.aborted&&(s=!0),Sm.error(`${i} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw s?Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}const{code:$We}=Ht("dnsaddr");async function TWe(r,e={}){const t=new AWe;e.signal!=null&&e.signal.addEventListener("abort",()=>{t.cancel()});const n=r.getPeerId(),[,s]=r.stringTuples().find(([a])=>a===$We)??[];if(s==null)throw new Error("No hostname found in multiaddr");let o=(await t.resolveTxt(`_dnsaddr.${s}`)).flat().map(a=>a.split("=")[1]).filter(Boolean);return n!=null&&(o=o.filter(a=>a.includes(n))),o}const rK=3e4,IWe=3e4,nK=100,sK=4,RWe=25,CWe={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:nK,maxDialsPerPeer:sK,dialTimeout:rK,inboundUpgradeTimeout:IWe,resolvers:{dnsaddr:TWe},addressSorter:E_},connectionGater:{},transportManager:{faultTolerance:hh.FATAL_ALL},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:lKe,enabled:!1,ttl:uKe},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:Fj},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};function xWe(r){const e=kt(CWe,r);if(e.transports==null||e.transports.length<1)throw T(new Error(st.ERR_TRANSPORTS_REQUIRED),O.ERR_TRANSPORTS_REQUIRED);if(e.connectionEncryption==null||e.connectionEncryption.length===0)throw T(new Error(st.CONN_ENCRYPTION_REQUIRED),O.CONN_ENCRYPTION_REQUIRED);if(e.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw T(new Error(st.ERR_PROTECTOR_REQUIRED),O.ERR_PROTECTOR_REQUIRED);return e.identify.host.agentVersion===Fj&&(DO||PO?e.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(b1||O7||OO||Nq)&&(e.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),e}var WD;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.id!=null&&(n.uint32(10),n.bytes(t.id)),t.pubKey!=null&&(n.uint32(18),n.bytes(t.pubKey)),t.privKey!=null&&(n.uint32(26),n.bytes(t.privKey)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.id=t.bytes();break;case 2:s.pubKey=t.bytes();break;case 3:s.privKey=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(WD||(WD={}));const iK=async()=>{const r=await qE("Ed25519"),e=await oK(r);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)},DWe=async r=>{const e=await qE("RSA",r?.bits??2048),t=await oK(e);if(t.type==="RSA")return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)};async function oK(r){return vi(HE(r.public),bue(r))}class PWe extends Zt{get[n0](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}get lan(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}get(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}findProviders(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}findPeer(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}getClosestPeers(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}provide(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}put(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}async getMode(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}async setMode(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}async refreshRoutingTable(){throw T(new Error(st.DHT_DISABLED),O.DHT_DISABLED)}}class OWe extends Zt{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}get multicodecs(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}getPeers(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}getTopics(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}subscribe(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}unsubscribe(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}getSubscribers(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}async publish(){throw T(new Error(st.PUBSUB_DISABLED),O.ERR_PUBSUB_DISABLED)}}var kWe=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const QD=kWe;var NWe=class{constructor(e){this.hwm=e||16,this.head=new QD(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const t=this.head;this.head=t.next=new QD(2*this.head.buffer.length),this.head.push(e)}}shift(){this.length!==0&&this.length--;const e=this.tail.shift();if(e===void 0&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return e}peek(){const e=this.tail.peek();return e===void 0&&this.tail.next?this.tail.next.peek():e}isEmpty(){return this.length===0}};const LWe=()=>{const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r};var MWe=LWe;const YD=NWe,XD=MWe;var UWe=class{constructor(){this._buffer=new YD,this._waitingConsumers=new YD}push(e){const{promise:t,resolve:n}=XD();return this._buffer.push({chunk:e,resolve:n}),this._consume(),t}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){const{promise:e,resolve:t}=XD();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}};const BWe=Et(UWe),JD=U("libp2p:dialer:dial-request");class zWe{constructor(e){const{addrs:t,dialAction:n,dialer:s}=e;this.addrs=t,this.dialer=s,this.dialAction=n}async run(e={}){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw T(new Error("No dial tokens available"),O.ERR_NO_DIAL_TOKENS);const n=new BWe;for(const a of t)n.push(a).catch(c=>{JD.error(c)});const s=this.addrs.map(()=>{const a=new AbortController;try{Rt.setMaxListeners?.(1/0,a.signal)}catch{}return a});if(e.signal!=null)try{Rt.setMaxListeners?.(1/0,e.signal)}catch{}let i=0,o=!1;try{return await Promise.any(this.addrs.map(async(a,c)=>{const u=await n.shift();if(o)throw this.dialer.releaseToken(t.splice(t.indexOf(u),1)[0]),T(new Error("dialAction already succeeded"),O.ERR_ALREADY_SUCCEEDED);const l=s[c];if(l==null)throw T(new Error("dialAction did not come with an AbortController"),O.ERR_INVALID_PARAMETERS);let h;try{const f=l.signal;h=await this.dialAction(a,{...e,signal:e.signal!=null?Io([f,e.signal]):f}),s[c]=void 0}finally{i++,this.addrs.length-i>=t.length?n.push(u).catch(f=>{JD.error(f)}):this.dialer.releaseToken(t.splice(t.indexOf(u),1)[0])}if(h==null)throw T(new Error("dialAction led to empty object"),O.ERR_TRANSPORT_DIAL_FAILED);return o=!0,h}))}finally{s.forEach(a=>{a!==void 0&&a.abort()}),t.forEach(a=>this.dialer.releaseToken(a))}}}const co=U("libp2p:dialer");class FWe{constructor(e,t={}){this.started=!1,this.addressSorter=t.addressSorter??E_,this.maxAddrsToDial=t.maxAddrsToDial??RWe,this.timeout=t.dialTimeout??rK,this.maxDialsPerPeer=t.maxDialsPerPeer??sK,this.tokens=[...new Array(t.maxParallelDials??nK)].map((n,s)=>s),this.components=e,this.pendingDials=Xl({name:"libp2p_dialler_pending_dials",metrics:e.metrics}),this.pendingDialTargets=Xl({name:"libp2p_dialler_pending_dial_targets",metrics:e.metrics});for(const[n,s]of Object.entries(t.resolvers??{}))GV.set(n,s)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(const e of this.pendingDials.values())try{e.controller.abort()}catch(t){co.error(t)}this.pendingDials.clear();for(const e of this.pendingDialTargets.values())e.abort();this.pendingDialTargets.clear()}async dial(e,t={}){const{peerId:n,multiaddr:s}=ZV(e);if(n!=null){if(this.components.peerId.equals(n))throw T(new Error("Tried to dial self"),O.ERR_DIALED_SELF);if(s!=null&&(co("storing multiaddrs %p",n,s),await this.components.peerStore.addressBook.add(n,[s])),await this.components.connectionGater.denyDialPeer(n))throw T(new Error("The dial request is blocked by gater.allowDialPeer"),O.ERR_PEER_DIAL_INTERCEPTED)}co("creating dial target for %p",n);const i=new AbortController,o=ZD();this.pendingDialTargets.set(o,i);let a=i.signal;t.signal!=null&&(a=Io([a,t.signal]));let c;try{c=await this._createDialTarget({peerId:n,multiaddr:s},{...t,signal:a})}finally{this.pendingDialTargets.delete(o)}if(c.addrs.length===0)throw T(new Error("The dial request has no valid addresses"),O.ERR_NO_VALID_ADDRESSES);const u=this.pendingDials.get(c.id)??this._createPendingDial(c,t);try{const l=await u.promise;return co("dial succeeded to %s",c.id),l}catch(l){throw co("dial failed to %s",c.id,l),u.controller.signal.aborted&&(l.code=O.ERR_TIMEOUT),co.error(l),l}finally{u.destroy()}}async _createDialTarget(e,t){let n=[];if(kl(e.multiaddr)&&n.push(e.multiaddr),!kl(e.multiaddr)&&ua(e.peerId)&&n.push(...await this._loadAddresses(e.peerId)),n=(await Promise.all(n.map(async i=>await this._resolve(i,t)))).flat().filter(i=>!!this.components.transportManager.transportForMultiaddr(i)),n=[...new Set(n.map(i=>i.toString()))].map(i=>ur(i)),n.length>this.maxAddrsToDial)throw T(new Error("dial with more addresses than allowed"),O.ERR_TOO_MANY_ADDRESSES);const s=ua(e.peerId)?e.peerId:void 0;if(s!=null){const i=`/p2p/${s.toString()}`;n=n.map(o=>{const a=o.getPeerId();return a==null||!s.equals(a)?o.encapsulate(i):o})}return{id:s==null?ZD():s.toString(),addrs:n}}async _loadAddresses(e){const t=await this.components.peerStore.addressBook.get(e);return(await Promise.all(t.map(async n=>await this.components.connectionGater.denyDialMultiaddr(e,n.multiaddr)?!1:n))).filter(VWe).sort(this.addressSorter).map(n=>n.multiaddr)}_createPendingDial(e,t={}){const n=async(u,l={})=>{if(l.signal?.aborted===!0)throw T(new Error("already aborted"),O.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(u,l).catch(h=>{throw co.error("dial to %s failed",u,h),h})},s=new zWe({addrs:e.addrs,dialAction:n,dialer:this}),i=new Xt.TimeoutController(this.timeout),o=[i.signal];t.signal!=null&&o.push(t.signal);const a=Io(o);try{Rt.setMaxListeners?.(1/0,a)}catch{}const c={dialRequest:s,controller:i,promise:s.run({...t,signal:a}),destroy:()=>{i.clear(),this.pendingDials.delete(e.id)}};return this.pendingDials.set(e.id,c),c}getTokens(e){const t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),n=this.tokens.splice(0,t);return co("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),n}releaseToken(e){this.tokens.includes(e)||(co("token %d released",e),this.tokens.push(e))}async _resolve(e,t){if(!e.protoNames().includes("dnsaddr"))return[e];const s=await this._resolveRecord(e,t);return(await Promise.all(s.map(async a=>await this._resolve(a,t)))).flat().reduce((a,c)=>(a.find(u=>u.equals(c))==null&&a.push(c),a),[])}async _resolveRecord(e,t){try{return e=ur(e.toString()),await e.resolve(t)}catch(n){return co.error(`multiaddr ${e.toString()} could not be resolved`,n),[]}}}function VWe(r){return!!r}function ZD(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}const Go=U("libp2p");class jWe extends Zt{constructor(e){super(),this.started=!1,this.peerId=e.peerId;const t=this.components=new uWe({peerId:e.peerId,datastore:e.datastore??new Yde,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...e.connectionGater}});t.peerStore=new cWe(t,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore}),this.services=[t],e.metrics!=null&&(this.metrics=this.components.metrics=this.configureComponent(e.metrics(this.components))),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",o=>{const{detail:a}=o;this.dispatchEvent(new oe("peer:discovery",{detail:a}))}),e.connectionProtector!=null&&(this.components.connectionProtector=e.connectionProtector(t)),this.components.upgrader=new qqe(this.components,{connectionEncryption:(e.connectionEncryption??[]).map(o=>this.configureComponent(o(this.components))),muxers:(e.streamMuxers??[]).map(o=>this.configureComponent(o(this.components))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new FWe(this.components,e.connectionManager),this.connectionManager=this.components.connectionManager=new qFe(this.components,e.connectionManager),this.components.connectionManager.addEventListener("peer:disconnect",o=>{this.dispatchEvent(new oe("peer:disconnect",{detail:o.detail}))}),this.components.connectionManager.addEventListener("peer:connect",o=>{this.dispatchEvent(new oe("peer:connect",{detail:o.detail}))}),this.registrar=this.components.registrar=new Vqe(this.components),this.components.transportManager=new yqe(this.components,e.transportManager),this.components.addressManager=new MFe(this.components,e.addresses),this.configureComponent(new hHe(this.components)),this.configureComponent(new GFe(this.components,{enabled:e.connectionManager.autoDial,minConnections:e.connectionManager.minConnections,autoDialInterval:e.connectionManager.autoDialInterval}));const n=cw.generateOptions();this.keychain=this.configureComponent(new cw(this.components,{...n,...e.keychain})),this.services.push(new lHe(this.components,e.nat)),e.transports.forEach(o=>{this.components.transportManager.add(this.configureComponent(o(this.components)))}),this.identifyService=new x_(this.components,{...e.identify}),this.configureComponent(this.identifyService),e.dht!=null?this.dht=this.components.dht=e.dht(this.components):this.dht=new PWe,e.pubsub!=null?this.pubsub=this.components.pubsub=e.pubsub(this.components):this.pubsub=new OWe;const s=(e.peerRouters??[]).map(o=>this.configureComponent(o(this.components)));e.dht!=null&&(s.push(this.configureComponent(new dHe(this.dht))),this.dht.addEventListener("peer",o=>{this.onDiscoveryPeer(o)})),this.peerRouting=this.components.peerRouting=this.configureComponent(new kFe(this.components,{...e.peerRouting,routers:s}));const i=(e.contentRouters??[]).map(o=>this.configureComponent(o(this.components)));e.dht!=null&&i.push(this.configureComponent(new lWe(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new NFe(this.components,{routers:i})),e.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new cKe(this.components,e.relay))),this.configureComponent(new AKe(this.components,{addressSorter:e.connectionManager.addressSorter,...e.relay}))),this.fetchService=this.configureComponent(new eHe(this.components,{...e.fetch})),this.pingService=this.configureComponent(new sHe(this.components,{...e.ping}));for(const o of e.peerDiscovery??[])this.configureComponent(o(this.components)).addEventListener("peer",c=>{this.onDiscoveryPeer(c)})}configureComponent(e){return ol(e)&&this.services.push(e),e}async start(){if(!this.started){this.started=!0,Go("libp2p is starting");try{await Promise.all(this.services.map(async e=>{e.beforeStart!=null&&await e.beforeStart()})),await Promise.all(this.services.map(e=>e.start())),await Promise.all(this.services.map(async e=>{e.afterStart!=null&&await e.afterStart()})),Go("libp2p has started")}catch(e){throw Go.error("An error occurred starting libp2p",e),await this.stop(),e}}}async stop(){this.started&&(Go("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map(async e=>{e.beforeStop!=null&&await e.beforeStop()})),await Promise.all(this.services.map(e=>e.stop())),await Promise.all(this.services.map(async e=>{e.afterStop!=null&&await e.afterStop()})),Go("libp2p has stopped"))}isStarted(){return this.started}getConnections(e){return this.components.connectionManager.getConnections(e)}getPeers(){const e=new Pc;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return await this.components.connectionManager.openConnection(e,t)}async dialProtocol(e,t,n={}){if(t==null)throw T(new Error("no protocols were provided to open a stream"),O.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(t=Array.isArray(t)?t:[t],t.length===0)throw T(new Error("no protocols were provided to open a stream"),O.ERR_INVALID_PROTOCOLS_FOR_STREAM);return await(await this.dial(e,n)).newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e){kl(e)&&(e=Ae(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e)}async getPublicKey(e,t={}){if(Go("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;const n=await this.peerStore.get(e);if(n.pubKey!=null)return n.pubKey;if(this.dht==null)throw T(new Error("Public key was not in the peer store and the DHT is not enabled"),O.ERR_NO_ROUTERS_AVAILABLE);const s=z([M("/pk/"),e.multihash.digest]);for await(const i of this.dht.get(s,t))if(i.name==="VALUE"){const o=Fl(i.value);return await this.peerStore.keyBook.set(e,i.value),o.bytes}throw T(new Error(`Node not responding with its public key: ${e.toString()}`),O.ERR_INVALID_RECORD)}async fetch(e,t,n={}){if(kl(e)){const s=Ae(e.getPeerId()??"");await this.components.peerStore.addressBook.add(s,[e]),e=s}return await this.fetchService.fetch(e,t,n)}async ping(e,t={}){if(kl(e)){const n=Ae(e.getPeerId()??"");await this.components.peerStore.addressBook.add(n,[e]),e=n}return await this.pingService.ping(e,t)}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async s=>{await this.components.registrar.handle(s,t,n)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async t=>{await this.components.registrar.unhandle(t)}))}async register(e,t){return await this.registrar.register(e,t)}unregister(e){this.registrar.unregister(e)}onDiscoveryPeer(e){const{detail:t}=e;if(t.id.toString()===this.peerId.toString()){Go.error(new Error(O.ERR_DISCOVERED_SELF));return}t.multiaddrs.length>0&&this.components.peerStore.addressBook.add(t.id,t.multiaddrs).catch(n=>Go.error(n)),t.protocols.length>0&&this.components.peerStore.protoBook.set(t.id,t.protocols).catch(n=>Go.error(n)),this.dispatchEvent(new oe("peer:discovery",{detail:t}))}}async function KWe(r){if(r.peerId==null){const e=r.datastore;if(e!=null)try{const t=new cw({datastore:e},{...cw.generateOptions(),...r.keychain??{}});r.peerId=await t.exportPeerId("self")}catch(t){if(t.code!=="ERR_NOT_FOUND")throw t}}return r.peerId==null&&(r.peerId=await iK()),new jWe(xWe(r))}async function qWe(r){const e=await KWe(r);return r.start!==!1&&await e.start(),e}const HWe=Lq(),{EventEmitter:GWe}=Rt;function eP(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;++t)if(r[t]!==e[t])return!1;return!0}function Am(){return{contacts:[],dontSplit:!1,left:null,right:null}}function Df(r,e){if(!(e instanceof Uint8Array))throw new TypeError(r+" is not a Uint8Array")}class bw extends GWe{constructor(e={}){super(),this.localNodeId=e.localNodeId||HWe(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||bw.distance,this.arbiter=e.arbiter||bw.arbiter,this.metadata=Object.assign({},e.metadata),Df("option.localNodeId as parameter 1",this.localNodeId),this.root=Am()}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let n=0,s=0;const i=Math.min(e.length,t.length),o=Math.max(e.length,t.length);for(;s<i;++s)n=n*256+(e[s]^t[s]);for(;s<o;++s)n=n*256+255;return n}add(e){Df("contact.id",(e||{}).id);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e.id,t++);const s=this._indexOf(n,e.id);return s>=0?(this._update(n,s,e),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(e),this.emit("added",e),this):n.dontSplit?(this.emit("ping",n.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(n,t),this.add(e))}closest(e,t=1/0){if(Df("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let n=[];for(let s=[this.root],i=0;s.length>0&&n.length<t;){const o=s.pop();if(o.contacts===null){const a=this._determineNode(o,e,i++);s.push(o.left===a?o.right:o.left),s.push(a)}else n=n.concat(o.contacts)}return n.map(s=>[this.distance(s.id,e),s]).sort((s,i)=>s[0]-i[0]).slice(0,t).map(s=>s[1])}count(){let e=0;for(const t=[this.root];t.length>0;){const n=t.pop();n.contacts===null?t.push(n.right,n.left):e+=n.contacts.length}return e}_determineNode(e,t,n){const s=n>>3,i=n%8;return t.length<=s&&i!==0?e.left:t[s]&1<<7-i?e.right:e.left}get(e){Df("id",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);const s=this._indexOf(n,e);return s>=0?n.contacts[s]:null}_indexOf(e,t){for(let n=0;n<e.contacts.length;++n)if(eP(e.contacts[n].id,t))return n;return-1}remove(e){Df("the id as parameter 1",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);const s=this._indexOf(n,e);if(s>=0){const i=n.contacts.splice(s,1)[0];this.emit("removed",i)}return this}_split(e,t){e.left=Am(),e.right=Am();for(const i of e.contacts)this._determineNode(e,i.id,t).contacts.push(i);e.contacts=null;const n=this._determineNode(e,this.localNodeId,t),s=e.left===n?e.right:e.left;s.dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const n=t.pop();n.contacts===null?t.push(n.right,n.left):e=e.concat(n.contacts)}return e}*toIterable(){for(const e=[this.root];e.length>0;){const t=e.pop();t.contacts===null?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,n){if(!eP(e.contacts[t].id,n.id))throw new Error("wrong index for _update");const s=e.contacts[t],i=this.arbiter(s,n);i===s&&s!==n||(e.contacts.splice(t,1),e.contacts.push(i),this.emit("updated",s,i))}}var WWe=bw;const QWe=Et(WWe),YWe=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},L_=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},XWe=r=>new TextEncoder().encode(r),JWe=r=>new TextDecoder().decode(r);var ZWe=aK,tP=128,eQe=127,tQe=~eQe,rQe=Math.pow(2,31);function aK(r,e,t){e=e||[],t=t||0;for(var n=t;r>=rQe;)e[t++]=r&255|tP,r/=128;for(;r&tQe;)e[t++]=r&255|tP,r>>>=7;return e[t]=r|0,aK.bytes=t-n+1,e}var nQe=J8,sQe=128,rP=127;function J8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw J8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&rP)<<s:(o&rP)*Math.pow(2,s),s+=7}while(o>=sQe);return J8.bytes=i-n,t}var iQe=Math.pow(2,7),oQe=Math.pow(2,14),aQe=Math.pow(2,21),cQe=Math.pow(2,28),lQe=Math.pow(2,35),uQe=Math.pow(2,42),hQe=Math.pow(2,49),dQe=Math.pow(2,56),fQe=Math.pow(2,63),pQe=function(r){return r<iQe?1:r<oQe?2:r<aQe?3:r<cQe?4:r<lQe?5:r<uQe?6:r<hQe?7:r<dQe?8:r<fQe?9:10},yQe={encode:ZWe,decode:nQe,encodingLength:pQe},mw=yQe;const Z8=(r,e=0)=>[mw.decode(r,e),mw.decode.bytes],Ew=(r,e,t=0)=>(mw.encode(r,e,t),e),vw=r=>mw.encodingLength(r),e7=(r,e)=>{const t=e.byteLength,n=vw(r),s=n+vw(t),i=new Uint8Array(s+t);return Ew(r,i,0),Ew(t,i,n),i.set(e,s),new M_(r,t,e,i)},cK=r=>{const e=L_(r),[t,n]=Z8(e),[s,i]=Z8(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new M_(t,s,o,e)},gQe=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&YWe(r.bytes,t.bytes)}};let M_=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const wQe=({name:r,code:e,encode:t})=>new bQe(r,e,t);let bQe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?e7(this.code,t):t.then(n=>e7(this.code,n))}else throw Error("Unknown type, must be binary type")}};const mQe=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),lK=wQe({name:"sha2-256",code:18,encode:mQe("SHA-256")}),f3=1e3,U_=60*f3,B_=60*U_,EQe=36*B_,vQe="/lan",_Qe="/ipfs",SQe="/kad/1.0.0",AQe="/dht/record",uK="/dht/provider",$Qe=256,TQe=24*B_,IQe=B_,t7=20,_w=3,RQe=Number(5*U_),CQe=Number(30*f3),xQe=Number(5*U_),DQe=Number(30*f3),PQe=Number(30*f3),OQe=M("/pk/");function z_(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const s=c3(n);return s==null?!0:!s})}}function F_(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(n==="localhost")return!0;if(t!==4&&t!==6||n==null)return!1;const s=c3(n);return s??!1})}}async function Kh(r){return(await lK.digest(r)).digest}async function la(r){return await Kh(r.toBytes())}function th(r){return new be(`${AQe}/${R(r,"base32")}`,!1)}function kQe(r){return z([OQe,r.toBytes()])}function NQe(r){return R(r.subarray(0,4))==="/pk/"}function LQe(r){return No(r.subarray(4))}function nP(r,e){const t=new Date;return new os(r,e,t).serialize()}function MQe(r,e=100){let t;return()=>{clearTimeout(t),t=setTimeout(()=>{r()},e)}}const UQe="kad-close",BQe=50,sP=20,zQe=1e4,FQe=10;class VQe{constructor(e,t){const{kBucketSize:n,pingTimeout:s,lan:i,pingConcurrency:o,protocol:a,tagName:c,tagValue:u}=t;this.components=e,this.log=U(`libp2p:kad-dht:${i?"lan":"wan"}:routing-table`),this.kBucketSize=n??sP,this.pingTimeout=s??zQe,this.pingConcurrency=o??FQe,this.lan=i,this.running=!1,this.protocol=a,this.tagName=c??UQe,this.tagValue=u??BQe;const l=()=>{this.metrics?.pingQueueSize.update(this.pingQueue.size),this.metrics?.pingRunning.update(this.pingQueue.pending)};this.pingQueue=new Cr({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",l),this.pingQueue.addListener("next",l),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_routing_table_size`),pingQueueSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_queue_size`),pingRunning:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_running`)});const e=new QWe({localNodeId:await la(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.on("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new Pc;const n=MQe(()=>{const s=new Pc(e.closest(e.localNodeId,sP).map(a=>a.peer)),i=s.difference(t),o=t.difference(s);Promise.resolve().then(async()=>{for(const a of i)await this.components.peerStore.tagPeer(a,this.tagName,{value:this.tagValue});for(const a of o)await this.components.peerStore.unTagPeer(a,this.tagName)}).catch(a=>{this.log.error("Could not update peer tags",a)}),t=s});e.on("added",()=>{n()}),e.on("removed",()=>{n()})}_onPing(e,t){this.pingQueue.add(async()=>{if(!this.running)return;let n=0;try{await Promise.all(e.map(async s=>{let i;try{i=new Xt.TimeoutController(this.pingTimeout);const o={signal:i.signal};this.log("pinging old contact %p",s.peer),(await(await this.components.connectionManager.openConnection(s.peer,o)).newStream(this.protocol,o)).close(),n++}catch(o){this.running&&this.kb!=null&&(this.log.error("could not ping peer %p",s.peer,o),this.log("evicting old contact after ping failed %p",s),this.kb.remove(s.id))}finally{i?.clear(),this.metrics?.routingTableSize.update(this.size)}})),this.running&&n<e.length&&this.kb!=null&&(this.log("adding new contact %p",t.peer),this.kb.add(t))}catch(s){this.log.error("could not process k-bucket ping event",s)}}).catch(n=>{this.log.error("could not process k-bucket ping event",n)})}get size(){return this.kb==null?0:this.kb.count()}async find(e){const t=await la(e),n=this.closestPeer(t);if(n!=null&&e.equals(n))return n}closestPeer(e){const t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return this.kb==null?[]:this.kb.closest(e,t).map(s=>s.peer)}async add(e){if(this.kb==null)throw new Error("RoutingTable is not started");const t=await la(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),this.metrics?.routingTableSize.update(this.size)}async remove(e){if(this.kb==null)throw new Error("RoutingTable is not started");const t=await la(e);this.kb.remove(t),this.metrics?.routingTableSize.update(this.size)}}const jQe=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],c2=15;class KQe{constructor(e){const{peerRouting:t,routingTable:n,refreshInterval:s,refreshQueryTimeout:i,lan:o}=e;this.log=U(`libp2p:kad-dht:${o?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=n,this.refreshInterval=s??xQe,this.refreshQueryTimeout=i??DQe,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(s=>s.toISOString()).join(", ")} ]`),Promise.all(n.map(async(s,i)=>{try{if(await this._refreshCommonPrefixLength(i,s,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(i+1),n.length-1);for(let a=i+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,s,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(s=>{this.log.error(s)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(s=>{this.log.error(s)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const s=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,s,this.routingTable.size);const i=new Xt.TimeoutController(this.refreshQueryTimeout);try{const o=await Oh(this.peerRouting.getClosestPeers(s.toBytes(),{signal:i.signal}));this.log(`found ${o} peers that were close to imaginary peer %p`,s),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,s,this.routingTable.size)}finally{i.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>c2&&(e=c2);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");const t=Pp(2),n=(t[1]<<8)+t[0],s=await this._makePeerId(this.routingTable.kb.localNodeId,n,e);return No(s)}async _makePeerId(e,t,n){if(n>c2)throw new Error(`Cannot generate peer ID for common prefix length greater than ${c2}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,u=jQe[c],l=new ArrayBuffer(34),h=new DataView(l,0,l.byteLength);return h.setUint8(0,lK.code),h.setUint8(1,32),h.setUint32(2,u,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb!=null)for(const{id:e}of this.routingTable.kb.toIterable()){const t=E1(this.routingTable.kb.localNodeId,e);let n=0;for(const s of t)if(s===0)n++;else break;yield n}}}function qQe(r){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}const p3=r=>{const e=Jt.encodingLength(r),t=qQe(e);return Jt.encode(r,t),p3.bytes=e,t};p3.bytes=0;function Sw(r){r=r??{};const e=r.lengthEncoder??p3;return async function*(n){for await(const s of n){const i=e(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}}}Sw.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??p3;return new Se(t(r.byteLength),r)};const HQe=8,GQe=1024*1024*4;var dl;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(dl||(dl={}));const V_=r=>{const e=Jt.decode(r);return V_.bytes=Jt.encodingLength(e),e};V_.bytes=0;function Aw(r){return async function*(t){const n=new Se;let s=dl.LENGTH,i=-1;const o=r?.lengthDecoder??V_,a=r?.maxLengthLength??HQe,c=r?.maxDataLength??GQe;for await(const u of t)for(n.append(u);n.byteLength>0;){if(s===dl.LENGTH)try{if(i=o(n),i<0)throw T(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>c)throw T(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const l=o.bytes;n.consume(l),r?.onLength!=null&&r.onLength(i),s=dl.DATA}catch(l){if(l instanceof RangeError){if(n.byteLength>a)throw T(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(s===dl.DATA){if(n.byteLength<i)break;const l=n.sublist(0,i);n.consume(i),r?.onData!=null&&r.onData(l),yield l,s=dl.LENGTH}}if(n.byteLength>0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}Aw.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return Aw({...e??{},onLength:i=>{t=i}})(n)};const iP=mi,WQe=Ei,hK=function(r){let e=0;if(r=r.toString().trim(),iP(r)){const t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(WQe(r)){const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=iP(t[n]);let o;i&&(o=hK(t[n]),t[n]=R(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,R(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){const i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},QQe=function(r,e=0,t){e=~~e,t=t??r.length-e;const n=new DataView(r.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},ti=-1,$w={},r7={},YQe=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ti,"ip6zone"],[43,8,"ipcidr"],[53,ti,"dns",!0],[54,ti,"dns4",!0],[55,ti,"dns6",!0],[56,ti,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[281,0,"webrtc-w3c"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ti,"unix",!1,!0],[421,ti,"ipfs"],[421,ti,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ti,"garlic64"],[448,0,"tls"],[449,ti,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,ti,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ti,"memory"]];YQe.forEach(r=>{const e=XQe(...r);r7[e.code]=e,$w[e.name]=e});function XQe(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function lr(r){if(typeof r=="number"){if(r7[r]!=null)return r7[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if($w[r]!=null)return $w[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}function JQe(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var ZQe=JQe,eYe=ZQe;let tYe=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},rYe=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return dK(this,e)}},nYe=class{constructor(e){this.decoders=e}or(e){return dK(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const dK=(r,e)=>new nYe({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let sYe=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new tYe(e,t,n),this.decoder=new rYe(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const y3=({name:r,prefix:e,encode:t,decode:n})=>new sYe(r,e,t,n),l0=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=eYe(t,e);return y3({prefix:r,name:e,encode:n,decode:i=>L_(s(i))})},iYe=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},oYe=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},on=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>y3({prefix:e,name:r,encode(s){return oYe(s,n,t)},decode(s){return iYe(s,n,t,r)}}),Yi=l0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),aYe=l0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),cYe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Yi,base58flickr:aYe},Symbol.toStringTag,{value:"Module"})),Ml=on({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lYe=on({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),uYe=on({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),hYe=on({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dYe=on({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),fYe=on({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pYe=on({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yYe=on({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),gYe=on({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),wYe=Object.freeze(Object.defineProperty({__proto__:null,base32:Ml,base32hex:dYe,base32hexpad:pYe,base32hexpadupper:yYe,base32hexupper:fYe,base32pad:uYe,base32padupper:hYe,base32upper:lYe,base32z:gYe},Symbol.toStringTag,{value:"Module"})),oP=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return mYe(t,n7(r),e||Yi.encoder);default:return EYe(t,n7(r),e||Ml.encoder)}},aP=new WeakMap,n7=r=>{const e=aP.get(r);if(e==null){const t=new Map;return aP.set(r,t),t}return e};let g3=class Wn{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Pf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==vYe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Wn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=e7(e,t);return Wn.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Wn.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&gQe(e.multihash,n.multihash)}toString(e){return oP(this,e)}toJSON(){return{"/":oP(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Wn)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Wn(n,s,i,o||cP(n,s,i.bytes))}else if(t[_Ye]===!0){const{version:n,multihash:s,code:i}=t,o=cK(s);return Wn.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Pf)throw new Error(`Version 0 CID must use dag-pb (code: ${Pf}) block encoding`);return new Wn(e,t,n,n.bytes)}case 1:{const s=cP(e,t,n.bytes);return new Wn(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Wn.create(0,Pf,e)}static createV1(e,t){return Wn.create(1,e,t)}static decode(e){const[t,n]=Wn.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Wn.inspectBytes(e),n=t.size-t.multihashSize,s=L_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new M_(t.multihashCode,t.digestSize,i,s);return[t.version===0?Wn.createV0(o):Wn.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=Z8(e.subarray(t));return t+=f,h};let s=n(),i=Pf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=bYe(e,t),i=Wn.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return n7(i).set(n,e),i}};const bYe=(r,e)=>{switch(r[0]){case"Q":{const t=e||Yi;return[Yi.prefix,t.decode(`${Yi.prefix}${r}`)]}case Yi.prefix:{const t=e||Yi;return[Yi.prefix,t.decode(r)]}case Ml.prefix:{const t=e||Ml;return[Ml.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},mYe=(r,e,t)=>{const{prefix:n}=t;if(n!==Yi.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},EYe=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Pf=112,vYe=18,cP=(r,e,t)=>{const n=vw(r),s=n+vw(e),i=new Uint8Array(s+t.byteLength);return Ew(r,i,0),Ew(e,i,n),i.set(t,s),i},_Ye=Symbol.for("@ipld/js-cid/CID"),SYe=y3({prefix:"\0",name:"identity",encode:r=>JWe(r),decode:r=>XWe(r)}),AYe=Object.freeze(Object.defineProperty({__proto__:null,identity:SYe},Symbol.toStringTag,{value:"Module"})),$Ye=on({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),TYe=Object.freeze(Object.defineProperty({__proto__:null,base2:$Ye},Symbol.toStringTag,{value:"Module"})),IYe=on({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),RYe=Object.freeze(Object.defineProperty({__proto__:null,base8:IYe},Symbol.toStringTag,{value:"Module"})),CYe=l0({prefix:"9",name:"base10",alphabet:"0123456789"}),xYe=Object.freeze(Object.defineProperty({__proto__:null,base10:CYe},Symbol.toStringTag,{value:"Module"})),DYe=on({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),PYe=on({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),OYe=Object.freeze(Object.defineProperty({__proto__:null,base16:DYe,base16upper:PYe},Symbol.toStringTag,{value:"Module"})),kYe=l0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),NYe=l0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),LYe=Object.freeze(Object.defineProperty({__proto__:null,base36:kYe,base36upper:NYe},Symbol.toStringTag,{value:"Module"})),MYe=on({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),UYe=on({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),BYe=on({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),zYe=on({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),FYe=Object.freeze(Object.defineProperty({__proto__:null,base64:MYe,base64pad:UYe,base64url:BYe,base64urlpad:zYe},Symbol.toStringTag,{value:"Module"})),fK=Array.from(""),VYe=fK.reduce((r,e,t)=>(r[t]=e,r),[]),jYe=fK.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function KYe(r){return r.reduce((e,t)=>(e+=VYe[t],e),"")}function qYe(r){const e=[];for(const t of r){const n=jYe[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const HYe=y3({prefix:"",name:"base256emoji",encode:KYe,decode:qYe}),GYe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:HYe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const WYe={...AYe,...TYe,...RYe,...xYe,...OYe,...wYe,...LYe,...cYe,...FYe,...GYe};function QYe(r,e){switch(lr(r).code){case 4:case 41:return JYe(e);case 42:return hP(e);case 6:case 273:case 33:case 132:return pK(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return hP(e);case 421:return rXe(e);case 444:return dP(e);case 445:return dP(e);case 466:return tXe(e);default:return R(e,"base16")}}function YYe(r,e){switch(lr(r).code){case 4:return lP(e);case 41:return lP(e);case 42:return uP(e);case 6:case 273:case 33:case 132:return j_(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return uP(e);case 421:return ZYe(e);case 444:return nXe(e);case 445:return sXe(e);case 466:return eXe(e);default:return M(e,"base16")}}const $m=Object.values(WYe).map(r=>r.decoder),XYe=function(){let r=$m[0].or($m[1]);return $m.slice(2).forEach(e=>r=r.or(e)),r}();function lP(r){if(!Nt(r))throw new Error("invalid ip address");return hK(r)}function JYe(r){const e=QQe(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Nt(e))throw new Error("invalid ip address");return e}function j_(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function pK(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function uP(r){const e=M(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function hP(r){const e=P.decode(r);if(r=r.slice(P.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return R(r)}function ZYe(r){let e;r[0]==="Q"||r[0]==="1"?e=cK(Yi.decode(`z${r}`)).bytes:e=g3.parse(r).multihash.bytes;const t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function eXe(r){const e=XYe.decode(r),t=Uint8Array.from(P.encode(e.length));return z([t,e],t.length+e.length)}function tXe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+R(t,"base64url")}function rXe(r){const e=P.decode(r),t=r.slice(P.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return R(t,"base58btc")}function nXe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ml.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=j_(n);return z([t,s],t.length+s.length)}function sXe(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Ml.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=j_(n);return z([t,s],t.length+s.length)}function dP(r){const e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=R(e,"base32"),s=pK(t);return`${n}:${s}`}function iXe(r){const e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){const s=t[n],i=lr(s);if(i.size===0){e.push([s]);continue}if(n++,n>=t.length)throw bK("invalid address: "+r);if(i.path===!0){e.push([s,q_(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function oXe(r){const e=[];return r.map(t=>{const n=w3(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),q_(e.join("/"))}function aXe(r){return r.map(e=>{Array.isArray(e)||(e=[e]);const t=w3(e);return e.length>1?[t.code,YYe(t.code,e[1])]:[t.code]})}function yK(r){return r.map(e=>{const t=w3(e);return e[1]!=null?[t.code,QYe(t.code,e[1])]:[t.code]})}function gK(r){return s7(z(r.map(e=>{const t=w3(e);let n=Uint8Array.from(P.encode(t.code));return e.length>1&&e[1]!=null&&(n=z([n,e[1]])),n})))}function wK(r,e){return r.size>0?r.size/8:r.size===0?0:P.decode(e)+(P.decode.bytes??0)}function K_(r){const e=[];let t=0;for(;t<r.length;){const n=P.decode(r,t),s=P.decode.bytes??0,i=lr(n),o=wK(i,r.slice(t+s));if(o===0){e.push([n]),t+=s;continue}const a=r.slice(t+s,t+s+o);if(t+=o+s,t>r.length)throw bK("Invalid address Uint8Array: "+R(r,"base16"));e.push([n,a])}return e}function fP(r){const e=K_(r),t=yK(e);return oXe(t)}function cXe(r){r=q_(r);const e=iXe(r),t=aXe(e);return gK(t)}function lXe(r){return cXe(r)}function s7(r){const e=uXe(r);if(e!=null)throw e;return Uint8Array.from(r)}function uXe(r){try{K_(r)}catch(e){return e}}function q_(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function bK(r){return new Error("Error parsing address: "+r)}function w3(r){return lr(r[0])}var Uu=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Tm=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Of,kf,Nf,pP;const hXe=Symbol.for("nodejs.util.inspect.custom"),dXe=[lr("dns").code,lr("dns4").code,lr("dns6").code,lr("dnsaddr").code],fXe=new Map,mK=Symbol.for("@multiformats/js-multiaddr/multiaddr");function pXe(r){return!!r?.[mK]}class fl{constructor(e){if(Of.set(this,void 0),kf.set(this,void 0),Nf.set(this,void 0),this[pP]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=s7(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=lXe(e)}else if(pXe(e))this.bytes=s7(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Uu(this,Of,"f")==null&&Tm(this,Of,fP(this.bytes),"f"),Uu(this,Of,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";const o=lr("tcp"),a=lr("udp"),c=lr("ip4"),u=lr("ip6"),l=lr("dns6"),h=lr("ip6zone");for(const[y,d]of this.stringTuples())y===h.code&&(i=`%${d??""}`),dXe.includes(y)&&(t=o.name,s=443,n=`${d??""}${i}`,e=y===l.code?6:4),(y===o.code||y===a.code)&&(t=lr(y).name,s=parseInt(d??"")),(y===c.code||y===u.code)&&(t=lr(y).name,n=`${d??""}${i}`,e=y===u.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},lr(e)))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const s=P.decode(t,n),i=P.decode.bytes??0,o=lr(s),a=wK(o,t.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Uu(this,kf,"f")==null&&Tm(this,kf,K_(this.bytes),"f"),Uu(this,kf,"f")}stringTuples(){return Uu(this,Nf,"f")==null&&Tm(this,Nf,yK(this.tuples()),"f"),Uu(this,Nf,"f")}encapsulate(e){return e=new fl(e),new fl(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new fl(n.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new fl(gK(t.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter(n=>n[0]===$w.ipfs.code).pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?R(Yi.decode(`z${n}`),"base58btc"):R(g3.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(t=>lr(t[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return Ie(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=fXe.get(t.name);if(n==null)throw T(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new fl(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Of=new WeakMap,kf=new WeakMap,Nf=new WeakMap,pP=mK,hXe)](){return`Multiaddr(${fP(this.bytes)})`}}function yXe(r){return new fl(r)}var yP;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.key=t.bytes();break;case 2:s.value=t.bytes();break;case 3:s.author=t.bytes();break;case 4:s.signature=t.bytes();break;case 5:s.timeReceived=t.string();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(yP||(yP={}));var Ul;(function(r){(function(s){s.PUT_VALUE="PUT_VALUE",s.GET_VALUE="GET_VALUE",s.ADD_PROVIDER="ADD_PROVIDER",s.GET_PROVIDERS="GET_PROVIDERS",s.FIND_NODE="FIND_NODE",s.PING="PING"})(r.MessageType||(r.MessageType={}));let e;(function(s){s[s.PUT_VALUE=0]="PUT_VALUE",s[s.GET_VALUE=1]="GET_VALUE",s[s.ADD_PROVIDER=2]="ADD_PROVIDER",s[s.GET_PROVIDERS=3]="GET_PROVIDERS",s[s.FIND_NODE=4]="FIND_NODE",s[s.PING=5]="PING"})(e||(e={})),function(s){s.codec=()=>Pm(e)}(r.MessageType||(r.MessageType={})),function(s){s.NOT_CONNECTED="NOT_CONNECTED",s.CONNECTED="CONNECTED",s.CAN_CONNECT="CAN_CONNECT",s.CANNOT_CONNECT="CANNOT_CONNECT"}(r.ConnectionType||(r.ConnectionType={}));let t;(function(s){s[s.NOT_CONNECTED=0]="NOT_CONNECTED",s[s.CONNECTED=1]="CONNECTED",s[s.CAN_CONNECT=2]="CAN_CONNECT",s[s.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(t||(t={})),function(s){s.codec=()=>Pm(t)}(r.ConnectionType||(r.ConnectionType={})),function(s){let i;s.codec=()=>(i==null&&(i=zr((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const u of o.addrs)a.uint32(18),a.bytes(u);o.connection!=null&&(a.uint32(24),r.ConnectionType.codec().encode(o.connection,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a)=>{const c={addrs:[]},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const l=o.uint32();switch(l>>>3){case 1:c.id=o.bytes();break;case 2:c.addrs.push(o.bytes());break;case 3:c.connection=r.ConnectionType.codec().decode(o);break;default:o.skipType(l&7);break}}return c})),i),s.encode=o=>Fr(o,s.codec()),s.decode=o=>Vr(o,s.codec())}(r.Peer||(r.Peer={}));let n;r.codec=()=>(n==null&&(n=zr((s,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.MessageType.codec().encode(s.type,i)),s.clusterLevelRaw!=null&&(i.uint32(80),i.int32(s.clusterLevelRaw)),s.key!=null&&(i.uint32(18),i.bytes(s.key)),s.record!=null&&(i.uint32(26),i.bytes(s.record)),s.closerPeers!=null)for(const a of s.closerPeers)i.uint32(66),r.Peer.codec().encode(a,i);if(s.providerPeers!=null)for(const a of s.providerPeers)i.uint32(74),r.Peer.codec().encode(a,i);o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{const o={closerPeers:[],providerPeers:[]},a=i==null?s.len:s.pos+i;for(;s.pos<a;){const c=s.uint32();switch(c>>>3){case 1:o.type=r.MessageType.codec().decode(s);break;case 10:o.clusterLevelRaw=s.int32();break;case 2:o.key=s.bytes();break;case 3:o.record=s.bytes();break;case 8:o.closerPeers.push(r.Peer.codec().decode(s,s.uint32()));break;case 9:o.providerPeers.push(r.Peer.codec().decode(s,s.uint32()));break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>Fr(s,r.codec()),r.decode=s=>Vr(s,r.codec())})(Ul||(Ul={}));const ns=Ul.MessageType,gXe=Ul.ConnectionType,wXe=Object.keys(ns);let fi=class EK{constructor(e,t,n){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=n,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){const e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return Ul.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(gP),providerPeers:this.providerPeers.map(gP),record:this.record==null?void 0:this.record.serialize().subarray()})}static deserialize(e){const t=Ul.decode(e),n=new EK(t.type??Ul.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return n.closerPeers=t.closerPeers.map(wP),n.providerPeers=t.providerPeers.map(wP),t.record?.length!=null&&(n.record=os.deserialize(t.record)),n}};function gP(r){return{id:r.id.toBytes(),addrs:(r.multiaddrs??[]).map(t=>t.bytes),connection:gXe.CONNECTED}}function wP(r){if(r.id==null)throw new Error("Invalid peer in message");return{id:No(r.id),multiaddrs:(r.addrs??[]).map(e=>yXe(e)),protocols:[]}}function bP(r){return{...r,name:"SENDING_QUERY",type:0,messageName:r.type,messageType:wXe.indexOf(r.type.toString())}}function i7(r){return{...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer!=null?r.closer:[],providers:r.providers!=null?r.providers:[]}}function l2(r){return{...r,name:"FINAL_PEER",type:2}}function ya(r){return{...r,name:"QUERY_ERROR",type:3}}function mP(r){return{...r,name:"PROVIDER",type:4}}function o7(r){return{...r,name:"VALUE",type:5}}function EP(r){return{...r,name:"DIALING_PEER",type:7}}let vP=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function vK(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new vP(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new vP(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}function bXe(r,e,t){return n=>r(vK(n,e,t))}function _P(r,e,t){return{sink:bXe(r.sink,e,{...t,onAbort:void 0}),source:vK(r.source,e,t)}}let mXe=class extends Zt{constructor(e,t){super();const{protocol:n,lan:s}=t;this.components=e,this.log=U(`libp2p:kad-dht:${s?"lan":"wan"}:network`),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n={}){if(this.running){this.log("sending %s to %p",t.type,e),yield EP({peer:e}),yield bP({to:e,type:t.type});try{const i=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n),o=await this._writeReadMessage(i,t.serialize(),n);yield i7({from:e,messageType:o.type,closer:o.closerPeers,providers:o.providerPeers,record:o.record})}catch(s){yield ya({from:e,error:s})}finally{}}}async*sendMessage(e,t,n={}){if(this.running){this.log("sending %s to %p",t.type,e),yield EP({peer:e}),yield bP({to:e,type:t.type});try{const i=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n);await this._writeMessage(i,t.serialize(),n),yield i7({from:e,messageType:t.type})}catch(s){yield ya({from:e,error:s})}finally{}}}async _writeMessage(e,t,n){n.signal!=null&&(e=_P(e,n.signal)),await Ve([t],Sw(),e,jr)}async _writeReadMessage(e,t,n){n.signal!=null&&(e=_P(e,n.signal));const s=await Ve([t],Sw(),e,Aw(),async o=>{const a=await to(o);if(a!=null)return a;throw new L("No message received","ERR_NO_MESSAGE_RECEIVED")}),i=fi.deserialize(s);return i.closerPeers.forEach(o=>{this.dispatchEvent(new oe("peer",{detail:o}))}),i.providerPeers.forEach(o=>{this.dispatchEvent(new oe("peer",{detail:o}))}),i}};var EXe=_K,SP=128,vXe=127,_Xe=~vXe,SXe=Math.pow(2,31);function _K(r,e,t){e=e||[],t=t||0;for(var n=t;r>=SXe;)e[t++]=r&255|SP,r/=128;for(;r&_Xe;)e[t++]=r&255|SP,r>>>=7;return e[t]=r|0,_K.bytes=t-n+1,e}var AXe=a7,$Xe=128,AP=127;function a7(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw a7.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&AP)<<s:(o&AP)*Math.pow(2,s),s+=7}while(o>=$Xe);return a7.bytes=i-n,t}var TXe=Math.pow(2,7),IXe=Math.pow(2,14),RXe=Math.pow(2,21),CXe=Math.pow(2,28),xXe=Math.pow(2,35),DXe=Math.pow(2,42),PXe=Math.pow(2,49),OXe=Math.pow(2,56),kXe=Math.pow(2,63),NXe=function(r){return r<TXe?1:r<IXe?2:r<RXe?3:r<CXe?4:r<xXe?5:r<DXe?6:r<PXe?7:r<OXe?8:r<kXe?9:10},LXe={encode:EXe,decode:AXe,encodingLength:NXe},SK=LXe;const $P=(r,e,t=0)=>(SK.encode(r,e,t),e),TP=r=>SK.encodingLength(r),IP=(r,e)=>{const t=e.byteLength,n=TP(r),s=n+TP(t),i=new Uint8Array(s+t);return $P(r,i,0),$P(t,i,n),i.set(e,s),new MXe(r,t,e,i)};let MXe=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const UXe=({name:r,code:e,encode:t})=>new BXe(r,e,t);let BXe=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?IP(this.code,t):t.then(n=>IP(this.code,n))}else throw Error("Unknown type, must be binary type")}};const zXe=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),FXe=UXe({name:"sha2-256",code:18,encode:zXe("SHA-256")});async function H_(r,e){const t=e.key,s=R(t).split("/");if(s.length<3)return;const i=r[s[1].toString()];if(i==null){const o="Invalid record keytype";throw new L(o,"ERR_INVALID_RECORD_KEY_TYPE")}await i(t,e.value)}const VXe=async(r,e)=>{if(!(r instanceof Uint8Array))throw new L('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(r.byteLength<5)throw new L("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if(R(r.subarray(0,4))!=="/pk/")throw new L("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");const n=r.slice(4),s=await FXe.digest(e);if(!Ie(n,s.bytes))throw new L("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")},jXe={pk:VXe};function KXe(r,e,t){if(t.length===0){const o="No records given";throw new L(o,"ERR_NO_RECORDS_RECEIVED")}const s=R(e).split("/");if(s.length<3){const o="Record key does not have a selector function";throw new L(o,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const i=r[s[1].toString()];if(i==null){const o=`Unrecognized key prefix: ${s[1]}`;throw new L(o,"ERR_UNRECOGNIZED_KEY_PREFIX")}return t.length===1?0:i(e,t)}function qXe(r,e){return 0}const HXe={pk:qXe};class GXe{constructor(e,t){const{validators:n,selectors:s,peerRouting:i,queryManager:o,routingTable:a,network:c,lan:u}=t;this.components=e,this.log=U(`libp2p:kad-dht:${u?"lan":"wan"}:content-fetching`),this.validators=n,this.selectors=s,this.peerRouting=i,this.queryManager=o,this.routingTable=a,this.network=c}async putLocal(e,t){const n=th(e);await this.components.datastore.put(n,t)}async getLocal(e){this.log("getLocal %b",e);const t=th(e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const s=os.deserialize(n);return await H_(this.validators,s),s}async*sendCorrectionRecord(e,t,n,s={}){this.log("sendCorrection for %b",e);const i=nP(e,n);for(const{value:o,from:a}of t){if(Ie(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const l=th(e);this.log(`Storing corrected record for key ${l.toString()}`),await this.components.datastore.put(l,i.subarray())}catch(l){this.log.error("Failed error correcting self",l)}continue}let c=!1;const u=new fi(ns.PUT_VALUE,e,0);u.record=os.deserialize(i);for await(const l of this.network.sendRequest(a,u,s))l.name==="PEER_RESPONSE"&&l.record!=null&&Ie(l.record.value,os.deserialize(i).value)&&(c=!0),yield l;c||(yield ya({from:a,error:new L("value not put correctly","ERR_PUT_VALUE_INVALID")})),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const s=nP(e,t),i=th(e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,s.subarray()),yield*Ve(this.peerRouting.getClosestPeers(e,{signal:n.signal}),o=>ls(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],u=new fi(ns.PUT_VALUE,e,0);u.record=os.deserialize(s),this.log("send put to %p",a.peer.id);for await(const l of this.network.sendRequest(a.peer.id,u,n))c.push(l),l.name==="PEER_RESPONSE"&&(l.record!=null&&Ie(l.record.value,os.deserialize(s).value)||c.push(ya({from:a.peer.id,error:new L("value not put correctly","ERR_PUT_VALUE_INVALID")})));return c}),o=>mb(o,{ordered:!1,concurrency:_w}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;const s=n.map(a=>a.value);let i=0;try{i=KXe(this.selectors,e,s)}catch(a){if(a.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw a}const o=s[i];if(this.log("GetValue %b %b",e,o),o==null)throw new L("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,n,o,t),yield n[i]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const a=await this.getLocal(e);yield o7({value:a.value,from:this.components.peerId})}catch(a){this.log("error getting local value for %b",e,a)}const n=await Kh(e),s=this.routingTable.closestPeers(n);this.log("found %d peers in routing table",s.length);const i=this,o=async function*({peer:a,signal:c}){for await(const u of i.peerRouting.getValueOrPeers(a,e,{signal:c}))yield u,u.name==="PEER_RESPONSE"&&u.record!=null&&(yield o7({from:a,value:u.record.value}))};yield*this.queryManager.run(e,s,o,t)}}class WXe{constructor(e,t){const{network:n,peerRouting:s,queryManager:i,routingTable:o,providers:a,lan:c}=t;this.components=e,this.log=U(`libp2p:kad-dht:${c?"lan":"wan"}:content-routing`),this.network=n,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.providers=a}async*provide(e,t,n={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);const s=new fi(ns.ADD_PROVIDER,e.multihash.bytes,0);s.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let i=0;const o=a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[];this.log("putProvider %s to %p",e,a.peer.id);try{this.log("sending provider record for %s to %p",e,a.peer.id);for await(const u of this.network.sendMessage(a.peer.id,s,n))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,a.peer.id),i++),c.push(u)}catch(u){this.log.error("error sending provide record to peer %p",a.peer.id,u),c.push(ya({from:a.peer.id,error:u}))}return c};yield*Ve(this.peerRouting.getClosestPeers(e.multihash.bytes,n),a=>ls(a,c=>o(c)),a=>mb(a,{ordered:!1,concurrency:_w}),async function*(a){for await(const c of a)yield*c}),this.log("sent provider records to %d peers",i)}async*findProviders(e,t){const n=this.routingTable.kBucketSize,s=e.multihash.bytes,i=await Kh(s),o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const l=[];for(const h of a.slice(0,n))l.push({id:h,multiaddrs:(await this.components.peerStore.addressBook.get(h)??[]).map(f=>f.multiaddr),protocols:[]});yield i7({from:this.components.peerId,messageType:ns.GET_PROVIDERS,providers:l}),yield mP({from:this.components.peerId,providers:l})}if(a.length>=n)return;const c=async function*({peer:l,signal:h}){const f=new fi(ns.GET_PROVIDERS,s,0);yield*o.network.sendRequest(l,f,{signal:h})},u=new Set(a.map(l=>l.toString()));for await(const l of this.queryManager.run(s,this.routingTable.closestPeers(i),c,t))if(yield l,l.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",l.providers.length,e,l.closer.length);const h=[];for(const f of l.providers)u.has(f.id.toString())||(u.add(f.id.toString()),h.push(f));if(h.length>0&&(yield mP({from:l.from,providers:h})),u.size===n)return}}}class QXe{constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peerId)}async add(e){if(this.peerDistances.find(s=>s.peerId.equals(e))!=null)return;const t=await la(e),n={peerId:e,distance:E1(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort((s,i)=>Om(s.distance,i.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(e.length===0)return!1;if(this.length===0)return!0;const t=await Promise.all(e.map(la)),n=this.peerDistances[this.peerDistances.length-1].distance;for(const s of t){const i=E1(this.originDhtKey,s);if(Om(i,n)<0)return!0}return!1}}class YXe{constructor(e,t){const{routingTable:n,network:s,validators:i,queryManager:o,lan:a}=t;this.components=e,this.routingTable=n,this.network=s,this.validators=i,this.queryManager=o,this.log=U(`libp2p:kad-dht:${a?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(n)}catch(s){if(s.code!=="ERR_NOT_FOUND")throw s}}if(t==null)try{t=await this.components.peerStore.get(e)}catch(s){if(s.code!=="ERR_NOT_FOUND")throw s}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(s=>s.multiaddr),protocols:[]}}async*_getValueSingle(e,t,n={}){const s=new fi(ns.GET_VALUE,t,0);yield*this.network.sendRequest(e,s,n)}async*getPublicKeyFromNode(e,t={}){const n=kQe(e);for await(const s of this._getValueSingle(e,n,t))if(yield s,s.name==="PEER_RESPONSE"&&s.record!=null){const i=await vi(HE({bytes:s.record.value}));if(!i.equals(e))throw new L("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(i.publicKey==null)throw new L("public key missing","ERR_PUBLIC_KEY_MISSING");yield o7({from:e,value:i.publicKey})}throw new L(`Node not responding with its public key: ${e.toString()}`,"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);const n=await this.findPeerLocal(e);if(n!=null){this.log("found local"),yield l2({from:this.components.peerId,peer:n});return}const s=await la(e),i=this.routingTable.closestPeers(s);if(i.find(l=>l.equals(e))!=null)try{const l=await this.components.peerStore.get(e);this.log("found in peerStore"),yield l2({from:this.components.peerId,peer:{id:l.id,multiaddrs:l.addresses.map(h=>h.multiaddr),protocols:[]}});return}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}const a=this,c=async function*({peer:l,signal:h}){const f=new fi(ns.FIND_NODE,e.toBytes(),0);for await(const y of a.network.sendRequest(l,f,{signal:h}))if(yield y,y.name==="PEER_RESPONSE"){const d=y.closer.find(p=>p.id.equals(e));d!=null&&(yield l2({from:y.from,peer:d}))}};let u=!1;for await(const l of this.queryManager.run(e.toBytes(),i,c,t))l.name==="FINAL_PEER"&&(u=!0),yield l;u||(yield ya({from:this.components.peerId,error:new L("Not found","ERR_NOT_FOUND")}))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await Kh(e),s=this.routingTable.closestPeers(n),i=this,o=new QXe(n,this.routingTable.kBucketSize);await Promise.all(s.map(async c=>{await o.add(c)}));const a=async function*({peer:c,signal:u}){i.log("closerPeersSingle %s from %p",R(e,"base32"),c);const l=new fi(ns.FIND_NODE,e,0);yield*i.network.sendRequest(c,l,{signal:u})};for await(const c of this.queryManager.run(e,s,a,t))yield c,c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async u=>{await o.add(u.id)}));this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield l2({from:this.components.peerId,peer:{id:c,multiaddrs:(await this.components.peerStore.addressBook.get(c)??[]).map(u=>u.multiaddr),protocols:[]}})}async*getValueOrPeers(e,t,n={}){for await(const s of this._getValueSingle(e,t,n)){if(s.name==="PEER_RESPONSE"&&s.record!=null)try{await this._verifyRecordOnline(s.record)}catch{const o="invalid record received, discarded";this.log(o),yield ya({from:s.from,error:new L(o,"ERR_INVALID_RECORD")});continue}yield s}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new L("invalid record received","ERR_INVALID_RECORD");await H_(this.validators,new os(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=await Kh(e),s=this.routingTable.closestPeers(n),i=[];for(const o of s)if(!o.equals(t))try{const a=await this.components.peerStore.addressBook.get(o),c=await this.components.peerStore.protoBook.get(o);i.push({id:o,multiaddrs:a.map(u=>u.multiaddr),protocols:c})}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return i.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",i.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),i}}const Wo=U("libp2p:kad-dht:providers");class XXe{constructor(e,t={}){const{cacheSize:n,cleanupInterval:s,provideValidity:i}=t;this.components=e,this.cleanupInterval=s??IQe,this.provideValidity=i??TQe,this.cache=nb(n??$Qe),this.syncQueue=new Cr({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(e=>{Wo.error(e)})},this.cleanupInterval))}async stop(){this.started=!1,this.cleaner!=null&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add(async()=>{const e=Date.now();let t=0,n=0;const s=new Map,i=this.components.datastore.batch(),o=this.components.datastore.query({prefix:uK});for await(const a of o)try{const{cid:c,peerId:u}=AK(a.key),l=$K(a.value).getTime(),h=Date.now(),f=h-l,y=f>this.provideValidity;if(Wo("comparing: %d - %d = %d > %d %s",h,l,f,this.provideValidity,y?"(expired)":""),y){n++,i.delete(a.key);const d=s.get(c)??new Set;d.add(u),s.set(c,d)}t++}catch(c){Wo.error(c.message)}s.size>0?(Wo("deleting %d / %d entries",n,t),await i.commit()):Wo("nothing to delete");for(const[a,c]of s){const u=g1(a),l=this.cache.get(u);if(l!=null){for(const h of c)l.delete(h);l.size===0?this.cache.remove(u):this.cache.set(u,l)}}Wo("Cleanup successful (%dms)",Date.now()-e)})}async _getProvidersMap(e){const t=g1(e);let n=this.cache.get(t);return n==null&&(n=await ZXe(this.components.datastore,e),this.cache.set(t,n)),n}async addProvider(e,t){await this.syncQueue.add(async()=>{Wo("%p provides %s",t,e);const n=await this._getProvidersMap(e);Wo("loaded %s provs",n.size);const s=new Date;n.set(t.toString(),s);const i=g1(e);this.cache.set(i,n),await JXe(this.components.datastore,e,t,s)})}async getProviders(e){return await this.syncQueue.add(async()=>(Wo("get providers for %s",e),[...(await this._getProvidersMap(e)).keys()].map(n=>Ae(n))),{throwOnTimeout:!0})}}function g1(r){const e=typeof r=="string"?r:R(r.multihash.bytes,"base32");return`${uK}/${e}`}async function JXe(r,e,t,n){const s=[g1(e),"/",t.toString()].join(""),i=new be(s),o=Uint8Array.from(P.encode(n.getTime()));await r.put(i,o)}function AK(r){const e=r.toString().split("/");if(e.length!==5)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:e[3],peerId:e[4]}}async function ZXe(r,e){const t=new Map,n=r.query({prefix:g1(e)});for await(const s of n){const{peerId:i}=AK(s.key);t.set(i,$K(s.value))}return t}function $K(r){return new Date(P.decode(r))}const eJe=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*tJe(r){const{key:e,startingPeer:t,ourPeerId:n,signal:s,query:i,alpha:o,pathIndex:a,numPaths:c,cleanUp:u,queryFuncTimeout:l,log:h,peersSeen:f}=r,y=new Cr({concurrency:o}),d=await Kh(e);function p(b,w){if(b==null)return;f.add(b);const S=BigInt("0x"+R(E1(w,d),"base16"));y.add(async()=>{let E;const m=[s];l!=null&&(E=new Xt.TimeoutController(l),m.push(E.signal));const v=Io(m);try{for await(const A of i({key:e,peer:b,signal:v,pathIndex:a,numPaths:c})){if(v.aborted)return;if(A.name==="PEER_RESPONSE")for(const g of A.closer){if(f.has(g.id)){h("already seen %p in query",g.id);continue}if(n.equals(g.id)){h("not querying ourselves");continue}const _=await la(g.id);if(BigInt("0x"+R(E1(_,d),"base16"))>S){h("skipping %p as they are not closer to %b than %p",g.id,e,b);continue}h("querying closer peer %p",g.id),p(g.id,_)}y.emit("completed",A)}E?.clear()}catch(A){s.aborted?y.emit("error",A):y.emit("completed",ya({from:b,error:A}))}finally{E?.clear()}},{priority:eJe-S}).catch(E=>{h.error(E)})}p(t,await la(t)),yield*rJe(y,s,u,h)}async function*rJe(r,e,t,n){let s=pt(),i=!0;const o=[],a=()=>{i&&(n("clean up queue, results %d, queue size %d, pending tasks %d",o.length,r.size,r.pending),i=!1,r.clear(),o.splice(0,o.length))};for(r.on("completed",c=>{o.push(c),s.resolve()}),r.on("error",c=>{n("queue error",c),a(),s.reject(c)}),r.on("idle",()=>{n("queue idle"),i=!1,s.resolve()}),e.addEventListener("abort",()=>{n("abort queue");const c=i;a(),c&&s.reject(new L("Query aborted","ERR_QUERY_ABORTED"))}),t.addEventListener("cleanup",()=>{a(),s.resolve()});i;)for(await s.promise,s=pt();o.length>0;){const c=o.shift();c!=null&&(yield c)}yield*o}class nJe{constructor(e,t){const{lan:n=!1,disjointPaths:s=t7,alpha:i=_w}=t;this.components=e,this.disjointPaths=s??t7,this.controllers=new Set,this.running=!1,this.alpha=i??_w,this.lan=n,this.queries=0}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&this.metrics==null&&(this.metrics={runningQueries:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_running_queries`),queryTime:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_query_time_seconds`)})}async stop(){this.running=!1;for(const e of this.controllers)e.abort();this.controllers.clear()}async*run(e,t,n,s={}){if(!this.running)throw new Error("QueryManager not started");const i=this.metrics?.queryTime.timer();let o;if(s.signal==null){o=new Xt.TimeoutController(PQe),s.signal=o.signal;try{Rt.setMaxListeners!=null&&Rt.setMaxListeners(1/0,o.signal)}catch{}}const a=new AbortController;this.controllers.add(a);const c=[a.signal];s.signal!=null&&c.push(s.signal);const u=Io(c);try{Rt.setMaxListeners!=null&&Rt.setMaxListeners(1/0,u)}catch{}const l=U(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+R(e,"base58btc")),h=t.slice(0,Math.min(this.disjointPaths,t.length)),f=Date.now(),y=new Zt;try{if(l("query:start"),this.queries++,this.metrics?.runningQueries.update(this.queries),t.length===0){l.error("Running query with no peers");return}const d=new Pc,p=h.map((b,w)=>tJe({key:e,startingPeer:b,ourPeerId:this.components.peerId,signal:u,query:n,pathIndex:w,numPaths:h.length,alpha:this.alpha,cleanUp:y,queryFuncTimeout:s.queryFuncTimeout,log:l,peersSeen:d}));for await(const b of ys(...p))yield b,b.name==="QUERY_ERROR"&&l("error",b.error)}catch(d){if(!(!this.running&&d.code==="ERR_QUERY_ABORTED"))throw d}finally{this.controllers.delete(a),o?.clear(),this.queries--,this.metrics?.runningQueries.update(this.queries),i?.(),y.dispatchEvent(new oe("cleanup")),l("query:done in %dms",Date.now()-f)}}}const Lf=U("libp2p:kad-dht:rpc:handlers:add-provider");class sJe{constructor(e){const{providers:t}=e;this.providers=t}async handle(e,t){if(Lf("start"),t.key==null||t.key.length===0)throw new L("Missing key","ERR_MISSING_KEY");let n;try{n=g3.decode(t.key)}catch{throw new L("Invalid CID","ERR_INVALID_CID")}(t.providerPeers==null||t.providerPeers.length===0)&&Lf.error("no providers found in message"),await Promise.all(t.providerPeers.map(async s=>{if(!s.id.equals(e)){Lf("invalid provider peer %p from %p",s.id,e);return}if(s.multiaddrs.length<1){Lf("no valid addresses for provider %p. Ignore",e);return}Lf("received provider %p for %s (addrs %s)",e,n,s.multiaddrs.map(i=>i.toString())),await this.providers.addProvider(n,s.id)}))}}const RP=U("libp2p:kad-dht:rpc:handlers:find-node");class iJe{constructor(e,t){const{peerRouting:n,lan:s}=t;this.components=e,this.peerRouting=n,this.lan=!!s}async handle(e,t){RP("incoming request from %p for peers closer to %b",e,t.key);let n=[];Ie(this.components.peerId.toBytes(),t.key)?n=[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(i=>i.decapsulateCode(lr("p2p").code)),protocols:[]}]:n=await this.peerRouting.getCloserPeersOffline(t.key,e),n=n.map(this.lan?F_:z_).filter(({multiaddrs:i})=>i.length);const s=new fi(t.type,new Uint8Array(0),t.clusterLevel);return n.length>0?s.closerPeers=n:RP("could not find any peers closer to %b than %p",t.key,e),s}}const CP=U("libp2p:kad-dht:rpc:handlers:get-providers");class oJe{constructor(e,t){const{peerRouting:n,providers:s,lan:i}=t;this.components=e,this.peerRouting=n,this.providers=s,this.lan=!!i}async handle(e,t){let n;try{n=g3.decode(t.key)}catch{throw new L("Invalid CID","ERR_INVALID_CID")}CP("%p asking for providers for %s",e,n);const[s,i]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(t.key,e)]),o=await this._getPeers(s),a=await this._getPeers(i.map(({id:u})=>u)),c=new fi(t.type,t.key,t.clusterLevel);return o.length>0&&(c.providerPeers=o),a.length>0&&(c.closerPeers=a),CP("got %s providers %s closerPeers",o.length,a.length),c}async _getAddresses(e){return(await this.components.peerStore.addressBook.get(e)).map(n=>n.multiaddr)}async _getPeers(e){const t=[],n=this.lan?F_:z_;for(const s of e){const i=n({id:s,multiaddrs:await this._getAddresses(s),protocols:[]});i.multiaddrs.length>0&&t.push(i)}return t}}const Bu=U("libp2p:kad-dht:rpc:handlers:get-value");class aJe{constructor(e,t){const{peerRouting:n}=t;this.components=e,this.peerRouting=n}async handle(e,t){const n=t.key;if(Bu("%p asked for key %b",e,n),n==null||n.length===0)throw new L("Invalid key","ERR_INVALID_KEY");const s=new fi(ns.GET_VALUE,n,t.clusterLevel);if(NQe(n)){Bu("is public key");const a=LQe(n);let c;try{const u=await this.components.peerStore.keyBook.get(a);if(u==null)throw new L("No public key found in key book","ERR_NOT_FOUND");c=u}catch(u){if(u.code!=="ERR_NOT_FOUND")throw u}if(c!=null)return Bu("returning found public key"),s.record=new os(n,c,new Date),s}const[i,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(t.key,e)]);return i!=null&&(Bu("had record for %b in local datastore",n),s.record=i),o.length>0&&(Bu("had %s closer peers in routing table",o.length),s.closerPeers=o),s}async _checkLocalDatastore(e){Bu("checkLocalDatastore looking for %b",e);const t=th(e);let n;try{n=await this.components.datastore.get(t)}catch(i){if(i.code==="ERR_NOT_FOUND")return;throw i}const s=os.deserialize(n);if(s==null)throw new L("Invalid record","ERR_INVALID_RECORD");if(s.timeReceived==null||Date.now()-s.timeReceived.getTime()>EQe){await this.components.datastore.delete(t);return}return s}}const cJe=U("libp2p:kad-dht:rpc:handlers:ping");class lJe{async handle(e,t){return cJe("ping from %p",e),t}}class uJe{constructor(e,t){const{validators:n}=t;this.components=e,this.log=U("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=n}async handle(e,t){const n=t.key;this.log("%p asked us to store value for key %b",e,n);const s=t.record;if(s==null){const i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new L(i,"ERR_EMPTY_RECORD")}try{await H_(this.validators,s),s.timeReceived=new Date;const i=th(s.key);await this.components.datastore.put(i,s.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,i)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}}class hJe{constructor(e,t){const{providers:n,peerRouting:s,validators:i,lan:o}=t;this.log=U("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[ns.GET_VALUE]:new aJe(e,{peerRouting:s}),[ns.PUT_VALUE]:new uJe(e,{validators:i}),[ns.FIND_NODE]:new iJe(e,{peerRouting:s,lan:o}),[ns.ADD_PROVIDER]:new sJe({providers:n}),[ns.GET_PROVIDERS]:new oJe(e,{peerRouting:s,providers:n,lan:o}),[ns.PING]:new lJe}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(s){this.log.error("Failed to update the kbucket store",s)}const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}return await n.handle(e,t)}onIncomingStream(e){Promise.resolve().then(async()=>{const{stream:t,connection:n}=e,s=n.remotePeer;try{await this.routingTable.add(s)}catch(o){this.log.error(o)}const i=this;await Ve(t,Aw(),async function*(o){for await(const a of o){const c=fi.deserialize(a);i.log("incoming %s from %p",c.type,s);const u=await i.handleMessage(s,c);u!=null&&(yield u.serialize())}},Sw(),t)}).catch(t=>{this.log.error(t)})}}class dJe extends Zt{constructor(e,t){super();const{protocol:n,lan:s}=t;this.components=e,this.log=U(`libp2p:kad-dht:topology-listener:${s?"lan":"wan"}`),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;const e=f9({onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new oe("peer",{detail:t}))}});this.registrarId=await this.components.registrar.register(this.protocol,e)}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class fJe{constructor(e,t){const{peerRouting:n,lan:s,count:i,interval:o,queryTimeout:a}=t;this.components=e,this.log=U(`libp2p:kad-dht:${s?"lan":"wan"}:query-self`),this.running=!1,this.peerRouting=n,this.count=i??t7,this.interval=o??RQe,this.queryTimeout=a??CQe}isStarted(){return this.running}async start(){this.running||(this.running=!0,this._querySelf())}async stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}_querySelf(){Promise.resolve().then(async()=>{const e=new Xt.TimeoutController(this.queryTimeout);try{this.controller=new AbortController;const t=Io([this.controller.signal,e.signal]);try{Rt.setMaxListeners!=null&&Rt.setMaxListeners(1/0,t)}catch{}const n=await Ve(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:t}),s=>Vl(s,this.count),async s=>await Oh(s));this.log("query ran successfully - found %d peers",n)}catch(t){this.log("query error",t)}finally{this.timeoutId=setTimeout(this._querySelf.bind(this),this.interval),e.clear()}}).catch(e=>{this.log("query error",e)})}}const pJe=32,yJe=64;let xP=class extends Zt{constructor(e,t){super();const{kBucketSize:n,clientMode:s,validators:i,selectors:o,querySelfInterval:a,lan:c,protocolPrefix:u,pingTimeout:l,pingConcurrency:h,maxInboundStreams:f,maxOutboundStreams:y,providers:d}=t;this.running=!1,this.components=e,this.lan=!!c,this.log=U(`libp2p:kad-dht:${c===!0?"lan":"wan"}`),this.protocol=`${u??_Qe}${c===!0?vQe:""}${SQe}`,this.kBucketSize=n??20,this.clientMode=s??!0,this.maxInboundStreams=f??pJe,this.maxOutboundStreams=y??yJe,this.routingTable=new VQe(e,{kBucketSize:n,lan:this.lan,pingTimeout:l,pingConcurrency:h,protocol:this.protocol}),this.providers=new XXe(e,d??{}),this.validators={...jXe,...i},this.selectors={...HXe,...o},this.network=new mXe(e,{protocol:this.protocol,lan:this.lan}),this.queryManager=new nJe(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:c}),this.peerRouting=new YXe(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new GXe(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,network:this.network,lan:this.lan}),this.contentRouting=new WXe(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new KQe({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new hJe(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new dJe(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new fJe(e,{peerRouting:this.peerRouting,interval:a,lan:this.lan}),this.network.addEventListener("peer",p=>{const b=p.detail;this.onPeerConnect(b).catch(w=>{this.log.error("could not add %p to routing table",b.id,w)}),this.dispatchEvent(new oe("peer",{detail:b}))}),this.topologyListener.addEventListener("peer",p=>{const b=p.detail;Promise.resolve().then(async()=>{const w=await this.components.peerStore.addressBook.get(b),S={id:b,multiaddrs:w.map(E=>E.multiaddr),protocols:[]};await this.onPeerConnect(S)}).catch(w=>{this.log.error("could not add %p to routing table",b,w)})})}get[n0](){return!0}get[Symbol.toStringTag](){return"@libp2p/kad-dht"}async onPeerConnect(e){if(this.log("peer %p connected with protocols %s",e.id,e.protocols),this.lan?e=F_(e):e=z_(e),e.multiaddrs.length===0){this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map(t=>t.toString()));return}try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),e==="client"?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.querySelf.start()]),await this.routingTableRefresh.start()}async stop(){this.running=!1,await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop(),this.querySelf.stop()])}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}};const gJe=U("libp2p:kad-dht");class wJe extends Zt{constructor(e,t,n){super(),this.components=e,this.wan=t,this.lan=n,this.wan.addEventListener("peer",s=>{this.dispatchEvent(new oe("peer",{detail:s.detail}))}),this.lan.addEventListener("peer",s=>{this.dispatchEvent(new oe("peer",{detail:s.detail}))})}get[n0](){return!0}get[Symbol.toStringTag](){return"@libp2p/dual-kad-dht"}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return await this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,n={}){for await(const s of ys(this.lan.put(e,t,n),this.wan.put(e,t,n)))yield s}async*get(e,t={}){let n=!1,s=!1;for await(const i of ys(this.lan.get(e,t),this.wan.get(e,t)))yield i,i.name==="DIALING_PEER"&&(n=!0),i.name==="VALUE"&&(n=!0,i.value!=null&&(s=!0)),i.name==="SENDING_QUERY"&&(n=!0);if(!n)throw new L("No peers found in routing table!","ERR_NO_PEERS_IN_ROUTING_TABLE");s||(yield ya({from:this.components.peerId,error:new L("Not found","ERR_NOT_FOUND")}))}async*provide(e,t={}){let n=0,s=0;const i=[],o=[this.lan];await this.wan.getMode()==="server"&&o.push(this.wan);for await(const a of ys(...o.map(c=>c.provide(e,t))))yield a,a.name==="SENDING_QUERY"&&n++,a.name==="QUERY_ERROR"&&i.push(a.error),a.name==="PEER_RESPONSE"&&a.messageName==="ADD_PROVIDER"&&(gJe("sent provider record for %s to %p",e,a.from),s++);if(s===0)throw i.length>0?new L(`Failed to provide to ${i.length} of ${n} peers`,"ERR_PROVIDES_FAILED",{errors:i}):new L("Failed to provide - no peers found","ERR_PROVIDES_FAILED")}async*findProviders(e,t={}){yield*ys(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let n=!1;for await(const s of ys(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield s,(s.name==="SENDING_QUERY"||s.name==="FINAL_PEER")&&(n=!0);if(!n)throw new L("Peer lookup failed","ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*ys(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}}class bJe extends wJe{constructor(e,t){super(e,new xP(e,{protocolPrefix:"/ipfs",...t,lan:!1}),new xP(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}))}}function mJe(r){return e=>new bJe(e,r)}const EJe=de("dns4"),vJe=de("dns6"),_Je=de("dnsaddr"),Zl=Dr(de("dns"),_Je,EJe,vJe),b3=Dr(de("ip4"),de("ip6")),qh=Dr($e(b3,de("tcp")),$e(Zl,de("tcp"))),m3=$e(b3,de("udp")),SJe=$e(m3,de("utp")),AJe=$e(m3,de("quic")),$Je=$e(m3,de("quic-v1")),c7=Dr($e(qh,de("ws")),$e(Zl,de("ws"))),l7=Dr($e(c7,de("p2p")),c7),u7=Dr($e(qh,de("wss")),$e(Zl,de("wss")),$e(qh,de("tls"),de("ws")),$e(Zl,de("tls"),de("ws"))),Tw=Dr($e(u7,de("p2p")),u7),h7=Dr($e(qh,de("http")),$e(b3,de("http")),$e(Zl,de("http"))),d7=Dr($e(qh,de("https")),$e(b3,de("https")),$e(Zl,de("https"))),DP=$e(m3,de("webrtc-direct"),de("certhash")),TK=Dr($e(DP,de("p2p")),DP),PP=$e($Je,de("webtransport"),de("certhash"),de("certhash")),IK=Dr($e(PP,de("p2p")),PP),RK=Dr($e(l7,de("p2p-webrtc-star"),de("p2p")),$e(Tw,de("p2p-webrtc-star"),de("p2p")),$e(l7,de("p2p-webrtc-star")),$e(Tw,de("p2p-webrtc-star"))),CK=Dr($e(h7,de("p2p-webrtc-direct"),de("p2p")),$e(d7,de("p2p-webrtc-direct"),de("p2p")),$e(h7,de("p2p-webrtc-direct")),$e(d7,de("p2p-webrtc-direct"))),f7=Dr(c7,u7,h7,d7,RK,CK,qh,SJe,AJe,Zl,TK,IK),vc=Dr($e(f7,de("p2p")),RK,CK,TK,IK,de("p2p")),OP=Dr($e(vc,de("p2p-circuit"),vc),$e(vc,de("p2p-circuit")),$e(de("p2p-circuit"),vc),$e(f7,de("p2p-circuit")),$e(de("p2p-circuit"),f7),de("p2p-circuit")),xK=()=>Dr($e(OP,xK),OP),Mf=xK(),TJe=Dr($e(Mf,vc,Mf),$e(vc,Mf),$e(Mf,vc),Mf,vc);function DK(r){function e(t){let n;try{n=Hp(t)}catch{return!1}const s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return e}function $e(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(s=>(n=typeof s=="function"?s().partialMatch(t):s.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:DK(e),partialMatch:e}}function Dr(...r){function e(n){let s=null;return r.some(i=>{const o=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return o!=null?(s=o,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:DK(e),partialMatch:e}}function de(r){const e=r;function t(s){let i;try{i=Hp(s)}catch{return!1}const o=i.protoNames();return o.length===1&&o[0]===e}function n(s){return s.length===0?null:s[0]===e?s.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const u2=U("libp2p:bootstrap"),IJe="bootstrap",RJe=50,CJe=12e4,xJe=1e3;class PK extends Zt{constructor(e,t={list:[]}){if(t.list==null||t.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??xJe,this.list=[];for(const n of t.list){if(!TJe.matches(n)){u2.error("Invalid multiaddr");continue}const s=Hp(n),i=s.getPeerId();if(i==null){u2.error("Invalid bootstrap multiaddr without peer id");continue}const o={id:Ae(i),multiaddrs:[s],protocols:[]};this.list.push(o)}this._init=t}get[n0](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return!!this.timer}start(){this.isStarted()||(u2("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{u2.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const e of this.list){if(await this.components.peerStore.tagPeer(e.id,this._init.tagName??IJe,{value:this._init.tagValue??RJe,ttl:this._init.tagTTL??CJe}),this.timer==null)return;this.dispatchEvent(new oe("peer",{detail:e}))}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}PK.tag="bootstrap";function DJe(r){return e=>new PK(e,r)}const PJe=WebSocket;var E3={},v3={};Object.defineProperty(v3,"__esModule",{value:!0});class OJe{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,s)=>{this.pullQueue.push({resolve:n,reject:s})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let OK=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const s=new OJe;s.highWaterMark=t,s.lowWaterMark=n,s.removeCallback=e({push:i=>s.push(i),stop:()=>s.stop(),fail:i=>s.fail(i),on:(i,o)=>{s.eventHandlers[i]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>s[Symbol.asyncIterator](),Object.freeze(this)}};v3.EventIterator=OK;v3.default=OK;Object.defineProperty(E3,"__esModule",{value:!0});const G_=v3;var kJe=E3.EventIterator=G_.EventIterator;function NJe(r,e,t){return new G_.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}E3.subscribe=NJe;E3.default=G_.EventIterator;function kP(r){return r instanceof ArrayBuffer||r?.constructor?.name==="ArrayBuffer"&&typeof r?.byteLength=="number"}const LJe=r=>{r.binaryType="arraybuffer";const e=async()=>await new Promise((i,o)=>{if(n)return i();if(s!=null)return o(s);const a=l=>{r.removeEventListener("open",c),r.removeEventListener("error",u),l()},c=()=>a(i),u=l=>{a(()=>o(l.error??new Error(`connect ECONNREFUSED ${r.url}`)))};r.addEventListener("open",c),r.addEventListener("error",u)}),t=async function*(){const i=new kJe(({push:o,stop:a,fail:c})=>{const u=h=>{let f=null;typeof h.data=="string"&&(f=M(h.data)),kP(h.data)&&(f=new Uint8Array(h.data)),h.data instanceof Uint8Array&&(f=h.data),f!=null&&o(f)},l=h=>c(h.error??new Error("Socket error"));return r.addEventListener("message",u),r.addEventListener("error",l),r.addEventListener("close",a),()=>{r.removeEventListener("message",u),r.removeEventListener("error",l),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of i)yield kP(o)?new Uint8Array(o):o}();let n=r.readyState===1,s;return r.addEventListener("open",()=>{n=!0,s=null}),r.addEventListener("close",()=>{n=!1,s=null}),r.addEventListener("error",i=>{n||(s=i.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},MJe=r=>{if(r.readyState>=2)throw new Error("socket closed");if(r.readyState!==1)return new Promise((e,t)=>{function n(){r.removeEventListener("open",s),r.removeEventListener("error",i)}function s(){n(),e()}function i(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",s),r.addEventListener("error",i)})},UJe=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const s of n){try{await MJe(r)}catch(i){if(i.message==="socket closed")break;throw i}r.send(s)}if(e.closeOnEnd!=null&&r.readyState<=1)return await new Promise((s,i)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)s();else{const a=Object.assign(new Error("ws error"),{event:o});i(a)}}),setTimeout(()=>r.close())})}),BJe=(r,e)=>{e=e??{};const t=LJe(r);let n=e.remoteAddress,s=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,s=parseInt(o.port,10)}catch{}if(n==null||s==null)throw new Error("Remote connection did not have address and/or port");return{sink:UJe(r,e),source:t,connected:async()=>await t.connected(),close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:s,socket:r}},zJe={http:"ws",https:"wss"},FJe="ws",VJe=(r,e)=>_E.relative(r,e,zJe,FJe);function jJe(r,e){const t=typeof window>"u"?"":window.location;e=e??{};const n=VJe(r,t.toString()),s=new PJe(n,e.websocket);return BJe(s,e)}function KJe(){throw new Error("WebSocket Servers can not be created in the browser!")}let NP=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function LP(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new NP(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new NP(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}const kK=421,NK=290,qJe=2e3;class HJe extends Error{constructor(e){super(e),this.name="TimeoutError"}}let GJe=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const MP=r=>globalThis.DOMException===void 0?new GJe(r):new DOMException(r),UP=r=>{const e=r.reason===void 0?MP("This operation was aborted."):r.reason;return e instanceof Error?e:MP(e)};function WJe(r,e){const{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e;let o;const c=new Promise((u,l)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:f}=e;f.aborted&&l(UP(f)),f.addEventListener("abort",()=>{l(UP(f))})}if(t===Number.POSITIVE_INFINITY){r.then(u,l);return}const h=new HJe;o=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(f){l(f)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?u():s instanceof Error?l(s):(h.message=s??`Promise timed out after ${t} milliseconds`,l(h))},t),(async()=>{try{u(await r)}catch(f){l(f)}})()}).finally(()=>{c.clear()});return c.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},c}const BP=U("libp2p:websockets:socket");function QJe(r,e,t){t=t??{};const n={async sink(s){t?.signal!=null&&(s=LP(s,t.signal));try{await r.sink(s)}catch(i){i.type!=="aborted"&&BP.error(i)}},source:t.signal!=null?LP(r.source,t.signal):r.source,remoteAddr:e,timeline:{open:Date.now()},async close(){const s=Date.now();try{await WJe(r.close(),{milliseconds:qJe})}catch{const{host:o,port:a}=n.remoteAddr.toOptions();BP("timeout closing stream to %s:%s after %dms, destroying it manually",o,a,Date.now()-s),r.destroy()}finally{n.timeline.close=Date.now()}}};return r.socket.addEventListener("close",()=>{n.timeline.close==null&&(n.timeline.close=Date.now())},{once:!0}),n}function YJe(r){return r.filter(e=>{if(e.protoCodes().includes(NK))return!1;const t=e.decapsulateCode(kK);return l7.matches(t)||Tw.matches(t)})}function XJe(r){return r.filter(e=>{if(e.protoCodes().includes(NK))return!1;const t=e.decapsulateCode(kK);return Tw.matches(t)})}const Ba=U("libp2p:websockets");class JJe{constructor(e){this.init=e}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[r_](){return!0}async dial(e,t){Ba("dialing %s",e),t=t??{};const n=await this._connect(e,t),s=QJe(n,e);Ba("new outbound connection %s",s.remoteAddr);const i=await t.upgrader.upgradeOutbound(s);return Ba("outbound connection %s upgraded",s.remoteAddr),i}async _connect(e,t){if(t?.signal?.aborted===!0)throw new aS;const n=e.toOptions();Ba("dialing %s:%s",n.host,n.port);const s=pt(),i=u=>{Ba.error("connection error:",u),s.reject(u)},o=jJe(qv(e),this.init);if(o.socket.on!=null?o.socket.on("error",i):o.socket.onerror=i,t.signal==null)return await Promise.race([o.connected(),s.promise]),Ba("connected %s",e),o;let a;const c=new Promise((u,l)=>{if(a=()=>{l(new aS),o.close().catch(h=>{Ba.error("error closing raw socket",h)})},t?.signal?.aborted===!0){a();return}t?.signal?.addEventListener("abort",a)});try{await Promise.race([c,s.promise,o.connected()])}finally{a!=null&&t?.signal?.removeEventListener("abort",a)}return Ba("connected %s",e),o}createListener(e){return KJe({...this.init,...e})}filter(e){return e=Array.isArray(e)?e:[e],this.init?.filter!=null?this.init?.filter(e):b1||O7?XJe(e):YJe(e)}}function ZJe(r={}){return()=>new JJe(r)}let zP=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function LK(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new zP(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new zP(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}function FP(r){return new Uint8Array(r)}var Ye;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(Ye||(Ye={}));const W_=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),VP=Object.freeze({NEW_STREAM:Ye.NEW_STREAM,MESSAGE:Ye.MESSAGE_INITIATOR,CLOSE:Ye.CLOSE_INITIATOR,RESET:Ye.RESET_INITIATOR}),eZe=Object.freeze({MESSAGE:Ye.MESSAGE_RECEIVER,CLOSE:Ye.CLOSE_RECEIVER,RESET:Ye.RESET_RECEIVER}),jP=1024*1024,tZe=(r,e)=>{e.append(r)};async function*rZe(r,e={}){let t=new Se,n=!1,s=pt(),i=Number(e.size??jP);(isNaN(i)||i===0||i<0)&&(i=jP);const o=e.yieldAfter??0,a=e.serialize??tZe;for(Promise.resolve().then(async()=>{try{let c;for await(const u of r){if(a(u,t),t.byteLength>=i){clearTimeout(c),s.resolve();continue}c=setTimeout(()=>{s.resolve()},o)}clearTimeout(c),s.resolve()}catch(c){s.reject(c)}finally{n=!0}});!n;)if(await s.promise,s=pt(),t.byteLength>0){const c=t;t=new Se,yield c.subarray()}}const Im=10*1024;let nZe=class{constructor(){this._pool=FP(Im),this._poolOffset=0}write(e,t){const n=this._pool;let s=this._poolOffset;P.encode(e.id<<3|e.type,n,s),s+=P.encode.bytes??0,(e.type===Ye.NEW_STREAM||e.type===Ye.MESSAGE_INITIATOR||e.type===Ye.MESSAGE_RECEIVER)&&e.data!=null?P.encode(e.data.length,n,s):P.encode(0,n,s),s+=P.encode.bytes??0;const i=n.subarray(this._poolOffset,s);Im-s<100?(this._pool=FP(Im),this._poolOffset=0):this._poolOffset=s,t.append(i),(e.type===Ye.NEW_STREAM||e.type===Ye.MESSAGE_INITIATOR||e.type===Ye.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}};const KP=new nZe;async function*sZe(r,e=0){if(e==null||e===0){for await(const t of r){const n=new Se;for(const s of t)KP.write(s,n);yield n.subarray()}return}yield*rZe(r,{size:e,serialize:(t,n)=>{for(const s of t)KP.write(s,n)}})}const MK=1<<20,iZe=4<<20;let oZe=class{constructor(e=MK,t=iZe){this._buffer=new Se,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(u){if(u.code==="ERR_MSG_TOO_BIG")throw u;break}const{id:n,type:s,length:i,offset:o}=this._headerInfo;if(this._buffer.length-o<i)break;const c={id:n,type:s};(s===Ye.NEW_STREAM||s===Ye.MESSAGE_INITIATOR||s===Ye.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+i)),t.push(c),this._buffer.consume(o+i),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=HP(e),{value:s,offset:i}=HP(e,n),o=t&7;if(W_[o]==null)throw new Error(`Invalid type received: ${o}`);if(s>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:o,offset:n+i,length:s}}};const aZe=128,qP=127;function HP(r,e=0){let t=0,n=0,s=e,i;const o=r.length;do{if(s>=o||n>49)throw e=0,new RangeError("Could not decode varint");i=r.get(s++),t+=n<28?(i&qP)<<n:(i&qP)*Math.pow(2,n),n+=7}while(i>=aZe);return e=s-e,{value:t,offset:e}}function UK(r){const e=new globalThis.AbortController;function t(){e.abort();for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(const i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=n,s}const Ti=U("libp2p:mplex:stream"),Rm="ERR_STREAM_RESET",cZe="ERR_STREAM_ABORT",lZe="ERR_SINK_ENDED",uZe="ERR_DOUBLE_SINK";function hZe(r){const{id:e,name:t,send:n,onEnd:s,type:i="initiator",maxMsgSize:o=MK}=r,a=new AbortController,c=new AbortController,u=new AbortController,l=i==="initiator"?VP:eZe,h=i==="initiator"?`i${e}`:`r${e}`,f=`${t??e}`;let y=!1,d=!1,p=!1,b;const w={open:Date.now()},S=A=>{y||(y=!0,Ti.trace("%s stream %s source end - err: %o",i,f,A),A!=null&&b==null&&(b=A),d&&(v.stat.timeline.close=Date.now(),s?.(b)))},E=A=>{d||(d=!0,Ti.trace("%s stream %s sink end - err: %o",i,f,A),A!=null&&b==null&&(b=A),y&&(w.close=Date.now(),s?.(b)))},m=$r({onEnd:S}),v={close:()=>{Ti.trace("%s stream %s close",i,f),v.closeRead(),v.closeWrite()},closeRead:()=>{Ti.trace("%s stream %s closeRead",i,f),!y&&m.end()},closeWrite:()=>{if(Ti.trace("%s stream %s closeWrite",i,f),!d){u.abort();try{n({id:e,type:l.CLOSE})}catch(A){Ti.trace("%s stream %s error sending close",i,t,A)}E()}},abort:A=>{Ti.trace("%s stream %s abort",i,f,A),m.end(A),a.abort(),E(A)},reset:()=>{const A=new L("stream reset",Rm);c.abort(),m.end(A),E(A)},sink:async A=>{if(p)throw new L("sink already called on stream",uZe);if(p=!0,d)throw new L("stream closed for writing",lZe);const g=UK([a.signal,c.signal,u.signal]);try{A=LK(A,g),i==="initiator"&&n({id:e,type:VP.NEW_STREAM,data:new Se(M(f))});for await(let _ of A)for(;_.length>0;){if(_.length<=o){n({id:e,type:l.MESSAGE,data:_ instanceof Uint8Array?new Se(_):_});break}_=_ instanceof Uint8Array?new Se(_):_,n({id:e,type:l.MESSAGE,data:_.sublist(0,o)}),_.consume(o)}}catch(_){if(_.type==="aborted"&&_.message==="The operation was aborted"){if(u.signal.aborted)return;c.signal.aborted&&(_.message="stream reset",_.code=Rm),a.signal.aborted&&(_.message="stream aborted",_.code=cZe)}if(_.code===Rm)Ti.trace("%s stream %s reset",i,t);else{Ti.trace("%s stream %s error",i,t,_);try{n({id:e,type:l.RESET})}catch($){Ti.trace("%s stream %s error sending reset",i,t,$)}}m.end(_),E(_);return}finally{g.clear()}try{n({id:e,type:l.CLOSE})}catch(_){Ti.trace("%s stream %s error sending close",i,t,_)}E()},source:m,sourcePush:A=>{m.push(A)},sourceReadableLength(){return m.readableLength},stat:{direction:i==="initiator"?"outbound":"inbound",timeline:w},metadata:{},id:h};return v}const Ii=U("libp2p:mplex"),dZe=1024,fZe=1024,pZe=1024*1024*4,yZe=5;function GP(r){const e={...r,type:`${W_[r.type]} (${r.type})`};return r.type===Ye.NEW_STREAM&&(e.data=R(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===Ye.MESSAGE_INITIATOR||r.type===Ye.MESSAGE_RECEIVER)&&(e.data=R(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}class gZe{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();const t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new k7.RateLimiterMemory({points:e.disconnectThreshold??yZe,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){this.closeController.signal.aborted||(e!=null?this.streams.forEach(t=>{t.abort(e)}):this.streams.forEach(t=>{t.close()}),this.closeController.abort())}_newReceiverStream(e){const{id:t,name:n}=e,s=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:s})}_newStream(e){const{id:t,name:n,type:s,registry:i}=e;if(Ii("new %s stream %s",s,t),s==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??fZe))throw new L("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(i.has(t))throw new Error(`${s} stream ${t} already exists!`);const c=hZe({id:t,name:n,send:u=>{Ii.enabled&&Ii.trace("%s stream %s send",s,t,GP(u)),this._source.push(u)},type:s,onEnd:()=>{Ii("%s stream with id %s and protocol %s ended",s,t,c.stat.protocol),i.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize});return i.set(t,c),c}_createSink(){return async t=>{const n=UK([this.closeController.signal,this._init.signal]);try{t=LK(t,n);const s=new oZe(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const i of t)for(const o of s.write(i))await this._handleIncoming(o);this._source.end()}catch(s){Ii("error in sink",s),this._source.end(s)}finally{n.clear()}}}_createSource(){const t=$O({objectMode:!0,onEnd:n=>{this.close(n)}});return Object.assign(sZe(t,this._init.minSendBytes),{push:t.push,end:t.end,return:t.return})}async _handleIncoming(e){const{id:t,type:n}=e;if(Ii.enabled&&Ii.trace("incoming message",GP(e)),e.type===Ye.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??dZe)){Ii("too many inbound streams open"),this._source.push({id:t,type:Ye.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{Ii("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this._source.end(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:R(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const i=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(i==null){Ii("missing stream %s for message type %s",t,W_[n]);return}const o=this._init.maxStreamBufferSize??pZe;switch(n){case Ye.MESSAGE_INITIATOR:case Ye.MESSAGE_RECEIVER:if(i.sourceReadableLength()>o){this._source.push({id:e.id,type:n===Ye.MESSAGE_INITIATOR?Ye.RESET_RECEIVER:Ye.RESET_INITIATOR});const a=new L("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");i.abort(a);return}i.sourcePush(e.data);break;case Ye.CLOSE_INITIATOR:case Ye.CLOSE_RECEIVER:i.closeRead();break;case Ye.RESET_INITIATOR:case Ye.RESET_RECEIVER:i.reset();break;default:Ii("unknown message type %s",n)}}}class wZe{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new gZe({...e,...this._init})}}function bZe(r={}){return()=>new wZe(r)}const BK=r=>Jt.decode(r);BK.bytes=0;function WP(r,e={}){const t=$r();r.sink(t).catch(o=>{t.end(o)}),r.sink=async o=>{for await(const a of o)t.push(a)};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const s=new Se,i={read:async o=>{if(o==null){const{done:c,value:u}=await n.next();return c===!0?new Se:u}for(;s.byteLength<o;){const{value:c,done:u}=await n.next();if(u===!0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF");s.append(c)}const a=s.sublist(0,o);return s.consume(o),a},readLP:async()=>{let o=-1;const a=new Se,c=e?.lengthDecoder??BK;for(;;){a.append(await i.read(1));try{o=c(a)}catch(u){if(u instanceof RangeError)continue;throw u}if(o>-1)break;if(e?.maxLengthLength!=null&&a.byteLength>e.maxLengthLength)throw T(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG")}if(e?.maxDataLength!=null&&o>e.maxDataLength)throw T(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");return await i.read(o)},readPB:async o=>{const a=await i.readLP();if(a==null)throw new Error("Value is null");const c=a instanceof Uint8Array?a:a.subarray();return o.decode(c)},write:o=>{o instanceof Uint8Array?t.push(o):t.push(o.subarray())},writeLP:o=>{i.write(I_.single(o,e))},writePB:(o,a)=>{i.writeLP(a.encode(o))},pb:o=>({read:async()=>await i.readPB(o),write:a=>{i.writePB(a,o)},unwrap:()=>i}),unwrap:()=>{const o=r.source;return r.source=async function*(){yield*s,yield*o}(),r}};return i}function QP(){const r=pt();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function mZe(){const r=QP(),e=QP();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}const EZe=8,vZe=1024*1024*4;var pl;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(pl||(pl={}));const Q_=r=>{const e=Jt.decode(r);return Q_.bytes=Jt.encodingLength(e),e};Q_.bytes=0;function p7(r){return async function*(t){const n=new Se;let s=pl.LENGTH,i=-1;const o=r?.lengthDecoder??Q_,a=r?.maxLengthLength??EZe,c=r?.maxDataLength??vZe;for await(const u of t)for(n.append(u);n.byteLength>0;){if(s===pl.LENGTH)try{if(i=o(n),i<0)throw T(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>c)throw T(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const l=o.bytes;n.consume(l),r?.onLength!=null&&r.onLength(i),s=pl.DATA}catch(l){if(l instanceof RangeError){if(n.byteLength>a)throw T(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(s===pl.DATA){if(n.byteLength<i)break;const l=n.sublist(0,i);n.consume(i),r?.onData!=null&&r.onData(l),yield l,s=pl.LENGTH}}if(n.byteLength>0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}p7.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return p7({...e??{},onLength:i=>{t=i}})(n)};const tp=65535,YP=tp-16,_Ze=!!globalThis.process?.env?.DUMP_SESSION_KEYS;var zK={},u0={},Y_={};Object.defineProperty(Y_,"__esModule",{value:!0});function SZe(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}Y_.isSerializableHash=SZe;var Yc={};Object.defineProperty(Yc,"__esModule",{value:!0});function AZe(r,e,t){return~(r-1)&e|r-1&t}Yc.select=AZe;function $Ze(r,e){return(r|0)-(e|0)-1>>>31&1}Yc.lessOrEqual=$Ze;function FK(r,e){if(r.length!==e.length)return 0;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return 1&t-1>>>8}Yc.compare=FK;function TZe(r,e){return r.length===0||e.length===0?!1:FK(r,e)!==0}Yc.equal=TZe;var no={};Object.defineProperty(no,"__esModule",{value:!0});function IZe(r){for(var e=0;e<r.length;e++)r[e]=0;return r}no.wipe=IZe;Object.defineProperty(u0,"__esModule",{value:!0});var lo=Y_,RZe=Yc,CZe=no,VK=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(n).clean():n.set(t);for(var s=0;s<n.length;s++)n[s]^=54;this._inner.update(n);for(var s=0;s<n.length;s++)n[s]^=106;this._outer.update(n),lo.isSerializableHash(this._inner)&&lo.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),CZe.wipe(n)}return r.prototype.reset=function(){if(!lo.isSerializableHash(this._inner)||!lo.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){lo.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),lo.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!lo.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!lo.isSerializableHash(this._inner)||!lo.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!lo.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();u0.HMAC=VK;function xZe(r,e,t){var n=new VK(r,e);n.update(t);var s=n.digest();return n.clean(),s}u0.hmac=xZe;u0.equal=RZe.equal;Object.defineProperty(zK,"__esModule",{value:!0});var XP=u0,JP=no,DZe=function(){function r(e,t,n,s){n===void 0&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var i=XP.hmac(this._hash,n,t);this._hmac=new XP.HMAC(e,i),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),n=0;n<t.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[n]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),JP.wipe(this._buffer),JP.wipe(this._counter),this._bufpos=0},r}(),PZe=zK.HKDF=DZe,F2={},jK={},_3={},S3={};Object.defineProperty(S3,"__esModule",{value:!0});S3.BrowserRandomSource=void 0;const ZP=65536;class OZe{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let n=0;n<t.length;n+=ZP)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,ZP)));return t}}S3.BrowserRandomSource=OZe;var A3={};Object.defineProperty(A3,"__esModule",{value:!0});A3.NodeRandomSource=void 0;const kZe=no;class NZe{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof P7<"u"){const e=D7();e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const n=new Uint8Array(e);for(let s=0;s<n.length;s++)n[s]=t[s];return(0,kZe.wipe)(t),n}}A3.NodeRandomSource=NZe;Object.defineProperty(_3,"__esModule",{value:!0});_3.SystemRandomSource=void 0;const LZe=S3,MZe=A3;class UZe{constructor(){if(this.isAvailable=!1,this.name="",this._source=new LZe.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new MZe.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}_3.SystemRandomSource=UZe;var Ce={},KK={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});function e(a,c){var u=a>>>16&65535,l=a&65535,h=c>>>16&65535,f=c&65535;return l*f+(u*f+l*h<<16>>>0)|0}r.mul=Math.imul||e;function t(a,c){return a+c|0}r.add=t;function n(a,c){return a-c|0}r.sub=n;function s(a,c){return a<<c|a>>>32-c}r.rotl=s;function i(a,c){return a<<32-c|a>>>c}r.rotr=i;function o(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a}r.isInteger=Number.isInteger||o,r.MAX_SAFE_INTEGER=9007199254740991,r.isSafeInteger=function(a){return r.isInteger(a)&&a>=-r.MAX_SAFE_INTEGER&&a<=r.MAX_SAFE_INTEGER}})(KK);Object.defineProperty(Ce,"__esModule",{value:!0});var qK=KK;function BZe(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}Ce.readInt16BE=BZe;function zZe(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}Ce.readUint16BE=zZe;function FZe(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}Ce.readInt16LE=FZe;function VZe(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}Ce.readUint16LE=VZe;function HK(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}Ce.writeUint16BE=HK;Ce.writeInt16BE=HK;function GK(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}Ce.writeUint16LE=GK;Ce.writeInt16LE=GK;function y7(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}Ce.readInt32BE=y7;function g7(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}Ce.readUint32BE=g7;function w7(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}Ce.readInt32LE=w7;function b7(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}Ce.readUint32LE=b7;function Iw(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}Ce.writeUint32BE=Iw;Ce.writeInt32BE=Iw;function Rw(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}Ce.writeUint32LE=Rw;Ce.writeInt32LE=Rw;function jZe(r,e){e===void 0&&(e=0);var t=y7(r,e),n=y7(r,e+4);return t*4294967296+n-(n>>31)*4294967296}Ce.readInt64BE=jZe;function KZe(r,e){e===void 0&&(e=0);var t=g7(r,e),n=g7(r,e+4);return t*4294967296+n}Ce.readUint64BE=KZe;function qZe(r,e){e===void 0&&(e=0);var t=w7(r,e),n=w7(r,e+4);return n*4294967296+t-(t>>31)*4294967296}Ce.readInt64LE=qZe;function HZe(r,e){e===void 0&&(e=0);var t=b7(r,e),n=b7(r,e+4);return n*4294967296+t}Ce.readUint64LE=HZe;function WK(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Iw(r/4294967296>>>0,e,t),Iw(r>>>0,e,t+4),e}Ce.writeUint64BE=WK;Ce.writeInt64BE=WK;function QK(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Rw(r>>>0,e,t),Rw(r/4294967296>>>0,e,t+4),e}Ce.writeUint64LE=QK;Ce.writeInt64LE=QK;function GZe(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,s=1,i=r/8+t-1;i>=t;i--)n+=e[i]*s,s*=256;return n}Ce.readUintBE=GZe;function WZe(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,s=1,i=t;i<t+r/8;i++)n+=e[i]*s,s*=256;return n}Ce.readUintLE=WZe;function QZe(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!qK.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,i=r/8+n-1;i>=n;i--)t[i]=e/s&255,s*=256;return t}Ce.writeUintBE=QZe;function YZe(r,e,t,n){if(t===void 0&&(t=new Uint8Array(r/8)),n===void 0&&(n=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!qK.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,i=n;i<n+r/8;i++)t[i]=e/s&255,s*=256;return t}Ce.writeUintLE=YZe;function XZe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}Ce.readFloat32BE=XZe;function JZe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}Ce.readFloat32LE=JZe;function ZZe(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}Ce.readFloat64BE=ZZe;function eet(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}Ce.readFloat64LE=eet;function tet(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r),e}Ce.writeFloat32BE=tet;function ret(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat32(t,r,!0),e}Ce.writeFloat32LE=ret;function net(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r),e}Ce.writeFloat64BE=net;function set(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.setFloat64(t,r,!0),e}Ce.writeFloat64LE=set;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.randomStringForEntropy=r.randomString=r.randomUint32=r.randomBytes=r.defaultRandomSource=void 0;const e=_3,t=Ce,n=no;r.defaultRandomSource=new e.SystemRandomSource;function s(u,l=r.defaultRandomSource){return l.randomBytes(u)}r.randomBytes=s;function i(u=r.defaultRandomSource){const l=s(4,u),h=(0,t.readUint32LE)(l);return(0,n.wipe)(l),h}r.randomUint32=i;const o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function a(u,l=o,h=r.defaultRandomSource){if(l.length<2)throw new Error("randomString charset is too short");if(l.length>256)throw new Error("randomString charset is too long");let f="";const y=l.length,d=256-256%y;for(;u>0;){const p=s(Math.ceil(u*256/d),h);for(let b=0;b<p.length&&u>0;b++){const w=p[b];w<d&&(f+=l.charAt(w%y),u--)}(0,n.wipe)(p)}return f}r.randomString=a;function c(u,l=o,h=r.defaultRandomSource){const f=Math.ceil(u/(Math.log(l.length)/Math.LN2));return a(f,l,h)}r.randomStringForEntropy=c})(jK);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.sharedKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.scalarMultBase=r.scalarMult=r.SHARED_KEY_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=void 0;const e=jK,t=no;r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=32,r.SHARED_KEY_LENGTH=32;function n(m){const v=new Float64Array(16);if(m)for(let A=0;A<m.length;A++)v[A]=m[A];return v}const s=new Uint8Array(32);s[0]=9;const i=n([56129,1]);function o(m){let v=1;for(let A=0;A<16;A++){let g=m[A]+v+65535;v=Math.floor(g/65536),m[A]=g-v*65536}m[0]+=v-1+37*(v-1)}function a(m,v,A){const g=~(A-1);for(let _=0;_<16;_++){const $=g&(m[_]^v[_]);m[_]^=$,v[_]^=$}}function c(m,v){const A=n(),g=n();for(let _=0;_<16;_++)g[_]=v[_];o(g),o(g),o(g);for(let _=0;_<2;_++){A[0]=g[0]-65517;for(let x=1;x<15;x++)A[x]=g[x]-65535-(A[x-1]>>16&1),A[x-1]&=65535;A[15]=g[15]-32767-(A[14]>>16&1);const $=A[15]>>16&1;A[14]&=65535,a(g,A,1-$)}for(let _=0;_<16;_++)m[2*_]=g[_]&255,m[2*_+1]=g[_]>>8}function u(m,v){for(let A=0;A<16;A++)m[A]=v[2*A]+(v[2*A+1]<<8);m[15]&=32767}function l(m,v,A){for(let g=0;g<16;g++)m[g]=v[g]+A[g]}function h(m,v,A){for(let g=0;g<16;g++)m[g]=v[g]-A[g]}function f(m,v,A){let g,_,$=0,x=0,k=0,j=0,G=0,Q=0,V=0,ne=0,W=0,ue=0,Me=0,yt=0,er=0,Kt=0,ce=0,xe=0,je=0,et=0,it=0,dt=0,gt=0,vt=0,$t=0,xt=0,Lt=0,Xc=0,vu=0,vd=0,d0=0,I3=0,nS=0,an=A[0],cn=A[1],ln=A[2],un=A[3],hn=A[4],dn=A[5],fn=A[6],pn=A[7],yn=A[8],gn=A[9],wn=A[10],bn=A[11],mn=A[12],En=A[13],vn=A[14],_n=A[15];g=v[0],$+=g*an,x+=g*cn,k+=g*ln,j+=g*un,G+=g*hn,Q+=g*dn,V+=g*fn,ne+=g*pn,W+=g*yn,ue+=g*gn,Me+=g*wn,yt+=g*bn,er+=g*mn,Kt+=g*En,ce+=g*vn,xe+=g*_n,g=v[1],x+=g*an,k+=g*cn,j+=g*ln,G+=g*un,Q+=g*hn,V+=g*dn,ne+=g*fn,W+=g*pn,ue+=g*yn,Me+=g*gn,yt+=g*wn,er+=g*bn,Kt+=g*mn,ce+=g*En,xe+=g*vn,je+=g*_n,g=v[2],k+=g*an,j+=g*cn,G+=g*ln,Q+=g*un,V+=g*hn,ne+=g*dn,W+=g*fn,ue+=g*pn,Me+=g*yn,yt+=g*gn,er+=g*wn,Kt+=g*bn,ce+=g*mn,xe+=g*En,je+=g*vn,et+=g*_n,g=v[3],j+=g*an,G+=g*cn,Q+=g*ln,V+=g*un,ne+=g*hn,W+=g*dn,ue+=g*fn,Me+=g*pn,yt+=g*yn,er+=g*gn,Kt+=g*wn,ce+=g*bn,xe+=g*mn,je+=g*En,et+=g*vn,it+=g*_n,g=v[4],G+=g*an,Q+=g*cn,V+=g*ln,ne+=g*un,W+=g*hn,ue+=g*dn,Me+=g*fn,yt+=g*pn,er+=g*yn,Kt+=g*gn,ce+=g*wn,xe+=g*bn,je+=g*mn,et+=g*En,it+=g*vn,dt+=g*_n,g=v[5],Q+=g*an,V+=g*cn,ne+=g*ln,W+=g*un,ue+=g*hn,Me+=g*dn,yt+=g*fn,er+=g*pn,Kt+=g*yn,ce+=g*gn,xe+=g*wn,je+=g*bn,et+=g*mn,it+=g*En,dt+=g*vn,gt+=g*_n,g=v[6],V+=g*an,ne+=g*cn,W+=g*ln,ue+=g*un,Me+=g*hn,yt+=g*dn,er+=g*fn,Kt+=g*pn,ce+=g*yn,xe+=g*gn,je+=g*wn,et+=g*bn,it+=g*mn,dt+=g*En,gt+=g*vn,vt+=g*_n,g=v[7],ne+=g*an,W+=g*cn,ue+=g*ln,Me+=g*un,yt+=g*hn,er+=g*dn,Kt+=g*fn,ce+=g*pn,xe+=g*yn,je+=g*gn,et+=g*wn,it+=g*bn,dt+=g*mn,gt+=g*En,vt+=g*vn,$t+=g*_n,g=v[8],W+=g*an,ue+=g*cn,Me+=g*ln,yt+=g*un,er+=g*hn,Kt+=g*dn,ce+=g*fn,xe+=g*pn,je+=g*yn,et+=g*gn,it+=g*wn,dt+=g*bn,gt+=g*mn,vt+=g*En,$t+=g*vn,xt+=g*_n,g=v[9],ue+=g*an,Me+=g*cn,yt+=g*ln,er+=g*un,Kt+=g*hn,ce+=g*dn,xe+=g*fn,je+=g*pn,et+=g*yn,it+=g*gn,dt+=g*wn,gt+=g*bn,vt+=g*mn,$t+=g*En,xt+=g*vn,Lt+=g*_n,g=v[10],Me+=g*an,yt+=g*cn,er+=g*ln,Kt+=g*un,ce+=g*hn,xe+=g*dn,je+=g*fn,et+=g*pn,it+=g*yn,dt+=g*gn,gt+=g*wn,vt+=g*bn,$t+=g*mn,xt+=g*En,Lt+=g*vn,Xc+=g*_n,g=v[11],yt+=g*an,er+=g*cn,Kt+=g*ln,ce+=g*un,xe+=g*hn,je+=g*dn,et+=g*fn,it+=g*pn,dt+=g*yn,gt+=g*gn,vt+=g*wn,$t+=g*bn,xt+=g*mn,Lt+=g*En,Xc+=g*vn,vu+=g*_n,g=v[12],er+=g*an,Kt+=g*cn,ce+=g*ln,xe+=g*un,je+=g*hn,et+=g*dn,it+=g*fn,dt+=g*pn,gt+=g*yn,vt+=g*gn,$t+=g*wn,xt+=g*bn,Lt+=g*mn,Xc+=g*En,vu+=g*vn,vd+=g*_n,g=v[13],Kt+=g*an,ce+=g*cn,xe+=g*ln,je+=g*un,et+=g*hn,it+=g*dn,dt+=g*fn,gt+=g*pn,vt+=g*yn,$t+=g*gn,xt+=g*wn,Lt+=g*bn,Xc+=g*mn,vu+=g*En,vd+=g*vn,d0+=g*_n,g=v[14],ce+=g*an,xe+=g*cn,je+=g*ln,et+=g*un,it+=g*hn,dt+=g*dn,gt+=g*fn,vt+=g*pn,$t+=g*yn,xt+=g*gn,Lt+=g*wn,Xc+=g*bn,vu+=g*mn,vd+=g*En,d0+=g*vn,I3+=g*_n,g=v[15],xe+=g*an,je+=g*cn,et+=g*ln,it+=g*un,dt+=g*hn,gt+=g*dn,vt+=g*fn,$t+=g*pn,xt+=g*yn,Lt+=g*gn,Xc+=g*wn,vu+=g*bn,vd+=g*mn,d0+=g*En,I3+=g*vn,nS+=g*_n,$+=38*je,x+=38*et,k+=38*it,j+=38*dt,G+=38*gt,Q+=38*vt,V+=38*$t,ne+=38*xt,W+=38*Lt,ue+=38*Xc,Me+=38*vu,yt+=38*vd,er+=38*d0,Kt+=38*I3,ce+=38*nS,_=1,g=$+_+65535,_=Math.floor(g/65536),$=g-_*65536,g=x+_+65535,_=Math.floor(g/65536),x=g-_*65536,g=k+_+65535,_=Math.floor(g/65536),k=g-_*65536,g=j+_+65535,_=Math.floor(g/65536),j=g-_*65536,g=G+_+65535,_=Math.floor(g/65536),G=g-_*65536,g=Q+_+65535,_=Math.floor(g/65536),Q=g-_*65536,g=V+_+65535,_=Math.floor(g/65536),V=g-_*65536,g=ne+_+65535,_=Math.floor(g/65536),ne=g-_*65536,g=W+_+65535,_=Math.floor(g/65536),W=g-_*65536,g=ue+_+65535,_=Math.floor(g/65536),ue=g-_*65536,g=Me+_+65535,_=Math.floor(g/65536),Me=g-_*65536,g=yt+_+65535,_=Math.floor(g/65536),yt=g-_*65536,g=er+_+65535,_=Math.floor(g/65536),er=g-_*65536,g=Kt+_+65535,_=Math.floor(g/65536),Kt=g-_*65536,g=ce+_+65535,_=Math.floor(g/65536),ce=g-_*65536,g=xe+_+65535,_=Math.floor(g/65536),xe=g-_*65536,$+=_-1+37*(_-1),_=1,g=$+_+65535,_=Math.floor(g/65536),$=g-_*65536,g=x+_+65535,_=Math.floor(g/65536),x=g-_*65536,g=k+_+65535,_=Math.floor(g/65536),k=g-_*65536,g=j+_+65535,_=Math.floor(g/65536),j=g-_*65536,g=G+_+65535,_=Math.floor(g/65536),G=g-_*65536,g=Q+_+65535,_=Math.floor(g/65536),Q=g-_*65536,g=V+_+65535,_=Math.floor(g/65536),V=g-_*65536,g=ne+_+65535,_=Math.floor(g/65536),ne=g-_*65536,g=W+_+65535,_=Math.floor(g/65536),W=g-_*65536,g=ue+_+65535,_=Math.floor(g/65536),ue=g-_*65536,g=Me+_+65535,_=Math.floor(g/65536),Me=g-_*65536,g=yt+_+65535,_=Math.floor(g/65536),yt=g-_*65536,g=er+_+65535,_=Math.floor(g/65536),er=g-_*65536,g=Kt+_+65535,_=Math.floor(g/65536),Kt=g-_*65536,g=ce+_+65535,_=Math.floor(g/65536),ce=g-_*65536,g=xe+_+65535,_=Math.floor(g/65536),xe=g-_*65536,$+=_-1+37*(_-1),m[0]=$,m[1]=x,m[2]=k,m[3]=j,m[4]=G,m[5]=Q,m[6]=V,m[7]=ne,m[8]=W,m[9]=ue,m[10]=Me,m[11]=yt,m[12]=er,m[13]=Kt,m[14]=ce,m[15]=xe}function y(m,v){f(m,v,v)}function d(m,v){const A=n();for(let g=0;g<16;g++)A[g]=v[g];for(let g=253;g>=0;g--)y(A,A),g!==2&&g!==4&&f(A,A,v);for(let g=0;g<16;g++)m[g]=A[g]}function p(m,v){const A=new Uint8Array(32),g=new Float64Array(80),_=n(),$=n(),x=n(),k=n(),j=n(),G=n();for(let W=0;W<31;W++)A[W]=m[W];A[31]=m[31]&127|64,A[0]&=248,u(g,v);for(let W=0;W<16;W++)$[W]=g[W];_[0]=k[0]=1;for(let W=254;W>=0;--W){const ue=A[W>>>3]>>>(W&7)&1;a(_,$,ue),a(x,k,ue),l(j,_,x),h(_,_,x),l(x,$,k),h($,$,k),y(k,j),y(G,_),f(_,x,_),f(x,$,j),l(j,_,x),h(_,_,x),y($,_),h(x,k,G),f(_,x,i),l(_,_,k),f(x,x,_),f(_,k,G),f(k,$,g),y($,j),a(_,$,ue),a(x,k,ue)}for(let W=0;W<16;W++)g[W+16]=_[W],g[W+32]=x[W],g[W+48]=$[W],g[W+64]=k[W];const Q=g.subarray(32),V=g.subarray(16);d(Q,Q),f(V,V,Q);const ne=new Uint8Array(32);return c(ne,V),ne}r.scalarMult=p;function b(m){return p(m,s)}r.scalarMultBase=b;function w(m){if(m.length!==r.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${r.SECRET_KEY_LENGTH} bytes`);const v=new Uint8Array(m);return{publicKey:b(v),secretKey:v}}r.generateKeyPairFromSeed=w;function S(m){const v=(0,e.randomBytes)(32,m),A=w(v);return(0,t.wipe)(v),A}r.generateKeyPair=S;function E(m,v,A=!1){if(m.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(v.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const g=p(m,v);if(A){let _=0;for(let $=0;$<g.length;$++)_|=g[$];if(_===0)throw new Error("X25519: invalid shared key")}return g}r.sharedKey=E})(F2);var m7={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Ce,t=no;r.DIGEST_LENGTH=32,r.BLOCK_SIZE=64;var n=function(){function a(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return a.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},a.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},a.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},a.prototype.update=function(c,u){if(u===void 0&&(u=c.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var l=0;if(this._bytesHashed+=u,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&u>0;)this._buffer[this._bufferLength++]=c[l++],u--;this._bufferLength===this.blockSize&&(i(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(u>=this.blockSize&&(l=i(this._temp,this._state,c,l,u),u%=this.blockSize);u>0;)this._buffer[this._bufferLength++]=c[l++],u--;return this},a.prototype.finish=function(c){if(!this._finished){var u=this._bytesHashed,l=this._bufferLength,h=u/536870912|0,f=u<<3,y=u%64<56?64:128;this._buffer[l]=128;for(var d=l+1;d<y-8;d++)this._buffer[d]=0;e.writeUint32BE(h,this._buffer,y-8),e.writeUint32BE(f,this._buffer,y-4),i(this._temp,this._state,this._buffer,0,y),this._finished=!0}for(var d=0;d<this.digestLength/4;d++)e.writeUint32BE(this._state[d],c,d*4);return this},a.prototype.digest=function(){var c=new Uint8Array(this.digestLength);return this.finish(c),c},a.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},a.prototype.restoreState=function(c){return this._state.set(c.state),this._bufferLength=c.bufferLength,c.buffer&&this._buffer.set(c.buffer),this._bytesHashed=c.bytesHashed,this._finished=!1,this},a.prototype.cleanSavedState=function(c){t.wipe(c.state),c.buffer&&t.wipe(c.buffer),c.bufferLength=0,c.bytesHashed=0},a}();r.SHA256=n;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function i(a,c,u,l,h){for(;h>=64;){for(var f=c[0],y=c[1],d=c[2],p=c[3],b=c[4],w=c[5],S=c[6],E=c[7],m=0;m<16;m++){var v=l+m*4;a[m]=e.readUint32BE(u,v)}for(var m=16;m<64;m++){var A=a[m-2],g=(A>>>17|A<<32-17)^(A>>>19|A<<32-19)^A>>>10;A=a[m-15];var _=(A>>>7|A<<32-7)^(A>>>18|A<<32-18)^A>>>3;a[m]=(g+a[m-7]|0)+(_+a[m-16]|0)}for(var m=0;m<64;m++){var g=(((b>>>6|b<<26)^(b>>>11|b<<21)^(b>>>25|b<<7))+(b&w^~b&S)|0)+(E+(s[m]+a[m]|0)|0)|0,_=((f>>>2|f<<32-2)^(f>>>13|f<<32-13)^(f>>>22|f<<32-22))+(f&y^f&d^y&d)|0;E=S,S=w,w=b,b=p+g|0,p=d,d=y,y=f,f=g+_|0}c[0]+=f,c[1]+=y,c[2]+=d,c[3]+=p,c[4]+=b,c[5]+=w,c[6]+=S,c[7]+=E,l+=64,h-=64}return l}function o(a){var c=new n;c.update(a);var u=c.digest();return c.clean(),u}r.hash=o})(m7);var rp={},$3={};Object.defineProperty($3,"__esModule",{value:!0});var Sn=Ce,E7=no,iet=20;function oet(r,e,t){for(var n=1634760805,s=857760878,i=2036477234,o=1797285236,a=t[3]<<24|t[2]<<16|t[1]<<8|t[0],c=t[7]<<24|t[6]<<16|t[5]<<8|t[4],u=t[11]<<24|t[10]<<16|t[9]<<8|t[8],l=t[15]<<24|t[14]<<16|t[13]<<8|t[12],h=t[19]<<24|t[18]<<16|t[17]<<8|t[16],f=t[23]<<24|t[22]<<16|t[21]<<8|t[20],y=t[27]<<24|t[26]<<16|t[25]<<8|t[24],d=t[31]<<24|t[30]<<16|t[29]<<8|t[28],p=e[3]<<24|e[2]<<16|e[1]<<8|e[0],b=e[7]<<24|e[6]<<16|e[5]<<8|e[4],w=e[11]<<24|e[10]<<16|e[9]<<8|e[8],S=e[15]<<24|e[14]<<16|e[13]<<8|e[12],E=n,m=s,v=i,A=o,g=a,_=c,$=u,x=l,k=h,j=f,G=y,Q=d,V=p,ne=b,W=w,ue=S,Me=0;Me<iet;Me+=2)E=E+g|0,V^=E,V=V>>>32-16|V<<16,k=k+V|0,g^=k,g=g>>>32-12|g<<12,m=m+_|0,ne^=m,ne=ne>>>32-16|ne<<16,j=j+ne|0,_^=j,_=_>>>32-12|_<<12,v=v+$|0,W^=v,W=W>>>32-16|W<<16,G=G+W|0,$^=G,$=$>>>32-12|$<<12,A=A+x|0,ue^=A,ue=ue>>>32-16|ue<<16,Q=Q+ue|0,x^=Q,x=x>>>32-12|x<<12,v=v+$|0,W^=v,W=W>>>32-8|W<<8,G=G+W|0,$^=G,$=$>>>32-7|$<<7,A=A+x|0,ue^=A,ue=ue>>>32-8|ue<<8,Q=Q+ue|0,x^=Q,x=x>>>32-7|x<<7,m=m+_|0,ne^=m,ne=ne>>>32-8|ne<<8,j=j+ne|0,_^=j,_=_>>>32-7|_<<7,E=E+g|0,V^=E,V=V>>>32-8|V<<8,k=k+V|0,g^=k,g=g>>>32-7|g<<7,E=E+_|0,ue^=E,ue=ue>>>32-16|ue<<16,G=G+ue|0,_^=G,_=_>>>32-12|_<<12,m=m+$|0,V^=m,V=V>>>32-16|V<<16,Q=Q+V|0,$^=Q,$=$>>>32-12|$<<12,v=v+x|0,ne^=v,ne=ne>>>32-16|ne<<16,k=k+ne|0,x^=k,x=x>>>32-12|x<<12,A=A+g|0,W^=A,W=W>>>32-16|W<<16,j=j+W|0,g^=j,g=g>>>32-12|g<<12,v=v+x|0,ne^=v,ne=ne>>>32-8|ne<<8,k=k+ne|0,x^=k,x=x>>>32-7|x<<7,A=A+g|0,W^=A,W=W>>>32-8|W<<8,j=j+W|0,g^=j,g=g>>>32-7|g<<7,m=m+$|0,V^=m,V=V>>>32-8|V<<8,Q=Q+V|0,$^=Q,$=$>>>32-7|$<<7,E=E+_|0,ue^=E,ue=ue>>>32-8|ue<<8,G=G+ue|0,_^=G,_=_>>>32-7|_<<7;Sn.writeUint32LE(E+n|0,r,0),Sn.writeUint32LE(m+s|0,r,4),Sn.writeUint32LE(v+i|0,r,8),Sn.writeUint32LE(A+o|0,r,12),Sn.writeUint32LE(g+a|0,r,16),Sn.writeUint32LE(_+c|0,r,20),Sn.writeUint32LE($+u|0,r,24),Sn.writeUint32LE(x+l|0,r,28),Sn.writeUint32LE(k+h|0,r,32),Sn.writeUint32LE(j+f|0,r,36),Sn.writeUint32LE(G+y|0,r,40),Sn.writeUint32LE(Q+d|0,r,44),Sn.writeUint32LE(V+p|0,r,48),Sn.writeUint32LE(ne+b|0,r,52),Sn.writeUint32LE(W+w|0,r,56),Sn.writeUint32LE(ue+S|0,r,60)}function YK(r,e,t,n,s){if(s===void 0&&(s=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<t.length)throw new Error("ChaCha: destination is shorter than source");var i,o;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");i=new Uint8Array(16),o=i.length-e.length,i.set(e,o)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");i=e,o=s}for(var a=new Uint8Array(64),c=0;c<t.length;c+=64){oet(a,i,r);for(var u=c;u<c+64&&u<t.length;u++)n[u]=t[u]^a[u-c];cet(i,0,o)}return E7.wipe(a),s===0&&E7.wipe(i),n}$3.streamXOR=YK;function aet(r,e,t,n){return n===void 0&&(n=0),E7.wipe(t),YK(r,e,t,t,n)}$3.stream=aet;function cet(r,e,t){for(var n=1;t--;)n=n+(r[e]&255)|0,r[e]=n&255,n>>>=8,e++;if(n>0)throw new Error("ChaCha: counter overflow")}var XK={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Yc,t=no;r.DIGEST_LENGTH=16;var n=function(){function o(a){this.digestLength=r.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var c=a[0]|a[1]<<8;this._r[0]=c&8191;var u=a[2]|a[3]<<8;this._r[1]=(c>>>13|u<<3)&8191;var l=a[4]|a[5]<<8;this._r[2]=(u>>>10|l<<6)&7939;var h=a[6]|a[7]<<8;this._r[3]=(l>>>7|h<<9)&8191;var f=a[8]|a[9]<<8;this._r[4]=(h>>>4|f<<12)&255,this._r[5]=f>>>1&8190;var y=a[10]|a[11]<<8;this._r[6]=(f>>>14|y<<2)&8191;var d=a[12]|a[13]<<8;this._r[7]=(y>>>11|d<<5)&8065;var p=a[14]|a[15]<<8;this._r[8]=(d>>>8|p<<8)&8191,this._r[9]=p>>>5&127,this._pad[0]=a[16]|a[17]<<8,this._pad[1]=a[18]|a[19]<<8,this._pad[2]=a[20]|a[21]<<8,this._pad[3]=a[22]|a[23]<<8,this._pad[4]=a[24]|a[25]<<8,this._pad[5]=a[26]|a[27]<<8,this._pad[6]=a[28]|a[29]<<8,this._pad[7]=a[30]|a[31]<<8}return o.prototype._blocks=function(a,c,u){for(var l=this._fin?0:2048,h=this._h[0],f=this._h[1],y=this._h[2],d=this._h[3],p=this._h[4],b=this._h[5],w=this._h[6],S=this._h[7],E=this._h[8],m=this._h[9],v=this._r[0],A=this._r[1],g=this._r[2],_=this._r[3],$=this._r[4],x=this._r[5],k=this._r[6],j=this._r[7],G=this._r[8],Q=this._r[9];u>=16;){var V=a[c+0]|a[c+1]<<8;h+=V&8191;var ne=a[c+2]|a[c+3]<<8;f+=(V>>>13|ne<<3)&8191;var W=a[c+4]|a[c+5]<<8;y+=(ne>>>10|W<<6)&8191;var ue=a[c+6]|a[c+7]<<8;d+=(W>>>7|ue<<9)&8191;var Me=a[c+8]|a[c+9]<<8;p+=(ue>>>4|Me<<12)&8191,b+=Me>>>1&8191;var yt=a[c+10]|a[c+11]<<8;w+=(Me>>>14|yt<<2)&8191;var er=a[c+12]|a[c+13]<<8;S+=(yt>>>11|er<<5)&8191;var Kt=a[c+14]|a[c+15]<<8;E+=(er>>>8|Kt<<8)&8191,m+=Kt>>>5|l;var ce=0,xe=ce;xe+=h*v,xe+=f*(5*Q),xe+=y*(5*G),xe+=d*(5*j),xe+=p*(5*k),ce=xe>>>13,xe&=8191,xe+=b*(5*x),xe+=w*(5*$),xe+=S*(5*_),xe+=E*(5*g),xe+=m*(5*A),ce+=xe>>>13,xe&=8191;var je=ce;je+=h*A,je+=f*v,je+=y*(5*Q),je+=d*(5*G),je+=p*(5*j),ce=je>>>13,je&=8191,je+=b*(5*k),je+=w*(5*x),je+=S*(5*$),je+=E*(5*_),je+=m*(5*g),ce+=je>>>13,je&=8191;var et=ce;et+=h*g,et+=f*A,et+=y*v,et+=d*(5*Q),et+=p*(5*G),ce=et>>>13,et&=8191,et+=b*(5*j),et+=w*(5*k),et+=S*(5*x),et+=E*(5*$),et+=m*(5*_),ce+=et>>>13,et&=8191;var it=ce;it+=h*_,it+=f*g,it+=y*A,it+=d*v,it+=p*(5*Q),ce=it>>>13,it&=8191,it+=b*(5*G),it+=w*(5*j),it+=S*(5*k),it+=E*(5*x),it+=m*(5*$),ce+=it>>>13,it&=8191;var dt=ce;dt+=h*$,dt+=f*_,dt+=y*g,dt+=d*A,dt+=p*v,ce=dt>>>13,dt&=8191,dt+=b*(5*Q),dt+=w*(5*G),dt+=S*(5*j),dt+=E*(5*k),dt+=m*(5*x),ce+=dt>>>13,dt&=8191;var gt=ce;gt+=h*x,gt+=f*$,gt+=y*_,gt+=d*g,gt+=p*A,ce=gt>>>13,gt&=8191,gt+=b*v,gt+=w*(5*Q),gt+=S*(5*G),gt+=E*(5*j),gt+=m*(5*k),ce+=gt>>>13,gt&=8191;var vt=ce;vt+=h*k,vt+=f*x,vt+=y*$,vt+=d*_,vt+=p*g,ce=vt>>>13,vt&=8191,vt+=b*A,vt+=w*v,vt+=S*(5*Q),vt+=E*(5*G),vt+=m*(5*j),ce+=vt>>>13,vt&=8191;var $t=ce;$t+=h*j,$t+=f*k,$t+=y*x,$t+=d*$,$t+=p*_,ce=$t>>>13,$t&=8191,$t+=b*g,$t+=w*A,$t+=S*v,$t+=E*(5*Q),$t+=m*(5*G),ce+=$t>>>13,$t&=8191;var xt=ce;xt+=h*G,xt+=f*j,xt+=y*k,xt+=d*x,xt+=p*$,ce=xt>>>13,xt&=8191,xt+=b*_,xt+=w*g,xt+=S*A,xt+=E*v,xt+=m*(5*Q),ce+=xt>>>13,xt&=8191;var Lt=ce;Lt+=h*Q,Lt+=f*G,Lt+=y*j,Lt+=d*k,Lt+=p*x,ce=Lt>>>13,Lt&=8191,Lt+=b*$,Lt+=w*_,Lt+=S*g,Lt+=E*A,Lt+=m*v,ce+=Lt>>>13,Lt&=8191,ce=(ce<<2)+ce|0,ce=ce+xe|0,xe=ce&8191,ce=ce>>>13,je+=ce,h=xe,f=je,y=et,d=it,p=dt,b=gt,w=vt,S=$t,E=xt,m=Lt,c+=16,u-=16}this._h[0]=h,this._h[1]=f,this._h[2]=y,this._h[3]=d,this._h[4]=p,this._h[5]=b,this._h[6]=w,this._h[7]=S,this._h[8]=E,this._h[9]=m},o.prototype.finish=function(a,c){c===void 0&&(c=0);var u=new Uint16Array(10),l,h,f,y;if(this._leftover){for(y=this._leftover,this._buffer[y++]=1;y<16;y++)this._buffer[y]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(l=this._h[1]>>>13,this._h[1]&=8191,y=2;y<10;y++)this._h[y]+=l,l=this._h[y]>>>13,this._h[y]&=8191;for(this._h[0]+=l*5,l=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=l,l=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=l,u[0]=this._h[0]+5,l=u[0]>>>13,u[0]&=8191,y=1;y<10;y++)u[y]=this._h[y]+l,l=u[y]>>>13,u[y]&=8191;for(u[9]-=8192,h=(l^1)-1,y=0;y<10;y++)u[y]&=h;for(h=~h,y=0;y<10;y++)this._h[y]=this._h[y]&h|u[y];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,f=this._h[0]+this._pad[0],this._h[0]=f&65535,y=1;y<8;y++)f=(this._h[y]+this._pad[y]|0)+(f>>>16)|0,this._h[y]=f&65535;return a[c+0]=this._h[0]>>>0,a[c+1]=this._h[0]>>>8,a[c+2]=this._h[1]>>>0,a[c+3]=this._h[1]>>>8,a[c+4]=this._h[2]>>>0,a[c+5]=this._h[2]>>>8,a[c+6]=this._h[3]>>>0,a[c+7]=this._h[3]>>>8,a[c+8]=this._h[4]>>>0,a[c+9]=this._h[4]>>>8,a[c+10]=this._h[5]>>>0,a[c+11]=this._h[5]>>>8,a[c+12]=this._h[6]>>>0,a[c+13]=this._h[6]>>>8,a[c+14]=this._h[7]>>>0,a[c+15]=this._h[7]>>>8,this._finished=!0,this},o.prototype.update=function(a){var c=0,u=a.length,l;if(this._leftover){l=16-this._leftover,l>u&&(l=u);for(var h=0;h<l;h++)this._buffer[this._leftover+h]=a[c+h];if(u-=l,c+=l,this._leftover+=l,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(u>=16&&(l=u-u%16,this._blocks(a,c,l),c+=l,u-=l),u){for(var h=0;h<u;h++)this._buffer[this._leftover+h]=a[c+h];this._leftover+=u}return this},o.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var a=new Uint8Array(16);return this.finish(a),a},o.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},o}();r.Poly1305=n;function s(o,a){var c=new n(o);c.update(a);var u=c.digest();return c.clean(),u}r.oneTimeAuth=s;function i(o,a){return o.length!==r.DIGEST_LENGTH||a.length!==r.DIGEST_LENGTH?!1:e.equal(o,a)}r.equal=i})(XK);(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=$3,t=XK,n=no,s=Ce,i=Yc;r.KEY_LENGTH=32,r.NONCE_LENGTH=12,r.TAG_LENGTH=16;var o=new Uint8Array(16),a=function(){function c(u){if(this.nonceLength=r.NONCE_LENGTH,this.tagLength=r.TAG_LENGTH,u.length!==r.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(u)}return c.prototype.seal=function(u,l,h,f){if(u.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var y=new Uint8Array(16);y.set(u,y.length-u.length);var d=new Uint8Array(32);e.stream(this._key,y,d,4);var p=l.length+this.tagLength,b;if(f){if(f.length!==p)throw new Error("ChaCha20Poly1305: incorrect destination length");b=f}else b=new Uint8Array(p);return e.streamXOR(this._key,y,l,b,4),this._authenticate(b.subarray(b.length-this.tagLength,b.length),d,b.subarray(0,b.length-this.tagLength),h),n.wipe(y),b},c.prototype.open=function(u,l,h,f){if(u.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(l.length<this.tagLength)return null;var y=new Uint8Array(16);y.set(u,y.length-u.length);var d=new Uint8Array(32);e.stream(this._key,y,d,4);var p=new Uint8Array(this.tagLength);if(this._authenticate(p,d,l.subarray(0,l.length-this.tagLength),h),!i.equal(p,l.subarray(l.length-this.tagLength,l.length)))return null;var b=l.length-this.tagLength,w;if(f){if(f.length!==b)throw new Error("ChaCha20Poly1305: incorrect destination length");w=f}else w=new Uint8Array(b);return e.streamXOR(this._key,y,l.subarray(0,l.length-this.tagLength),w,4),n.wipe(y),w},c.prototype.clean=function(){return n.wipe(this._key),this},c.prototype._authenticate=function(u,l,h,f){var y=new t.Poly1305(l);f&&(y.update(f),f.length%16>0&&y.update(o.subarray(f.length%16))),y.update(h),h.length%16>0&&y.update(o.subarray(h.length%16));var d=new Uint8Array(8);f&&s.writeUint64LE(f.length,d),y.update(d),s.writeUint64LE(h.length,d),y.update(d);for(var p=y.digest(),b=0;b<p.length;b++)u[b]=p[b];y.clean(),n.wipe(p),n.wipe(d)},c}();r.ChaCha20Poly1305=a})(rp);const uet={hashSHA256(r){return m7.hash(r)},getHKDF(r,e){const s=new PZe(m7.SHA256,e,r).expand(96),i=s.subarray(0,32),o=s.subarray(32,64),a=s.subarray(64,96);return[i,o,a]},generateX25519KeyPair(){const r=F2.generateKeyPair();return{publicKey:r.publicKey,privateKey:r.secretKey}},generateX25519KeyPairFromSeed(r){const e=F2.generateKeyPairFromSeed(r);return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519SharedKey(r,e){return F2.sharedKey(r,e)},chaCha20Poly1305Encrypt(r,e,t,n){return new rp.ChaCha20Poly1305(n).seal(e,r,t)},chaCha20Poly1305Decrypt(r,e,t,n,s){return new rp.ChaCha20Poly1305(n).open(e,r,t,s)}},het=r=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r),Cw=r=>{const e=het(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,r,!1),e};Cw.bytes=2;const V2=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");return r instanceof Uint8Array?new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,!1):r.getUint16(0)};V2.bytes=2;function det(r){return z([r.ne,r.ciphertext],r.ne.length+r.ciphertext.length)}function fet(r){return z([r.ne,r.ns,r.ciphertext],r.ne.length+r.ns.length+r.ciphertext.length)}function pet(r){return z([r.ns,r.ciphertext],r.ns.length+r.ciphertext.length)}function yet(r){if(r.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:r.subarray(0,32),ciphertext:r.subarray(32,r.length),ns:new Uint8Array(0)}}function get(r){if(r.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:r.subarray(0,32),ns:r.subarray(32,80),ciphertext:r.subarray(80,r.length)}}function wet(r){if(r.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:r.subarray(0,48),ciphertext:r.subarray(48,r.length)}}function bet(r,e){return async function*(t){for await(const n of t)for(let s=0;s<n.length;s+=YP){let i=s+YP;i>n.length&&(i=n.length);const o=r.encrypt(n.subarray(s,i),r.session);e?.encryptedPackets.increment(),yield Cw(o.byteLength),yield o}}}function met(r,e){return async function*(t){for await(const n of t)for(let s=0;s<n.length;s+=tp){let i=s+tp;if(i>n.length&&(i=n.length),i-rp.TAG_LENGTH<s)throw new Error("Invalid chunk");const o=n.subarray(s,i),a=n.subarray(s,i-rp.TAG_LENGTH),{plaintext:c,valid:u}=r.decrypt(o,r.session,a);if(!u)throw e?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e?.decryptedPackets.increment(),yield c}}}class xw extends Error{constructor(e="Unexpected Peer"){super(e),this.code=xw.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class rh extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=rh.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}var Dw;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={webtransportCerthashes:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.webtransportCerthashes.push(t.bytes());break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(Dw||(Dw={}));var Pw;(function(r){let e;r.codec=()=>(e==null&&(e=zr((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),(s.writeDefaults===!0||t.identityKey!=null&&t.identityKey.byteLength>0)&&(n.uint32(10),n.bytes(t.identityKey??new Uint8Array(0))),(s.writeDefaults===!0||t.identitySig!=null&&t.identitySig.byteLength>0)&&(n.uint32(18),n.bytes(t.identitySig??new Uint8Array(0))),t.extensions!=null&&(n.uint32(34),Dw.codec().encode(t.extensions,n,{writeDefaults:!1})),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.identityKey=t.bytes();break;case 2:s.identitySig=t.bytes();break;case 4:s.extensions=Dw.codec().decode(t,t.uint32());break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>Fr(t,r.codec()),r.decode=t=>Vr(t,r.codec())})(Pw||(Pw={}));async function Eet(r,e,t){const n=await _et(r,JK(e));if(r.publicKey==null)throw new Error("PublicKey was missing from local PeerId");return vet(r.publicKey,n,t)}function vet(r,e,t){return Pw.encode({identityKey:r,identitySig:e,extensions:t??{webtransportCerthashes:[]}}).subarray()}async function _et(r,e){if(r.privateKey==null)throw new Error("PrivateKey was missing from PeerId");return await(await ba(r.privateKey)).sign(e)}async function eO(r){return await vi(r.identityKey)}function tO(r){return Pw.decode(r)}function JK(r){const e=M("noise-libp2p-static-key:");return z([e,r],e.length+r.length)}async function rO(r,e,t){const n=await vi(e.identityKey);if(!n.equals(t))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${t.toString()}`);const s=JK(r);if(n.publicKey==null)throw new Error("PublicKey was missing from PeerId");if(e.identitySig==null)throw new Error("Signature was missing from message");if(!await Fl(n.publicKey).verify(s,e.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function h2(r){return!(!(r instanceof Uint8Array)||r.length!==32)}const Qn=U("libp2p:noise");let pi;_Ze?pi=Qn:pi=Object.assign(()=>{},{enabled:!1,trace:()=>{},error:()=>{}});function Aet(r){pi(`LOCAL_STATIC_PUBLIC_KEY ${R(r.publicKey,"hex")}`),pi(`LOCAL_STATIC_PRIVATE_KEY ${R(r.privateKey,"hex")}`)}function nO(r){r?(pi(`LOCAL_PUBLIC_EPHEMERAL_KEY ${R(r.publicKey,"hex")}`),pi(`LOCAL_PRIVATE_EPHEMERAL_KEY ${R(r.privateKey,"hex")}`)):pi("Missing local ephemeral keys.")}function $et(r){pi(`REMOTE_STATIC_PUBLIC_KEY ${R(r,"hex")}`)}function sO(r){pi(`REMOTE_EPHEMERAL_PUBLIC_KEY ${R(r,"hex")}`)}function Tet(r){r.cs1&&r.cs2?(pi(`CIPHER_STATE_1 ${r.cs1.n.getUint64()} ${R(r.cs1.k,"hex")}`),pi(`CIPHER_STATE_2 ${r.cs2.n.getUint64()} ${R(r.cs2.k,"hex")}`)):pi("Missing cipher state.")}const Iet=0,Ret=4294967295,Cet="Cipherstate has reached maximum n, a new handshake must be performed";class xet{constructor(e=Iet){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>Ret)throw new Error(Cet)}}class Det{constructor(e){this.crypto=e}encryptWithAd(e,t,n){const s=this.encrypt(e.k,e.n,t,n);return e.n.increment(),s}decryptWithAd(e,t,n,s){const{plaintext:i,valid:o}=this.decrypt(e.k,e.n,t,n,s);return o&&e.n.increment(),{plaintext:i,valid:o}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){const t=this.createEmptyKey();return Ie(t,e)}encrypt(e,t,n,s){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(s,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return this.hasKey(e.cs)?n=this.encryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,n),n}decrypt(e,t,n,s,i){t.assertValue();const o=this.crypto.chaCha20Poly1305Decrypt(s,t.getBytes(),n,e,i);return o?{plaintext:o,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let n,s=!0;return this.hasKey(e.cs)?{plaintext:n,valid:s}=this.decryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,t),{plaintext:n,valid:s}}dh(e,t){try{const n=this.crypto.generateX25519SharedKey(e,t);return n.length===32?n:n.subarray(0,32)}catch(n){const s=n;return Qn.error(s),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(z([e,t],e.length+t.length))}mixKey(e,t){const[n,s]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(s),e.ck=n}initializeKey(e){return{k:e,n:new xet}}initializeSymmetric(e){const t=M(e,"utf-8"),n=this.hashProtocolName(t),s=n,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:s,h:n}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}else return this.getHash(e,new Uint8Array(0))}split(e){const[t,n]=this.crypto.getHKDF(e.ck,new Uint8Array(0)),s=this.initializeKey(t),i=this.initializeKey(n);return{cs1:s,cs2:i}}writeMessageRegular(e,t){const n=this.encryptWithAd(e,new Uint8Array(0),t),s=this.createEmptyKey(),i=new Uint8Array(0);return{ne:s,ns:i,ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class Pet extends Det{initializeInitiator(e,t,n,s){const i="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(i);this.mixHash(o,e);const a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:s,re:a}}initializeResponder(e,t,n,s){const i="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(i);this.mixHash(o,e);const a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:s,re:a}}writeMessageA(e,t,n){const s=new Uint8Array(0);n!==void 0?e.e=n:e.e=this.crypto.generateX25519KeyPair();const i=e.e.publicKey;this.mixHash(e.ss,i);const o=this.encryptAndHash(e.ss,t);return{ne:i,ns:s,ciphertext:o}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const s=e.s.publicKey,i=this.encryptAndHash(e.ss,s);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const o=this.encryptAndHash(e.ss,t);return{ne:n,ns:i,ciphertext:o}}writeMessageC(e,t){const n=e.s.publicKey,s=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t),a={ne:this.createEmptyKey(),ns:s,ciphertext:i},{cs1:c,cs2:u}=this.split(e.ss);return{h:e.ss.h,messageBuffer:a,cs1:c,cs2:u}}readMessageA(e,t){return h2(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(h2(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:n,valid:s}=this.decryptAndHash(e.ss,t.ns);s&&h2(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:s&&o}}readMessageC(e,t){const{plaintext:n,valid:s}=this.decryptAndHash(e.ss,t.ns);if(s&&h2(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:a,cs2:c}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:s&&o,cs1:a,cs2:c}}initSession(e,t,n){const s=this.createEmptyKey(),i=new Uint8Array(32);let o;return e?o=this.initializeInitiator(t,n,i,s):o=this.initializeResponder(t,n,i,s),{hs:o,i:e,mc:0}}sendMessage(e,t,n){let s;if(e.mc===0)s=this.writeMessageA(e.hs,t,n);else if(e.mc===1)s=this.writeMessageB(e.hs,t);else if(e.mc===2){const{h:i,messageBuffer:o,cs1:a,cs2:c}=this.writeMessageC(e.hs,t);s=o,e.h=i,e.cs1=a,e.cs2=c}else if(e.mc>2)if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");s=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");s=this.writeMessageRegular(e.cs2,t)}else throw new Error("Session invalid.");return e.mc++,s}recvMessage(e,t){let n=new Uint8Array(0),s=!1;if(e.mc===0)({plaintext:n,valid:s}=this.readMessageA(e.hs,t));else if(e.mc===1)({plaintext:n,valid:s}=this.readMessageB(e.hs,t));else if(e.mc===2){const{h:i,plaintext:o,valid:a,cs1:c,cs2:u}=this.readMessageC(e.hs,t);n=o,s=a,e.h=i,e.cs1=c,e.cs2=u}return e.mc++,{plaintext:n,valid:s}}}class Oet{constructor(e,t,n,s,i,o,a,c){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=n,this.staticKeypair=i,this.connection=o,a&&(this.remotePeer=a),this.xx=c??new Pet(s),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(Aet(this.session.hs.s),this.isInitiator){Qn.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(det(e)),Qn.trace("Stage 0 - Initiator finished sending first message."),nO(this.session.hs.e)}else{Qn.trace("Stage 0 - Responder waiting to receive first message...");const e=yet((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new rh("xx handshake stage 0 validation fail");Qn.trace("Stage 0 - Responder received first message."),sO(this.session.hs.re)}}async exchange(){if(this.isInitiator){Qn.trace("Stage 1 - Initiator waiting to receive first message from responder...");const e=get((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new rh("xx handshake stage 1 validation fail");Qn.trace("Stage 1 - Initiator received the message."),sO(this.session.hs.re),$et(this.session.hs.rs),Qn.trace("Initiator going to check remote's signature...");try{const s=tO(t);this.remotePeer=this.remotePeer||await eO(s),await rO(this.session.hs.rs,s,this.remotePeer),this.setRemoteNoiseExtension(s.extensions)}catch(s){const i=s;throw new xw(`Error occurred while verifying signed payload: ${i.message}`)}Qn.trace("All good with the signature!")}else{Qn.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(fet(e)),Qn.trace("Stage 1 - Responder sent the second handshake message with signed payload."),nO(this.session.hs.e)}}async finish(){if(this.isInitiator){Qn.trace("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(pet(e)),Qn.trace("Stage 2 - Initiator sent message with signed payload.")}else{Qn.trace("Stage 2 - Responder waiting for third handshake message...");const e=wet((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new rh("xx handshake stage 2 validation fail");Qn.trace("Stage 2 - Responder received the message, finished handshake.");try{const s=tO(t);this.remotePeer=this.remotePeer||await eO(s),await rO(this.session.hs.rs,s,this.remotePeer),this.setRemoteNoiseExtension(s.extensions)}catch(s){const i=s;throw new xw(`Error occurred while verifying signed payload: ${i.message}`)}}Tet(this.session)}encrypt(e,t){const n=this.getCS(t);return this.xx.encryptWithAd(n,new Uint8Array(0),e)}decrypt(e,t,n){const s=this.getCS(t,!1);return this.xx.decryptWithAd(s,new Uint8Array(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new rh("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}function ket(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}class Net{constructor(e={}){this.protocol="/noise";const{staticNoiseKey:t,extensions:n,crypto:s,prologueBytes:i,metrics:o}=e;this.crypto=s??uet,this.extensions=n,this.metrics=o?ket(o):void 0,t?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(t):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=i??new Uint8Array(0)}async secureOutbound(e,t,n){const s=WP(t,{lengthEncoder:Cw,lengthDecoder:V2,maxDataLength:tp}),i=await this.performHandshake({connection:s,isInitiator:!0,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(s,i),remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,n){const s=WP(t,{lengthEncoder:Cw,lengthDecoder:V2,maxDataLength:tp}),i=await this.performHandshake({connection:s,isInitiator:!1,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(s,i),remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){const t=await Eet(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:n,remotePeer:s,connection:i}=e,o=new Oet(n,t,this.prologue,this.crypto,this.staticKeys,i,s);try{await o.propose(),await o.exchange(),await o.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){if(this.metrics?.xxHandshakeErrors.increment(),a instanceof Error)throw a.message=`Error occurred during XX handshake: ${a.message}`,a}return o}async createSecureConnection(e,t){const[n,s]=mZe(),i=e.unwrap();return await Ve(n,bet(t,this.metrics),i,p7({lengthDecoder:V2}),met(t,this.metrics),n),s}}function ZK(r={}){return()=>new Net(r)}const Let=kt.bind({ignoreUndefined:!0,concatArrays:!0});function X_({options:r={},peerId:e,multiaddrs:t=[],repo:n,keychainConfig:s={},config:i={}}){const{datastore:o}=n,a=Met({options:r,config:i,datastore:o,keychainConfig:s,peerId:e,multiaddrs:t});return typeof r.libp2p=="function"?r.libp2p({libp2pOptions:a,options:r,config:i,datastore:o,peerId:e}):(a.start=!1,qWe(a))}function Met({options:r,config:e,datastore:t,keychainConfig:n,peerId:s,multiaddrs:i}){const o=()=>{const y=Be(e,"Pubsub.Router")||"gossipsub",d=T$e();if(!d[y])throw T(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${y} router.`),"ERR_NOT_SUPPORTED");return d[y]},a={datastore:t,peerId:s},c={addresses:{listen:i.map(y=>y.toString()),announce:Be(r,"addresses.announce",Be(e,"Addresses.Announce",[])),noAnnounce:Be(r,"addresses.noAnnounce",Be(e,"Addresses.NoAnnounce",[]))},connectionManager:Be(r,"connectionManager",{maxConnections:Be(r,"config.Swarm.ConnMgr.HighWater",Be(e,"Swarm.ConnMgr.HighWater")),minConnections:Be(r,"config.Swarm.ConnMgr.LowWater",Be(e,"Swarm.ConnMgr.LowWater"))}),keychain:n,identify:{host:{agentVersion:`js-ipfs/${Zy}`}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[bZe({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[ZK()],relay:{enabled:Be(r,"relay.enabled",Be(e,"relay.enabled",!0)),hop:{enabled:Be(r,"relay.hop.enabled",Be(e,"relay.hop.enabled",!1)),active:Be(r,"relay.hop.active",Be(e,"relay.hop.active",!1))}},nat:{enabled:!Be(e,"Swarm.DisableNatPortMap",!1)}};Be(r,"config.Pubsub.Enabled",Be(e,"Pubsub.Enabled",!0))&&(c.pubsub=o()),Be(e,"Routing.Type","dhtclient")!=="none"&&(c.dht=mJe({clientMode:Be(e,"Routing.Type","dht")!=="dhtserver",kBucketSize:Be(r,"dht.kBucketSize",20),validators:{ipns:sv},selectors:{ipns:YL}}));const u=Be(r,"config.Bootstrap",Be(e,"Bootstrap",[]));u.length>0&&c.peerDiscovery?.push(DJe({list:u}));let l=Be(r,"libp2p",void 0);typeof l=="function"&&(l=void 0);const h=Let(a,UBe(),c,l),f=Be(r,"config.Addresses.Delegates",Be(e,"Addresses.Delegates",[]));if(f.length>0){const y=f[Math.floor(Math.random()*f.length)],d=ld(y).toOptions(),p={host:d.host,protocol:parseInt(d.port)===443?"https":"http",port:d.port},b=Oke(p);h.contentRouters?.push(mRe(b)),h.peerRouters?.push(ZIe(b))}return Be(r,"config.Discovery.MDNS.Enabled",Be(e,"Discovery.MDNS.Enabled",!0))||(h.peerDiscovery=h.peerDiscovery?.filter(y=>{try{if(typeof y=="function")return y({})[Symbol.toStringTag]!=="@libp2p/mdns"}catch{}return!0})),h.transports==null&&(h.transports=[]),h.transports.find(y=>{try{if(typeof y=="function")return y({})[Symbol.toStringTag]==="@libp2p/websockets"}catch{}return!1})==null&&h.transports.push(ZJe()),h}const eq=kt.bind({ignoreUndefined:!0}),w1=U("ipfs:components:peer:storage");class J_{constructor(e,t,n,s,i){this.print=s,this.peerId=e,this.keychain=t,this.repo=n,this.print=s,this.isNew=i}static async start(e,t,n){const{repoAutoMigrate:s,repo:i,onMigrationProgress:o}=n,a=typeof i=="string"||i==null?uSe(e,t,{path:i,autoMigrate:s,onMigrationProgress:o}):i,{peerId:c,keychain:u,isNew:l}=await Uet(e,a,n);return new J_(c,u,a,e,l)}}const Uet=async(r,e,t)=>{if(!e.closed)return{...await iO(e,t),isNew:!1};try{return await e.open(),{...await iO(e,t),isNew:!1}}catch(n){if(n.code!==Gf)throw n;if(t.init&&t.init.allowNew===!1)throw new nd("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await Bet(r,e,t),isNew:!0}}},Bet=async(r,e,t)=>{const n=t.init||{},s=await e.exists();if(w1("repo exists?",s),s===!0)throw new Error("repo already exists");const i=n.privateKey?await zet(n.privateKey):await Fet(r,n),o=Vet(i);w1("peer identity: %s",o.PeerID);const a={...eq(tq(ch(),n.profiles),t.config),Identity:o};await e.init(a),await e.open(),w1("repo opened");const c={pass:t.pass};try{c.dek=await e.config.get("Keychain.DEK")}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}const u=await X_({options:void 0,multiaddrs:void 0,peerId:i,repo:e,config:a,keychainConfig:c});return await e.datastore.has(new be("/info/self"))||await u.keychain.importPeer("self",i),await e.config.set("Keychain",{DEK:u.keychain.init.dek}),{peerId:i,keychain:u.keychain}},zet=async r=>{if(w1("using user-supplied private-key"),ua(r))return r;const e=M(r,"base64pad"),t=await ba(e);return await vi(t.public.bytes,t.bytes)},Fet=(r,{algorithm:e="Ed25519",bits:t=2048})=>{if(r("generating %s keypair...",e),e==="Ed25519")return iK();if(e==="RSA")return DWe({bits:t});throw T(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},Vet=r=>{if(r.privateKey==null)throw T(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:r.toString(),PrivKey:R(r.privateKey,"base64pad")}},iO=async(r,e)=>{const t=e.config,n=e.init&&e.init.profiles||[],s=e.pass,i=await r.config.getAll(),o=jet(tq(i,n),t);if(i!==o&&await r.config.replace(o),!o.Identity||!o.Identity.PrivKey)throw new bp("No private key was found in the config, please intialize the repo");const a=M(o.Identity.PrivKey,"base64pad"),c=await ba(a),u=await vi(c.public.bytes,c.bytes),l=await X_({options:void 0,multiaddrs:void 0,peerId:u,repo:r,config:o,keychainConfig:{pass:s,...o.Keychain}});return{peerId:u,keychain:l.keychain}},jet=(r,e)=>e?eq(r,e):r,tq=(r,e)=>(e||[]).reduce((t,n)=>{const s=eg[n];if(!s)throw new Error(`Could not find profile with name '${n}'`);return w1("applying profile %s",n),s.transform(t)},r);var Ket=rq,oO=128,qet=127,Het=~qet,Get=Math.pow(2,31);function rq(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Get;)e[t++]=r&255|oO,r/=128;for(;r&Het;)e[t++]=r&255|oO,r>>>=7;return e[t]=r|0,rq.bytes=t-n+1,e}var Wet=v7,Qet=128,aO=127;function v7(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw v7.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&aO)<<s:(o&aO)*Math.pow(2,s),s+=7}while(o>=Qet);return v7.bytes=i-n,t}var Yet=Math.pow(2,7),Xet=Math.pow(2,14),Jet=Math.pow(2,21),Zet=Math.pow(2,28),ett=Math.pow(2,35),ttt=Math.pow(2,42),rtt=Math.pow(2,49),ntt=Math.pow(2,56),stt=Math.pow(2,63),itt=function(r){return r<Yet?1:r<Xet?2:r<Jet?3:r<Zet?4:r<ett?5:r<ttt?6:r<rtt?7:r<ntt?8:r<stt?9:10},ott={encode:Ket,decode:Wet,encodingLength:itt},Ow=ott;const _7=(r,e=0)=>[Ow.decode(r,e),Ow.decode.bytes],kw=(r,e,t=0)=>(Ow.encode(r,e,t),e),Nw=r=>Ow.encodingLength(r),att=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Z_=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},S7=(r,e)=>{const t=e.byteLength,n=Nw(r),s=n+Nw(t),i=new Uint8Array(s+t);return kw(r,i,0),kw(t,i,n),i.set(e,s),new eS(r,t,e,i)},ctt=r=>{const e=Z_(r),[t,n]=_7(e),[s,i]=_7(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new eS(t,s,o,e)},ltt=(r,e)=>{if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&att(r.bytes,t.bytes)}};class eS{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}}function utt(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var htt=utt,dtt=htt;let ftt=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ptt=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return nq(this,e)}},ytt=class{constructor(e){this.decoders=e}or(e){return nq(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const nq=(r,e)=>new ytt({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let gtt=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new ftt(e,t,n),this.decoder=new ptt(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const sq=({name:r,prefix:e,encode:t,decode:n})=>new gtt(r,e,t,n),iq=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=dtt(t,e);return sq({prefix:r,name:e,encode:n,decode:i=>Z_(s(i))})},wtt=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},btt=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ra=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>sq({prefix:e,name:r,encode(s){return btt(s,n,t)},decode(s){return wtt(s,n,t,r)}}),Ft=iq({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});iq({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const j2=Ra({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ra({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ra({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ra({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ra({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ra({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ra({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ra({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ra({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const cO=(r,e)=>{const{bytes:t,version:n}=r;switch(n){case 0:return Ett(t,A7(r),e||Ft.encoder);default:return vtt(t,A7(r),e||j2.encoder)}},lO=new WeakMap,A7=r=>{const e=lO.get(r);if(e==null){const t=new Map;return lO.set(r,t),t}return e};class It{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Uf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==_tt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return It.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=S7(e,t);return It.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return It.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&ltt(e.multihash,n.multihash)}toString(e){return cO(this,e)}toJSON(){return{"/":cO(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof It)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new It(n,s,i,o||uO(n,s,i.bytes))}else if(t[Stt]===!0){const{version:n,multihash:s,code:i}=t,o=ctt(s);return It.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Uf)throw new Error(`Version 0 CID must use dag-pb (code: ${Uf}) block encoding`);return new It(e,t,n,n.bytes)}case 1:{const s=uO(e,t,n.bytes);return new It(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return It.create(0,Uf,e)}static createV1(e,t){return It.create(1,e,t)}static decode(e){const[t,n]=It.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=It.inspectBytes(e),n=t.size-t.multihashSize,s=Z_(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new eS(t.multihashCode,t.digestSize,i,s);return[t.version===0?It.createV0(o):It.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,f]=_7(e.subarray(t));return t+=f,h};let s=n(),i=Uf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),u=t+c,l=u-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){const[n,s]=mtt(e,t),i=It.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return A7(i).set(n,e),i}}const mtt=(r,e)=>{switch(r[0]){case"Q":{const t=e||Ft;return[Ft.prefix,t.decode(`${Ft.prefix}${r}`)]}case Ft.prefix:{const t=e||Ft;return[Ft.prefix,t.decode(r)]}case j2.prefix:{const t=e||j2;return[j2.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Ett=(r,e,t)=>{const{prefix:n}=t;if(n!==Ft.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s},vtt=(r,e,t)=>{const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s},Uf=112,_tt=18,uO=(r,e,t)=>{const n=Nw(r),s=n+Nw(e),i=new Uint8Array(s+t.byteLength);return kw(r,i,0),kw(e,i,n),i.set(t,s),i},Stt=Symbol.for("@ipld/js-cid/CID"),Att=({name:r,code:e,encode:t})=>new $tt(r,e,t);class $tt{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?S7(this.code,t):t.then(n=>S7(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Ttt=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Cm=Att({name:"sha2-256",code:18,encode:Ttt("SHA-256")});var Itt=oq,hO=128,Rtt=127,Ctt=~Rtt,xtt=Math.pow(2,31);function oq(r,e,t){e=e||[],t=t||0;for(var n=t;r>=xtt;)e[t++]=r&255|hO,r/=128;for(;r&Ctt;)e[t++]=r&255|hO,r>>>=7;return e[t]=r|0,oq.bytes=t-n+1,e}var Dtt=$7,Ptt=128,dO=127;function $7(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw $7.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&dO)<<s:(o&dO)*Math.pow(2,s),s+=7}while(o>=Ptt);return $7.bytes=i-n,t}var Ott=Math.pow(2,7),ktt=Math.pow(2,14),Ntt=Math.pow(2,21),Ltt=Math.pow(2,28),Mtt=Math.pow(2,35),Utt=Math.pow(2,42),Btt=Math.pow(2,49),ztt=Math.pow(2,56),Ftt=Math.pow(2,63),Vtt=function(r){return r<Ott?1:r<ktt?2:r<Ntt?3:r<Ltt?4:r<Mtt?5:r<Utt?6:r<Btt?7:r<ztt?8:r<Ftt?9:10},jtt={encode:Itt,decode:Dtt,encodingLength:Vtt};const fO=jtt;var Ktt=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=fO.decode(r);e.push(t),r=r.slice(fO.decode.bytes)}return e};const qtt=Et(Ktt);function Htt(r){let e=new Uint8Array(r.reduce((n,s)=>n+P.encodingLength(s),0)),t=0;for(const n of r)e=HO.encode(n,e,t),t+=P.encodingLength(n);return e}class aq{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(Ft)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}}const uo=le.Reader,Bf=le.Writer,We=le.util,Ue=le.roots["ipfs-bitswap"]||(le.roots["ipfs-bitswap"]={}),Ji=Ue.Message=(()=>{function r(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.wantlist=null,r.prototype.blocks=We.emptyArray,r.prototype.payload=We.emptyArray,r.prototype.blockPresences=We.emptyArray,r.prototype.pendingBytes=0,r.encode=function(t,n){if(n||(n=Bf.create()),t.wantlist!=null&&Object.hasOwnProperty.call(t,"wantlist")&&Ue.Message.Wantlist.encode(t.wantlist,n.uint32(10).fork()).ldelim(),t.blocks!=null&&t.blocks.length)for(var s=0;s<t.blocks.length;++s)n.uint32(18).bytes(t.blocks[s]);if(t.payload!=null&&t.payload.length)for(var s=0;s<t.payload.length;++s)Ue.Message.Block.encode(t.payload[s],n.uint32(26).fork()).ldelim();if(t.blockPresences!=null&&t.blockPresences.length)for(var s=0;s<t.blockPresences.length;++s)Ue.Message.BlockPresence.encode(t.blockPresences[s],n.uint32(34).fork()).ldelim();return t.pendingBytes!=null&&Object.hasOwnProperty.call(t,"pendingBytes")&&n.uint32(40).int32(t.pendingBytes),n},r.decode=function(t,n){t instanceof uo||(t=uo.create(t));for(var s=n===void 0?t.len:t.pos+n,i=new Ue.Message;t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:{i.wantlist=Ue.Message.Wantlist.decode(t,t.uint32());break}case 2:{i.blocks&&i.blocks.length||(i.blocks=[]),i.blocks.push(t.bytes());break}case 3:{i.payload&&i.payload.length||(i.payload=[]),i.payload.push(Ue.Message.Block.decode(t,t.uint32()));break}case 4:{i.blockPresences&&i.blockPresences.length||(i.blockPresences=[]),i.blockPresences.push(Ue.Message.BlockPresence.decode(t,t.uint32()));break}case 5:{i.pendingBytes=t.int32();break}default:t.skipType(o&7);break}}return i},r.fromObject=function(t){if(t instanceof Ue.Message)return t;var n=new Ue.Message;if(t.wantlist!=null){if(typeof t.wantlist!="object")throw TypeError(".Message.wantlist: object expected");n.wantlist=Ue.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");n.blocks=[];for(var s=0;s<t.blocks.length;++s)typeof t.blocks[s]=="string"?We.base64.decode(t.blocks[s],n.blocks[s]=We.newBuffer(We.base64.length(t.blocks[s])),0):t.blocks[s].length>=0&&(n.blocks[s]=t.blocks[s])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");n.payload=[];for(var s=0;s<t.payload.length;++s){if(typeof t.payload[s]!="object")throw TypeError(".Message.payload: object expected");n.payload[s]=Ue.Message.Block.fromObject(t.payload[s])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");n.blockPresences=[];for(var s=0;s<t.blockPresences.length;++s){if(typeof t.blockPresences[s]!="object")throw TypeError(".Message.blockPresences: object expected");n.blockPresences[s]=Ue.Message.BlockPresence.fromObject(t.blockPresences[s])}}return t.pendingBytes!=null&&(n.pendingBytes=t.pendingBytes|0),n},r.toObject=function(t,n){n||(n={});var s={};if((n.arrays||n.defaults)&&(s.blocks=[],s.payload=[],s.blockPresences=[]),n.defaults&&(s.wantlist=null,s.pendingBytes=0),t.wantlist!=null&&t.hasOwnProperty("wantlist")&&(s.wantlist=Ue.Message.Wantlist.toObject(t.wantlist,n)),t.blocks&&t.blocks.length){s.blocks=[];for(var i=0;i<t.blocks.length;++i)s.blocks[i]=n.bytes===String?We.base64.encode(t.blocks[i],0,t.blocks[i].length):n.bytes===Array?Array.prototype.slice.call(t.blocks[i]):t.blocks[i]}if(t.payload&&t.payload.length){s.payload=[];for(var i=0;i<t.payload.length;++i)s.payload[i]=Ue.Message.Block.toObject(t.payload[i],n)}if(t.blockPresences&&t.blockPresences.length){s.blockPresences=[];for(var i=0;i<t.blockPresences.length;++i)s.blockPresences[i]=Ue.Message.BlockPresence.toObject(t.blockPresences[i],n)}return t.pendingBytes!=null&&t.hasOwnProperty("pendingBytes")&&(s.pendingBytes=t.pendingBytes),s},r.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},r.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Message"},r.Wantlist=function(){function e(t){if(this.entries=[],t)for(var n=Object.keys(t),s=0;s<n.length;++s)t[n[s]]!=null&&(this[n[s]]=t[n[s]])}return e.prototype.entries=We.emptyArray,e.prototype.full=!1,e.encode=function(n,s){if(s||(s=Bf.create()),n.entries!=null&&n.entries.length)for(var i=0;i<n.entries.length;++i)Ue.Message.Wantlist.Entry.encode(n.entries[i],s.uint32(10).fork()).ldelim();return n.full!=null&&Object.hasOwnProperty.call(n,"full")&&s.uint32(16).bool(n.full),s},e.decode=function(n,s){n instanceof uo||(n=uo.create(n));for(var i=s===void 0?n.len:n.pos+s,o=new Ue.Message.Wantlist;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:{o.entries&&o.entries.length||(o.entries=[]),o.entries.push(Ue.Message.Wantlist.Entry.decode(n,n.uint32()));break}case 2:{o.full=n.bool();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof Ue.Message.Wantlist)return n;var s=new Ue.Message.Wantlist;if(n.entries){if(!Array.isArray(n.entries))throw TypeError(".Message.Wantlist.entries: array expected");s.entries=[];for(var i=0;i<n.entries.length;++i){if(typeof n.entries[i]!="object")throw TypeError(".Message.Wantlist.entries: object expected");s.entries[i]=Ue.Message.Wantlist.Entry.fromObject(n.entries[i])}}return n.full!=null&&(s.full=!!n.full),s},e.toObject=function(n,s){s||(s={});var i={};if((s.arrays||s.defaults)&&(i.entries=[]),s.defaults&&(i.full=!1),n.entries&&n.entries.length){i.entries=[];for(var o=0;o<n.entries.length;++o)i.entries[o]=Ue.Message.Wantlist.Entry.toObject(n.entries[o],s)}return n.full!=null&&n.hasOwnProperty("full")&&(i.full=n.full),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Wantlist"},e.WantType=function(){const t={},n=Object.create(t);return n[t[0]="Block"]=0,n[t[1]="Have"]=1,n}(),e.Entry=function(){function t(n){if(n)for(var s=Object.keys(n),i=0;i<s.length;++i)n[s[i]]!=null&&(this[s[i]]=n[s[i]])}return t.prototype.block=We.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(s,i){return i||(i=Bf.create()),s.block!=null&&Object.hasOwnProperty.call(s,"block")&&i.uint32(10).bytes(s.block),s.priority!=null&&Object.hasOwnProperty.call(s,"priority")&&i.uint32(16).int32(s.priority),s.cancel!=null&&Object.hasOwnProperty.call(s,"cancel")&&i.uint32(24).bool(s.cancel),s.wantType!=null&&Object.hasOwnProperty.call(s,"wantType")&&i.uint32(32).int32(s.wantType),s.sendDontHave!=null&&Object.hasOwnProperty.call(s,"sendDontHave")&&i.uint32(40).bool(s.sendDontHave),i},t.decode=function(s,i){s instanceof uo||(s=uo.create(s));for(var o=i===void 0?s.len:s.pos+i,a=new Ue.Message.Wantlist.Entry;s.pos<o;){var c=s.uint32();switch(c>>>3){case 1:{a.block=s.bytes();break}case 2:{a.priority=s.int32();break}case 3:{a.cancel=s.bool();break}case 4:{a.wantType=s.int32();break}case 5:{a.sendDontHave=s.bool();break}default:s.skipType(c&7);break}}return a},t.fromObject=function(s){if(s instanceof Ue.Message.Wantlist.Entry)return s;var i=new Ue.Message.Wantlist.Entry;switch(s.block!=null&&(typeof s.block=="string"?We.base64.decode(s.block,i.block=We.newBuffer(We.base64.length(s.block)),0):s.block.length>=0&&(i.block=s.block)),s.priority!=null&&(i.priority=s.priority|0),s.cancel!=null&&(i.cancel=!!s.cancel),s.wantType){case"Block":case 0:i.wantType=0;break;case"Have":case 1:i.wantType=1;break}return s.sendDontHave!=null&&(i.sendDontHave=!!s.sendDontHave),i},t.toObject=function(s,i){i||(i={});var o={};return i.defaults&&(i.bytes===String?o.block="":(o.block=[],i.bytes!==Array&&(o.block=We.newBuffer(o.block))),o.priority=0,o.cancel=!1,o.wantType=i.enums===String?"Block":0,o.sendDontHave=!1),s.block!=null&&s.hasOwnProperty("block")&&(o.block=i.bytes===String?We.base64.encode(s.block,0,s.block.length):i.bytes===Array?Array.prototype.slice.call(s.block):s.block),s.priority!=null&&s.hasOwnProperty("priority")&&(o.priority=s.priority),s.cancel!=null&&s.hasOwnProperty("cancel")&&(o.cancel=s.cancel),s.wantType!=null&&s.hasOwnProperty("wantType")&&(o.wantType=i.enums===String?Ue.Message.Wantlist.WantType[s.wantType]:s.wantType),s.sendDontHave!=null&&s.hasOwnProperty("sendDontHave")&&(o.sendDontHave=s.sendDontHave),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},t.getTypeUrl=function(s){return s===void 0&&(s="type.googleapis.com"),s+"/Message.Wantlist.Entry"},t}(),e}(),r.Block=function(){function e(t){if(t)for(var n=Object.keys(t),s=0;s<n.length;++s)t[n[s]]!=null&&(this[n[s]]=t[n[s]])}return e.prototype.prefix=We.newBuffer([]),e.prototype.data=We.newBuffer([]),e.encode=function(n,s){return s||(s=Bf.create()),n.prefix!=null&&Object.hasOwnProperty.call(n,"prefix")&&s.uint32(10).bytes(n.prefix),n.data!=null&&Object.hasOwnProperty.call(n,"data")&&s.uint32(18).bytes(n.data),s},e.decode=function(n,s){n instanceof uo||(n=uo.create(n));for(var i=s===void 0?n.len:n.pos+s,o=new Ue.Message.Block;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:{o.prefix=n.bytes();break}case 2:{o.data=n.bytes();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof Ue.Message.Block)return n;var s=new Ue.Message.Block;return n.prefix!=null&&(typeof n.prefix=="string"?We.base64.decode(n.prefix,s.prefix=We.newBuffer(We.base64.length(n.prefix)),0):n.prefix.length>=0&&(s.prefix=n.prefix)),n.data!=null&&(typeof n.data=="string"?We.base64.decode(n.data,s.data=We.newBuffer(We.base64.length(n.data)),0):n.data.length>=0&&(s.data=n.data)),s},e.toObject=function(n,s){s||(s={});var i={};return s.defaults&&(s.bytes===String?i.prefix="":(i.prefix=[],s.bytes!==Array&&(i.prefix=We.newBuffer(i.prefix))),s.bytes===String?i.data="":(i.data=[],s.bytes!==Array&&(i.data=We.newBuffer(i.data)))),n.prefix!=null&&n.hasOwnProperty("prefix")&&(i.prefix=s.bytes===String?We.base64.encode(n.prefix,0,n.prefix.length):s.bytes===Array?Array.prototype.slice.call(n.prefix):n.prefix),n.data!=null&&n.hasOwnProperty("data")&&(i.data=s.bytes===String?We.base64.encode(n.data,0,n.data.length):s.bytes===Array?Array.prototype.slice.call(n.data):n.data),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.Block"},e}(),r.BlockPresenceType=function(){const e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),r.BlockPresence=function(){function e(t){if(t)for(var n=Object.keys(t),s=0;s<n.length;++s)t[n[s]]!=null&&(this[n[s]]=t[n[s]])}return e.prototype.cid=We.newBuffer([]),e.prototype.type=0,e.encode=function(n,s){return s||(s=Bf.create()),n.cid!=null&&Object.hasOwnProperty.call(n,"cid")&&s.uint32(10).bytes(n.cid),n.type!=null&&Object.hasOwnProperty.call(n,"type")&&s.uint32(16).int32(n.type),s},e.decode=function(n,s){n instanceof uo||(n=uo.create(n));for(var i=s===void 0?n.len:n.pos+s,o=new Ue.Message.BlockPresence;n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:{o.cid=n.bytes();break}case 2:{o.type=n.int32();break}default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof Ue.Message.BlockPresence)return n;var s=new Ue.Message.BlockPresence;switch(n.cid!=null&&(typeof n.cid=="string"?We.base64.decode(n.cid,s.cid=We.newBuffer(We.base64.length(n.cid)),0):n.cid.length>=0&&(s.cid=n.cid)),n.type){case"Have":case 0:s.type=0;break;case"DontHave":case 1:s.type=1;break}return s},e.toObject=function(n,s){s||(s={});var i={};return s.defaults&&(s.bytes===String?i.cid="":(i.cid=[],s.bytes!==Array&&(i.cid=We.newBuffer(i.cid))),i.type=s.enums===String?"Have":0),n.cid!=null&&n.hasOwnProperty("cid")&&(i.cid=s.bytes===String?We.base64.encode(n.cid,0,n.cid.length):s.bytes===Array?Array.prototype.slice.call(n.cid):n.cid),n.type!=null&&n.hasOwnProperty("type")&&(i.type=s.enums===String?Ue.Message.BlockPresenceType[n.type]:n.type),i},e.prototype.toJSON=function(){return this.constructor.toObject(this,le.util.toJSONOptions)},e.getTypeUrl=function(n){return n===void 0&&(n="type.googleapis.com"),n+"/Message.BlockPresence"},e}(),r})(),pO={Block:Ji.Wantlist.WantType.Block,Have:Ji.Wantlist.WantType.Have},Gtt=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{const s=r(t),i=r(n);return s<i?-1:s>i?1:0});class h0{constructor(e,t){this.set=t?Xl({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){const s=e.toString(Ft),i=this.set.get(s);i?(i.inc(),i.priority=t,i.wantType===pO.Have&&n===pO.Block&&(i.wantType=n)):(this.set.set(s,new aq(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){const t=e.toString(Ft),n=this.set.get(t);n&&(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(Gtt(e=>e[1].key,Array.from(this.set.entries())))}contains(e){const t=e.toString(Ft);return this.set.has(t)}get(e){const t=e.toString(Ft);return this.set.get(t)}}h0.Entry=aq;const Wtt=h0.Entry;class Lw{constructor(e,t,n,s,i){this.entry=new Wtt(e,t,n),this.cancel=!!s,this.sendDontHave=!!i}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(Ft)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}}const Ed=(r,e)=>{const t=["bitswap"];return e&&t.push(e),r&&t.push(`${r.toString().slice(0,8)}`),U(t.join(":"))},xm=(r,e)=>{if(r.size!==e.size)return!1;for(const[t,n]of r){const s=e.get(t);if(s===void 0||n instanceof Uint8Array&&s instanceof Uint8Array&&!Ie(n,s)||n instanceof Lw&&s instanceof Lw&&!n.equals(s))return!1}return!0};class Vt{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,s,i){n==null&&(n=Vt.WantType.Block);const o=e.toString(Ft),a=this.wantlist.get(o);a?(a.wantType===n&&(a.priority=t),s&&(a.cancel=!!s),i&&(a.sendDontHave=!!i),n===Vt.WantType.Block&&a.wantType===Vt.WantType.Have&&(a.wantType=n)):this.wantlist.set(o,new Lw(e,t,n,s,i))}addBlock(e,t){const n=e.toString(Ft);this.blocks.set(n,t)}addHave(e){const t=e.toString(Ft);this.blockPresences.has(t)||this.blockPresences.set(t,Vt.BlockPresenceType.Have)}addDontHave(e){const t=e.toString(Ft);this.blockPresences.has(t)||this.blockPresences.set(t,Vt.BlockPresenceType.DontHave)}cancel(e){const t=e.toString(Ft);this.wantlist.delete(t),this.addEntry(e,0,Vt.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:!!t.cancel})),full:this.full?!0:void 0},blocks:Array.from(this.blocks.values())};return Ji.encode(e).finish()}serializeToBitswap110(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:!!t.cancel,sendDontHave:!!t.sendDontHave})),full:this.full?!0:void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(const[t,n]of this.blocks.entries()){const s=It.parse(t),i=s.version,o=s.code,a=s.multihash.code,c=s.multihash.digest.length,u=Htt([i,o,a,c]);e.payload.push(new Ji.Block({prefix:u,data:n}))}for(const[t,n]of this.blockPresences)e.blockPresences.push(new Ji.BlockPresence({cid:It.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),Ji.encode(e).finish()}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!xm(this.wantlist,e.wantlist)||!xm(this.blocks,e.blocks)||!xm(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){const e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}}Vt.deserialize=async(r,e)=>{const t=Ji.decode(r),n=t.wantlist&&t.wantlist.full||!1,s=new Vt(n);return t.wantlist&&t.wantlist.entries&&t.wantlist.entries.forEach(i=>{if(!i.block)return;const o=It.decode(i.block);s.addEntry(o,i.priority||0,i.wantType,!!i.cancel,!!i.sendDontHave)}),t.blockPresences&&t.blockPresences.forEach(i=>{if(!i.cid)return;const o=It.decode(i.cid);i.type===Vt.BlockPresenceType.Have?s.addHave(o):s.addDontHave(o)}),t.blocks.length>0?(await Promise.all(t.blocks.map(async i=>{const o=await Cm.digest(i),a=It.createV0(o);s.addBlock(a,i)})),s):(t.payload.length>0&&(await Promise.all(t.payload.map(async i=>{if(!i.prefix||!i.data)return;const o=qtt(i.prefix),a=o[0],c=o[1],u=o[2],l=u===Cm.code?Cm:e&&await e.getHasher(u);if(!l)throw new L("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");const h=await l.digest(i.data),f=It.create(a,c,h);s.addBlock(f,i.data)})),s.setPendingBytes(t.pendingBytes)),s)};Vt.blockPresenceSize=r=>r.bytes.length+1;Vt.Entry=Lw;Vt.WantType={Block:Ji.Wantlist.WantType.Block,Have:Ji.Wantlist.WantType.Have};Vt.BlockPresenceType={Have:Ji.BlockPresenceType.Have,DontHave:Ji.BlockPresenceType.DontHave};const Qtt=3,Ytt=Math.pow(2,31)-1,Xtt=1e3,Jtt=1;var Ztt=ert;function ert(r,e,t){var n=null,s=null,i=function(){n&&(clearTimeout(n),s=null,n=null)},o=function(){var c=s;i(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,u=arguments,l=t&&!n;if(i(),s=function(){r.apply(c,u)},n=setTimeout(function(){if(n=null,!l){var h=s;return s=null,h()}},e),l)return s()};return a.cancel=i,a.flush=o,a}class trt{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=Ed(e,"msgqueue"),this.sendEntries=Ztt(this._sendEntries.bind(this),Jtt)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;const e=new Vt(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(t){this._log.error("cant connect to peer %s: %s",this.peerId.toString(),t.message);return}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,e).catch(t=>{this._log.error("send error: %s",t.message)})}}class rrt{constructor(e,t,n,s){this.peers=Xl({name:"ipfs_bitswap_want_manager_peers",metrics:s.metrics}),this.wantlist=new h0(n,s),this.network=t,this._stats=n,this._peerId=e,this._log=Ed(e,"want")}_addEntries(e,t,n){const s=e.map((i,o)=>new Vt.Entry(i,Ytt-o,Vt.WantType.Block,t));s.forEach(i=>{i.cancel?n?this.wantlist.removeForce(i.cid.toString(Ft)):this.wantlist.remove(i.cid):(this._log("adding to wl"),this.wantlist.add(i.cid,i.priority))});for(const i of this.peers.values())i.addEntries(s)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t){t.refcnt++;return}t=new trt(this._peerId,e,this.network);const n=new Vt(!0);for(const s of this.wantlist.entries())n.addEntry(s[1].cid,s[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toString());t&&(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>this.disconnected(e.peerId))}}function nrt(r){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}const T3=r=>{const e=Jt.encodingLength(r),t=nrt(e);return Jt.encode(r,t),T3.bytes=e,t};T3.bytes=0;function cq(r){r=r??{};const e=r.lengthEncoder??T3;return async function*(n){for await(const s of n){const i=e(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}}}cq.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??T3;return new Se(t(r.byteLength),r)};const srt=8,irt=1024*1024*4;var yl;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(yl||(yl={}));const tS=r=>{const e=Jt.decode(r);return tS.bytes=Jt.encodingLength(e),e};tS.bytes=0;function T7(r){return async function*(t){const n=new Se;let s=yl.LENGTH,i=-1;const o=r?.lengthDecoder??tS,a=r?.maxLengthLength??srt,c=r?.maxDataLength??irt;for await(const u of t)for(n.append(u);n.byteLength>0;){if(s===yl.LENGTH)try{if(i=o(n),i<0)throw T(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>c)throw T(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const l=o.bytes;n.consume(l),r?.onLength!=null&&r.onLength(i),s=yl.DATA}catch(l){if(l instanceof RangeError){if(n.byteLength>a)throw T(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(s===yl.DATA){if(n.byteLength<i)break;const l=n.sublist(0,i);n.consume(i),r?.onData!=null&&r.onData(l),yield l,s=yl.LENGTH}}if(n.byteLength>0)throw T(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}T7.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return T7({...e??{},onLength:i=>{t=i}})(n)};class yO extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function ort(r,e,t){const n=t??{},s=Vc(r);async function*i(){let o;const a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){const{abortMessage:l,abortCode:h}=n;throw new yO(l,h)}const u=new Promise((l,h)=>{o=()=>{const{abortMessage:f,abortCode:y}=n;h(new yO(f,y))}});c=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);const l=u.type==="aborted"&&e.aborted;if(l&&n.onAbort!=null&&await n.onAbort(r),typeof s.return=="function")try{const h=s.return();h instanceof Promise&&h.catch(f=>{n.onReturnError!=null&&n.onReturnError(f)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(l&&n.returnOnAbort===!0)return;throw u}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}const I7="/ipfs/bitswap/1.0.0",R7="/ipfs/bitswap/1.1.0",C7="/ipfs/bitswap/1.2.0",art=32,crt=128,lrt=3e4;let urt=class{constructor(e,t,n,s={}){this._log=Ed(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[I7],s.b100Only||(this._protocols.unshift(R7),this._protocols.unshift(C7)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=s.hashLoader,this._maxInboundStreams=s.maxInboundStreams??art,this._maxOutboundStreams=s.maxOutboundStreams??crt,this._incomingStreamTimeout=s.incomingStreamTimeout??lrt}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});const e=f9({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(const t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach(t=>{this._onPeerConnect(t.remotePeer)})}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),this._registrarIds!=null){for(const e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection({stream:e,connection:t}){if(!this._running)return;const n=new Xt.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then(async()=>{this._log("incoming new bitswap %s connection from %p",e.stat.protocol,t.remotePeer),await Ve(ort(e.source,n.signal),T7(),async s=>{for await(const i of s){try{const o=await Vt.deserialize(i.subarray(),this._hashLoader);await this._bitswap._receiveMessage(t.remotePeer,o)}catch(o){this._bitswap._receiveError(o);break}n.reset()}})}).catch(s=>{this._log(s),e.abort(s)}).finally(()=>{n.clear(),e.close()})}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){const n=[];let s=0;for await(const i of this.findProviders(e,t))if(this._log(`connecting to provider ${i.id}`),n.push(this.connectTo(i.id,t).catch(o=>{this._log.error(o)})),s++,s===Qtt)break;await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");const n=e.toString();this._log("sendMessage to %s",n,t);const i=await(await this._libp2p.dial(e)).newStream([C7,R7,I7]);await hrt(i,t,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){const n=e.toString();if(this._stats){for(const s of t.values())this._stats.push(n,"dataSent",s.length);this._stats.push(n,"blocksSent",t.size)}}};async function hrt(r,e,t){try{let n;switch(r.stat.protocol){case I7:n=e.serializeToBitswap100();break;case R7:case C7:n=e.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+r.stat.protocol)}await Ve([n],cq(),r)}catch(n){t(n)}finally{r.close()}}class drt{constructor(e){this.partner=e,this.wantlist=new h0,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class lq extends Map{constructor(e,t){super(),this._cmp=t||this._defaultSort,this._keys=[];for(const[n,s]of e||[])this.set(n,s)}update(e){if(e<0||e>=this._keys.length)return;const t=this._keys[e];this._keys.splice(e,1);const n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){const s=this.indexOf(e);this._keys.splice(s,1)}super.set(e,t);const n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;const t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;const t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){const s=t+n>>>1,i=this._kCmp(this._keys[s],e);if(i<0)t=s+1;else if(i>0)n=s;else return s}return t}*keys(){for(const e of this._keys)yield e}*values(){for(const e of this._keys)yield this.get(e)}*entries(){for(const e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(e)for(const n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}}const frt={hasNewInfo(){return!1},merge(){}};class prt{constructor(e=frt){this._taskMerger=e,this._byPeer=new lq([],gO.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());n||(n=new gO(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){const t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};const{tasks:n,pendingSize:s}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:s};const i=t.peerId;return t.isIdle()?this._byPeer.delete(i.toString()):this._byPeer.update(0),{peerId:i,tasks:n,pendingSize:s}}_head(){if(this._byPeer.size!==0)for(const[,e]of this._byPeer)return e}remove(e,t){const n=this._byPeer.get(t.toString());n&&n.remove(e)}tasksDone(e,t){const n=this._byPeer.get(e.toString());if(!n)return;const s=this._byPeer.indexOf(e.toString());for(const i of t)n.taskDone(i);this._byPeer.update(s)}}class gO{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new yrt,this._active=new Set}pushTasks(e){for(const t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;const t=this._pending.get(e.topic);if(t){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){const t=[];for(const n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0;const n=[],s=this._pending.tasks();for(let i=0;i<s.length&&t<e;i++){const o=s[i];n.push(o),t+=o.size,this._pending.delete(o.topic),this._activeTotalSize+=o.size,this._active.add(o)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}}class yrt{constructor(){this._tasks=new lq([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){const n=this._tasks.get(e);if(!n)return;const s=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(s)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}}const grt={hasNewInfo(r,e){let t=!1,n=!1;for(const s of e)s.data.haveBlock&&(t=!0),s.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){const t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}},wO=Vt.WantType,wrt=16*1024,brt=1024;class mrt{constructor(e,t,n,s,i,o={}){this._log=Ed(e,"engine"),this.blockstore=t,this.network=n,this._stats=s,this._opts=this._processOpts(o),this.ledgerMap=Xl({name:"ipfs_bitswap_ledger_map",metrics:i.metrics}),this._running=!1,this._requestQueue=new prt(grt)}_processOpts(e){return{maxSizeReplaceHasWithBlock:brt,targetMessageSize:wrt,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks()})}async _processTasks(){if(!this._running)return;const{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;const s=new Vt(!1);s.setPendingBytes(n);const i=[],o=new Map;for(const c of t){const u=It.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(i.push(u),o.set(c.topic,c.data)):s.addHave(u):s.addDontHave(u)}const a=await this._getBlocks(i);for(const[c,u]of o){const l=It.parse(c),h=a.get(c);h?s.addBlock(l,h):u.sendDontHave&&s.addDontHave(l)}if(s.empty){e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e&&await this.network.sendMessage(e,s);for(const[c,u]of a.entries())e&&this.messageSent(e,It.parse(c),u)}catch(c){this._log.error(c)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(e.length){for(const t of this.ledgerMap.values())for(const n of e){const s=t.wantlistContains(n.cid);if(!s)continue;const i=n.data.length,o=this._sendAsBlock(s.wantType,i);let a=i;o||(a=Vt.blockPresenceSize(s.cid)),this._requestQueue.pushTasks(t.partner,[{topic:s.cid.toString(Ft),priority:s.priority,size:a,data:{blockSize:i,isWantBlock:o,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){const n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new h0),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}const s=[],i=[];t.wantlist.forEach(o=>{o.cancel?(n.cancelWant(o.cid),s.push(o.cid)):(n.wants(o.cid,o.priority,o.wantType),i.push(o))}),this._cancelWants(e,s),await this._addWants(e,i),this._scheduleProcessTasks()}_cancelWants(e,t){for(const n of t)this._requestQueue.remove(n.toString(Ft),e)}async _addWants(e,t){const n=await this._getBlockSizes(t.map(i=>i.cid)),s=[];for(const i of t){const o=i.cid.toString(Ft),a=n.get(o);if(a==null)i.sendDontHave&&s.push({topic:o,priority:i.priority,size:Vt.blockPresenceSize(i.cid),data:{isWantBlock:i.wantType===wO.Block,blockSize:0,haveBlock:!1,sendDontHave:i.sendDontHave}});else{const c=this._sendAsBlock(i.wantType,a);let u=a;c||(u=Vt.blockPresenceSize(i.cid)),s.push({topic:o,priority:i.priority,size:u,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:i.sendDontHave}})}this._requestQueue.pushTasks(e,s)}}_sendAsBlock(e,t){return e===wO.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){const t=await this._getBlocks(e);return new Map([...t].map(([n,s])=>[n,s.length]))}async _getBlocks(e){const t=new Map;return await Promise.all(e.map(async n=>{try{const s=await this.blockstore.get(n);t.set(n.toString(Ft),s)}catch(s){s.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,s)}})),t}_updateBlockAccounting(e,t){for(const n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){const s=this._findOrCreate(e);s.sentBytes(n.length),s.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){const t=e.toString(),n=this.ledgerMap.get(t);if(n)return n;const s=new drt(e);return this.ledgerMap.set(t,s),this._stats&&this._stats.push(t,"peerCount",1),s}start(){this._running=!0}stop(){this._running=!1}}const bO=r=>`unwant:${R(r.multihash.bytes,"base64")}`,mO=r=>`block:${R(r.multihash.bytes,"base64")}`;class Ert extends Rt.EventEmitter{constructor(e){super(),this.setMaxListeners(Xtt),this._log=Ed(e,"notif")}hasBlock(e,t){const n=mO(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");const n=mO(e),s=bO(e);return this._log(`wantBlock:${e}`),new Promise((i,o)=>{const a=()=>{this.removeListener(n,c),o(new Error(`Block for ${e} unwanted`))},c=u=>{this.removeListener(s,a),i(u)};this.once(s,a),this.once(n,c),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(s,a),o(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){const t=bO(e);this._log(t),this.emit(t)}}var uq={exports:{}};(function(r,e){const t=Math.exp;r.exports=function(s){if(typeof s!="number")throw new Error("must provide a timespan to the moving average constructor");if(s<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let i,o=0,a=0,c=0,u,l={};function h(f,y){return 1-t(-(f-y)/s)}return l.push=function(y,d){if(u){const p=h(y,u),b=d-i,w=p*b;i=p*d+(1-p)*i,o=(1-p)*(o+b*w),a=Math.sqrt(o),c=i+p*b}else i=d;u=y},l.movingAverage=function(){return i},l.variance=function(){return o},l.deviation=function(){return a},l.forecast=function(){return c},l}})(uq);var vrt=uq.exports;const EO=Et(vrt);class vO extends Rt.EventEmitter{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(s=>{(this._movingAverages[n][s]=EO(s)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){const t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){const s=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const i=s/t*1e3;let o=this._movingAverages[e];o||(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=o[a];c||(c=o[a]=EO(a)),c.push(n,i)})}_applyOp(e){const t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}}const _O={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]};class _rt extends Rt.EventEmitter{constructor(e,t=[],n=_O){super();const s=Object.assign({},_O,n);if(typeof s.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof s.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=s,this._enabled=this._options.enabled,this._global=new vO(t,s),this._global.on("update",i=>this.emit("update",i)),this._peers=Xl({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(const e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){const t=typeof e!="string"&&e.toString?e.toString():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let s=this._peers.get(e);s||(s=new vO(this._initialCounters,this._options),this._peers.set(e,s)),s.push(t,n)}}disconnected(e){const t=e.toString(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}}const Srt={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},Art=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class $rt extends h9{constructor(e,t,n={}){super(),this._libp2p=e,this._log=Ed(this.peerId),this._options=Object.assign({},Srt,n),this._stats=new _rt(e,Art,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new urt(e,this,this._stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new mrt(this.peerId,t,this.network,this._stats,e),this.wm=new rrt(this.peerId,this.network,this._stats,e),this.notifications=new Ert(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch{this._log("failed to receive message",t)}if(t.blocks.size===0)return;const n=[];for(const[s,i]of t.blocks.entries()){const o=It.parse(s);n.push({wasWanted:this.wm.wantlist.contains(o),cid:o,data:i})}this.wm.cancelWants(n.filter(({wasWanted:s})=>s).map(({cid:s})=>s)),await Promise.all(n.map(({cid:s,wasWanted:i,data:o})=>this._handleReceivedBlock(e,s,o,i)))}async _handleReceivedBlock(e,t,n,s){this._log("received block");const i=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,i),s&&await this.put(t,n)}_updateReceiveCounters(e,t,n,s){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),s&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){const n=(c,u)=>(this.wm.wantBlocks([c],u),this.notifications.wantBlock(c,u));let s=!1;const i=async(c,u)=>{try{return await this.blockstore.get(c,u)}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l;return s||(s=!0,this.network.findAndConnect(c,u).catch(h=>this._log.error(h))),n(c,u)}},o=new AbortController,a=t.signal?Io([t.signal,o.signal]):o.signal;try{return await Promise.race([this.notifications.wantBlock(e,{signal:a}),i(e,{signal:a})])}finally{o.abort()}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}unwant(e){const t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>this.notifications.unwantBlock(n))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(const{key:n,value:s}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,s),yield{key:n,value:s}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch(n=>{this._log.error("Failed to provide: %s",n.message)})}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}has(e){return this.blockstore.has(e)}}const Trt=(r,e,t={})=>new $rt(r,e,t);function Irt(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,w=0,S=d.length;w!==S&&d[w]===0;)w++,p++;for(var E=(S-w)*l+1>>>0,m=new Uint8Array(E);w!==S;){for(var v=d[w],A=0,g=E-1;(v!==0||A<b)&&g!==-1;g--,A++)v+=256*m[g]>>>0,m[g]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");b=A,w++}for(var _=E-b;_!==E&&m[_]===0;)_++;for(var $=c.repeat(p);_<E;++_)$+=r.charAt(m[_]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,w=0;d[p]===c;)b++,p++;for(var S=(d.length-p)*u+1>>>0,E=new Uint8Array(S);d[p];){var m=t[d.charCodeAt(p)];if(m===255)return;for(var v=0,A=S-1;(m!==0||v<w)&&A!==-1;A--,v++)m+=a*E[A]>>>0,E[A]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");w=v,p++}if(d[p]!==" "){for(var g=S-w;g!==S&&E[g]===0;)g++;for(var _=new Uint8Array(b+(S-g)),$=b;g!==S;)_[$++]=E[g++];return _}}}function y(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:y}}var Rrt=Irt,Crt=Rrt;const xrt=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};class Drt{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Prt{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return hq(this,e)}}class Ort{constructor(e){this.decoders=e}or(e){return hq(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const hq=(r,e)=>new Ort({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class krt{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Drt(e,t,n),this.decoder=new Prt(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const dq=({name:r,prefix:e,encode:t,decode:n})=>new krt(r,e,t,n),fq=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=Crt(t,e);return dq({prefix:r,name:e,encode:n,decode:i=>xrt(s(i))})},Nrt=(r,e,t,n)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,u=0;for(let l=0;l<i;++l){const h=s[r[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Lrt=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ca=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>dq({prefix:e,name:r,encode(s){return Lrt(s,n,t)},decode(s){return Nrt(s,n,t,r)}});Ca({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Ca({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Ca({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Ca({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Ca({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Ca({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Ca({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Ca({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Ca({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});fq({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});fq({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});class Mrt extends h9{constructor(e,t){super(),this.child=e,this.bitswap=t}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(e,t,n={}){await this.has(e)||(this.bitswap.isStarted()?await this.bitswap.put(e,t,n):await this.child.put(e,t,n))}async*putMany(e,t={}){const n=Yt(e,async({key:s})=>!await this.has(s));this.bitswap.isStarted()?yield*this.bitswap.putMany(n,t):yield*this.child.putMany(n,t)}async get(e,t={}){return!await this.has(e)&&this.bitswap.isStarted()?this.bitswap.get(e,t):this.child.get(e,t)}async*getMany(e,t={}){const n=$r({objectMode:!0}),s=$r({objectMode:!0});Promise.resolve().then(async()=>{for await(const i of e)!await this.has(i)&&this.bitswap.isStarted()?n.push(i):s.push(i);n.end(),s.end()}),yield*ys(this.bitswap.getMany(n,t),this.child.getMany(s,t))}async delete(e,t){await this.child.delete(e,t)}async*deleteMany(e,t){yield*this.child.deleteMany(e,t)}async has(e,t={}){return this.child.has(e,t)}async*query(e,t={}){yield*this.child.query(e,t)}async*queryKeys(e,t={}){yield*this.child.queryKeys(e,t)}}class rS{constructor(e,t,n,s,i){this.peerId=e,this.libp2p=t,this.bitswap=n,this.repo=s,this.blockstore=i}static async start({peerId:e,repo:t,print:n,hashers:s,options:i}){t.closed&&await t.open();const o=await t.config.getAll(),a=await X_({options:i,repo:t,peerId:e,multiaddrs:Urt(e,o),config:o,keychainConfig:void 0});await a.start();for(const l of a.getMultiaddrs())n(`Swarm listening on ${l.toString()}`);const c=Trt(a,t.blocks,{statsEnabled:!0,hashLoader:s,maxInboundStreams:1024,maxOutboundStreams:1024});await c.start();const u=new Mrt(t.blocks,c);return t.blocks=u,t.pins.blockstore=u,new rS(e,a,c,t,u)}static async stop(e){e.repo.blocks=e.blockstore.unwrap(),e.repo.pins.blockstore=e.blockstore.unwrap(),await e.bitswap.stop(),await e.libp2p.stop()}}const Urt=(r,e)=>{const t=r.toString(),n=[],s=e.Addresses&&e.Addresses.Swarm||[];for(const i of s){let o=ld(i);if(o.protoCodes().includes(Brt))throw T(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");const a=o.getPeerId();a&&a!==t&&(o=o.encapsulate(`/p2p/${t}`)),n.push(o)}return n},Brt=479;function zrt({network:r}){async function e(t={}){const n=[],{libp2p:s}=await r.use(t);return await s.peerStore.forEach(i=>{n.push({id:i.id,addrs:i.addresses.map(o=>o.multiaddr)})}),n}return Y(e)}function Frt({network:r}){async function e(t,n={}){const{libp2p:s}=await r.use(n);await s.dial(t,n)}return Y(e)}function Vrt({network:r}){async function e(t,n={}){const{libp2p:s}=await r.use(n);await s.hangUp(t)}return Y(e)}function jrt({network:r}){async function e(t={}){const{libp2p:n}=await r.use(t);return n.getMultiaddrs()}return Y(e)}function Krt({network:r}){async function e(t={}){const{libp2p:n}=await r.use(t);if(t.verbose){const i=[];for(const o of n.getConnections()){const a={addr:o.remoteAddr,peer:o.remotePeer};(t.verbose||t.direction)&&(a.direction=o.stat.direction),t.verbose&&(a.muxer=o.stat.multiplexer,a.latency="n/a",a.streams=[]),i.push(a)}return i}const s=new Map;for(const i of n.getConnections()){const o={addr:i.remoteAddr,peer:i.remotePeer};s.set(i.remotePeer.toString(),o)}return Array.from(s.values())}return Y(e)}class qrt{constructor({network:e}){this.addrs=zrt({network:e}),this.connect=Frt({network:e}),this.disconnect=Vrt({network:e}),this.localAddrs=jrt({network:e}),this.peers=Krt({network:e})}}const zf={success:!0,time:0,text:""};function Hrt({network:r}){async function*e(t,n={}){const{libp2p:s}=await r.use();n.count=n.count||10;const i=await s.peerStore.get(t);let o=i&&i.id;if(!o){yield{...zf,text:`Looking up peer ${t}`};const u=await s.peerRouting.findPeer(t);o=u&&u.id}if(!o)throw new Error("Peer was not found");yield{...zf,text:`PING ${o.toString()}`};let a=0,c=0;for(let u=0;u<n.count;u++)try{const l=await s.ping(o);c+=l,a++,yield{...zf,time:l}}catch(l){yield{...zf,success:!1,text:l.toString()}}if(a){const u=c/a;yield{...zf,text:`Average latency: ${u}ms`}}}return Y(e)}const Dm="/ipns/";function SO(r){r.startsWith(Dm)&&(r=r.substring(Dm.length));let e;if((r[0]==="1"||r[0]==="Q")&&(r=`z${r}`),r[0]==="z"&&(e=is.decode(r)),r[0]==="k"&&(e=fy.decode(r)),!e)throw new Error("Could not parse string");if(e[0]!==1&&e[1]!==114&&(e=z([[1,114],e])),e.length!==40)throw new Error("Incorrect length "+e.length);return z([M(Dm),e.subarray(2)])}function Grt({network:r,repo:e,peerId:t}){const{get:n,put:s,findProvs:i,findPeer:o,provide:a,query:c}={async*get(u,l={}){const{libp2p:h}=await zu(r,t,l),f=u instanceof Uint8Array?u:SO(u);if(h.dht==null)throw T(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.get(f,l)},async*put(u,l,h){const{libp2p:f}=await zu(r,t,h),y=u instanceof Uint8Array?u:SO(u);if(f.dht==null)throw T(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*f.dht.put(y,l,h)},async*findProvs(u,l={}){const{libp2p:h}=await zu(r,t,l);if(h.dht==null)throw T(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.findProviders(u,{signal:l.signal})},async*findPeer(u,l={}){const{libp2p:h}=await zu(r,t,l);if(h.dht==null)throw T(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.findPeer(u,{signal:l.signal})},async*provide(u,l={recursive:!1}){const{libp2p:h}=await zu(r,t,l);if(!await e.blocks.has(u))throw T(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(l.recursive)throw T(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(h.dht==null)throw T(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.provide(u)},async*query(u,l={}){const{libp2p:h}=await zu(r,t,l);let f;const y=we.asCID(u);if(y!=null?f=y.multihash.bytes:f=Ae(u.toString()).toBytes(),h.dht==null)throw T(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*h.dht.getClosestPeers(f,l)}};return{get:Y(n),put:Y(s),findProvs:Y(i),findPeer:Y(o),provide:Y(a),query:Y(c)}}const zu=async(r,e,t)=>{const n=await r.use(t);if(n.libp2p.dht!=null)return n;{const s=async function*(){yield{from:e,name:"QUERY_ERROR",type:3,error:new nd("dht not enabled")}};return{libp2p:{dht:{get:s,put:s,findProviders:s,findPeer:s,provide:s,getClosestPeers:s}}}}};function Wrt({network:r,config:e}){const t=Be(e||{},"Pubsub.Enabled",!0),n={};let s;return{subscribe:t?Y(i):Ff,unsubscribe:t?Y(o):Ff,publish:t?Y(a):Ff,ls:t?Y(c):Ff,peers:t?Y(u):Ff};async function i(l,h,f={}){const{libp2p:y}=await r.use(f);y.pubsub.subscribe(l),s==null&&(s=d=>{const p=d.detail;n[p.topic]&&n[p.topic].forEach(b=>{if(typeof b=="function"){b(p);return}b!=null&&b.handleEvent!=null&&b.handleEvent(p)})},y.pubsub.addEventListener("message",s)),h!=null&&(n[l]==null&&(n[l]=[]),n[l].push(h))}async function o(l,h,f={}){const{libp2p:y}=await r.use(f);h!=null&&n[l]!=null&&(n[l]=n[l].filter(d=>d!==h),n[l].length===0&&delete n[l]),typeof h!="function"&&delete n[l],n[l]==null&&y.pubsub.unsubscribe(l),Object.keys(n).length===0&&(y.pubsub.removeEventListener("message",s),s=void 0)}async function a(l,h,f={}){const{libp2p:y}=await r.use(f);if(!h)throw T(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await y.pubsub.publish(l,h)}async function c(l={}){const{libp2p:h}=await r.use(l);return h.pubsub.getTopics()}async function u(l,h={}){const{libp2p:f}=await r.use(h);return f.pubsub.getSubscribers(l)}}const Ff=async()=>{throw new nd("pubsub not enabled")},Qrt=kt.bind({ignoreUndefined:!0}),za=U("ipfs"),Yrt=3e4;class Xrt{constructor({print:e,storage:t,codecs:n,options:s}){const{peerId:i,repo:o,keychain:a}=t,c=ki.create(rS),u=L5e(s.preload),l=Ooe(),h=koe({network:c}),f=new afe(s),y=Object.values(Qte);(s.ipld&&s.ipld.hashers?s.ipld.hashers:[]).forEach(Q=>y.push(Q)),this.hashers=new nF({hashers:y,loadHasher:s.ipld&&s.ipld.loadHasher});const d=Object.values(lN);(s.ipld&&s.ipld.bases?s.ipld.bases:[]).forEach(Q=>d.push(Q)),this.bases=new tF({bases:d,loadBase:s.ipld&&s.ipld.loadBase});const p=new yce({repo:o,codecs:n}),b=new f0e({codecs:n,hashers:this.hashers,preload:u,repo:o}),w=new Efe({dns:l,ipns:f,repo:o,codecs:n,peerId:i,isOnline:h,keychain:a,options:s}),S=oce({repo:o,codecs:n,bases:this.bases,name:w}),E=new zme({repo:o,codecs:n,hashers:this.hashers,preload:u}),m=Object.assign(_fe({repo:o,codecs:n,resolve:S,preload:u}),{local:Rfe({repo:t.repo})}),{add:v,addAll:A,cat:g,get:_,ls:$}=new b6e({preload:u,repo:o,options:s.EXPERIMENTAL,hashers:this.hashers}),x=J8e({repo:o,preload:u,hashers:this.hashers,options:s}),k=M5e({files:x,preload:u,options:s.preload});this.preload=u,this.name=w,this.ipns=f,this.pin=p,this.resolve=S,this.block=b,this.refs=m,this.start=Bie({network:c,peerId:i,repo:o,preload:u,ipns:f,mfsPreload:k,print:e,keychain:a,hashers:this.hashers,options:s}),this.stop=zie({network:c,preload:u,mfsPreload:k,ipns:f,repo:o}),this.dht=Grt({network:c,repo:o,peerId:i}),this.pubsub=Wrt({network:c,config:s.config}),this.dns=l,this.isOnline=h,this.id=S6e({network:c,peerId:i}),this.version=v6e({repo:o}),this.bitswap=new Pfe({network:c}),this.bootstrap=new a0e({repo:o}),this.config=R6e({repo:o}),this.ping=Hrt({network:c}),this.add=v,this.addAll=A,this.cat=g,this.get=_,this.ls=$,this.dag=E,this.files=x,this.key=new o7e({keychain:a}),this.object=new g7e({preload:u,codecs:n,repo:o}),this.repo=new E7e({repo:o,hashers:this.hashers}),this.stats=new _7e({repo:o,network:c}),this.swarm=new qrt({network:c}),Object.defineProperty(this,"libp2p",{get(){const Q=c.try();return Q?Q.libp2p:void 0}});const j=()=>Promise.reject(T(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")),G=async function*(){throw T(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};this.commands=j,this.diag={cmds:j,net:j,sys:j},this.log={level:j,ls:j,tail:G},this.mount=j,this.codecs=n}async init(){throw new Bl}}const Jrt=async r=>{const e=Ct({Data:new Ot({type:"directory"}).marshal(),Links:[]}),t=await r.block.put(e,{mhtype:"sha2-256",format:"dag-pb"});return await r.pin.add(t),t},Zrt=()=>({start:!0,EXPERIMENTAL:{},preload:{enabled:!pa.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}});async function ent(r={}){r=Qrt(Zrt(),r);const e=r.init||{},t={name:e4.name,code:e4.code,encode:u=>u,decode:u=>u},n=Object.values(Yte);[kc,Ak,qk,eN,t].concat(r.ipld&&r.ipld.codecs||[]).forEach(u=>n.push(u));const s=new rF({codecs:n,loadCodec:r.ipld&&r.ipld.loadCodec}),i=r.silent?za:console.log;za("creating repo");const o=await J_.start(i,s,r);za("getting repo config");const a=await o.repo.config.getAll(),c=new Xrt({storage:o,print:i,codecs:s,options:{...r,config:a}});if(za("starting preload"),await c.preload.start(),za("starting storage"),c.ipns.startOffline(o),o.isNew&&!e.emptyRepo){const u=await Jrt(c);if(za("adding default assets"),await(c.addAll,void 0),za("initializing IPNS keyspace"),o.peerId.publicKey==null)throw T(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");const l=new Xt.TimeoutController(Yrt);try{await c.ipns.initializeKeyspace(o.peerId,M(`/ipfs/${u}`),{signal:l.signal})}finally{l.clear()}}return r.start!==!1&&(za("starting node"),await c.start()),c}const tnt=ent,Vat=Symbol.for("@libp2p/transport");var x7;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(x7||(x7={}));const rnt=async()=>{let r;return b1||OO?r=(await _d(()=>import("./configNavigateur-2bfe812d.js"),["configNavigateur-2bfe812d.js","const-340ca9ac.js","index-9d686756.js","index-02e680bf.css","index-68c6c4af.js"])).default:O7?r=(await _d(()=>import("./configTravailleur-9c9a4933.js"),["configTravailleur-9c9a4933.js","index-68c6c4af.js","index-9d686756.js","index-02e680bf.css"])).default:PO?r=(await _d(()=>import("./configlectronPrincipal-173096e5.js"),["configlectronPrincipal-173096e5.js","const-340ca9ac.js","index-9d686756.js","index-02e680bf.css","index-55978231.js","index-68c6c4af.js"])).default:DO?r=(await _d(()=>import("./configNode-4dd20121.js"),["configNode-4dd20121.js","const-340ca9ac.js","index-9d686756.js","index-02e680bf.css","index-55978231.js","index-68c6c4af.js"])).default:(console.warn("Plateforme non reconnue. On utilisera la configuration navigateur."),r=(await _d(()=>import("./configNavigateur-2bfe812d.js"),["configNavigateur-2bfe812d.js","const-340ca9ac.js","index-9d686756.js","index-02e680bf.css","index-68c6c4af.js"])).default),r},nnt=()=>({libp2p:{streamMuxers:[BG()],connectionEncryption:[ZK()],transportManager:{faultTolerance:x7.NO_FATAL}},relay:{enabled:!0,hop:{enabled:!0,active:!0}}});async function snt(r="./constl/sfip"){const e=nnt(),t=await rnt();e.repo=r;const n=kt(e,t);return await tnt(n)}const jat=Object.freeze(Object.defineProperty({__proto__:null,default:snt},Symbol.toStringTag,{value:"Module"}));export{cS as A,oe as C,Zt as E,CK as P,Se as U,TBe as W,m1 as a,B2 as b,EBe as c,Vat as d,T as e,RK as f,ot as g,n0 as h,Hit as i,jat as j,U as l,Hp as m,ZK as n,Ae as p,Z9 as r,r_ as s,ZJe as w};
//# sourceMappingURL=index-9755d31a.js.map
