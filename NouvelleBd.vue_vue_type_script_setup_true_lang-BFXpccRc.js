import{d as be,p as pe,ம as Ce,cv as ge,u as xe,n as _e,r,q as b,v as A,s as $,c as y,a as O,x as Be,w as s,b as t,V as Ve,h as a,i as Ne,e as we,z as H,t as I,ap as he,f as J,m as ye,T as Oe,W as d,X as De,M as P,c4 as X,ah as R,er as K,es as ke,F as Q,ac as Se,at as Y,eF as Z,ad as Te,j as Le,R as je,aj as Ae,bu as $e,y as Ie,bv as Pe,H as Re,I as Ue,J as qe}from"./index-C7pHU6pD.js";import{_ as Ge}from"./ChoisirStatut.vue_vue_type_script_setup_true_lang-DV5_sClQ.js";import{c as Me}from"./SélecteurNuée.vue_vue_type_script_setup_true_lang-Bo7djRRa.js";const Ee={class:"text-center"},He=be({__name:"NouvelleBd",props:{init:{}},emits:["nouvelle"],setup(ee,{emit:te}){const v=ee,ne=te,c=pe(),{$மொ:u}=Ce(),ie=ge(),{isRtl:D}=xe(),{mdAndUp:ae}=_e(),k=r(!1),l=["cheminement","gabaritBd","gabaritNuée","noms","descriptions","motsClefs","licence","licenceContenu","statut","confirmation"],o=r(v.init?.type===void 0?0:l.indexOf("statut")),le=b(()=>{switch(l[o.value]){case"cheminement":return"bds.nouvelle.titreCheminement";case"gabaritBd":return"bds.nouvelle.titreGabaritBd";case"gabaritNuée":return"bds.nouvelle.titreGabaritNuée";case"noms":return"bds.nouvelle.titreNoms";case"descriptions":return"bds.nouvelle.titreDescriptions";case"motsClefs":return"bds.nouvelle.titreMotsClefs";case"licence":return"bds.nouvelle.titreLicence";case"licenceContenu":return"bds.nouvelle.titreLicenceContenu";case"statut":return"bds.nouvelle.titreStatut";case"confirmation":return"bds.nouvelle.titreConfirmation";default:return""}}),se=b(()=>{switch(l[o.value]){case"cheminement":return"bds.nouvelle.sousTitreCheminement";case"gabaritBd":return"bds.nouvelle.sousTitreGabaritBd";case"gabaritNuée":return"bds.nouvelle.sousTitreGabaritNuée";case"noms":return"bds.nouvelle.sousTitreNoms";case"descriptions":return"bds.nouvelle.sousTitreDescriptions";case"motsClefs":return"bds.nouvelle.sousTitreMotsClefs";case"licence":return"bds.nouvelle.sousTitreLicence";case"licenceContenu":return"bds.nouvelle.sousTitreLicenceContenu";case"statut":return"bds.nouvelle.sousTitreStatut";case"confirmation":return"bds.nouvelle.sousTitreConfirmation";default:return""}}),p=r(v.init?.type),U=n=>{p.value=n,o.value=l.indexOf(n==="bd"?"gabaritBd":"gabaritNuée")},ue=()=>{p.value="nouvelle",o.value=l.indexOf("noms")},oe=()=>{switch(l[o.value]){case"gabaritBd":case"gabaritNuée":o.value=l.indexOf("licence");break;case"licence":o.value=l.indexOf(w.value?"statut":"licenceContenu");break;default:o.value++;break}},re=()=>{switch(l[o.value]){case"gabaritBd":case"gabaritNuée":case"noms":o.value=l.indexOf("cheminement");break;case"licence":o.value=l.indexOf(p.value==="bd"?"gabaritBd":p.value==="nuée"?"gabaritNuée":"motsClefs");break;case"statut":o.value=l.indexOf(w.value?"licence":"licenceContenu");break;default:o.value--;break}},q=b(()=>{switch(l[o.value]){case"cheminement":return{actif:!1,visible:!1};case"gabaritBd":return{actif:!!C.value,visible:!0};case"gabaritNuée":return{actif:!!_.value,visible:!0};case"noms":return{actif:Object.keys(g.value).length>0,visible:!0};case"licence":return{actif:!!m.value,visible:!0};case"licenceContenu":return{actif:!!f.value,visible:!0};case"confirmation":return{actif:!1,visible:!1};default:return{actif:!0,visible:!0}}}),G=b(()=>{switch(l[o.value]){case"statut":return{actif:!v.init,visible:!v.init};case"cheminement":return{actif:!1,visible:!1};case"confirmation":return{actif:!h.value,visible:!0};default:return{actif:!0,visible:!0}}}),_=r(),C=r(),M=async n=>{C.value=n},E=async n=>{const e=await c.nuées.générerSchémaBdNuée({idNuée:n,licence:"ODbl-1_0"});e&&(_.value=e,m.value=e.licence,f.value=e.licenceContenu)},B=r(!0);A(()=>{v.init&&(v.init.type==="bd"?M(v.init.id):v.init.type==="nuée"&&E(v.init.id))});const g=r({}),ce=n=>{g.value=n},V=r({}),de=n=>{V.value=n},N=r([]),W=$(c.licences.suivreLicences),m=r(),w=r(!0),f=r(),S=$(c.bds.suivreLicenceBd,{idBd:C}),x=b(()=>S.value&&W.value?.[S.value]?.conditions.includes("partageÉgal"));A(()=>{x.value&&(m.value=S.value)});const T=$(c.bds.suivreLicenceContenuBd,{idBd:C}),z=b(()=>T.value&&W.value?.[T.value]?.conditions.includes("partageÉgal"));A(()=>{z.value&&(f.value=T.value)});const L=r({statut:"active"}),F=b(()=>{if(m.value)return{licenceChoisie:m.value}}),j=r(!0),h=r(!1),ve=async()=>{h.value=!0;let n;if(p.value==="nouvelle"){if(!F.value)return;const{licenceChoisie:e}=F.value;if(n=await c.bds.créerBd({licence:e,licenceContenu:f.value}),!n)throw new Error("Bd non créée.");await c.bds.sauvegarderNomsBd({idBd:n,noms:Object.fromEntries(Object.entries(g.value))}),await c.bds.sauvegarderDescriptionsBd({idBd:n,descriptions:Object.fromEntries(Object.entries(V.value))}),await c.bds.ajouterMotsClefsBd({idBd:n,idsMotsClefs:N.value})}else if(p.value==="nuée"){if(!_.value)return;n=await c.bds.créerBdDeSchéma({schéma:_.value})}else{if(!C.value)return;n=await c.bds.copierBd({idBd:C.value,copierDonnées:B.value})}await c.bds.changerStatutBd({idBd:n,statut:L.value}),ne("nouvelle",n),me(),j.value&&ie.push(encodeURI(`/données/bd/${encodeURIComponent(n)}`))},me=()=>{g.value={},V.value={},m.value=void 0,f.value=void 0,N.value=[],o.value=0,h.value=!1,k.value=!1};return(n,e)=>(O(),y(Be,{modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=i=>k.value=i)},{activator:s(({props:i})=>[Re(n.$slots,"activateur",Ue(qe({props:i})))]),default:s(()=>[t(Ve,{class:"mx-auto","min-width":a(ae)?750:300},{default:s(()=>[t(Ne,null,{default:s(()=>[t(we,{class:"text-h5 justify-space-between"},{default:s(()=>[H("span",null,I(a(u)(le.value)),1)]),_:1}),t(he,null,{default:s(()=>[J(I(a(u)(se.value)),1)]),_:1})]),_:1}),t(ye,null,{default:s(()=>[t(Oe,{modelValue:o.value,"onUpdate:modelValue":e[13]||(e[13]=i=>o.value=i),style:{"overflow-y":"scroll"}},{default:s(()=>[(O(),y(d,{key:l.indexOf("cheminement")},{default:s(()=>[t(De,null,{default:s(()=>[t(P,{"prepend-icon":"mdi-creation-outline","append-icon":a(D)?"mdi-chevron-left":"mdi-chevron-right",title:a(u)("bds.nouvelle.créerNouvelle"),onClick:e[0]||(e[0]=()=>ue())},null,8,["append-icon","title"]),t(P,{"prepend-icon":"mdi-table","append-icon":a(D)?"mdi-chevron-left":"mdi-chevron-right",title:a(u)("bds.nouvelle.copierDeBd"),onClick:e[1]||(e[1]=()=>U("bd"))},null,8,["append-icon","title"]),t(P,{"prepend-icon":"mdi-table-multiple","append-icon":a(D)?"mdi-chevron-left":"mdi-chevron-right",title:a(u)("bds.nouvelle.copierDeNuée"),onClick:e[2]||(e[2]=()=>U("nuée"))},null,8,["append-icon","title"])]),_:1})]),_:1})),t(d,{value:l.indexOf("gabaritBd")},{default:s(()=>[t(X,{multiples:!1,onSelectionnee:e[3]||(e[3]=i=>i[0]&&M(i[0]))}),t(R,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=i=>B.value=i),label:a(u)("bds.copier.copierDonnées"),color:"primary"},null,8,["modelValue","label"])]),_:1},8,["value"]),t(d,{value:l.indexOf("gabaritNuée")},{default:s(()=>[t(Me,{multiples:!1,onSelectionnee:e[5]||(e[5]=i=>i.length&&E(i[0]))})]),_:1},8,["value"]),t(d,{value:l.indexOf("noms")},{default:s(()=>[t(K,{"texte-aucun-nom":a(u)("communs.texteAucunNom"),"indice-langue":a(u)("communs.indiceLangue"),"etiquette-nom":a(u)("communs.étiquetteNom"),"indice-nom":a(u)("bds.nouvelle.texteIndiceNom"),"noms-initiaux":g.value,"autorisation-modification":!0,onAjusterNoms:ce},null,8,["texte-aucun-nom","indice-langue","etiquette-nom","indice-nom","noms-initiaux"])]),_:1},8,["value"]),t(d,{value:l.indexOf("descriptions")},{default:s(()=>[t(K,{"texte-aucun-nom":a(u)("bds.nouvelle.texteAucuneDescription"),"indice-langue":a(u)("communs.indiceLangue"),"etiquette-nom":a(u)("bds.nouvelle.texteÉtiquetteDescription"),"indice-nom":a(u)("bds.nouvelle.texteIndiceDescription"),"noms-initiaux":V.value,"autorisation-modification":!0,longue:"",onAjusterNoms:de},null,8,["texte-aucun-nom","indice-langue","etiquette-nom","indice-nom","noms-initiaux"])]),_:1},8,["value"]),t(d,{value:5},{default:s(()=>[t(ke,{multiples:"",originaux:N.value,onSelectionnee:e[6]||(e[6]=i=>N.value=i)},null,8,["originaux"])]),_:1}),t(d,{value:l.indexOf("licence")},{default:s(()=>[x.value?(O(),y(Y,{key:0,class:"mb-4",variant:"outlined",type:"info",density:"compact",title:a(u)("licences.titrePartageÉgale"),text:a(u)("licences.infoPartageÉgale")},null,8,["title","text"])):Q("",!0),t(Z,{licence:m.value,"permission-modifier":!x.value,onChangerLicence:e[7]||(e[7]=i=>m.value=i)},null,8,["licence","permission-modifier"]),Se(t(R,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=i=>w.value=i),label:a(u)("licences.pareilPourContenu"),disabled:!!x.value,color:"primary"},null,8,["modelValue","label","disabled"]),[[Te,m.value]])]),_:1},8,["value"]),t(d,{value:l.indexOf("licenceContenu")},{default:s(()=>[z.value&&B.value?(O(),y(Y,{key:0,class:"mb-4",variant:"outlined",type:"info",density:"compact",title:a(u)("licences.titrePartageÉgale"),text:a(u)("licences.infoPartageÉgale")},null,8,["title","text"])):Q("",!0),t(Z,{licence:f.value,"permission-modifier":!x.value,onChangerLicence:e[9]||(e[9]=i=>f.value=i)},null,8,["licence","permission-modifier"])]),_:1},8,["value"]),t(d,{value:l.indexOf("statut")},{default:s(()=>[t(Ge,{initial:L.value,onChoisir:e[10]||(e[10]=i=>L.value=i)},{sélecteur:s(({choisirNouvelle:i})=>[t(X,{multiples:!1,onSelectionnee:fe=>i(fe[0])},null,8,["onSelectionnee"])]),_:1},8,["initial"])]),_:1},8,["value"]),t(d,{value:l.indexOf("confirmation")},{default:s(()=>[H("div",Ee,[t(Le,{class:"mt-3",variant:"outlined",loading:h.value,onClick:e[11]||(e[11]=()=>ve())},{default:s(()=>[J(I(a(u)("bds.nouvelle.texteBtnCréation")),1)]),_:1},8,["loading"]),t(R,{modelValue:j.value,"onUpdate:modelValue":e[12]||(e[12]=i=>j.value=i),color:"primary",label:a(u)("bds.nouvelle.ouvrirAprèsCréation")},null,8,["modelValue","label"])])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),t(je),t(Ae,null,{default:s(()=>[t($e,{visible:G.value.visible,actif:G.value.actif,onRetour:re},null,8,["visible","actif"]),t(Ie),t(Pe,{visible:q.value.visible,actif:q.value.actif,onSuivant:oe},null,8,["visible","actif"])]),_:1})]),_:1},8,["min-width"])]),_:3},8,["modelValue"]))}});export{He as _};
//# sourceMappingURL=NouvelleBd.vue_vue_type_script_setup_true_lang-BFXpccRc.js.map
